{"ast":null,"code":"import { qs, qsa } from \"./core\";\nimport Url from \"./url\";\nimport Path from \"./path\";\nexport function replaceBase(doc, section) {\n  var base;\n  var head;\n  var url = section.url;\n  var absolute = url.indexOf(\"://\") > -1;\n  if (!doc) {\n    return;\n  }\n  head = qs(doc, \"head\");\n  base = qs(head, \"base\");\n  if (!base) {\n    base = doc.createElement(\"base\");\n    head.insertBefore(base, head.firstChild);\n  }\n\n  // Fix for Safari crashing if the url doesn't have an origin\n  if (!absolute && window && window.location) {\n    url = window.location.origin + url;\n  }\n  base.setAttribute(\"href\", url);\n}\nexport function replaceCanonical(doc, section) {\n  var head;\n  var link;\n  var url = section.canonical;\n  if (!doc) {\n    return;\n  }\n  head = qs(doc, \"head\");\n  link = qs(head, \"link[rel='canonical']\");\n  if (link) {\n    link.setAttribute(\"href\", url);\n  } else {\n    link = doc.createElement(\"link\");\n    link.setAttribute(\"rel\", \"canonical\");\n    link.setAttribute(\"href\", url);\n    head.appendChild(link);\n  }\n}\nexport function replaceMeta(doc, section) {\n  var head;\n  var meta;\n  var id = section.idref;\n  if (!doc) {\n    return;\n  }\n  head = qs(doc, \"head\");\n  meta = qs(head, \"link[property='dc.identifier']\");\n  if (meta) {\n    meta.setAttribute(\"content\", id);\n  } else {\n    meta = doc.createElement(\"meta\");\n    meta.setAttribute(\"name\", \"dc.identifier\");\n    meta.setAttribute(\"content\", id);\n    head.appendChild(meta);\n  }\n}\n\n// TODO: move me to Contents\nexport function replaceLinks(contents, fn) {\n  var links = contents.querySelectorAll(\"a[href]\");\n  if (!links.length) {\n    return;\n  }\n  var base = qs(contents.ownerDocument, \"base\");\n  var location = base ? base.getAttribute(\"href\") : undefined;\n  var replaceLink = function (link) {\n    var href = link.getAttribute(\"href\");\n    if (href.indexOf(\"mailto:\") === 0) {\n      return;\n    }\n    var absolute = href.indexOf(\"://\") > -1;\n    if (absolute) {\n      link.setAttribute(\"target\", \"_blank\");\n    } else {\n      var linkUrl;\n      try {\n        linkUrl = new Url(href, location);\n      } catch (error) {\n        // NOOP\n      }\n      link.onclick = function () {\n        if (linkUrl && linkUrl.hash) {\n          fn(linkUrl.Path.path + linkUrl.hash);\n        } else if (linkUrl) {\n          fn(linkUrl.Path.path);\n        } else {\n          fn(href);\n        }\n        return false;\n      };\n    }\n  }.bind(this);\n  for (var i = 0; i < links.length; i++) {\n    replaceLink(links[i]);\n  }\n}\nexport function substitute(content, urls, replacements) {\n  urls.forEach(function (url, i) {\n    if (url && replacements[i]) {\n      // Account for special characters in the file name.\n      // See https://stackoverflow.com/a/6318729.\n      url = url.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n      content = content.replace(new RegExp(url, \"g\"), replacements[i]);\n    }\n  });\n  return content;\n}","map":{"version":3,"names":["qs","qsa","Url","Path","replaceBase","doc","section","base","head","url","absolute","indexOf","createElement","insertBefore","firstChild","window","location","origin","setAttribute","replaceCanonical","link","canonical","appendChild","replaceMeta","meta","id","idref","replaceLinks","contents","fn","links","querySelectorAll","length","ownerDocument","getAttribute","undefined","replaceLink","href","linkUrl","error","onclick","hash","path","bind","i","substitute","content","urls","replacements","forEach","replace","RegExp"],"sources":["/home/parallels/Downloads/react-epub-viewer-demo/node_modules/epubjs/src/utils/replacements.js"],"sourcesContent":["import { qs, qsa } from \"./core\";\nimport Url from \"./url\";\nimport Path from \"./path\";\n\nexport function replaceBase(doc, section){\n\tvar base;\n\tvar head;\n\tvar url = section.url;\n\tvar absolute = (url.indexOf(\"://\") > -1);\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tbase = qs(head, \"base\");\n\n\tif(!base) {\n\t\tbase = doc.createElement(\"base\");\n\t\thead.insertBefore(base, head.firstChild);\n\t}\n\n\t// Fix for Safari crashing if the url doesn't have an origin\n\tif (!absolute && window && window.location) {\n\t\turl = window.location.origin + url;\n\t}\n\n\tbase.setAttribute(\"href\", url);\n}\n\nexport function replaceCanonical(doc, section){\n\tvar head;\n\tvar link;\n\tvar url = section.canonical;\n\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tlink = qs(head, \"link[rel='canonical']\");\n\n\tif (link) {\n\t\tlink.setAttribute(\"href\", url);\n\t} else {\n\t\tlink = doc.createElement(\"link\");\n\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\tlink.setAttribute(\"href\", url);\n\t\thead.appendChild(link);\n\t}\n}\n\nexport function replaceMeta(doc, section){\n\tvar head;\n\tvar meta;\n\tvar id = section.idref;\n\tif(!doc){\n\t\treturn;\n\t}\n\n\thead = qs(doc, \"head\");\n\tmeta = qs(head, \"link[property='dc.identifier']\");\n\n\tif (meta) {\n\t\tmeta.setAttribute(\"content\", id);\n\t} else {\n\t\tmeta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.identifier\");\n\t\tmeta.setAttribute(\"content\", id);\n\t\thead.appendChild(meta);\n\t}\n}\n\n// TODO: move me to Contents\nexport function replaceLinks(contents, fn) {\n\n\tvar links = contents.querySelectorAll(\"a[href]\");\n\n\tif (!links.length) {\n\t\treturn;\n\t}\n\n\tvar base = qs(contents.ownerDocument, \"base\");\n\tvar location = base ? base.getAttribute(\"href\") : undefined;\n\tvar replaceLink = function(link){\n\t\tvar href = link.getAttribute(\"href\");\n\n\t\tif(href.indexOf(\"mailto:\") === 0){\n\t\t\treturn;\n\t\t}\n\n\t\tvar absolute = (href.indexOf(\"://\") > -1);\n\n\t\tif(absolute){\n\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\n\n\t\t}else{\n\t\t\tvar linkUrl;\n\t\t\ttry {\n\t\t\t\tlinkUrl = new Url(href, location);\t\n\t\t\t} catch(error) {\n\t\t\t\t// NOOP\n\t\t\t}\n\n\t\t\tlink.onclick = function(){\n\n\t\t\t\tif(linkUrl && linkUrl.hash) {\n\t\t\t\t\tfn(linkUrl.Path.path + linkUrl.hash);\n\t\t\t\t} else if(linkUrl){\n\t\t\t\t\tfn(linkUrl.Path.path);\n\t\t\t\t} else {\n\t\t\t\t\tfn(href);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t}.bind(this);\n\n\tfor (var i = 0; i < links.length; i++) {\n\t\treplaceLink(links[i]);\n\t}\n\n\n}\n\nexport function substitute(content, urls, replacements) {\n\turls.forEach(function(url, i){\n\t\tif (url && replacements[i]) {\n\t\t\t// Account for special characters in the file name.\n\t\t\t// See https://stackoverflow.com/a/6318729.\n\t\t\turl = url.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n\t\t\tcontent = content.replace(new RegExp(url, \"g\"), replacements[i]);\n\t\t}\n\t});\n\treturn content;\n}\n"],"mappings":"AAAA,SAASA,EAAE,EAAEC,GAAG,QAAQ,QAAQ;AAChC,OAAOC,GAAG,MAAM,OAAO;AACvB,OAAOC,IAAI,MAAM,QAAQ;AAEzB,OAAO,SAASC,WAAW,CAACC,GAAG,EAAEC,OAAO,EAAC;EACxC,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAIC,GAAG,GAAGH,OAAO,CAACG,GAAG;EACrB,IAAIC,QAAQ,GAAID,GAAG,CAACE,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAE;EAExC,IAAG,CAACN,GAAG,EAAC;IACP;EACD;EAEAG,IAAI,GAAGR,EAAE,CAACK,GAAG,EAAE,MAAM,CAAC;EACtBE,IAAI,GAAGP,EAAE,CAACQ,IAAI,EAAE,MAAM,CAAC;EAEvB,IAAG,CAACD,IAAI,EAAE;IACTA,IAAI,GAAGF,GAAG,CAACO,aAAa,CAAC,MAAM,CAAC;IAChCJ,IAAI,CAACK,YAAY,CAACN,IAAI,EAAEC,IAAI,CAACM,UAAU,CAAC;EACzC;;EAEA;EACA,IAAI,CAACJ,QAAQ,IAAIK,MAAM,IAAIA,MAAM,CAACC,QAAQ,EAAE;IAC3CP,GAAG,GAAGM,MAAM,CAACC,QAAQ,CAACC,MAAM,GAAGR,GAAG;EACnC;EAEAF,IAAI,CAACW,YAAY,CAAC,MAAM,EAAET,GAAG,CAAC;AAC/B;AAEA,OAAO,SAASU,gBAAgB,CAACd,GAAG,EAAEC,OAAO,EAAC;EAC7C,IAAIE,IAAI;EACR,IAAIY,IAAI;EACR,IAAIX,GAAG,GAAGH,OAAO,CAACe,SAAS;EAE3B,IAAG,CAAChB,GAAG,EAAC;IACP;EACD;EAEAG,IAAI,GAAGR,EAAE,CAACK,GAAG,EAAE,MAAM,CAAC;EACtBe,IAAI,GAAGpB,EAAE,CAACQ,IAAI,EAAE,uBAAuB,CAAC;EAExC,IAAIY,IAAI,EAAE;IACTA,IAAI,CAACF,YAAY,CAAC,MAAM,EAAET,GAAG,CAAC;EAC/B,CAAC,MAAM;IACNW,IAAI,GAAGf,GAAG,CAACO,aAAa,CAAC,MAAM,CAAC;IAChCQ,IAAI,CAACF,YAAY,CAAC,KAAK,EAAE,WAAW,CAAC;IACrCE,IAAI,CAACF,YAAY,CAAC,MAAM,EAAET,GAAG,CAAC;IAC9BD,IAAI,CAACc,WAAW,CAACF,IAAI,CAAC;EACvB;AACD;AAEA,OAAO,SAASG,WAAW,CAAClB,GAAG,EAAEC,OAAO,EAAC;EACxC,IAAIE,IAAI;EACR,IAAIgB,IAAI;EACR,IAAIC,EAAE,GAAGnB,OAAO,CAACoB,KAAK;EACtB,IAAG,CAACrB,GAAG,EAAC;IACP;EACD;EAEAG,IAAI,GAAGR,EAAE,CAACK,GAAG,EAAE,MAAM,CAAC;EACtBmB,IAAI,GAAGxB,EAAE,CAACQ,IAAI,EAAE,gCAAgC,CAAC;EAEjD,IAAIgB,IAAI,EAAE;IACTA,IAAI,CAACN,YAAY,CAAC,SAAS,EAAEO,EAAE,CAAC;EACjC,CAAC,MAAM;IACND,IAAI,GAAGnB,GAAG,CAACO,aAAa,CAAC,MAAM,CAAC;IAChCY,IAAI,CAACN,YAAY,CAAC,MAAM,EAAE,eAAe,CAAC;IAC1CM,IAAI,CAACN,YAAY,CAAC,SAAS,EAAEO,EAAE,CAAC;IAChCjB,IAAI,CAACc,WAAW,CAACE,IAAI,CAAC;EACvB;AACD;;AAEA;AACA,OAAO,SAASG,YAAY,CAACC,QAAQ,EAAEC,EAAE,EAAE;EAE1C,IAAIC,KAAK,GAAGF,QAAQ,CAACG,gBAAgB,CAAC,SAAS,CAAC;EAEhD,IAAI,CAACD,KAAK,CAACE,MAAM,EAAE;IAClB;EACD;EAEA,IAAIzB,IAAI,GAAGP,EAAE,CAAC4B,QAAQ,CAACK,aAAa,EAAE,MAAM,CAAC;EAC7C,IAAIjB,QAAQ,GAAGT,IAAI,GAAGA,IAAI,CAAC2B,YAAY,CAAC,MAAM,CAAC,GAAGC,SAAS;EAC3D,IAAIC,WAAW,GAAG,UAAShB,IAAI,EAAC;IAC/B,IAAIiB,IAAI,GAAGjB,IAAI,CAACc,YAAY,CAAC,MAAM,CAAC;IAEpC,IAAGG,IAAI,CAAC1B,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,EAAC;MAChC;IACD;IAEA,IAAID,QAAQ,GAAI2B,IAAI,CAAC1B,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAE;IAEzC,IAAGD,QAAQ,EAAC;MAEXU,IAAI,CAACF,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC;IAEtC,CAAC,MAAI;MACJ,IAAIoB,OAAO;MACX,IAAI;QACHA,OAAO,GAAG,IAAIpC,GAAG,CAACmC,IAAI,EAAErB,QAAQ,CAAC;MAClC,CAAC,CAAC,OAAMuB,KAAK,EAAE;QACd;MAAA;MAGDnB,IAAI,CAACoB,OAAO,GAAG,YAAU;QAExB,IAAGF,OAAO,IAAIA,OAAO,CAACG,IAAI,EAAE;UAC3BZ,EAAE,CAACS,OAAO,CAACnC,IAAI,CAACuC,IAAI,GAAGJ,OAAO,CAACG,IAAI,CAAC;QACrC,CAAC,MAAM,IAAGH,OAAO,EAAC;UACjBT,EAAE,CAACS,OAAO,CAACnC,IAAI,CAACuC,IAAI,CAAC;QACtB,CAAC,MAAM;UACNb,EAAE,CAACQ,IAAI,CAAC;QACT;QAEA,OAAO,KAAK;MACb,CAAC;IACF;EACD,CAAC,CAACM,IAAI,CAAC,IAAI,CAAC;EAEZ,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGd,KAAK,CAACE,MAAM,EAAEY,CAAC,EAAE,EAAE;IACtCR,WAAW,CAACN,KAAK,CAACc,CAAC,CAAC,CAAC;EACtB;AAGD;AAEA,OAAO,SAASC,UAAU,CAACC,OAAO,EAAEC,IAAI,EAAEC,YAAY,EAAE;EACvDD,IAAI,CAACE,OAAO,CAAC,UAASxC,GAAG,EAAEmC,CAAC,EAAC;IAC5B,IAAInC,GAAG,IAAIuC,YAAY,CAACJ,CAAC,CAAC,EAAE;MAC3B;MACA;MACAnC,GAAG,GAAGA,GAAG,CAACyC,OAAO,CAAC,0BAA0B,EAAE,MAAM,CAAC;MACrDJ,OAAO,GAAGA,OAAO,CAACI,OAAO,CAAC,IAAIC,MAAM,CAAC1C,GAAG,EAAE,GAAG,CAAC,EAAEuC,YAAY,CAACJ,CAAC,CAAC,CAAC;IACjE;EACD,CAAC,CAAC;EACF,OAAOE,OAAO;AACf"},"metadata":{},"sourceType":"module"}