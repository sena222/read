{"ast":null,"code":"import EventEmitter from \"event-emitter\";\nimport { extend, defer, windowBounds, isNumber } from \"../../utils/core\";\nimport scrollType from \"../../utils/scrolltype\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\nclass DefaultViewManager {\n  constructor(options) {\n    this.name = \"default\";\n    this.optsSettings = options.settings;\n    this.View = options.view;\n    this.request = options.request;\n    this.renditionQueue = options.queue;\n    this.q = new Queue(this);\n    this.settings = extend(this.settings || {}, {\n      infinite: true,\n      hidden: false,\n      width: undefined,\n      height: undefined,\n      axis: undefined,\n      writingMode: undefined,\n      flow: \"scrolled\",\n      ignoreClass: \"\",\n      fullsize: undefined,\n      allowScriptedContent: false,\n      allowPopups: false\n    });\n    extend(this.settings, options.settings || {});\n    this.viewSettings = {\n      ignoreClass: this.settings.ignoreClass,\n      axis: this.settings.axis,\n      flow: this.settings.flow,\n      layout: this.layout,\n      method: this.settings.method,\n      // srcdoc, blobUrl, write\n      width: 0,\n      height: 0,\n      forceEvenPages: true,\n      allowScriptedContent: this.settings.allowScriptedContent,\n      allowPopups: this.settings.allowPopups\n    };\n    this.rendered = false;\n  }\n  render(element, size) {\n    let tag = element.tagName;\n    if (typeof this.settings.fullsize === \"undefined\" && tag && (tag.toLowerCase() == \"body\" || tag.toLowerCase() == \"html\")) {\n      this.settings.fullsize = true;\n    }\n    if (this.settings.fullsize) {\n      this.settings.overflow = \"visible\";\n      this.overflow = this.settings.overflow;\n    }\n    this.settings.size = size;\n    this.settings.rtlScrollType = scrollType();\n\n    // Save the stage\n    this.stage = new Stage({\n      width: size.width,\n      height: size.height,\n      overflow: this.overflow,\n      hidden: this.settings.hidden,\n      axis: this.settings.axis,\n      fullsize: this.settings.fullsize,\n      direction: this.settings.direction\n    });\n    this.stage.attachTo(element);\n\n    // Get this stage container div\n    this.container = this.stage.getContainer();\n\n    // Views array methods\n    this.views = new Views(this.container);\n\n    // Calculate Stage Size\n    this._bounds = this.bounds();\n    this._stageSize = this.stage.size();\n\n    // Set the dimensions for views\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n\n    // Function to handle a resize event.\n    // Will only attach if width and height are both fixed.\n    this.stage.onResize(this.onResized.bind(this));\n    this.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n    // Add Event Listeners\n    this.addEventListeners();\n\n    // Add Layout method\n    // this.applyLayoutMethod();\n    if (this.layout) {\n      this.updateLayout();\n    }\n    this.rendered = true;\n  }\n  addEventListeners() {\n    var scroller;\n    window.addEventListener(\"unload\", function (e) {\n      this.destroy();\n    }.bind(this));\n    if (!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n    this._onScroll = this.onScroll.bind(this);\n    scroller.addEventListener(\"scroll\", this._onScroll);\n  }\n  removeEventListeners() {\n    var scroller;\n    if (!this.settings.fullsize) {\n      scroller = this.container;\n    } else {\n      scroller = window;\n    }\n    scroller.removeEventListener(\"scroll\", this._onScroll);\n    this._onScroll = undefined;\n  }\n  destroy() {\n    clearTimeout(this.orientationTimeout);\n    clearTimeout(this.resizeTimeout);\n    clearTimeout(this.afterScrolled);\n    this.clear();\n    this.removeEventListeners();\n    this.stage.destroy();\n    this.rendered = false;\n\n    /*\n    \t\tclearTimeout(this.trimTimeout);\n    \tif(this.settings.hidden) {\n    \t\tthis.element.removeChild(this.wrapper);\n    \t} else {\n    \t\tthis.element.removeChild(this.container);\n    \t}\n    */\n  }\n\n  onOrientationChange(e) {\n    let {\n      orientation\n    } = window;\n    if (this.optsSettings.resizeOnOrientationChange) {\n      this.resize();\n    }\n\n    // Per ampproject:\n    // In IOS 10.3, the measured size of an element is incorrect if the\n    // element size depends on window size directly and the measurement\n    // happens in window.resize event. Adding a timeout for correct\n    // measurement. See https://github.com/ampproject/amphtml/issues/8479\n    clearTimeout(this.orientationTimeout);\n    this.orientationTimeout = setTimeout(function () {\n      this.orientationTimeout = undefined;\n      if (this.optsSettings.resizeOnOrientationChange) {\n        this.resize();\n      }\n      this.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n    }.bind(this), 500);\n  }\n  onResized(e) {\n    this.resize();\n  }\n  resize(width, height, epubcfi) {\n    let stageSize = this.stage.size(width, height);\n\n    // For Safari, wait for orientation to catch up\n    // if the window is a square\n    this.winBounds = windowBounds();\n    if (this.orientationTimeout && this.winBounds.width === this.winBounds.height) {\n      // reset the stage size for next resize\n      this._stageSize = undefined;\n      return;\n    }\n    if (this._stageSize && this._stageSize.width === stageSize.width && this._stageSize.height === stageSize.height) {\n      // Size is the same, no need to resize\n      return;\n    }\n    this._stageSize = stageSize;\n    this._bounds = this.bounds();\n\n    // Clear current views\n    this.clear();\n\n    // Update for new views\n    this.viewSettings.width = this._stageSize.width;\n    this.viewSettings.height = this._stageSize.height;\n    this.updateLayout();\n    this.emit(EVENTS.MANAGERS.RESIZED, {\n      width: this._stageSize.width,\n      height: this._stageSize.height\n    }, epubcfi);\n  }\n  createView(section, forceRight) {\n    return new this.View(section, extend(this.viewSettings, {\n      forceRight\n    }));\n  }\n  handleNextPrePaginated(forceRight, section, action) {\n    let next;\n    if (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n      if (forceRight || section.index === 0) {\n        // First page (cover) should stand alone for pre-paginated books\n        return;\n      }\n      next = section.next();\n      if (next && !next.properties.includes(\"page-spread-left\")) {\n        return action.call(this, next);\n      }\n    }\n  }\n  display(section, target) {\n    var displaying = new defer();\n    var displayed = displaying.promise;\n\n    // Check if moving to target is needed\n    if (target === section.href || isNumber(target)) {\n      target = undefined;\n    }\n\n    // Check to make sure the section we want isn't already shown\n    var visible = this.views.find(section);\n\n    // View is already shown, just move to correct location in view\n    if (visible && section && this.layout.name !== \"pre-paginated\") {\n      let offset = visible.offset();\n      if (this.settings.direction === \"ltr\") {\n        this.scrollTo(offset.left, offset.top, true);\n      } else {\n        let width = visible.width();\n        this.scrollTo(offset.left + width, offset.top, true);\n      }\n      if (target) {\n        let offset = visible.locationOf(target);\n        let width = visible.width();\n        this.moveTo(offset, width);\n      }\n      displaying.resolve();\n      return displayed;\n    }\n\n    // Hide all current views\n    this.clear();\n    let forceRight = false;\n    if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\n      forceRight = true;\n    }\n    this.add(section, forceRight).then(function (view) {\n      // Move to correct place within the section, if needed\n      if (target) {\n        let offset = view.locationOf(target);\n        let width = view.width();\n        this.moveTo(offset, width);\n      }\n    }.bind(this), err => {\n      displaying.reject(err);\n    }).then(function () {\n      return this.handleNextPrePaginated(forceRight, section, this.add);\n    }.bind(this)).then(function () {\n      this.views.show();\n      displaying.resolve();\n    }.bind(this));\n    // .then(function(){\n    // \treturn this.hooks.display.trigger(view);\n    // }.bind(this))\n    // .then(function(){\n    // \tthis.views.show();\n    // }.bind(this));\n    return displayed;\n  }\n  afterDisplayed(view) {\n    this.emit(EVENTS.MANAGERS.ADDED, view);\n  }\n  afterResized(view) {\n    this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n  }\n  moveTo(offset, width) {\n    var distX = 0,\n      distY = 0;\n    if (!this.isPaginated) {\n      distY = offset.top;\n    } else {\n      distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n      if (distX + this.layout.delta > this.container.scrollWidth) {\n        distX = this.container.scrollWidth - this.layout.delta;\n      }\n      distY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\n      if (distY + this.layout.delta > this.container.scrollHeight) {\n        distY = this.container.scrollHeight - this.layout.delta;\n      }\n    }\n    if (this.settings.direction === 'rtl') {\n      /***\n      \tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta`\n      \tto distX or use `Math.ceil` function, or multiply offset.left by -1\n      \tbefore `Math.floor`\n      */\n      distX = distX + this.layout.delta;\n      distX = distX - width;\n    }\n    this.scrollTo(distX, distY, true);\n  }\n  add(section, forceRight) {\n    var view = this.createView(section, forceRight);\n    this.views.append(view);\n\n    // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    view.on(EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    return view.display(this.request);\n  }\n  append(section, forceRight) {\n    var view = this.createView(section, forceRight);\n    this.views.append(view);\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    view.on(EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    return view.display(this.request);\n  }\n  prepend(section, forceRight) {\n    var view = this.createView(section, forceRight);\n    view.on(EVENTS.VIEWS.RESIZED, bounds => {\n      this.counter(bounds);\n    });\n    this.views.prepend(view);\n    view.onDisplayed = this.afterDisplayed.bind(this);\n    view.onResize = this.afterResized.bind(this);\n    view.on(EVENTS.VIEWS.AXIS, axis => {\n      this.updateAxis(axis);\n    });\n    view.on(EVENTS.VIEWS.WRITING_MODE, mode => {\n      this.updateWritingMode(mode);\n    });\n    return view.display(this.request);\n  }\n  counter(bounds) {\n    if (this.settings.axis === \"vertical\") {\n      this.scrollBy(0, bounds.heightDelta, true);\n    } else {\n      this.scrollBy(bounds.widthDelta, 0, true);\n    }\n  }\n\n  // resizeView(view) {\n  //\n  // \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n  // \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n  // \t} else {\n  // \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n  // \t}\n  //\n  // };\n\n  next() {\n    var next;\n    var left;\n    let dir = this.settings.direction;\n    if (!this.views.length) return;\n    if (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n      this.scrollLeft = this.container.scrollLeft;\n      left = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n      if (left <= this.container.scrollWidth) {\n        this.scrollBy(this.layout.delta, 0, true);\n      } else {\n        next = this.views.last().section.next();\n      }\n    } else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n      this.scrollLeft = this.container.scrollLeft;\n      if (this.settings.rtlScrollType === \"default\") {\n        left = this.container.scrollLeft;\n        if (left > 0) {\n          this.scrollBy(this.layout.delta, 0, true);\n        } else {\n          next = this.views.last().section.next();\n        }\n      } else {\n        left = this.container.scrollLeft + this.layout.delta * -1;\n        if (left > this.container.scrollWidth * -1) {\n          this.scrollBy(this.layout.delta, 0, true);\n        } else {\n          next = this.views.last().section.next();\n        }\n      }\n    } else if (this.isPaginated && this.settings.axis === \"vertical\") {\n      this.scrollTop = this.container.scrollTop;\n      let top = this.container.scrollTop + this.container.offsetHeight;\n      if (top < this.container.scrollHeight) {\n        this.scrollBy(0, this.layout.height, true);\n      } else {\n        next = this.views.last().section.next();\n      }\n    } else {\n      next = this.views.last().section.next();\n    }\n    if (next) {\n      this.clear();\n      // The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n      this.updateLayout();\n      let forceRight = false;\n      if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\n        forceRight = true;\n      }\n      return this.append(next, forceRight).then(function () {\n        return this.handleNextPrePaginated(forceRight, next, this.append);\n      }.bind(this), err => {\n        return err;\n      }).then(function () {\n        // Reset position to start for scrolled-doc vertical-rl in default mode\n        if (!this.isPaginated && this.settings.axis === \"horizontal\" && this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\") {\n          this.scrollTo(this.container.scrollWidth, 0, true);\n        }\n        this.views.show();\n      }.bind(this));\n    }\n  }\n  prev() {\n    var prev;\n    var left;\n    let dir = this.settings.direction;\n    if (!this.views.length) return;\n    if (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n      this.scrollLeft = this.container.scrollLeft;\n      left = this.container.scrollLeft;\n      if (left > 0) {\n        this.scrollBy(-this.layout.delta, 0, true);\n      } else {\n        prev = this.views.first().section.prev();\n      }\n    } else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n      this.scrollLeft = this.container.scrollLeft;\n      if (this.settings.rtlScrollType === \"default\") {\n        left = this.container.scrollLeft + this.container.offsetWidth;\n        if (left < this.container.scrollWidth) {\n          this.scrollBy(-this.layout.delta, 0, true);\n        } else {\n          prev = this.views.first().section.prev();\n        }\n      } else {\n        left = this.container.scrollLeft;\n        if (left < 0) {\n          this.scrollBy(-this.layout.delta, 0, true);\n        } else {\n          prev = this.views.first().section.prev();\n        }\n      }\n    } else if (this.isPaginated && this.settings.axis === \"vertical\") {\n      this.scrollTop = this.container.scrollTop;\n      let top = this.container.scrollTop;\n      if (top > 0) {\n        this.scrollBy(0, -this.layout.height, true);\n      } else {\n        prev = this.views.first().section.prev();\n      }\n    } else {\n      prev = this.views.first().section.prev();\n    }\n    if (prev) {\n      this.clear();\n      // The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n      this.updateLayout();\n      let forceRight = false;\n      if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\n        forceRight = true;\n      }\n      return this.prepend(prev, forceRight).then(function () {\n        var left;\n        if (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n          left = prev.prev();\n          if (left) {\n            return this.prepend(left);\n          }\n        }\n      }.bind(this), err => {\n        return err;\n      }).then(function () {\n        if (this.isPaginated && this.settings.axis === \"horizontal\") {\n          if (this.settings.direction === \"rtl\") {\n            if (this.settings.rtlScrollType === \"default\") {\n              this.scrollTo(0, 0, true);\n            } else {\n              this.scrollTo(this.container.scrollWidth * -1 + this.layout.delta, 0, true);\n            }\n          } else {\n            this.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n          }\n        }\n        this.views.show();\n      }.bind(this));\n    }\n  }\n  current() {\n    var visible = this.visible();\n    if (visible.length) {\n      // Current is the last visible view\n      return visible[visible.length - 1];\n    }\n    return null;\n  }\n  clear() {\n    // this.q.clear();\n\n    if (this.views) {\n      this.views.hide();\n      this.scrollTo(0, 0, true);\n      this.views.clear();\n    }\n  }\n  currentLocation() {\n    this.updateLayout();\n    if (this.isPaginated && this.settings.axis === \"horizontal\") {\n      this.location = this.paginatedLocation();\n    } else {\n      this.location = this.scrolledLocation();\n    }\n    return this.location;\n  }\n  scrolledLocation() {\n    let visible = this.visible();\n    let container = this.container.getBoundingClientRect();\n    let pageHeight = container.height < window.innerHeight ? container.height : window.innerHeight;\n    let pageWidth = container.width < window.innerWidth ? container.width : window.innerWidth;\n    let vertical = this.settings.axis === \"vertical\";\n    let rtl = this.settings.direction === \"rtl\";\n    let offset = 0;\n    let used = 0;\n    if (this.settings.fullsize) {\n      offset = vertical ? window.scrollY : window.scrollX;\n    }\n    let sections = visible.map(view => {\n      let {\n        index,\n        href\n      } = view.section;\n      let position = view.position();\n      let width = view.width();\n      let height = view.height();\n      let startPos;\n      let endPos;\n      let stopPos;\n      let totalPages;\n      if (vertical) {\n        startPos = offset + container.top - position.top + used;\n        endPos = startPos + pageHeight - used;\n        totalPages = this.layout.count(height, pageHeight).pages;\n        stopPos = pageHeight;\n      } else {\n        startPos = offset + container.left - position.left + used;\n        endPos = startPos + pageWidth - used;\n        totalPages = this.layout.count(width, pageWidth).pages;\n        stopPos = pageWidth;\n      }\n      let currPage = Math.ceil(startPos / stopPos);\n      let pages = [];\n      let endPage = Math.ceil(endPos / stopPos);\n\n      // Reverse page counts for horizontal rtl\n      if (this.settings.direction === \"rtl\" && !vertical) {\n        let tempStartPage = currPage;\n        currPage = totalPages - endPage;\n        endPage = totalPages - tempStartPage;\n      }\n      pages = [];\n      for (var i = currPage; i <= endPage; i++) {\n        let pg = i + 1;\n        pages.push(pg);\n      }\n      let mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n      return {\n        index,\n        href,\n        pages,\n        totalPages,\n        mapping\n      };\n    });\n    return sections;\n  }\n  paginatedLocation() {\n    let visible = this.visible();\n    let container = this.container.getBoundingClientRect();\n    let left = 0;\n    let used = 0;\n    if (this.settings.fullsize) {\n      left = window.scrollX;\n    }\n    let sections = visible.map(view => {\n      let {\n        index,\n        href\n      } = view.section;\n      let offset;\n      let position = view.position();\n      let width = view.width();\n\n      // Find mapping\n      let start;\n      let end;\n      let pageWidth;\n      if (this.settings.direction === \"rtl\") {\n        offset = container.right - left;\n        pageWidth = Math.min(Math.abs(offset - position.left), this.layout.width) - used;\n        end = position.width - (position.right - offset) - used;\n        start = end - pageWidth;\n      } else {\n        offset = container.left + left;\n        pageWidth = Math.min(position.right - offset, this.layout.width) - used;\n        start = offset - position.left + used;\n        end = start + pageWidth;\n      }\n      used += pageWidth;\n      let mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n      let totalPages = this.layout.count(width).pages;\n      let startPage = Math.floor(start / this.layout.pageWidth);\n      let pages = [];\n      let endPage = Math.floor(end / this.layout.pageWidth);\n\n      // start page should not be negative\n      if (startPage < 0) {\n        startPage = 0;\n        endPage = endPage + 1;\n      }\n\n      // Reverse page counts for rtl\n      if (this.settings.direction === \"rtl\") {\n        let tempStartPage = startPage;\n        startPage = totalPages - endPage;\n        endPage = totalPages - tempStartPage;\n      }\n      for (var i = startPage + 1; i <= endPage; i++) {\n        let pg = i;\n        pages.push(pg);\n      }\n      return {\n        index,\n        href,\n        pages,\n        totalPages,\n        mapping\n      };\n    });\n    return sections;\n  }\n  isVisible(view, offsetPrev, offsetNext, _container) {\n    var position = view.position();\n    var container = _container || this.bounds();\n    if (this.settings.axis === \"horizontal\" && position.right > container.left - offsetPrev && position.left < container.right + offsetNext) {\n      return true;\n    } else if (this.settings.axis === \"vertical\" && position.bottom > container.top - offsetPrev && position.top < container.bottom + offsetNext) {\n      return true;\n    }\n    return false;\n  }\n  visible() {\n    var container = this.bounds();\n    var views = this.views.displayed();\n    var viewsLength = views.length;\n    var visible = [];\n    var isVisible;\n    var view;\n    for (var i = 0; i < viewsLength; i++) {\n      view = views[i];\n      isVisible = this.isVisible(view, 0, 0, container);\n      if (isVisible === true) {\n        visible.push(view);\n      }\n    }\n    return visible;\n  }\n  scrollBy(x, y, silent) {\n    let dir = this.settings.direction === \"rtl\" ? -1 : 1;\n    if (silent) {\n      this.ignore = true;\n    }\n    if (!this.settings.fullsize) {\n      if (x) this.container.scrollLeft += x * dir;\n      if (y) this.container.scrollTop += y;\n    } else {\n      window.scrollBy(x * dir, y * dir);\n    }\n    this.scrolled = true;\n  }\n  scrollTo(x, y, silent) {\n    if (silent) {\n      this.ignore = true;\n    }\n    if (!this.settings.fullsize) {\n      this.container.scrollLeft = x;\n      this.container.scrollTop = y;\n    } else {\n      window.scrollTo(x, y);\n    }\n    this.scrolled = true;\n  }\n  onScroll() {\n    let scrollTop;\n    let scrollLeft;\n    if (!this.settings.fullsize) {\n      scrollTop = this.container.scrollTop;\n      scrollLeft = this.container.scrollLeft;\n    } else {\n      scrollTop = window.scrollY;\n      scrollLeft = window.scrollX;\n    }\n    this.scrollTop = scrollTop;\n    this.scrollLeft = scrollLeft;\n    if (!this.ignore) {\n      this.emit(EVENTS.MANAGERS.SCROLL, {\n        top: scrollTop,\n        left: scrollLeft\n      });\n      clearTimeout(this.afterScrolled);\n      this.afterScrolled = setTimeout(function () {\n        this.emit(EVENTS.MANAGERS.SCROLLED, {\n          top: this.scrollTop,\n          left: this.scrollLeft\n        });\n      }.bind(this), 20);\n    } else {\n      this.ignore = false;\n    }\n  }\n  bounds() {\n    var bounds;\n    bounds = this.stage.bounds();\n    return bounds;\n  }\n  applyLayout(layout) {\n    this.layout = layout;\n    this.updateLayout();\n    if (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\n      this.display(this.views.first().section);\n    }\n    // this.manager.layout(this.layout.format);\n  }\n\n  updateLayout() {\n    if (!this.stage) {\n      return;\n    }\n    this._stageSize = this.stage.size();\n    if (!this.isPaginated) {\n      this.layout.calculate(this._stageSize.width, this._stageSize.height);\n    } else {\n      this.layout.calculate(this._stageSize.width, this._stageSize.height, this.settings.gap);\n\n      // Set the look ahead offset for what is visible\n      this.settings.offset = this.layout.delta / this.layout.divisor;\n\n      // this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n    }\n\n    // Set the dimensions for views\n    this.viewSettings.width = this.layout.width;\n    this.viewSettings.height = this.layout.height;\n    this.setLayout(this.layout);\n  }\n  setLayout(layout) {\n    this.viewSettings.layout = layout;\n    this.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n    if (this.views) {\n      this.views.forEach(function (view) {\n        if (view) {\n          view.setLayout(layout);\n        }\n      });\n    }\n  }\n  updateWritingMode(mode) {\n    this.writingMode = mode;\n  }\n  updateAxis(axis, forceUpdate) {\n    if (!forceUpdate && axis === this.settings.axis) {\n      return;\n    }\n    this.settings.axis = axis;\n    this.stage && this.stage.axis(axis);\n    this.viewSettings.axis = axis;\n    if (this.mapping) {\n      this.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n    }\n    if (this.layout) {\n      if (axis === \"vertical\") {\n        this.layout.spread(\"none\");\n      } else {\n        this.layout.spread(this.layout.settings.spread);\n      }\n    }\n  }\n  updateFlow(flow) {\n    let defaultScrolledOverflow = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"auto\";\n    let isPaginated = flow === \"paginated\" || flow === \"auto\";\n    this.isPaginated = isPaginated;\n    if (flow === \"scrolled-doc\" || flow === \"scrolled-continuous\" || flow === \"scrolled\") {\n      this.updateAxis(\"vertical\");\n    } else {\n      this.updateAxis(\"horizontal\");\n    }\n    this.viewSettings.flow = flow;\n    if (!this.settings.overflow) {\n      this.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\n    } else {\n      this.overflow = this.settings.overflow;\n    }\n    this.stage && this.stage.overflow(this.overflow);\n    this.updateLayout();\n  }\n  getContents() {\n    var contents = [];\n    if (!this.views) {\n      return contents;\n    }\n    this.views.forEach(function (view) {\n      const viewContents = view && view.contents;\n      if (viewContents) {\n        contents.push(viewContents);\n      }\n    });\n    return contents;\n  }\n  direction() {\n    let dir = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"ltr\";\n    this.settings.direction = dir;\n    this.stage && this.stage.direction(dir);\n    this.viewSettings.direction = dir;\n    this.updateLayout();\n  }\n  isRendered() {\n    return this.rendered;\n  }\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\nexport default DefaultViewManager;","map":{"version":3,"names":["EventEmitter","extend","defer","windowBounds","isNumber","scrollType","Mapping","Queue","Stage","Views","EVENTS","DefaultViewManager","constructor","options","name","optsSettings","settings","View","view","request","renditionQueue","queue","q","infinite","hidden","width","undefined","height","axis","writingMode","flow","ignoreClass","fullsize","allowScriptedContent","allowPopups","viewSettings","layout","method","forceEvenPages","rendered","render","element","size","tag","tagName","toLowerCase","overflow","rtlScrollType","stage","direction","attachTo","container","getContainer","views","_bounds","bounds","_stageSize","onResize","onResized","bind","onOrientationChange","addEventListeners","updateLayout","scroller","window","addEventListener","e","destroy","_onScroll","onScroll","removeEventListeners","removeEventListener","clearTimeout","orientationTimeout","resizeTimeout","afterScrolled","clear","orientation","resizeOnOrientationChange","resize","setTimeout","emit","MANAGERS","ORIENTATION_CHANGE","epubcfi","stageSize","winBounds","RESIZED","createView","section","forceRight","handleNextPrePaginated","action","next","divisor","index","properties","includes","call","display","target","displaying","displayed","promise","href","visible","find","offset","scrollTo","left","top","locationOf","moveTo","resolve","add","then","err","reject","show","afterDisplayed","ADDED","afterResized","RESIZE","distX","distY","isPaginated","Math","floor","delta","scrollWidth","scrollHeight","append","onDisplayed","on","VIEWS","AXIS","updateAxis","WRITING_MODE","mode","updateWritingMode","prepend","counter","scrollBy","heightDelta","widthDelta","dir","length","scrollLeft","offsetWidth","last","scrollTop","offsetHeight","prev","first","current","hide","currentLocation","location","paginatedLocation","scrolledLocation","getBoundingClientRect","pageHeight","innerHeight","pageWidth","innerWidth","vertical","rtl","used","scrollY","scrollX","sections","map","position","startPos","endPos","stopPos","totalPages","count","pages","currPage","ceil","endPage","tempStartPage","i","pg","push","mapping","page","contents","cfiBase","start","end","right","min","abs","startPage","isVisible","offsetPrev","offsetNext","_container","bottom","viewsLength","x","y","silent","ignore","scrolled","SCROLL","SCROLLED","applyLayout","calculate","gap","setLayout","props","forEach","forceUpdate","spread","updateFlow","defaultScrolledOverflow","getContents","viewContents","isRendered","prototype"],"sources":["/home/parallels/Downloads/react-epub-viewer-demo/node_modules/epubjs/src/managers/default/index.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber} from \"../../utils/core\";\nimport scrollType from \"../../utils/scrolltype\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.optsSettings = options.settings;\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\taxis: undefined,\n\t\t\twritingMode: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\tignoreClass: \"\",\n\t\t\tfullsize: undefined,\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: true,\n\t\t\tallowScriptedContent: this.settings.allowScriptedContent,\n\t\t\tallowPopups: this.settings.allowPopups\n\t\t};\n\n\t\tthis.rendered = false;\n\n\t}\n\n\trender(element, size){\n\t\tlet tag = element.tagName;\n\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\n\t\t\t\ttag && (tag.toLowerCase() == \"body\" ||\n\t\t\t\ttag.toLowerCase() == \"html\")) {\n\t\t\t\tthis.settings.fullsize = true;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tthis.settings.overflow = \"visible\";\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.settings.size = size;\n\n\t\tthis.settings.rtlScrollType = scrollType();\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis,\n\t\t\tfullsize: this.settings.fullsize,\n\t\t\tdirection: this.settings.direction\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\n\t\tthis.rendered = true;\n\n\t}\n\n\taddEventListeners(){\n\t\tvar scroller;\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tdestroy(){\n\t\tclearTimeout(this.orientationTimeout);\n\t\tclearTimeout(this.resizeTimeout);\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.clear();\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.stage.destroy();\n\n\t\tthis.rendered = false;\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t}\n\n\tonOrientationChange(e) {\n\t\tlet {orientation} = window;\n\n\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\tthis.resize();\n\t\t}\n\n\t\t// Per ampproject:\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\n\t\t// element size depends on window size directly and the measurement\n\t\t// happens in window.resize event. Adding a timeout for correct\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\n\t\tclearTimeout(this.orientationTimeout);\n\t\tthis.orientationTimeout = setTimeout(function(){\n\t\t\tthis.orientationTimeout = undefined;\n\n\t\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\t\tthis.resize();\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n\t\t}.bind(this), 500);\n\n\t}\n\n\tonResized(e) {\n\t\tthis.resize();\n\t}\n\n\tresize(width, height, epubcfi){\n\t\tlet stageSize = this.stage.size(width, height);\n\n\t\t// For Safari, wait for orientation to catch up\n\t\t// if the window is a square\n\t\tthis.winBounds = windowBounds();\n\t\tif (this.orientationTimeout &&\n\t\t\t\tthis.winBounds.width === this.winBounds.height) {\n\t\t\t// reset the stage size for next resize\n\t\t\tthis._stageSize = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._stageSize &&\n\t\t\t\tthis._stageSize.width === stageSize.width &&\n\t\t\t\tthis._stageSize.height === stageSize.height ) {\n\t\t\t// Size is the same, no need to resize\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = stageSize;\n\n\t\tthis._bounds = this.bounds();\n\n\t\t// Clear current views\n\t\tthis.clear();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\n\t\t\twidth: this._stageSize.width,\n\t\t\theight: this._stageSize.height\n\t\t}, epubcfi);\n\t}\n\n\tcreateView(section, forceRight) {\n\t\treturn new this.View(section, extend(this.viewSettings, { forceRight }) );\n\t}\n\n\thandleNextPrePaginated(forceRight, section, action) {\n\t\tlet next;\n\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\tif (forceRight || section.index === 0) {\n\t\t\t\t// First page (cover) should stand alone for pre-paginated books\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnext = section.next();\n\t\t\tif (next && !next.properties.includes(\"page-spread-left\")) {\n\t\t\t\treturn action.call(this, next);\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check if moving to target is needed\n\t\tif (target === section.href || isNumber(target)) {\n\t\t\ttarget = undefined;\n\t\t}\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location in view\n\t\tif(visible && section && this.layout.name !== \"pre-paginated\") {\n\t\t\tlet offset = visible.offset();\n\n\t\t\tif (this.settings.direction === \"ltr\") {\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\n\t\t\t} else {\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\n\t\t\t}\n\n\t\t\tif(target) {\n\t\t\t\tlet offset = visible.locationOf(target);\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.moveTo(offset, width);\n\t\t\t}\n\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.clear();\n\n\t\tlet forceRight = false;\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\n\t\t\tforceRight = true;\n\t\t}\n\n\t\tthis.add(section, forceRight)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\tlet offset = view.locationOf(target);\n\t\t\t\t\tlet width = view.width();\n\t\t\t\t\tthis.moveTo(offset, width);\n\t\t\t\t}\n\n\t\t\t}.bind(this), (err) => {\n\t\t\t\tdisplaying.reject(err);\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\treturn this.handleNextPrePaginated(forceRight, section, this.add);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this));\n\t\t// .then(function(){\n\t\t// \treturn this.hooks.display.trigger(view);\n\t\t// }.bind(this))\n\t\t// .then(function(){\n\t\t// \tthis.views.show();\n\t\t// }.bind(this));\n\t\treturn displayed;\n\t}\n\n\tafterDisplayed(view){\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\tmoveTo(offset, width){\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\n\t\t\tdistY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distY + this.layout.delta > this.container.scrollHeight) {\n\t\t\t\tdistY = this.container.scrollHeight - this.layout.delta;\n\t\t\t}\n\t\t}\n\t\tif(this.settings.direction === 'rtl'){\n\t\t\t/***\n\t\t\t\tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta`\n\t\t\t\tto distX or use `Math.ceil` function, or multiply offset.left by -1\n\t\t\t\tbefore `Math.floor`\n\t\t\t*/\n\t\t\tdistX = distX + this.layout.delta\n\t\t\tdistX = distX - width\n\t\t}\n\t\tthis.scrollTo(distX, distY, true);\n\t}\n\n\tadd(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tappend(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tprepend(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar left;\n\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\tleft = this.container.scrollLeft;\n\n\t\t\t\tif (left > 0) {\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tnext = this.views.last().section.next();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tleft = this.container.scrollLeft + ( this.layout.delta * -1 );\n\n\t\t\t\tif (left > this.container.scrollWidth * -1){\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tnext = this.views.last().section.next();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top  = this.container.scrollTop + this.container.offsetHeight;\n\n\t\t\tif(top < this.container.scrollHeight) {\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else {\n\t\t\tnext = this.views.last().section.next();\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.clear();\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\t\t\tthis.updateLayout();\n\n\t\t\tlet forceRight = false;\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\n\t\t\t\tforceRight = true;\n\t\t\t}\n\n\t\t\treturn this.append(next, forceRight)\n\t\t\t\t.then(function(){\n\t\t\t\t\treturn this.handleNextPrePaginated(forceRight, next, this.append);\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\n\t\t\t\t\t// Reset position to start for scrolled-doc vertical-rl in default mode\n\t\t\t\t\tif (!this.isPaginated &&\n\t\t\t\t\t\tthis.settings.axis === \"horizontal\" &&\n\t\t\t\t\t\tthis.settings.direction === \"rtl\" &&\n\t\t\t\t\t\tthis.settings.rtlScrollType === \"default\") {\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth, 0, true);\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t}\n\n\tprev(){\n\t\tvar prev;\n\t\tvar left;\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth;\n\n\t\t\t\tif (left < this.container.scrollWidth) {\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tleft = this.container.scrollLeft;\n\n\t\t\t\tif (left < 0) {\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top = this.container.scrollTop;\n\n\t\t\tif(top > 0) {\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.clear();\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\t\t\tthis.updateLayout();\n\n\t\t\tlet forceRight = false;\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\n\t\t\t\tforceRight = true;\n\t\t\t}\n\n\t\t\treturn this.prepend(prev, forceRight)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\t\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tthis.scrollTo((this.container.scrollWidth * -1) + this.layout.delta, 0, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear () {\n\n\t\t// this.q.clear();\n\n\t\tif (this.views) {\n\t\t\tthis.views.hide();\n\t\t\tthis.scrollTo(0,0, true);\n\t\t\tthis.views.clear();\n\t\t}\n\t}\n\n\tcurrentLocation(){\n\t\tthis.updateLayout();\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t} else {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t}\n\t\treturn this.location;\n\t}\n\n\tscrolledLocation() {\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\t\tlet pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\t\tlet pageWidth = (container.width < window.innerWidth) ? container.width : window.innerWidth;\n\t\tlet vertical = (this.settings.axis === \"vertical\");\n\t\tlet rtl =  (this.settings.direction === \"rtl\");\n\t\t\n\t\tlet offset = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\toffset = vertical ? window.scrollY : window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet position = view.position();\n\t\t\tlet width = view.width();\n\t\t\tlet height = view.height();\n\n\t\t\tlet startPos;\n\t\t\tlet endPos;\n\t\t\tlet stopPos;\n\t\t\tlet totalPages;\n\n\t\t\tif (vertical) {\n\t\t\t\tstartPos = offset + container.top - position.top + used;\n\t\t\t\tendPos = startPos + pageHeight - used;\n\t\t\t\ttotalPages = this.layout.count(height, pageHeight).pages;\n\t\t\t\tstopPos = pageHeight;\n\t\t\t} else {\n\t\t\t\tstartPos = offset + container.left - position.left + used;\n\t\t\t\tendPos = startPos + pageWidth - used;\n\t\t\t\ttotalPages = this.layout.count(width, pageWidth).pages;\n\t\t\t\tstopPos = pageWidth;\n\t\t\t}\n\n\t\t\tlet currPage = Math.ceil(startPos / stopPos);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.ceil(endPos / stopPos);\n\n\t\t\t// Reverse page counts for horizontal rtl\n\t\t\tif (this.settings.direction === \"rtl\" && !vertical) {\n\t\t\t\tlet tempStartPage = currPage;\n\t\t\t\tcurrPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\t\t\tpages = [];\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\n\t\t\t\tlet pg = i + 1;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tpaginatedLocation(){\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\n\t\tlet left = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\tleft = window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet offset;\n\t\t\tlet position = view.position();\n\t\t\tlet width = view.width();\n\n\t\t\t// Find mapping\n\t\t\tlet start;\n\t\t\tlet end;\n\t\t\tlet pageWidth;\n\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\toffset = container.right - left;\n\t\t\t\tpageWidth = Math.min(Math.abs(offset - position.left), this.layout.width) - used;\n\t\t\t\tend = position.width - (position.right - offset) - used;\n\t\t\t\tstart = end - pageWidth;\n\t\t\t} else {\n\t\t\t\toffset = container.left + left;\n\t\t\t\tpageWidth = Math.min(position.right - offset, this.layout.width) - used;\n\t\t\t\tstart = offset - position.left + used;\n\t\t\t\tend = start + pageWidth;\n\t\t\t}\n\n\t\t\tused += pageWidth;\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n\n\t\t\tlet totalPages = this.layout.count(width).pages;\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\n\t\t\t\n\t\t\t// start page should not be negative\n\t\t\tif (startPage < 0) {\n\t\t\t\tstartPage = 0;\n\t\t\t\tendPage = endPage + 1;\n\t\t\t}\n\n\t\t\t// Reverse page counts for rtl\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\tlet tempStartPage = startPage;\n\t\t\t\tstartPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\n\t\t\t\tlet pg = i;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvisible(){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t}\n\n\tscrollBy(x, y, silent){\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tif(x) this.container.scrollLeft += x * dir;\n\t\t\tif(y) this.container.scrollTop += y;\n\t\t} else {\n\t\t\twindow.scrollBy(x * dir, y * dir);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY;\n\t\t\tscrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\t\ttop: scrollTop,\n\t\t\t\tleft: scrollLeft\n\t\t\t});\n\n\t\t\tclearTimeout(this.afterScrolled);\n\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t});\n\t\t\t}.bind(this), 20);\n\n\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t}\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t}\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\t\tif (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\n\t\t\tthis.display(this.views.first().section);\n\t\t}\n\t\t // this.manager.layout(this.layout.format);\n\t}\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(!this.isPaginated) {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta / this.layout.divisor;\n\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\t}\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.forEach(function(view){\n\t\t\t\tif (view) {\n\t\t\t\t\tview.setLayout(layout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tupdateWritingMode(mode) {\n\t\tthis.writingMode = mode;\n\t}\n\n\tupdateAxis(axis, forceUpdate){\n\n\t\tif (!forceUpdate && axis === this.settings.axis) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.stage && this.stage.axis(axis);\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tif (this.mapping) {\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n\t\t}\n\n\t\tif (this.layout) {\n\t\t\tif (axis === \"vertical\") {\n\t\t\t\tthis.layout.spread(\"none\");\n\t\t\t} else {\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFlow(flow, defaultScrolledOverflow=\"auto\"){\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\n\n\t\tthis.isPaginated = isPaginated;\n\n\t\tif (flow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\tflow === \"scrolled\") {\n\t\t\tthis.updateAxis(\"vertical\");\n\t\t} else {\n\t\t\tthis.updateAxis(\"horizontal\");\n\t\t}\n\n\t\tthis.viewSettings.flow = flow;\n\n\t\tif (!this.settings.overflow) {\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\n\t\t} else {\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.stage && this.stage.overflow(this.overflow);\n\n\t\tthis.updateLayout();\n\n\t}\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tif (!this.views) {\n\t\t\treturn contents;\n\t\t}\n\t\tthis.views.forEach(function(view){\n\t\t\tconst viewContents = view && view.contents;\n\t\t\tif (viewContents) {\n\t\t\t\tcontents.push(viewContents);\n\t\t\t}\n\t\t});\n\t\treturn contents;\n\t}\n\n\tdirection(dir=\"ltr\") {\n\t\tthis.settings.direction = dir;\n\n\t\tthis.stage && this.stage.direction(dir);\n\n\t\tthis.viewSettings.direction = dir;\n\n\t\tthis.updateLayout();\n\t}\n\n\tisRendered() {\n\t\treturn this.rendered;\n\t}\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}