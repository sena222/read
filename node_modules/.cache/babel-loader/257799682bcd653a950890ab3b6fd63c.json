{"ast":null,"code":"import _classCallCheck from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport EventEmitter from \"event-emitter\";\nimport { extend, defer, windowBounds, isNumber } from \"../../utils/core\";\nimport scrollType from \"../../utils/scrolltype\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\nvar DefaultViewManager = /*#__PURE__*/function () {\n  function DefaultViewManager(options) {\n    _classCallCheck(this, DefaultViewManager);\n    this.name = \"default\";\n    this.optsSettings = options.settings;\n    this.View = options.view;\n    this.request = options.request;\n    this.renditionQueue = options.queue;\n    this.q = new Queue(this);\n    this.settings = extend(this.settings || {}, {\n      infinite: true,\n      hidden: false,\n      width: undefined,\n      height: undefined,\n      axis: undefined,\n      writingMode: undefined,\n      flow: \"scrolled\",\n      ignoreClass: \"\",\n      fullsize: undefined,\n      allowScriptedContent: false,\n      allowPopups: false\n    });\n    extend(this.settings, options.settings || {});\n    this.viewSettings = {\n      ignoreClass: this.settings.ignoreClass,\n      axis: this.settings.axis,\n      flow: this.settings.flow,\n      layout: this.layout,\n      method: this.settings.method,\n      // srcdoc, blobUrl, write\n      width: 0,\n      height: 0,\n      forceEvenPages: true,\n      allowScriptedContent: this.settings.allowScriptedContent,\n      allowPopups: this.settings.allowPopups\n    };\n    this.rendered = false;\n  }\n  _createClass(DefaultViewManager, [{\n    key: \"render\",\n    value: function render(element, size) {\n      var tag = element.tagName;\n      if (typeof this.settings.fullsize === \"undefined\" && tag && (tag.toLowerCase() == \"body\" || tag.toLowerCase() == \"html\")) {\n        this.settings.fullsize = true;\n      }\n      if (this.settings.fullsize) {\n        this.settings.overflow = \"visible\";\n        this.overflow = this.settings.overflow;\n      }\n      this.settings.size = size;\n      this.settings.rtlScrollType = scrollType();\n\n      // Save the stage\n      this.stage = new Stage({\n        width: size.width,\n        height: size.height,\n        overflow: this.overflow,\n        hidden: this.settings.hidden,\n        axis: this.settings.axis,\n        fullsize: this.settings.fullsize,\n        direction: this.settings.direction\n      });\n      this.stage.attachTo(element);\n\n      // Get this stage container div\n      this.container = this.stage.getContainer();\n\n      // Views array methods\n      this.views = new Views(this.container);\n\n      // Calculate Stage Size\n      this._bounds = this.bounds();\n      this._stageSize = this.stage.size();\n\n      // Set the dimensions for views\n      this.viewSettings.width = this._stageSize.width;\n      this.viewSettings.height = this._stageSize.height;\n\n      // Function to handle a resize event.\n      // Will only attach if width and height are both fixed.\n      this.stage.onResize(this.onResized.bind(this));\n      this.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n      // Add Event Listeners\n      this.addEventListeners();\n\n      // Add Layout method\n      // this.applyLayoutMethod();\n      if (this.layout) {\n        this.updateLayout();\n      }\n      this.rendered = true;\n    }\n  }, {\n    key: \"addEventListeners\",\n    value: function addEventListeners() {\n      var scroller;\n      window.addEventListener(\"unload\", function (e) {\n        this.destroy();\n      }.bind(this));\n      if (!this.settings.fullsize) {\n        scroller = this.container;\n      } else {\n        scroller = window;\n      }\n      this._onScroll = this.onScroll.bind(this);\n      scroller.addEventListener(\"scroll\", this._onScroll);\n    }\n  }, {\n    key: \"removeEventListeners\",\n    value: function removeEventListeners() {\n      var scroller;\n      if (!this.settings.fullsize) {\n        scroller = this.container;\n      } else {\n        scroller = window;\n      }\n      scroller.removeEventListener(\"scroll\", this._onScroll);\n      this._onScroll = undefined;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      clearTimeout(this.orientationTimeout);\n      clearTimeout(this.resizeTimeout);\n      clearTimeout(this.afterScrolled);\n      this.clear();\n      this.removeEventListeners();\n      this.stage.destroy();\n      this.rendered = false;\n\n      /*\n      \t\tclearTimeout(this.trimTimeout);\n      \tif(this.settings.hidden) {\n      \t\tthis.element.removeChild(this.wrapper);\n      \t} else {\n      \t\tthis.element.removeChild(this.container);\n      \t}\n      */\n    }\n  }, {\n    key: \"onOrientationChange\",\n    value: function onOrientationChange(e) {\n      var _window = window,\n        orientation = _window.orientation;\n      if (this.optsSettings.resizeOnOrientationChange) {\n        this.resize();\n      }\n\n      // Per ampproject:\n      // In IOS 10.3, the measured size of an element is incorrect if the\n      // element size depends on window size directly and the measurement\n      // happens in window.resize event. Adding a timeout for correct\n      // measurement. See https://github.com/ampproject/amphtml/issues/8479\n      clearTimeout(this.orientationTimeout);\n      this.orientationTimeout = setTimeout(function () {\n        this.orientationTimeout = undefined;\n        if (this.optsSettings.resizeOnOrientationChange) {\n          this.resize();\n        }\n        this.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n      }.bind(this), 500);\n    }\n  }, {\n    key: \"onResized\",\n    value: function onResized(e) {\n      this.resize();\n    }\n  }, {\n    key: \"resize\",\n    value: function resize(width, height, epubcfi) {\n      var stageSize = this.stage.size(width, height);\n\n      // For Safari, wait for orientation to catch up\n      // if the window is a square\n      this.winBounds = windowBounds();\n      if (this.orientationTimeout && this.winBounds.width === this.winBounds.height) {\n        // reset the stage size for next resize\n        this._stageSize = undefined;\n        return;\n      }\n      if (this._stageSize && this._stageSize.width === stageSize.width && this._stageSize.height === stageSize.height) {\n        // Size is the same, no need to resize\n        return;\n      }\n      this._stageSize = stageSize;\n      this._bounds = this.bounds();\n\n      // Clear current views\n      this.clear();\n\n      // Update for new views\n      this.viewSettings.width = this._stageSize.width;\n      this.viewSettings.height = this._stageSize.height;\n      this.updateLayout();\n      this.emit(EVENTS.MANAGERS.RESIZED, {\n        width: this._stageSize.width,\n        height: this._stageSize.height\n      }, epubcfi);\n    }\n  }, {\n    key: \"createView\",\n    value: function createView(section, forceRight) {\n      return new this.View(section, extend(this.viewSettings, {\n        forceRight: forceRight\n      }));\n    }\n  }, {\n    key: \"handleNextPrePaginated\",\n    value: function handleNextPrePaginated(forceRight, section, action) {\n      var next;\n      if (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n        if (forceRight || section.index === 0) {\n          // First page (cover) should stand alone for pre-paginated books\n          return;\n        }\n        next = section.next();\n        if (next && !next.properties.includes(\"page-spread-left\")) {\n          return action.call(this, next);\n        }\n      }\n    }\n  }, {\n    key: \"display\",\n    value: function display(section, target) {\n      var displaying = new defer();\n      var displayed = displaying.promise;\n\n      // Check if moving to target is needed\n      if (target === section.href || isNumber(target)) {\n        target = undefined;\n      }\n\n      // Check to make sure the section we want isn't already shown\n      var visible = this.views.find(section);\n\n      // View is already shown, just move to correct location in view\n      if (visible && section && this.layout.name !== \"pre-paginated\") {\n        var offset = visible.offset();\n        if (this.settings.direction === \"ltr\") {\n          this.scrollTo(offset.left, offset.top, true);\n        } else {\n          var width = visible.width();\n          this.scrollTo(offset.left + width, offset.top, true);\n        }\n        if (target) {\n          var _offset = visible.locationOf(target);\n          var _width = visible.width();\n          this.moveTo(_offset, _width);\n        }\n        displaying.resolve();\n        return displayed;\n      }\n\n      // Hide all current views\n      this.clear();\n      var forceRight = false;\n      if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\n        forceRight = true;\n      }\n      this.add(section, forceRight).then(function (view) {\n        // Move to correct place within the section, if needed\n        if (target) {\n          var _offset2 = view.locationOf(target);\n          var _width2 = view.width();\n          this.moveTo(_offset2, _width2);\n        }\n      }.bind(this), function (err) {\n        displaying.reject(err);\n      }).then(function () {\n        return this.handleNextPrePaginated(forceRight, section, this.add);\n      }.bind(this)).then(function () {\n        this.views.show();\n        displaying.resolve();\n      }.bind(this));\n      // .then(function(){\n      // \treturn this.hooks.display.trigger(view);\n      // }.bind(this))\n      // .then(function(){\n      // \tthis.views.show();\n      // }.bind(this));\n      return displayed;\n    }\n  }, {\n    key: \"afterDisplayed\",\n    value: function afterDisplayed(view) {\n      this.emit(EVENTS.MANAGERS.ADDED, view);\n    }\n  }, {\n    key: \"afterResized\",\n    value: function afterResized(view) {\n      this.emit(EVENTS.MANAGERS.RESIZE, view.section);\n    }\n  }, {\n    key: \"moveTo\",\n    value: function moveTo(offset, width) {\n      var distX = 0,\n        distY = 0;\n      if (!this.isPaginated) {\n        distY = offset.top;\n      } else {\n        distX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n        if (distX + this.layout.delta > this.container.scrollWidth) {\n          distX = this.container.scrollWidth - this.layout.delta;\n        }\n        distY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\n        if (distY + this.layout.delta > this.container.scrollHeight) {\n          distY = this.container.scrollHeight - this.layout.delta;\n        }\n      }\n      if (this.settings.direction === 'rtl') {\n        /***\n        \tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta`\n        \tto distX or use `Math.ceil` function, or multiply offset.left by -1\n        \tbefore `Math.floor`\n        */\n        distX = distX + this.layout.delta;\n        distX = distX - width;\n      }\n      this.scrollTo(distX, distY, true);\n    }\n  }, {\n    key: \"add\",\n    value: function add(section, forceRight) {\n      var _this = this;\n      var view = this.createView(section, forceRight);\n      this.views.append(view);\n\n      // view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n      view.onDisplayed = this.afterDisplayed.bind(this);\n      view.onResize = this.afterResized.bind(this);\n      view.on(EVENTS.VIEWS.AXIS, function (axis) {\n        _this.updateAxis(axis);\n      });\n      view.on(EVENTS.VIEWS.WRITING_MODE, function (mode) {\n        _this.updateWritingMode(mode);\n      });\n      return view.display(this.request);\n    }\n  }, {\n    key: \"append\",\n    value: function append(section, forceRight) {\n      var _this2 = this;\n      var view = this.createView(section, forceRight);\n      this.views.append(view);\n      view.onDisplayed = this.afterDisplayed.bind(this);\n      view.onResize = this.afterResized.bind(this);\n      view.on(EVENTS.VIEWS.AXIS, function (axis) {\n        _this2.updateAxis(axis);\n      });\n      view.on(EVENTS.VIEWS.WRITING_MODE, function (mode) {\n        _this2.updateWritingMode(mode);\n      });\n      return view.display(this.request);\n    }\n  }, {\n    key: \"prepend\",\n    value: function prepend(section, forceRight) {\n      var _this3 = this;\n      var view = this.createView(section, forceRight);\n      view.on(EVENTS.VIEWS.RESIZED, function (bounds) {\n        _this3.counter(bounds);\n      });\n      this.views.prepend(view);\n      view.onDisplayed = this.afterDisplayed.bind(this);\n      view.onResize = this.afterResized.bind(this);\n      view.on(EVENTS.VIEWS.AXIS, function (axis) {\n        _this3.updateAxis(axis);\n      });\n      view.on(EVENTS.VIEWS.WRITING_MODE, function (mode) {\n        _this3.updateWritingMode(mode);\n      });\n      return view.display(this.request);\n    }\n  }, {\n    key: \"counter\",\n    value: function counter(bounds) {\n      if (this.settings.axis === \"vertical\") {\n        this.scrollBy(0, bounds.heightDelta, true);\n      } else {\n        this.scrollBy(bounds.widthDelta, 0, true);\n      }\n    }\n\n    // resizeView(view) {\n    //\n    // \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n    // \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n    // \t} else {\n    // \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n    // \t}\n    //\n    // };\n  }, {\n    key: \"next\",\n    value: function next() {\n      var next;\n      var left;\n      var dir = this.settings.direction;\n      if (!this.views.length) return;\n      if (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n        this.scrollLeft = this.container.scrollLeft;\n        left = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n        if (left <= this.container.scrollWidth) {\n          this.scrollBy(this.layout.delta, 0, true);\n        } else {\n          next = this.views.last().section.next();\n        }\n      } else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n        this.scrollLeft = this.container.scrollLeft;\n        if (this.settings.rtlScrollType === \"default\") {\n          left = this.container.scrollLeft;\n          if (left > 0) {\n            this.scrollBy(this.layout.delta, 0, true);\n          } else {\n            next = this.views.last().section.next();\n          }\n        } else {\n          left = this.container.scrollLeft + this.layout.delta * -1;\n          if (left > this.container.scrollWidth * -1) {\n            this.scrollBy(this.layout.delta, 0, true);\n          } else {\n            next = this.views.last().section.next();\n          }\n        }\n      } else if (this.isPaginated && this.settings.axis === \"vertical\") {\n        this.scrollTop = this.container.scrollTop;\n        var top = this.container.scrollTop + this.container.offsetHeight;\n        if (top < this.container.scrollHeight) {\n          this.scrollBy(0, this.layout.height, true);\n        } else {\n          next = this.views.last().section.next();\n        }\n      } else {\n        next = this.views.last().section.next();\n      }\n      if (next) {\n        this.clear();\n        // The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n        this.updateLayout();\n        var forceRight = false;\n        if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\n          forceRight = true;\n        }\n        return this.append(next, forceRight).then(function () {\n          return this.handleNextPrePaginated(forceRight, next, this.append);\n        }.bind(this), function (err) {\n          return err;\n        }).then(function () {\n          // Reset position to start for scrolled-doc vertical-rl in default mode\n          if (!this.isPaginated && this.settings.axis === \"horizontal\" && this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\") {\n            this.scrollTo(this.container.scrollWidth, 0, true);\n          }\n          this.views.show();\n        }.bind(this));\n      }\n    }\n  }, {\n    key: \"prev\",\n    value: function prev() {\n      var prev;\n      var left;\n      var dir = this.settings.direction;\n      if (!this.views.length) return;\n      if (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n        this.scrollLeft = this.container.scrollLeft;\n        left = this.container.scrollLeft;\n        if (left > 0) {\n          this.scrollBy(-this.layout.delta, 0, true);\n        } else {\n          prev = this.views.first().section.prev();\n        }\n      } else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n        this.scrollLeft = this.container.scrollLeft;\n        if (this.settings.rtlScrollType === \"default\") {\n          left = this.container.scrollLeft + this.container.offsetWidth;\n          if (left < this.container.scrollWidth) {\n            this.scrollBy(-this.layout.delta, 0, true);\n          } else {\n            prev = this.views.first().section.prev();\n          }\n        } else {\n          left = this.container.scrollLeft;\n          if (left < 0) {\n            this.scrollBy(-this.layout.delta, 0, true);\n          } else {\n            prev = this.views.first().section.prev();\n          }\n        }\n      } else if (this.isPaginated && this.settings.axis === \"vertical\") {\n        this.scrollTop = this.container.scrollTop;\n        var top = this.container.scrollTop;\n        if (top > 0) {\n          this.scrollBy(0, -this.layout.height, true);\n        } else {\n          prev = this.views.first().section.prev();\n        }\n      } else {\n        prev = this.views.first().section.prev();\n      }\n      if (prev) {\n        this.clear();\n        // The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n        this.updateLayout();\n        var forceRight = false;\n        if (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\n          forceRight = true;\n        }\n        return this.prepend(prev, forceRight).then(function () {\n          var left;\n          if (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n            left = prev.prev();\n            if (left) {\n              return this.prepend(left);\n            }\n          }\n        }.bind(this), function (err) {\n          return err;\n        }).then(function () {\n          if (this.isPaginated && this.settings.axis === \"horizontal\") {\n            if (this.settings.direction === \"rtl\") {\n              if (this.settings.rtlScrollType === \"default\") {\n                this.scrollTo(0, 0, true);\n              } else {\n                this.scrollTo(this.container.scrollWidth * -1 + this.layout.delta, 0, true);\n              }\n            } else {\n              this.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n            }\n          }\n          this.views.show();\n        }.bind(this));\n      }\n    }\n  }, {\n    key: \"current\",\n    value: function current() {\n      var visible = this.visible();\n      if (visible.length) {\n        // Current is the last visible view\n        return visible[visible.length - 1];\n      }\n      return null;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      // this.q.clear();\n\n      if (this.views) {\n        this.views.hide();\n        this.scrollTo(0, 0, true);\n        this.views.clear();\n      }\n    }\n  }, {\n    key: \"currentLocation\",\n    value: function currentLocation() {\n      this.updateLayout();\n      if (this.isPaginated && this.settings.axis === \"horizontal\") {\n        this.location = this.paginatedLocation();\n      } else {\n        this.location = this.scrolledLocation();\n      }\n      return this.location;\n    }\n  }, {\n    key: \"scrolledLocation\",\n    value: function scrolledLocation() {\n      var _this4 = this;\n      var visible = this.visible();\n      var container = this.container.getBoundingClientRect();\n      var pageHeight = container.height < window.innerHeight ? container.height : window.innerHeight;\n      var pageWidth = container.width < window.innerWidth ? container.width : window.innerWidth;\n      var vertical = this.settings.axis === \"vertical\";\n      var rtl = this.settings.direction === \"rtl\";\n      var offset = 0;\n      var used = 0;\n      if (this.settings.fullsize) {\n        offset = vertical ? window.scrollY : window.scrollX;\n      }\n      var sections = visible.map(function (view) {\n        var _view$section = view.section,\n          index = _view$section.index,\n          href = _view$section.href;\n        var position = view.position();\n        var width = view.width();\n        var height = view.height();\n        var startPos;\n        var endPos;\n        var stopPos;\n        var totalPages;\n        if (vertical) {\n          startPos = offset + container.top - position.top + used;\n          endPos = startPos + pageHeight - used;\n          totalPages = _this4.layout.count(height, pageHeight).pages;\n          stopPos = pageHeight;\n        } else {\n          startPos = offset + container.left - position.left + used;\n          endPos = startPos + pageWidth - used;\n          totalPages = _this4.layout.count(width, pageWidth).pages;\n          stopPos = pageWidth;\n        }\n        var currPage = Math.ceil(startPos / stopPos);\n        var pages = [];\n        var endPage = Math.ceil(endPos / stopPos);\n\n        // Reverse page counts for horizontal rtl\n        if (_this4.settings.direction === \"rtl\" && !vertical) {\n          var tempStartPage = currPage;\n          currPage = totalPages - endPage;\n          endPage = totalPages - tempStartPage;\n        }\n        pages = [];\n        for (var i = currPage; i <= endPage; i++) {\n          var pg = i + 1;\n          pages.push(pg);\n        }\n        var mapping = _this4.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n        return {\n          index: index,\n          href: href,\n          pages: pages,\n          totalPages: totalPages,\n          mapping: mapping\n        };\n      });\n      return sections;\n    }\n  }, {\n    key: \"paginatedLocation\",\n    value: function paginatedLocation() {\n      var _this5 = this;\n      var visible = this.visible();\n      var container = this.container.getBoundingClientRect();\n      var left = 0;\n      var used = 0;\n      if (this.settings.fullsize) {\n        left = window.scrollX;\n      }\n      var sections = visible.map(function (view) {\n        var _view$section2 = view.section,\n          index = _view$section2.index,\n          href = _view$section2.href;\n        var offset;\n        var position = view.position();\n        var width = view.width();\n\n        // Find mapping\n        var start;\n        var end;\n        var pageWidth;\n        if (_this5.settings.direction === \"rtl\") {\n          offset = container.right - left;\n          pageWidth = Math.min(Math.abs(offset - position.left), _this5.layout.width) - used;\n          end = position.width - (position.right - offset) - used;\n          start = end - pageWidth;\n        } else {\n          offset = container.left + left;\n          pageWidth = Math.min(position.right - offset, _this5.layout.width) - used;\n          start = offset - position.left + used;\n          end = start + pageWidth;\n        }\n        used += pageWidth;\n        var mapping = _this5.mapping.page(view.contents, view.section.cfiBase, start, end);\n        var totalPages = _this5.layout.count(width).pages;\n        var startPage = Math.floor(start / _this5.layout.pageWidth);\n        var pages = [];\n        var endPage = Math.floor(end / _this5.layout.pageWidth);\n\n        // start page should not be negative\n        if (startPage < 0) {\n          startPage = 0;\n          endPage = endPage + 1;\n        }\n\n        // Reverse page counts for rtl\n        if (_this5.settings.direction === \"rtl\") {\n          var tempStartPage = startPage;\n          startPage = totalPages - endPage;\n          endPage = totalPages - tempStartPage;\n        }\n        for (var i = startPage + 1; i <= endPage; i++) {\n          var pg = i;\n          pages.push(pg);\n        }\n        return {\n          index: index,\n          href: href,\n          pages: pages,\n          totalPages: totalPages,\n          mapping: mapping\n        };\n      });\n      return sections;\n    }\n  }, {\n    key: \"isVisible\",\n    value: function isVisible(view, offsetPrev, offsetNext, _container) {\n      var position = view.position();\n      var container = _container || this.bounds();\n      if (this.settings.axis === \"horizontal\" && position.right > container.left - offsetPrev && position.left < container.right + offsetNext) {\n        return true;\n      } else if (this.settings.axis === \"vertical\" && position.bottom > container.top - offsetPrev && position.top < container.bottom + offsetNext) {\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"visible\",\n    value: function visible() {\n      var container = this.bounds();\n      var views = this.views.displayed();\n      var viewsLength = views.length;\n      var visible = [];\n      var isVisible;\n      var view;\n      for (var i = 0; i < viewsLength; i++) {\n        view = views[i];\n        isVisible = this.isVisible(view, 0, 0, container);\n        if (isVisible === true) {\n          visible.push(view);\n        }\n      }\n      return visible;\n    }\n  }, {\n    key: \"scrollBy\",\n    value: function scrollBy(x, y, silent) {\n      var dir = this.settings.direction === \"rtl\" ? -1 : 1;\n      if (silent) {\n        this.ignore = true;\n      }\n      if (!this.settings.fullsize) {\n        if (x) this.container.scrollLeft += x * dir;\n        if (y) this.container.scrollTop += y;\n      } else {\n        window.scrollBy(x * dir, y * dir);\n      }\n      this.scrolled = true;\n    }\n  }, {\n    key: \"scrollTo\",\n    value: function scrollTo(x, y, silent) {\n      if (silent) {\n        this.ignore = true;\n      }\n      if (!this.settings.fullsize) {\n        this.container.scrollLeft = x;\n        this.container.scrollTop = y;\n      } else {\n        window.scrollTo(x, y);\n      }\n      this.scrolled = true;\n    }\n  }, {\n    key: \"onScroll\",\n    value: function onScroll() {\n      var scrollTop;\n      var scrollLeft;\n      if (!this.settings.fullsize) {\n        scrollTop = this.container.scrollTop;\n        scrollLeft = this.container.scrollLeft;\n      } else {\n        scrollTop = window.scrollY;\n        scrollLeft = window.scrollX;\n      }\n      this.scrollTop = scrollTop;\n      this.scrollLeft = scrollLeft;\n      if (!this.ignore) {\n        this.emit(EVENTS.MANAGERS.SCROLL, {\n          top: scrollTop,\n          left: scrollLeft\n        });\n        clearTimeout(this.afterScrolled);\n        this.afterScrolled = setTimeout(function () {\n          this.emit(EVENTS.MANAGERS.SCROLLED, {\n            top: this.scrollTop,\n            left: this.scrollLeft\n          });\n        }.bind(this), 20);\n      } else {\n        this.ignore = false;\n      }\n    }\n  }, {\n    key: \"bounds\",\n    value: function bounds() {\n      var bounds;\n      bounds = this.stage.bounds();\n      return bounds;\n    }\n  }, {\n    key: \"applyLayout\",\n    value: function applyLayout(layout) {\n      this.layout = layout;\n      this.updateLayout();\n      if (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\n        this.display(this.views.first().section);\n      }\n      // this.manager.layout(this.layout.format);\n    }\n  }, {\n    key: \"updateLayout\",\n    value: function updateLayout() {\n      if (!this.stage) {\n        return;\n      }\n      this._stageSize = this.stage.size();\n      if (!this.isPaginated) {\n        this.layout.calculate(this._stageSize.width, this._stageSize.height);\n      } else {\n        this.layout.calculate(this._stageSize.width, this._stageSize.height, this.settings.gap);\n\n        // Set the look ahead offset for what is visible\n        this.settings.offset = this.layout.delta / this.layout.divisor;\n\n        // this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n      }\n\n      // Set the dimensions for views\n      this.viewSettings.width = this.layout.width;\n      this.viewSettings.height = this.layout.height;\n      this.setLayout(this.layout);\n    }\n  }, {\n    key: \"setLayout\",\n    value: function setLayout(layout) {\n      this.viewSettings.layout = layout;\n      this.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n      if (this.views) {\n        this.views.forEach(function (view) {\n          if (view) {\n            view.setLayout(layout);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"updateWritingMode\",\n    value: function updateWritingMode(mode) {\n      this.writingMode = mode;\n    }\n  }, {\n    key: \"updateAxis\",\n    value: function updateAxis(axis, forceUpdate) {\n      if (!forceUpdate && axis === this.settings.axis) {\n        return;\n      }\n      this.settings.axis = axis;\n      this.stage && this.stage.axis(axis);\n      this.viewSettings.axis = axis;\n      if (this.mapping) {\n        this.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n      }\n      if (this.layout) {\n        if (axis === \"vertical\") {\n          this.layout.spread(\"none\");\n        } else {\n          this.layout.spread(this.layout.settings.spread);\n        }\n      }\n    }\n  }, {\n    key: \"updateFlow\",\n    value: function updateFlow(flow) {\n      var defaultScrolledOverflow = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"auto\";\n      var isPaginated = flow === \"paginated\" || flow === \"auto\";\n      this.isPaginated = isPaginated;\n      if (flow === \"scrolled-doc\" || flow === \"scrolled-continuous\" || flow === \"scrolled\") {\n        this.updateAxis(\"vertical\");\n      } else {\n        this.updateAxis(\"horizontal\");\n      }\n      this.viewSettings.flow = flow;\n      if (!this.settings.overflow) {\n        this.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\n      } else {\n        this.overflow = this.settings.overflow;\n      }\n      this.stage && this.stage.overflow(this.overflow);\n      this.updateLayout();\n    }\n  }, {\n    key: \"getContents\",\n    value: function getContents() {\n      var contents = [];\n      if (!this.views) {\n        return contents;\n      }\n      this.views.forEach(function (view) {\n        var viewContents = view && view.contents;\n        if (viewContents) {\n          contents.push(viewContents);\n        }\n      });\n      return contents;\n    }\n  }, {\n    key: \"direction\",\n    value: function direction() {\n      var dir = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"ltr\";\n      this.settings.direction = dir;\n      this.stage && this.stage.direction(dir);\n      this.viewSettings.direction = dir;\n      this.updateLayout();\n    }\n  }, {\n    key: \"isRendered\",\n    value: function isRendered() {\n      return this.rendered;\n    }\n  }]);\n  return DefaultViewManager;\n}(); //-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\nexport default DefaultViewManager;","map":{"version":3,"names":["EventEmitter","extend","defer","windowBounds","isNumber","scrollType","Mapping","Queue","Stage","Views","EVENTS","DefaultViewManager","options","name","optsSettings","settings","View","view","request","renditionQueue","queue","q","infinite","hidden","width","undefined","height","axis","writingMode","flow","ignoreClass","fullsize","allowScriptedContent","allowPopups","viewSettings","layout","method","forceEvenPages","rendered","element","size","tag","tagName","toLowerCase","overflow","rtlScrollType","stage","direction","attachTo","container","getContainer","views","_bounds","bounds","_stageSize","onResize","onResized","bind","onOrientationChange","addEventListeners","updateLayout","scroller","window","addEventListener","e","destroy","_onScroll","onScroll","removeEventListener","clearTimeout","orientationTimeout","resizeTimeout","afterScrolled","clear","removeEventListeners","orientation","resizeOnOrientationChange","resize","setTimeout","emit","MANAGERS","ORIENTATION_CHANGE","epubcfi","stageSize","winBounds","RESIZED","section","forceRight","action","next","divisor","index","properties","includes","call","target","displaying","displayed","promise","href","visible","find","offset","scrollTo","left","top","locationOf","moveTo","resolve","add","then","err","reject","handleNextPrePaginated","show","ADDED","RESIZE","distX","distY","isPaginated","Math","floor","delta","scrollWidth","scrollHeight","createView","append","onDisplayed","afterDisplayed","afterResized","on","VIEWS","AXIS","updateAxis","WRITING_MODE","mode","updateWritingMode","display","counter","prepend","scrollBy","heightDelta","widthDelta","dir","length","scrollLeft","offsetWidth","last","scrollTop","offsetHeight","prev","first","hide","location","paginatedLocation","scrolledLocation","getBoundingClientRect","pageHeight","innerHeight","pageWidth","innerWidth","vertical","rtl","used","scrollY","scrollX","sections","map","position","startPos","endPos","stopPos","totalPages","count","pages","currPage","ceil","endPage","tempStartPage","i","pg","push","mapping","page","contents","cfiBase","start","end","right","min","abs","startPage","offsetPrev","offsetNext","_container","bottom","viewsLength","isVisible","x","y","silent","ignore","scrolled","SCROLL","SCROLLED","calculate","gap","setLayout","props","forEach","forceUpdate","spread","defaultScrolledOverflow","viewContents","prototype"],"sources":["/home/parallels/Downloads/read/node_modules/epubjs/src/managers/default/index.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {extend, defer, windowBounds, isNumber} from \"../../utils/core\";\nimport scrollType from \"../../utils/scrolltype\";\nimport Mapping from \"../../mapping\";\nimport Queue from \"../../utils/queue\";\nimport Stage from \"../helpers/stage\";\nimport Views from \"../helpers/views\";\nimport { EVENTS } from \"../../utils/constants\";\n\nclass DefaultViewManager {\n\tconstructor(options) {\n\n\t\tthis.name = \"default\";\n\t\tthis.optsSettings = options.settings;\n\t\tthis.View = options.view;\n\t\tthis.request = options.request;\n\t\tthis.renditionQueue = options.queue;\n\t\tthis.q = new Queue(this);\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\tinfinite: true,\n\t\t\thidden: false,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\taxis: undefined,\n\t\t\twritingMode: undefined,\n\t\t\tflow: \"scrolled\",\n\t\t\tignoreClass: \"\",\n\t\t\tfullsize: undefined,\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t});\n\n\t\textend(this.settings, options.settings || {});\n\n\t\tthis.viewSettings = {\n\t\t\tignoreClass: this.settings.ignoreClass,\n\t\t\taxis: this.settings.axis,\n\t\t\tflow: this.settings.flow,\n\t\t\tlayout: this.layout,\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tforceEvenPages: true,\n\t\t\tallowScriptedContent: this.settings.allowScriptedContent,\n\t\t\tallowPopups: this.settings.allowPopups\n\t\t};\n\n\t\tthis.rendered = false;\n\n\t}\n\n\trender(element, size){\n\t\tlet tag = element.tagName;\n\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\n\t\t\t\ttag && (tag.toLowerCase() == \"body\" ||\n\t\t\t\ttag.toLowerCase() == \"html\")) {\n\t\t\t\tthis.settings.fullsize = true;\n\t\t}\n\n\t\tif (this.settings.fullsize) {\n\t\t\tthis.settings.overflow = \"visible\";\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.settings.size = size;\n\n\t\tthis.settings.rtlScrollType = scrollType();\n\n\t\t// Save the stage\n\t\tthis.stage = new Stage({\n\t\t\twidth: size.width,\n\t\t\theight: size.height,\n\t\t\toverflow: this.overflow,\n\t\t\thidden: this.settings.hidden,\n\t\t\taxis: this.settings.axis,\n\t\t\tfullsize: this.settings.fullsize,\n\t\t\tdirection: this.settings.direction\n\t\t});\n\n\t\tthis.stage.attachTo(element);\n\n\t\t// Get this stage container div\n\t\tthis.container = this.stage.getContainer();\n\n\t\t// Views array methods\n\t\tthis.views = new Views(this.container);\n\n\t\t// Calculate Stage Size\n\t\tthis._bounds = this.bounds();\n\t\tthis._stageSize = this.stage.size();\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\t// Function to handle a resize event.\n\t\t// Will only attach if width and height are both fixed.\n\t\tthis.stage.onResize(this.onResized.bind(this));\n\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\n\n\t\t// Add Event Listeners\n\t\tthis.addEventListeners();\n\n\t\t// Add Layout method\n\t\t// this.applyLayoutMethod();\n\t\tif (this.layout) {\n\t\t\tthis.updateLayout();\n\t\t}\n\n\t\tthis.rendered = true;\n\n\t}\n\n\taddEventListeners(){\n\t\tvar scroller;\n\n\t\twindow.addEventListener(\"unload\", function(e){\n\t\t\tthis.destroy();\n\t\t}.bind(this));\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tthis._onScroll = this.onScroll.bind(this);\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\n\t}\n\n\tremoveEventListeners(){\n\t\tvar scroller;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscroller = this.container;\n\t\t} else {\n\t\t\tscroller = window;\n\t\t}\n\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\n\t\tthis._onScroll = undefined;\n\t}\n\n\tdestroy(){\n\t\tclearTimeout(this.orientationTimeout);\n\t\tclearTimeout(this.resizeTimeout);\n\t\tclearTimeout(this.afterScrolled);\n\n\t\tthis.clear();\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.stage.destroy();\n\n\t\tthis.rendered = false;\n\n\t\t/*\n\n\t\t\tclearTimeout(this.trimTimeout);\n\t\t\tif(this.settings.hidden) {\n\t\t\t\tthis.element.removeChild(this.wrapper);\n\t\t\t} else {\n\t\t\t\tthis.element.removeChild(this.container);\n\t\t\t}\n\t\t*/\n\t}\n\n\tonOrientationChange(e) {\n\t\tlet {orientation} = window;\n\n\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\tthis.resize();\n\t\t}\n\n\t\t// Per ampproject:\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\n\t\t// element size depends on window size directly and the measurement\n\t\t// happens in window.resize event. Adding a timeout for correct\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\n\t\tclearTimeout(this.orientationTimeout);\n\t\tthis.orientationTimeout = setTimeout(function(){\n\t\t\tthis.orientationTimeout = undefined;\n\n\t\t\tif(this.optsSettings.resizeOnOrientationChange) {\n\t\t\t\tthis.resize();\n\t\t\t}\n\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\n\t\t}.bind(this), 500);\n\n\t}\n\n\tonResized(e) {\n\t\tthis.resize();\n\t}\n\n\tresize(width, height, epubcfi){\n\t\tlet stageSize = this.stage.size(width, height);\n\n\t\t// For Safari, wait for orientation to catch up\n\t\t// if the window is a square\n\t\tthis.winBounds = windowBounds();\n\t\tif (this.orientationTimeout &&\n\t\t\t\tthis.winBounds.width === this.winBounds.height) {\n\t\t\t// reset the stage size for next resize\n\t\t\tthis._stageSize = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._stageSize &&\n\t\t\t\tthis._stageSize.width === stageSize.width &&\n\t\t\t\tthis._stageSize.height === stageSize.height ) {\n\t\t\t// Size is the same, no need to resize\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = stageSize;\n\n\t\tthis._bounds = this.bounds();\n\n\t\t// Clear current views\n\t\tthis.clear();\n\n\t\t// Update for new views\n\t\tthis.viewSettings.width = this._stageSize.width;\n\t\tthis.viewSettings.height = this._stageSize.height;\n\n\t\tthis.updateLayout();\n\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\n\t\t\twidth: this._stageSize.width,\n\t\t\theight: this._stageSize.height\n\t\t}, epubcfi);\n\t}\n\n\tcreateView(section, forceRight) {\n\t\treturn new this.View(section, extend(this.viewSettings, { forceRight }) );\n\t}\n\n\thandleNextPrePaginated(forceRight, section, action) {\n\t\tlet next;\n\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\tif (forceRight || section.index === 0) {\n\t\t\t\t// First page (cover) should stand alone for pre-paginated books\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnext = section.next();\n\t\t\tif (next && !next.properties.includes(\"page-spread-left\")) {\n\t\t\t\treturn action.call(this, next);\n\t\t\t}\n\t\t}\n\t}\n\n\tdisplay(section, target){\n\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\n\t\t// Check if moving to target is needed\n\t\tif (target === section.href || isNumber(target)) {\n\t\t\ttarget = undefined;\n\t\t}\n\n\t\t// Check to make sure the section we want isn't already shown\n\t\tvar visible = this.views.find(section);\n\n\t\t// View is already shown, just move to correct location in view\n\t\tif(visible && section && this.layout.name !== \"pre-paginated\") {\n\t\t\tlet offset = visible.offset();\n\n\t\t\tif (this.settings.direction === \"ltr\") {\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\n\t\t\t} else {\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\n\t\t\t}\n\n\t\t\tif(target) {\n\t\t\t\tlet offset = visible.locationOf(target);\n\t\t\t\tlet width = visible.width();\n\t\t\t\tthis.moveTo(offset, width);\n\t\t\t}\n\n\t\t\tdisplaying.resolve();\n\t\t\treturn displayed;\n\t\t}\n\n\t\t// Hide all current views\n\t\tthis.clear();\n\n\t\tlet forceRight = false;\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\n\t\t\tforceRight = true;\n\t\t}\n\n\t\tthis.add(section, forceRight)\n\t\t\t.then(function(view){\n\n\t\t\t\t// Move to correct place within the section, if needed\n\t\t\t\tif(target) {\n\t\t\t\t\tlet offset = view.locationOf(target);\n\t\t\t\t\tlet width = view.width();\n\t\t\t\t\tthis.moveTo(offset, width);\n\t\t\t\t}\n\n\t\t\t}.bind(this), (err) => {\n\t\t\t\tdisplaying.reject(err);\n\t\t\t})\n\t\t\t.then(function(){\n\t\t\t\treturn this.handleNextPrePaginated(forceRight, section, this.add);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\tthis.views.show();\n\n\t\t\t\tdisplaying.resolve();\n\n\t\t\t}.bind(this));\n\t\t// .then(function(){\n\t\t// \treturn this.hooks.display.trigger(view);\n\t\t// }.bind(this))\n\t\t// .then(function(){\n\t\t// \tthis.views.show();\n\t\t// }.bind(this));\n\t\treturn displayed;\n\t}\n\n\tafterDisplayed(view){\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\n\t}\n\n\tafterResized(view){\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\n\t}\n\n\tmoveTo(offset, width){\n\t\tvar distX = 0,\n\t\t\t\tdistY = 0;\n\n\t\tif(!this.isPaginated) {\n\t\t\tdistY = offset.top;\n\t\t} else {\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\n\t\t\t}\n\n\t\t\tdistY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\n\n\t\t\tif (distY + this.layout.delta > this.container.scrollHeight) {\n\t\t\t\tdistY = this.container.scrollHeight - this.layout.delta;\n\t\t\t}\n\t\t}\n\t\tif(this.settings.direction === 'rtl'){\n\t\t\t/***\n\t\t\t\tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta`\n\t\t\t\tto distX or use `Math.ceil` function, or multiply offset.left by -1\n\t\t\t\tbefore `Math.floor`\n\t\t\t*/\n\t\t\tdistX = distX + this.layout.delta\n\t\t\tdistX = distX - width\n\t\t}\n\t\tthis.scrollTo(distX, distY, true);\n\t}\n\n\tadd(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\n\t\tthis.views.append(view);\n\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tappend(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\t\tthis.views.append(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tprepend(section, forceRight){\n\t\tvar view = this.createView(section, forceRight);\n\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\n\t\t\tthis.counter(bounds);\n\t\t});\n\n\t\tthis.views.prepend(view);\n\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\n\t\tview.onResize = this.afterResized.bind(this);\n\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\n\t\t\tthis.updateAxis(axis);\n\t\t});\n\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\n\t\t\tthis.updateWritingMode(mode);\n\t\t});\n\n\t\treturn view.display(this.request);\n\t}\n\n\tcounter(bounds){\n\t\tif(this.settings.axis === \"vertical\") {\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\n\t\t} else {\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\n\t\t}\n\n\t}\n\n\t// resizeView(view) {\n\t//\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\n\t// \t} else {\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\n\t// \t}\n\t//\n\t// };\n\n\tnext(){\n\t\tvar next;\n\t\tvar left;\n\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\n\n\t\t\tif(left <= this.container.scrollWidth) {\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\tleft = this.container.scrollLeft;\n\n\t\t\t\tif (left > 0) {\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tnext = this.views.last().section.next();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tleft = this.container.scrollLeft + ( this.layout.delta * -1 );\n\n\t\t\t\tif (left > this.container.scrollWidth * -1){\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tnext = this.views.last().section.next();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top  = this.container.scrollTop + this.container.offsetHeight;\n\n\t\t\tif(top < this.container.scrollHeight) {\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\n\t\t\t} else {\n\t\t\t\tnext = this.views.last().section.next();\n\t\t\t}\n\n\t\t} else {\n\t\t\tnext = this.views.last().section.next();\n\t\t}\n\n\t\tif(next) {\n\t\t\tthis.clear();\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\t\t\tthis.updateLayout();\n\n\t\t\tlet forceRight = false;\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\n\t\t\t\tforceRight = true;\n\t\t\t}\n\n\t\t\treturn this.append(next, forceRight)\n\t\t\t\t.then(function(){\n\t\t\t\t\treturn this.handleNextPrePaginated(forceRight, next, this.append);\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\n\t\t\t\t\t// Reset position to start for scrolled-doc vertical-rl in default mode\n\t\t\t\t\tif (!this.isPaginated &&\n\t\t\t\t\t\tthis.settings.axis === \"horizontal\" &&\n\t\t\t\t\t\tthis.settings.direction === \"rtl\" &&\n\t\t\t\t\t\tthis.settings.rtlScrollType === \"default\") {\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth, 0, true);\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\n\n\t}\n\n\tprev(){\n\t\tvar prev;\n\t\tvar left;\n\t\tlet dir = this.settings.direction;\n\n\t\tif(!this.views.length) return;\n\n\t\tif(this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tleft = this.container.scrollLeft;\n\n\t\t\tif(left > 0) {\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\n\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\n\n\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth;\n\n\t\t\t\tif (left < this.container.scrollWidth) {\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tleft = this.container.scrollLeft;\n\n\t\t\t\tif (left < 0) {\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\n\t\t\t\t} else {\n\t\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\n\n\t\t\tthis.scrollTop = this.container.scrollTop;\n\n\t\t\tlet top = this.container.scrollTop;\n\n\t\t\tif(top > 0) {\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\n\t\t\t} else {\n\t\t\t\tprev = this.views.first().section.prev();\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tprev = this.views.first().section.prev();\n\n\t\t}\n\n\t\tif(prev) {\n\t\t\tthis.clear();\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\n\t\t\tthis.updateLayout();\n\n\t\t\tlet forceRight = false;\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\n\t\t\t\tforceRight = true;\n\t\t\t}\n\n\t\t\treturn this.prepend(prev, forceRight)\n\t\t\t\t.then(function(){\n\t\t\t\t\tvar left;\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\n\t\t\t\t\t\tleft = prev.prev();\n\t\t\t\t\t\tif (left) {\n\t\t\t\t\t\t\treturn this.prepend(left);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), (err) => {\n\t\t\t\t\treturn err;\n\t\t\t\t})\n\t\t\t\t.then(function(){\n\t\t\t\t\tif(this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\t\t\t\tif (this.settings.rtlScrollType === \"default\"){\n\t\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\tthis.scrollTo((this.container.scrollWidth * -1) + this.layout.delta, 0, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth - this.layout.delta, 0, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.views.show();\n\t\t\t\t}.bind(this));\n\t\t}\n\t}\n\n\tcurrent(){\n\t\tvar visible = this.visible();\n\t\tif(visible.length){\n\t\t\t// Current is the last visible view\n\t\t\treturn visible[visible.length-1];\n\t\t}\n\t\treturn null;\n\t}\n\n\tclear () {\n\n\t\t// this.q.clear();\n\n\t\tif (this.views) {\n\t\t\tthis.views.hide();\n\t\t\tthis.scrollTo(0,0, true);\n\t\t\tthis.views.clear();\n\t\t}\n\t}\n\n\tcurrentLocation(){\n\t\tthis.updateLayout();\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\n\t\t\tthis.location = this.paginatedLocation();\n\t\t} else {\n\t\t\tthis.location = this.scrolledLocation();\n\t\t}\n\t\treturn this.location;\n\t}\n\n\tscrolledLocation() {\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\t\tlet pageHeight = (container.height < window.innerHeight) ? container.height : window.innerHeight;\n\t\tlet pageWidth = (container.width < window.innerWidth) ? container.width : window.innerWidth;\n\t\tlet vertical = (this.settings.axis === \"vertical\");\n\t\tlet rtl =  (this.settings.direction === \"rtl\");\n\t\t\n\t\tlet offset = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\toffset = vertical ? window.scrollY : window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet position = view.position();\n\t\t\tlet width = view.width();\n\t\t\tlet height = view.height();\n\n\t\t\tlet startPos;\n\t\t\tlet endPos;\n\t\t\tlet stopPos;\n\t\t\tlet totalPages;\n\n\t\t\tif (vertical) {\n\t\t\t\tstartPos = offset + container.top - position.top + used;\n\t\t\t\tendPos = startPos + pageHeight - used;\n\t\t\t\ttotalPages = this.layout.count(height, pageHeight).pages;\n\t\t\t\tstopPos = pageHeight;\n\t\t\t} else {\n\t\t\t\tstartPos = offset + container.left - position.left + used;\n\t\t\t\tendPos = startPos + pageWidth - used;\n\t\t\t\ttotalPages = this.layout.count(width, pageWidth).pages;\n\t\t\t\tstopPos = pageWidth;\n\t\t\t}\n\n\t\t\tlet currPage = Math.ceil(startPos / stopPos);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.ceil(endPos / stopPos);\n\n\t\t\t// Reverse page counts for horizontal rtl\n\t\t\tif (this.settings.direction === \"rtl\" && !vertical) {\n\t\t\t\tlet tempStartPage = currPage;\n\t\t\t\tcurrPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\t\t\tpages = [];\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\n\t\t\t\tlet pg = i + 1;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tpaginatedLocation(){\n\t\tlet visible = this.visible();\n\t\tlet container = this.container.getBoundingClientRect();\n\n\t\tlet left = 0;\n\t\tlet used = 0;\n\n\t\tif(this.settings.fullsize) {\n\t\t\tleft = window.scrollX;\n\t\t}\n\n\t\tlet sections = visible.map((view) => {\n\t\t\tlet {index, href} = view.section;\n\t\t\tlet offset;\n\t\t\tlet position = view.position();\n\t\t\tlet width = view.width();\n\n\t\t\t// Find mapping\n\t\t\tlet start;\n\t\t\tlet end;\n\t\t\tlet pageWidth;\n\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\toffset = container.right - left;\n\t\t\t\tpageWidth = Math.min(Math.abs(offset - position.left), this.layout.width) - used;\n\t\t\t\tend = position.width - (position.right - offset) - used;\n\t\t\t\tstart = end - pageWidth;\n\t\t\t} else {\n\t\t\t\toffset = container.left + left;\n\t\t\t\tpageWidth = Math.min(position.right - offset, this.layout.width) - used;\n\t\t\t\tstart = offset - position.left + used;\n\t\t\t\tend = start + pageWidth;\n\t\t\t}\n\n\t\t\tused += pageWidth;\n\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\n\n\t\t\tlet totalPages = this.layout.count(width).pages;\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\n\t\t\tlet pages = [];\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\n\t\t\t\n\t\t\t// start page should not be negative\n\t\t\tif (startPage < 0) {\n\t\t\t\tstartPage = 0;\n\t\t\t\tendPage = endPage + 1;\n\t\t\t}\n\n\t\t\t// Reverse page counts for rtl\n\t\t\tif (this.settings.direction === \"rtl\") {\n\t\t\t\tlet tempStartPage = startPage;\n\t\t\t\tstartPage = totalPages - endPage;\n\t\t\t\tendPage = totalPages - tempStartPage;\n\t\t\t}\n\n\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\n\t\t\t\tlet pg = i;\n\t\t\t\tpages.push(pg);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\thref,\n\t\t\t\tpages,\n\t\t\t\ttotalPages,\n\t\t\t\tmapping\n\t\t\t};\n\t\t});\n\n\t\treturn sections;\n\t}\n\n\tisVisible(view, offsetPrev, offsetNext, _container){\n\t\tvar position = view.position();\n\t\tvar container = _container || this.bounds();\n\n\t\tif(this.settings.axis === \"horizontal\" &&\n\t\t\tposition.right > container.left - offsetPrev &&\n\t\t\tposition.left < container.right + offsetNext) {\n\n\t\t\treturn true;\n\n\t\t} else if(this.settings.axis === \"vertical\" &&\n\t\t\tposition.bottom > container.top - offsetPrev &&\n\t\t\tposition.top < container.bottom + offsetNext) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tvisible(){\n\t\tvar container = this.bounds();\n\t\tvar views = this.views.displayed();\n\t\tvar viewsLength = views.length;\n\t\tvar visible = [];\n\t\tvar isVisible;\n\t\tvar view;\n\n\t\tfor (var i = 0; i < viewsLength; i++) {\n\t\t\tview = views[i];\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\n\n\t\t\tif(isVisible === true) {\n\t\t\t\tvisible.push(view);\n\t\t\t}\n\n\t\t}\n\t\treturn visible;\n\t}\n\n\tscrollBy(x, y, silent){\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\n\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tif(x) this.container.scrollLeft += x * dir;\n\t\t\tif(y) this.container.scrollTop += y;\n\t\t} else {\n\t\t\twindow.scrollBy(x * dir, y * dir);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tscrollTo(x, y, silent){\n\t\tif(silent) {\n\t\t\tthis.ignore = true;\n\t\t}\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tthis.container.scrollLeft = x;\n\t\t\tthis.container.scrollTop = y;\n\t\t} else {\n\t\t\twindow.scrollTo(x,y);\n\t\t}\n\t\tthis.scrolled = true;\n\t}\n\n\tonScroll(){\n\t\tlet scrollTop;\n\t\tlet scrollLeft;\n\n\t\tif(!this.settings.fullsize) {\n\t\t\tscrollTop = this.container.scrollTop;\n\t\t\tscrollLeft = this.container.scrollLeft;\n\t\t} else {\n\t\t\tscrollTop = window.scrollY;\n\t\t\tscrollLeft = window.scrollX;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.scrollLeft = scrollLeft;\n\n\t\tif(!this.ignore) {\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\n\t\t\t\ttop: scrollTop,\n\t\t\t\tleft: scrollLeft\n\t\t\t});\n\n\t\t\tclearTimeout(this.afterScrolled);\n\t\t\tthis.afterScrolled = setTimeout(function () {\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\n\t\t\t\t\ttop: this.scrollTop,\n\t\t\t\t\tleft: this.scrollLeft\n\t\t\t\t});\n\t\t\t}.bind(this), 20);\n\n\n\n\t\t} else {\n\t\t\tthis.ignore = false;\n\t\t}\n\n\t}\n\n\tbounds() {\n\t\tvar bounds;\n\n\t\tbounds = this.stage.bounds();\n\n\t\treturn bounds;\n\t}\n\n\tapplyLayout(layout) {\n\n\t\tthis.layout = layout;\n\t\tthis.updateLayout();\n\t\tif (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\n\t\t\tthis.display(this.views.first().section);\n\t\t}\n\t\t // this.manager.layout(this.layout.format);\n\t}\n\n\tupdateLayout() {\n\n\t\tif (!this.stage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stageSize = this.stage.size();\n\n\t\tif(!this.isPaginated) {\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\n\t\t} else {\n\t\t\tthis.layout.calculate(\n\t\t\t\tthis._stageSize.width,\n\t\t\t\tthis._stageSize.height,\n\t\t\t\tthis.settings.gap\n\t\t\t);\n\n\t\t\t// Set the look ahead offset for what is visible\n\t\t\tthis.settings.offset = this.layout.delta / this.layout.divisor;\n\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\n\n\t\t}\n\n\t\t// Set the dimensions for views\n\t\tthis.viewSettings.width = this.layout.width;\n\t\tthis.viewSettings.height = this.layout.height;\n\n\t\tthis.setLayout(this.layout);\n\t}\n\n\tsetLayout(layout){\n\n\t\tthis.viewSettings.layout = layout;\n\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\n\n\t\tif(this.views) {\n\n\t\t\tthis.views.forEach(function(view){\n\t\t\t\tif (view) {\n\t\t\t\t\tview.setLayout(layout);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\tupdateWritingMode(mode) {\n\t\tthis.writingMode = mode;\n\t}\n\n\tupdateAxis(axis, forceUpdate){\n\n\t\tif (!forceUpdate && axis === this.settings.axis) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settings.axis = axis;\n\n\t\tthis.stage && this.stage.axis(axis);\n\n\t\tthis.viewSettings.axis = axis;\n\n\t\tif (this.mapping) {\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\n\t\t}\n\n\t\tif (this.layout) {\n\t\t\tif (axis === \"vertical\") {\n\t\t\t\tthis.layout.spread(\"none\");\n\t\t\t} else {\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateFlow(flow, defaultScrolledOverflow=\"auto\"){\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\n\n\t\tthis.isPaginated = isPaginated;\n\n\t\tif (flow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\" ||\n\t\t\t\tflow === \"scrolled\") {\n\t\t\tthis.updateAxis(\"vertical\");\n\t\t} else {\n\t\t\tthis.updateAxis(\"horizontal\");\n\t\t}\n\n\t\tthis.viewSettings.flow = flow;\n\n\t\tif (!this.settings.overflow) {\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\n\t\t} else {\n\t\t\tthis.overflow = this.settings.overflow;\n\t\t}\n\n\t\tthis.stage && this.stage.overflow(this.overflow);\n\n\t\tthis.updateLayout();\n\n\t}\n\n\tgetContents(){\n\t\tvar contents = [];\n\t\tif (!this.views) {\n\t\t\treturn contents;\n\t\t}\n\t\tthis.views.forEach(function(view){\n\t\t\tconst viewContents = view && view.contents;\n\t\t\tif (viewContents) {\n\t\t\t\tcontents.push(viewContents);\n\t\t\t}\n\t\t});\n\t\treturn contents;\n\t}\n\n\tdirection(dir=\"ltr\") {\n\t\tthis.settings.direction = dir;\n\n\t\tthis.stage && this.stage.direction(dir);\n\n\t\tthis.viewSettings.direction = dir;\n\n\t\tthis.updateLayout();\n\t}\n\n\tisRendered() {\n\t\treturn this.rendered;\n\t}\n}\n\n//-- Enable binding events to Manager\nEventEmitter(DefaultViewManager.prototype);\n\nexport default DefaultViewManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}