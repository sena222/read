{"ast":null,"code":"import _classCallCheck from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport EventEmitter from \"event-emitter\";\nimport { extend, borders, uuid, isNumber, bounds as _bounds, defer, createBlobUrl, revokeBlobUrl } from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\nvar IframeView = /*#__PURE__*/function () {\n  function IframeView(section, options) {\n    _classCallCheck(this, IframeView);\n    this.settings = extend({\n      ignoreClass: \"\",\n      axis: undefined,\n      //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n      direction: undefined,\n      width: 0,\n      height: 0,\n      layout: undefined,\n      globalLayoutProperties: {},\n      method: undefined,\n      forceRight: false,\n      allowScriptedContent: false,\n      allowPopups: false\n    }, options || {});\n    this.id = \"epubjs-view-\" + uuid();\n    this.section = section;\n    this.index = section.index;\n    this.element = this.container(this.settings.axis);\n    this.added = false;\n    this.displayed = false;\n    this.rendered = false;\n\n    // this.width  = this.settings.width;\n    // this.height = this.settings.height;\n\n    this.fixedWidth = 0;\n    this.fixedHeight = 0;\n\n    // Blank Cfi for Parsing\n    this.epubcfi = new EpubCFI();\n    this.layout = this.settings.layout;\n    // Dom events to listen for\n    // this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n    this.pane = undefined;\n    this.highlights = {};\n    this.underlines = {};\n    this.marks = {};\n  }\n  _createClass(IframeView, [{\n    key: \"container\",\n    value: function container(axis) {\n      var element = document.createElement(\"div\");\n      element.classList.add(\"epub-view\");\n\n      // this.element.style.minHeight = \"100px\";\n      element.style.height = \"0px\";\n      element.style.width = \"0px\";\n      element.style.overflow = \"hidden\";\n      element.style.position = \"relative\";\n      element.style.display = \"block\";\n      if (axis && axis == \"horizontal\") {\n        element.style.flex = \"none\";\n      } else {\n        element.style.flex = \"initial\";\n      }\n      return element;\n    }\n  }, {\n    key: \"create\",\n    value: function create() {\n      if (this.iframe) {\n        return this.iframe;\n      }\n      if (!this.element) {\n        this.element = this.createContainer();\n      }\n      this.iframe = document.createElement(\"iframe\");\n      this.iframe.id = this.id;\n      this.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n      this.iframe.style.overflow = \"hidden\";\n      this.iframe.seamless = \"seamless\";\n      // Back up if seamless isn't supported\n      this.iframe.style.border = \"none\";\n\n      // sandbox\n      this.iframe.sandbox = \"allow-same-origin\";\n      if (this.settings.allowScriptedContent) {\n        this.iframe.sandbox += \" allow-scripts\";\n      }\n      if (this.settings.allowPopups) {\n        this.iframe.sandbox += \" allow-popups\";\n      }\n      this.iframe.setAttribute(\"enable-annotation\", \"true\");\n      this.resizing = true;\n\n      // this.iframe.style.display = \"none\";\n      this.element.style.visibility = \"hidden\";\n      this.iframe.style.visibility = \"hidden\";\n      this.iframe.style.width = \"0\";\n      this.iframe.style.height = \"0\";\n      this._width = 0;\n      this._height = 0;\n      this.element.setAttribute(\"ref\", this.index);\n      this.added = true;\n      this.elementBounds = _bounds(this.element);\n\n      // if(width || height){\n      //   this.resize(width, height);\n      // } else if(this.width && this.height){\n      //   this.resize(this.width, this.height);\n      // } else {\n      //   this.iframeBounds = bounds(this.iframe);\n      // }\n\n      if (\"srcdoc\" in this.iframe) {\n        this.supportsSrcdoc = true;\n      } else {\n        this.supportsSrcdoc = false;\n      }\n      if (!this.settings.method) {\n        this.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n      }\n      return this.iframe;\n    }\n  }, {\n    key: \"render\",\n    value: function render(request, show) {\n      // view.onLayout = this.layout.format.bind(this.layout);\n      this.create();\n\n      // Fit to size of the container, apply padding\n      this.size();\n      if (!this.sectionRender) {\n        this.sectionRender = this.section.render(request);\n      }\n\n      // Render Chain\n      return this.sectionRender.then(function (contents) {\n        return this.load(contents);\n      }.bind(this)).then(function () {\n        var _this = this;\n        // find and report the writingMode axis\n        var writingMode = this.contents.writingMode();\n\n        // Set the axis based on the flow and writing mode\n        var axis;\n        if (this.settings.flow === \"scrolled\") {\n          axis = writingMode.indexOf(\"vertical\") === 0 ? \"horizontal\" : \"vertical\";\n        } else {\n          axis = writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n        }\n        if (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\n          this.layout.delta = this.layout.height;\n        }\n        this.setAxis(axis);\n        this.emit(EVENTS.VIEWS.AXIS, axis);\n        this.setWritingMode(writingMode);\n        this.emit(EVENTS.VIEWS.WRITING_MODE, writingMode);\n\n        // apply the layout function to the contents\n        this.layout.format(this.contents, this.section, this.axis);\n\n        // Listen for events that require an expansion of the iframe\n        this.addListeners();\n        return new Promise(function (resolve, reject) {\n          // Expand the iframe to the full size of the content\n          _this.expand();\n          if (_this.settings.forceRight) {\n            _this.element.style.marginLeft = _this.width() + \"px\";\n          }\n          resolve();\n        });\n      }.bind(this), function (e) {\n        this.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n        return new Promise(function (resolve, reject) {\n          reject(e);\n        });\n      }.bind(this)).then(function () {\n        this.emit(EVENTS.VIEWS.RENDERED, this.section);\n      }.bind(this));\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      if (this.iframe) {\n        this.iframe.style.width = \"0\";\n        this.iframe.style.height = \"0\";\n        this._width = 0;\n        this._height = 0;\n        this._textWidth = undefined;\n        this._contentWidth = undefined;\n        this._textHeight = undefined;\n        this._contentHeight = undefined;\n      }\n      this._needsReframe = true;\n    }\n\n    // Determine locks base on settings\n  }, {\n    key: \"size\",\n    value: function size(_width, _height) {\n      var width = _width || this.settings.width;\n      var height = _height || this.settings.height;\n      if (this.layout.name === \"pre-paginated\") {\n        this.lock(\"both\", width, height);\n      } else if (this.settings.axis === \"horizontal\") {\n        this.lock(\"height\", width, height);\n      } else {\n        this.lock(\"width\", width, height);\n      }\n      this.settings.width = width;\n      this.settings.height = height;\n    }\n\n    // Lock an axis to element dimensions, taking borders into account\n  }, {\n    key: \"lock\",\n    value: function lock(what, width, height) {\n      var elBorders = borders(this.element);\n      var iframeBorders;\n      if (this.iframe) {\n        iframeBorders = borders(this.iframe);\n      } else {\n        iframeBorders = {\n          width: 0,\n          height: 0\n        };\n      }\n      if (what == \"width\" && isNumber(width)) {\n        this.lockedWidth = width - elBorders.width - iframeBorders.width;\n        // this.resize(this.lockedWidth, width); //  width keeps ratio correct\n      }\n\n      if (what == \"height\" && isNumber(height)) {\n        this.lockedHeight = height - elBorders.height - iframeBorders.height;\n        // this.resize(width, this.lockedHeight);\n      }\n\n      if (what === \"both\" && isNumber(width) && isNumber(height)) {\n        this.lockedWidth = width - elBorders.width - iframeBorders.width;\n        this.lockedHeight = height - elBorders.height - iframeBorders.height;\n        // this.resize(this.lockedWidth, this.lockedHeight);\n      }\n\n      if (this.displayed && this.iframe) {\n        // this.contents.layout();\n        this.expand();\n      }\n    }\n\n    // Resize a single axis based on content dimensions\n  }, {\n    key: \"expand\",\n    value: function expand(force) {\n      var width = this.lockedWidth;\n      var height = this.lockedHeight;\n      var columns;\n      var textWidth, textHeight;\n      if (!this.iframe || this._expanding) return;\n      this._expanding = true;\n      if (this.layout.name === \"pre-paginated\") {\n        width = this.layout.columnWidth;\n        height = this.layout.height;\n      }\n      // Expand Horizontally\n      else if (this.settings.axis === \"horizontal\") {\n        // Get the width of the text\n        width = this.contents.textWidth();\n        if (width % this.layout.pageWidth > 0) {\n          width = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n        }\n        if (this.settings.forceEvenPages) {\n          columns = width / this.layout.pageWidth;\n          if (this.layout.divisor > 1 && this.layout.name === \"reflowable\" && columns % 2 > 0) {\n            // add a blank page\n            width += this.layout.pageWidth;\n          }\n        }\n      } // Expand Vertically\n      else if (this.settings.axis === \"vertical\") {\n        height = this.contents.textHeight();\n        if (this.settings.flow === \"paginated\" && height % this.layout.height > 0) {\n          height = Math.ceil(height / this.layout.height) * this.layout.height;\n        }\n      }\n\n      // Only Resize if dimensions have changed or\n      // if Frame is still hidden, so needs reframing\n      if (this._needsReframe || width != this._width || height != this._height) {\n        this.reframe(width, height);\n      }\n      this._expanding = false;\n    }\n  }, {\n    key: \"reframe\",\n    value: function reframe(width, height) {\n      var _this2 = this;\n      var size;\n      if (isNumber(width)) {\n        this.element.style.width = width + \"px\";\n        this.iframe.style.width = width + \"px\";\n        this._width = width;\n      }\n      if (isNumber(height)) {\n        this.element.style.height = height + \"px\";\n        this.iframe.style.height = height + \"px\";\n        this._height = height;\n      }\n      var widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n      var heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n      size = {\n        width: width,\n        height: height,\n        widthDelta: widthDelta,\n        heightDelta: heightDelta\n      };\n      this.pane && this.pane.render();\n      requestAnimationFrame(function () {\n        var mark;\n        for (var m in _this2.marks) {\n          if (_this2.marks.hasOwnProperty(m)) {\n            mark = _this2.marks[m];\n            _this2.placeMark(mark.element, mark.range);\n          }\n        }\n      });\n      this.onResize(this, size);\n      this.emit(EVENTS.VIEWS.RESIZED, size);\n      this.prevBounds = size;\n      this.elementBounds = _bounds(this.element);\n    }\n  }, {\n    key: \"load\",\n    value: function load(contents) {\n      var loading = new defer();\n      var loaded = loading.promise;\n      if (!this.iframe) {\n        loading.reject(new Error(\"No Iframe Available\"));\n        return loaded;\n      }\n      this.iframe.onload = function (event) {\n        this.onLoad(event, loading);\n      }.bind(this);\n      if (this.settings.method === \"blobUrl\") {\n        this.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n        this.iframe.src = this.blobUrl;\n        this.element.appendChild(this.iframe);\n      } else if (this.settings.method === \"srcdoc\") {\n        this.iframe.srcdoc = contents;\n        this.element.appendChild(this.iframe);\n      } else {\n        this.element.appendChild(this.iframe);\n        this.document = this.iframe.contentDocument;\n        if (!this.document) {\n          loading.reject(new Error(\"No Document Available\"));\n          return loaded;\n        }\n        this.iframe.contentDocument.open();\n        // For Cordova windows platform\n        if (window.MSApp && MSApp.execUnsafeLocalFunction) {\n          var outerThis = this;\n          MSApp.execUnsafeLocalFunction(function () {\n            outerThis.iframe.contentDocument.write(contents);\n          });\n        } else {\n          this.iframe.contentDocument.write(contents);\n        }\n        this.iframe.contentDocument.close();\n      }\n      return loaded;\n    }\n  }, {\n    key: \"onLoad\",\n    value: function onLoad(event, promise) {\n      var _this3 = this;\n      this.window = this.iframe.contentWindow;\n      this.document = this.iframe.contentDocument;\n      this.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n      this.rendering = false;\n      var link = this.document.querySelector(\"link[rel='canonical']\");\n      if (link) {\n        link.setAttribute(\"href\", this.section.canonical);\n      } else {\n        link = this.document.createElement(\"link\");\n        link.setAttribute(\"rel\", \"canonical\");\n        link.setAttribute(\"href\", this.section.canonical);\n        this.document.querySelector(\"head\").appendChild(link);\n      }\n      this.contents.on(EVENTS.CONTENTS.EXPAND, function () {\n        if (_this3.displayed && _this3.iframe) {\n          _this3.expand();\n          if (_this3.contents) {\n            _this3.layout.format(_this3.contents);\n          }\n        }\n      });\n      this.contents.on(EVENTS.CONTENTS.RESIZE, function (e) {\n        if (_this3.displayed && _this3.iframe) {\n          _this3.expand();\n          if (_this3.contents) {\n            _this3.layout.format(_this3.contents);\n          }\n        }\n      });\n      promise.resolve(this.contents);\n    }\n  }, {\n    key: \"setLayout\",\n    value: function setLayout(layout) {\n      this.layout = layout;\n      if (this.contents) {\n        this.layout.format(this.contents);\n        this.expand();\n      }\n    }\n  }, {\n    key: \"setAxis\",\n    value: function setAxis(axis) {\n      this.settings.axis = axis;\n      if (axis == \"horizontal\") {\n        this.element.style.flex = \"none\";\n      } else {\n        this.element.style.flex = \"initial\";\n      }\n      this.size();\n    }\n  }, {\n    key: \"setWritingMode\",\n    value: function setWritingMode(mode) {\n      // this.element.style.writingMode = writingMode;\n      this.writingMode = mode;\n    }\n  }, {\n    key: \"addListeners\",\n    value: function addListeners() {\n      //TODO: Add content listeners for expanding\n    }\n  }, {\n    key: \"removeListeners\",\n    value: function removeListeners(layoutFunc) {\n      //TODO: remove content listeners for expanding\n    }\n  }, {\n    key: \"display\",\n    value: function display(request) {\n      var displayed = new defer();\n      if (!this.displayed) {\n        this.render(request).then(function () {\n          this.emit(EVENTS.VIEWS.DISPLAYED, this);\n          this.onDisplayed(this);\n          this.displayed = true;\n          displayed.resolve(this);\n        }.bind(this), function (err) {\n          displayed.reject(err, this);\n        });\n      } else {\n        displayed.resolve(this);\n      }\n      return displayed.promise;\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.element.style.visibility = \"visible\";\n      if (this.iframe) {\n        this.iframe.style.visibility = \"visible\";\n\n        // Remind Safari to redraw the iframe\n        this.iframe.style.transform = \"translateZ(0)\";\n        this.iframe.offsetWidth;\n        this.iframe.style.transform = null;\n      }\n      this.emit(EVENTS.VIEWS.SHOWN, this);\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      // this.iframe.style.display = \"none\";\n      this.element.style.visibility = \"hidden\";\n      this.iframe.style.visibility = \"hidden\";\n      this.stopExpanding = true;\n      this.emit(EVENTS.VIEWS.HIDDEN, this);\n    }\n  }, {\n    key: \"offset\",\n    value: function offset() {\n      return {\n        top: this.element.offsetTop,\n        left: this.element.offsetLeft\n      };\n    }\n  }, {\n    key: \"width\",\n    value: function width() {\n      return this._width;\n    }\n  }, {\n    key: \"height\",\n    value: function height() {\n      return this._height;\n    }\n  }, {\n    key: \"position\",\n    value: function position() {\n      return this.element.getBoundingClientRect();\n    }\n  }, {\n    key: \"locationOf\",\n    value: function locationOf(target) {\n      var parentPos = this.iframe.getBoundingClientRect();\n      var targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n      return {\n        \"left\": targetPos.left,\n        \"top\": targetPos.top\n      };\n    }\n  }, {\n    key: \"onDisplayed\",\n    value: function onDisplayed(view) {\n      // Stub, override with a custom functions\n    }\n  }, {\n    key: \"onResize\",\n    value: function onResize(view, e) {\n      // Stub, override with a custom functions\n    }\n  }, {\n    key: \"bounds\",\n    value: function bounds(force) {\n      if (force || !this.elementBounds) {\n        this.elementBounds = _bounds(this.element);\n      }\n      return this.elementBounds;\n    }\n  }, {\n    key: \"highlight\",\n    value: function highlight(cfiRange) {\n      var _this4 = this;\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var cb = arguments.length > 2 ? arguments[2] : undefined;\n      var className = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"epubjs-hl\";\n      var styles = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n      if (!this.contents) {\n        return;\n      }\n      var attributes = Object.assign({\n        \"fill\": \"yellow\",\n        \"fill-opacity\": \"0.3\",\n        \"mix-blend-mode\": \"multiply\"\n      }, styles);\n      var range = this.contents.range(cfiRange);\n      var emitter = function emitter() {\n        _this4.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n      };\n      data[\"epubcfi\"] = cfiRange;\n      if (!this.pane) {\n        this.pane = new Pane(this.iframe, this.element);\n      }\n      var m = new Highlight(range, className, data, attributes);\n      var h = this.pane.addMark(m);\n      this.highlights[cfiRange] = {\n        \"mark\": h,\n        \"element\": h.element,\n        \"listeners\": [emitter, cb]\n      };\n      h.element.setAttribute(\"ref\", className);\n      h.element.addEventListener(\"click\", emitter);\n      h.element.addEventListener(\"touchstart\", emitter);\n      if (cb) {\n        h.element.addEventListener(\"click\", cb);\n        h.element.addEventListener(\"touchstart\", cb);\n      }\n      return h;\n    }\n  }, {\n    key: \"underline\",\n    value: function underline(cfiRange) {\n      var _this5 = this;\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var cb = arguments.length > 2 ? arguments[2] : undefined;\n      var className = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"epubjs-ul\";\n      var styles = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n      if (!this.contents) {\n        return;\n      }\n      var attributes = Object.assign({\n        \"stroke\": \"black\",\n        \"stroke-opacity\": \"0.3\",\n        \"mix-blend-mode\": \"multiply\"\n      }, styles);\n      var range = this.contents.range(cfiRange);\n      var emitter = function emitter() {\n        _this5.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n      };\n      data[\"epubcfi\"] = cfiRange;\n      if (!this.pane) {\n        this.pane = new Pane(this.iframe, this.element);\n      }\n      var m = new Underline(range, className, data, attributes);\n      var h = this.pane.addMark(m);\n      this.underlines[cfiRange] = {\n        \"mark\": h,\n        \"element\": h.element,\n        \"listeners\": [emitter, cb]\n      };\n      h.element.setAttribute(\"ref\", className);\n      h.element.addEventListener(\"click\", emitter);\n      h.element.addEventListener(\"touchstart\", emitter);\n      if (cb) {\n        h.element.addEventListener(\"click\", cb);\n        h.element.addEventListener(\"touchstart\", cb);\n      }\n      return h;\n    }\n  }, {\n    key: \"mark\",\n    value: function mark(cfiRange) {\n      var _this6 = this;\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var cb = arguments.length > 2 ? arguments[2] : undefined;\n      if (!this.contents) {\n        return;\n      }\n      if (cfiRange in this.marks) {\n        var item = this.marks[cfiRange];\n        return item;\n      }\n      var range = this.contents.range(cfiRange);\n      if (!range) {\n        return;\n      }\n      var container = range.commonAncestorContainer;\n      var parent = container.nodeType === 1 ? container : container.parentNode;\n      var emitter = function emitter(e) {\n        _this6.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n      };\n      if (range.collapsed && container.nodeType === 1) {\n        range = new Range();\n        range.selectNodeContents(container);\n      } else if (range.collapsed) {\n        // Webkit doesn't like collapsed ranges\n        range = new Range();\n        range.selectNodeContents(parent);\n      }\n      var mark = this.document.createElement(\"a\");\n      mark.setAttribute(\"ref\", \"epubjs-mk\");\n      mark.style.position = \"absolute\";\n      mark.dataset[\"epubcfi\"] = cfiRange;\n      if (data) {\n        Object.keys(data).forEach(function (key) {\n          mark.dataset[key] = data[key];\n        });\n      }\n      if (cb) {\n        mark.addEventListener(\"click\", cb);\n        mark.addEventListener(\"touchstart\", cb);\n      }\n      mark.addEventListener(\"click\", emitter);\n      mark.addEventListener(\"touchstart\", emitter);\n      this.placeMark(mark, range);\n      this.element.appendChild(mark);\n      this.marks[cfiRange] = {\n        \"element\": mark,\n        \"range\": range,\n        \"listeners\": [emitter, cb]\n      };\n      return parent;\n    }\n  }, {\n    key: \"placeMark\",\n    value: function placeMark(element, range) {\n      var top, right, left;\n      if (this.layout.name === \"pre-paginated\" || this.settings.axis !== \"horizontal\") {\n        var pos = range.getBoundingClientRect();\n        top = pos.top;\n        right = pos.right;\n      } else {\n        // Element might break columns, so find the left most element\n        var rects = range.getClientRects();\n        var rect;\n        for (var i = 0; i != rects.length; i++) {\n          rect = rects[i];\n          if (!left || rect.left < left) {\n            left = rect.left;\n            // right = rect.right;\n            right = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - this.layout.gap / 2;\n            top = rect.top;\n          }\n        }\n      }\n      element.style.top = \"\".concat(top, \"px\");\n      element.style.left = \"\".concat(right, \"px\");\n    }\n  }, {\n    key: \"unhighlight\",\n    value: function unhighlight(cfiRange) {\n      var item;\n      if (cfiRange in this.highlights) {\n        item = this.highlights[cfiRange];\n        this.pane.removeMark(item.mark);\n        item.listeners.forEach(function (l) {\n          if (l) {\n            item.element.removeEventListener(\"click\", l);\n            item.element.removeEventListener(\"touchstart\", l);\n          }\n          ;\n        });\n        delete this.highlights[cfiRange];\n      }\n    }\n  }, {\n    key: \"ununderline\",\n    value: function ununderline(cfiRange) {\n      var item;\n      if (cfiRange in this.underlines) {\n        item = this.underlines[cfiRange];\n        this.pane.removeMark(item.mark);\n        item.listeners.forEach(function (l) {\n          if (l) {\n            item.element.removeEventListener(\"click\", l);\n            item.element.removeEventListener(\"touchstart\", l);\n          }\n          ;\n        });\n        delete this.underlines[cfiRange];\n      }\n    }\n  }, {\n    key: \"unmark\",\n    value: function unmark(cfiRange) {\n      var item;\n      if (cfiRange in this.marks) {\n        item = this.marks[cfiRange];\n        this.element.removeChild(item.element);\n        item.listeners.forEach(function (l) {\n          if (l) {\n            item.element.removeEventListener(\"click\", l);\n            item.element.removeEventListener(\"touchstart\", l);\n          }\n          ;\n        });\n        delete this.marks[cfiRange];\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      for (var cfiRange in this.highlights) {\n        this.unhighlight(cfiRange);\n      }\n      for (var _cfiRange in this.underlines) {\n        this.ununderline(_cfiRange);\n      }\n      for (var _cfiRange2 in this.marks) {\n        this.unmark(_cfiRange2);\n      }\n      if (this.blobUrl) {\n        revokeBlobUrl(this.blobUrl);\n      }\n      if (this.displayed) {\n        this.displayed = false;\n        this.removeListeners();\n        this.contents.destroy();\n        this.stopExpanding = true;\n        this.element.removeChild(this.iframe);\n        if (this.pane) {\n          this.pane.element.remove();\n          this.pane = undefined;\n        }\n        this.iframe = undefined;\n        this.contents = undefined;\n        this._textWidth = null;\n        this._textHeight = null;\n        this._width = null;\n        this._height = null;\n      }\n\n      // this.element.style.height = \"0px\";\n      // this.element.style.width = \"0px\";\n    }\n  }]);\n  return IframeView;\n}();\nEventEmitter(IframeView.prototype);\nexport default IframeView;","map":{"version":3,"names":["EventEmitter","extend","borders","uuid","isNumber","bounds","defer","createBlobUrl","revokeBlobUrl","EpubCFI","Contents","EVENTS","Pane","Highlight","Underline","IframeView","section","options","settings","ignoreClass","axis","undefined","direction","width","height","layout","globalLayoutProperties","method","forceRight","allowScriptedContent","allowPopups","id","index","element","container","added","displayed","rendered","fixedWidth","fixedHeight","epubcfi","pane","highlights","underlines","marks","document","createElement","classList","add","style","overflow","position","display","flex","iframe","createContainer","scrolling","seamless","border","sandbox","setAttribute","resizing","visibility","_width","_height","elementBounds","supportsSrcdoc","request","show","create","size","sectionRender","render","then","contents","load","bind","writingMode","flow","indexOf","delta","setAxis","emit","VIEWS","AXIS","setWritingMode","WRITING_MODE","format","addListeners","Promise","resolve","reject","expand","marginLeft","e","LOAD_ERROR","RENDERED","_textWidth","_contentWidth","_textHeight","_contentHeight","_needsReframe","name","lock","what","elBorders","iframeBorders","lockedWidth","lockedHeight","force","columns","textWidth","textHeight","_expanding","columnWidth","pageWidth","Math","ceil","forceEvenPages","divisor","reframe","widthDelta","prevBounds","heightDelta","requestAnimationFrame","mark","m","hasOwnProperty","placeMark","range","onResize","RESIZED","loading","loaded","promise","Error","onload","event","onLoad","blobUrl","src","appendChild","srcdoc","contentDocument","open","window","MSApp","execUnsafeLocalFunction","outerThis","write","close","contentWindow","body","cfiBase","rendering","link","querySelector","canonical","on","CONTENTS","EXPAND","RESIZE","mode","layoutFunc","DISPLAYED","onDisplayed","err","transform","offsetWidth","SHOWN","stopExpanding","HIDDEN","top","offsetTop","left","offsetLeft","getBoundingClientRect","target","parentPos","targetPos","locationOf","view","cfiRange","data","cb","className","styles","attributes","Object","assign","emitter","MARK_CLICKED","h","addMark","addEventListener","item","commonAncestorContainer","parent","nodeType","parentNode","collapsed","Range","selectNodeContents","dataset","keys","forEach","key","right","pos","rects","getClientRects","rect","i","length","props","gap","removeMark","listeners","l","removeEventListener","removeChild","unhighlight","ununderline","unmark","removeListeners","destroy","remove","prototype"],"sources":["/home/parallels/Downloads/read/node_modules/epubjs/src/managers/views/iframe.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl} from \"../../utils/core\";\nimport EpubCFI from \"../../epubcfi\";\nimport Contents from \"../../contents\";\nimport { EVENTS } from \"../../utils/constants\";\nimport { Pane, Highlight, Underline } from \"marks-pane\";\n\nclass IframeView {\n\tconstructor(section, options) {\n\t\tthis.settings = extend({\n\t\t\tignoreClass : \"\",\n\t\t\taxis: undefined, //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\n\t\t\tdirection: undefined,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tlayout: undefined,\n\t\t\tglobalLayoutProperties: {},\n\t\t\tmethod: undefined,\n\t\t\tforceRight: false,\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t}, options || {});\n\n\t\tthis.id = \"epubjs-view-\" + uuid();\n\t\tthis.section = section;\n\t\tthis.index = section.index;\n\n\t\tthis.element = this.container(this.settings.axis);\n\n\t\tthis.added = false;\n\t\tthis.displayed = false;\n\t\tthis.rendered = false;\n\n\t\t// this.width  = this.settings.width;\n\t\t// this.height = this.settings.height;\n\n\t\tthis.fixedWidth  = 0;\n\t\tthis.fixedHeight = 0;\n\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.layout = this.settings.layout;\n\t\t// Dom events to listen for\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\n\n\t\tthis.pane = undefined;\n\t\tthis.highlights = {};\n\t\tthis.underlines = {};\n\t\tthis.marks = {};\n\n\t}\n\n\tcontainer(axis) {\n\t\tvar element = document.createElement(\"div\");\n\n\t\telement.classList.add(\"epub-view\");\n\n\t\t// this.element.style.minHeight = \"100px\";\n\t\telement.style.height = \"0px\";\n\t\telement.style.width = \"0px\";\n\t\telement.style.overflow = \"hidden\";\n\t\telement.style.position = \"relative\";\n\t\telement.style.display = \"block\";\n\n\t\tif(axis && axis == \"horizontal\"){\n\t\t\telement.style.flex = \"none\";\n\t\t} else {\n\t\t\telement.style.flex = \"initial\";\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tcreate() {\n\n\t\tif(this.iframe) {\n\t\t\treturn this.iframe;\n\t\t}\n\n\t\tif(!this.element) {\n\t\t\tthis.element = this.createContainer();\n\t\t}\n\n\t\tthis.iframe = document.createElement(\"iframe\");\n\t\tthis.iframe.id = this.id;\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\n\t\tthis.iframe.style.overflow = \"hidden\";\n\t\tthis.iframe.seamless = \"seamless\";\n\t\t// Back up if seamless isn't supported\n\t\tthis.iframe.style.border = \"none\";\n\n\t\t// sandbox\n\t\tthis.iframe.sandbox = \"allow-same-origin\";\n\t\tif (this.settings.allowScriptedContent) {\n\t\t\tthis.iframe.sandbox += \" allow-scripts\";\n\t\t}\n\t\tif (this.settings.allowPopups) {\n\t\t\tthis.iframe.sandbox += \" allow-popups\";\n\t\t}\n\t\t\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\n\n\t\tthis.resizing = true;\n\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.iframe.style.width = \"0\";\n\t\tthis.iframe.style.height = \"0\";\n\t\tthis._width = 0;\n\t\tthis._height = 0;\n\n\t\tthis.element.setAttribute(\"ref\", this.index);\n\n\t\tthis.added = true;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t\t// if(width || height){\n\t\t//   this.resize(width, height);\n\t\t// } else if(this.width && this.height){\n\t\t//   this.resize(this.width, this.height);\n\t\t// } else {\n\t\t//   this.iframeBounds = bounds(this.iframe);\n\t\t// }\n\n\n\t\tif((\"srcdoc\" in this.iframe)) {\n\t\t\tthis.supportsSrcdoc = true;\n\t\t} else {\n\t\t\tthis.supportsSrcdoc = false;\n\t\t}\n\n\t\tif (!this.settings.method) {\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\n\t\t}\n\n\t\treturn this.iframe;\n\t}\n\n\trender(request, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tthis.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.size();\n\n\t\tif(!this.sectionRender) {\n\t\t\tthis.sectionRender = this.section.render(request);\n\t\t}\n\n\t\t// Render Chain\n\t\treturn this.sectionRender\n\t\t\t.then(function(contents){\n\t\t\t\treturn this.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\n\t\t\t\t// find and report the writingMode axis\n\t\t\t\tlet writingMode = this.contents.writingMode();\n\n\t\t\t\t// Set the axis based on the flow and writing mode\n\t\t\t\tlet axis;\n\t\t\t\tif (this.settings.flow === \"scrolled\") {\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"horizontal\" : \"vertical\";\n\t\t\t\t} else {\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\t\t\t\t}\n\n\t\t\t\tif (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\n\t\t\t\t\tthis.layout.delta = this.layout.height;\n\t\t\t\t}\n\n\t\t\t\tthis.setAxis(axis);\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\n\n\t\t\t\tthis.setWritingMode(writingMode);\n\t\t\t\tthis.emit(EVENTS.VIEWS.WRITING_MODE, writingMode);\n\n\n\t\t\t\t// apply the layout function to the contents\n\t\t\t\tthis.layout.format(this.contents, this.section, this.axis);\n\n\t\t\t\t// Listen for events that require an expansion of the iframe\n\t\t\t\tthis.addListeners();\n\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t// Expand the iframe to the full size of the content\n\t\t\t\t\tthis.expand();\n\n\t\t\t\t\tif (this.settings.forceRight) {\n\t\t\t\t\t\tthis.element.style.marginLeft = this.width() + \"px\";\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t}.bind(this), function(e){\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t\t}.bind(this))\n\t\t\t.then(function() {\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\n\t\t\t}.bind(this));\n\n\t}\n\n\treset () {\n\t\tif (this.iframe) {\n\t\t\tthis.iframe.style.width = \"0\";\n\t\t\tthis.iframe.style.height = \"0\";\n\t\t\tthis._width = 0;\n\t\t\tthis._height = 0;\n\t\t\tthis._textWidth = undefined;\n\t\t\tthis._contentWidth = undefined;\n\t\t\tthis._textHeight = undefined;\n\t\t\tthis._contentHeight = undefined;\n\t\t}\n\t\tthis._needsReframe = true;\n\t}\n\n\t// Determine locks base on settings\n\tsize(_width, _height) {\n\t\tvar width = _width || this.settings.width;\n\t\tvar height = _height || this.settings.height;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\tthis.lock(\"both\", width, height);\n\t\t} else if(this.settings.axis === \"horizontal\") {\n\t\t\tthis.lock(\"height\", width, height);\n\t\t} else {\n\t\t\tthis.lock(\"width\", width, height);\n\t\t}\n\n\t\tthis.settings.width = width;\n\t\tthis.settings.height = height;\n\t}\n\n\t// Lock an axis to element dimensions, taking borders into account\n\tlock(what, width, height) {\n\t\tvar elBorders = borders(this.element);\n\t\tvar iframeBorders;\n\n\t\tif(this.iframe) {\n\t\t\tiframeBorders = borders(this.iframe);\n\t\t} else {\n\t\t\tiframeBorders = {width: 0, height: 0};\n\t\t}\n\n\t\tif(what == \"width\" && isNumber(width)){\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\n\t\t}\n\n\t\tif(what == \"height\" && isNumber(height)){\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(width, this.lockedHeight);\n\t\t}\n\n\t\tif(what === \"both\" &&\n\t\t\t isNumber(width) &&\n\t\t\t isNumber(height)){\n\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\n\t\t}\n\n\t\tif(this.displayed && this.iframe) {\n\n\t\t\t// this.contents.layout();\n\t\t\tthis.expand();\n\t\t}\n\n\n\n\t}\n\n\t// Resize a single axis based on content dimensions\n\texpand(force) {\n\t\tvar width = this.lockedWidth;\n\t\tvar height = this.lockedHeight;\n\t\tvar columns;\n\n\t\tvar textWidth, textHeight;\n\n\t\tif(!this.iframe || this._expanding) return;\n\n\t\tthis._expanding = true;\n\n\t\tif(this.layout.name === \"pre-paginated\") {\n\t\t\twidth = this.layout.columnWidth;\n\t\t\theight = this.layout.height;\n\t\t}\n\t\t// Expand Horizontally\n\t\telse if(this.settings.axis === \"horizontal\") {\n\t\t\t// Get the width of the text\n\t\t\twidth = this.contents.textWidth();\n\n\t\t\tif (width % this.layout.pageWidth > 0) {\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\n\t\t\t}\n\n\t\t\tif (this.settings.forceEvenPages) {\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\n\t\t\t\tif ( this.layout.divisor > 1 &&\n\t\t\t\t\t\t this.layout.name === \"reflowable\" &&\n\t\t\t\t\t\t(columns % 2 > 0)) {\n\t\t\t\t\t// add a blank page\n\t\t\t\t\twidth += this.layout.pageWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // Expand Vertically\n\t\telse if(this.settings.axis === \"vertical\") {\n\t\t\theight = this.contents.textHeight();\n\t\t\tif (this.settings.flow === \"paginated\" &&\n\t\t\t\theight % this.layout.height > 0) {\n\t\t\t\theight = Math.ceil(height / this.layout.height) * this.layout.height;\n\t\t\t}\n\t\t}\n\n\t\t// Only Resize if dimensions have changed or\n\t\t// if Frame is still hidden, so needs reframing\n\t\tif(this._needsReframe || width != this._width || height != this._height){\n\t\t\tthis.reframe(width, height);\n\t\t}\n\n\t\tthis._expanding = false;\n\t}\n\n\treframe(width, height) {\n\t\tvar size;\n\n\t\tif(isNumber(width)){\n\t\t\tthis.element.style.width = width + \"px\";\n\t\t\tthis.iframe.style.width = width + \"px\";\n\t\t\tthis._width = width;\n\t\t}\n\n\t\tif(isNumber(height)){\n\t\t\tthis.element.style.height = height + \"px\";\n\t\t\tthis.iframe.style.height = height + \"px\";\n\t\t\tthis._height = height;\n\t\t}\n\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\n\n\t\tsize = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\twidthDelta: widthDelta,\n\t\t\theightDelta: heightDelta,\n\t\t};\n\n\t\tthis.pane && this.pane.render();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tlet mark;\n\t\t\tfor (let m in this.marks) {\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\n\t\t\t\t\tmark = this.marks[m];\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.onResize(this, size);\n\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\n\n\t\tthis.prevBounds = size;\n\n\t\tthis.elementBounds = bounds(this.element);\n\n\t}\n\n\n\tload(contents) {\n\t\tvar loading = new defer();\n\t\tvar loaded = loading.promise;\n\n\t\tif(!this.iframe) {\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\n\t\t\treturn loaded;\n\t\t}\n\n\t\tthis.iframe.onload = function(event) {\n\n\t\t\tthis.onLoad(event, loading);\n\n\t\t}.bind(this);\n\n\t\tif (this.settings.method === \"blobUrl\") {\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\n\t\t\tthis.iframe.src = this.blobUrl;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else if(this.settings.method === \"srcdoc\"){\n\t\t\tthis.iframe.srcdoc = contents;\n\t\t\tthis.element.appendChild(this.iframe);\n\t\t} else {\n\n\t\t\tthis.element.appendChild(this.iframe);\n\n\t\t\tthis.document = this.iframe.contentDocument;\n\n\t\t\tif(!this.document) {\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\n\t\t\t\treturn loaded;\n\t\t\t}\n\n\t\t\tthis.iframe.contentDocument.open();\n\t\t\t// For Cordova windows platform\n\t\t\tif(window.MSApp && MSApp.execUnsafeLocalFunction) {\n\t\t\t\tvar outerThis = this;\n\t\t\t\tMSApp.execUnsafeLocalFunction(function () {\n\t\t\t\t\touterThis.iframe.contentDocument.write(contents);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.iframe.contentDocument.write(contents);\n\t\t\t}\n\t\t\tthis.iframe.contentDocument.close();\n\n\t\t}\n\n\t\treturn loaded;\n\t}\n\n\tonLoad(event, promise) {\n\n\t\tthis.window = this.iframe.contentWindow;\n\t\tthis.document = this.iframe.contentDocument;\n\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\n\n\t\tthis.rendering = false;\n\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\n\t\tif (link) {\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t} else {\n\t\t\tlink = this.document.createElement(\"link\");\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\n\t\t}\n\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\n\t\t\tif(this.displayed && this.iframe) {\n\t\t\t\tthis.expand();\n\t\t\t\tif (this.contents) {\n\t\t\t\t\tthis.layout.format(this.contents);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tpromise.resolve(this.contents);\n\t}\n\n\tsetLayout(layout) {\n\t\tthis.layout = layout;\n\n\t\tif (this.contents) {\n\t\t\tthis.layout.format(this.contents);\n\t\t\tthis.expand();\n\t\t}\n\t}\n\n\tsetAxis(axis) {\n\n\t\tthis.settings.axis = axis;\n\n\t\tif(axis == \"horizontal\"){\n\t\t\tthis.element.style.flex = \"none\";\n\t\t} else {\n\t\t\tthis.element.style.flex = \"initial\";\n\t\t}\n\n\t\tthis.size();\n\n\t}\n\n\tsetWritingMode(mode) {\n\t\t// this.element.style.writingMode = writingMode;\n\t\tthis.writingMode = mode;\n\t}\n\n\taddListeners() {\n\t\t//TODO: Add content listeners for expanding\n\t}\n\n\tremoveListeners(layoutFunc) {\n\t\t//TODO: remove content listeners for expanding\n\t}\n\n\tdisplay(request) {\n\t\tvar displayed = new defer();\n\n\t\tif (!this.displayed) {\n\n\t\t\tthis.render(request)\n\t\t\t\t.then(function () {\n\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\n\t\t\t\t\tthis.onDisplayed(this);\n\n\t\t\t\t\tthis.displayed = true;\n\t\t\t\t\tdisplayed.resolve(this);\n\n\t\t\t\t}.bind(this), function (err) {\n\t\t\t\t\tdisplayed.reject(err, this);\n\t\t\t\t});\n\n\t\t} else {\n\t\t\tdisplayed.resolve(this);\n\t\t}\n\n\n\t\treturn displayed.promise;\n\t}\n\n\tshow() {\n\n\t\tthis.element.style.visibility = \"visible\";\n\n\t\tif(this.iframe){\n\t\t\tthis.iframe.style.visibility = \"visible\";\n\n\t\t\t// Remind Safari to redraw the iframe\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\n\t\t\tthis.iframe.offsetWidth;\n\t\t\tthis.iframe.style.transform = null;\n\t\t}\n\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\n\t}\n\n\thide() {\n\t\t// this.iframe.style.display = \"none\";\n\t\tthis.element.style.visibility = \"hidden\";\n\t\tthis.iframe.style.visibility = \"hidden\";\n\n\t\tthis.stopExpanding = true;\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\n\t}\n\n\toffset() {\n\t\treturn {\n\t\t\ttop: this.element.offsetTop,\n\t\t\tleft: this.element.offsetLeft\n\t\t}\n\t}\n\n\twidth() {\n\t\treturn this._width;\n\t}\n\n\theight() {\n\t\treturn this._height;\n\t}\n\n\tposition() {\n\t\treturn this.element.getBoundingClientRect();\n\t}\n\n\tlocationOf(target) {\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\n\n\t\treturn {\n\t\t\t\"left\": targetPos.left,\n\t\t\t\"top\": targetPos.top\n\t\t};\n\t}\n\n\tonDisplayed(view) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tonResize(view, e) {\n\t\t// Stub, override with a custom functions\n\t}\n\n\tbounds(force) {\n\t\tif(force || !this.elementBounds) {\n\t\t\tthis.elementBounds = bounds(this.element);\n\t\t}\n\n\t\treturn this.elementBounds;\n\t}\n\n\thighlight(cfiRange, data={}, cb, className = \"epubjs-hl\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"fill\": \"yellow\", \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Highlight(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tunderline(cfiRange, data={}, cb, className = \"epubjs-ul\", styles = {}) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\t\tconst attributes = Object.assign({\"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\"}, styles);\n\t\tlet range = this.contents.range(cfiRange);\n\t\tlet emitter = () => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tdata[\"epubcfi\"] = cfiRange;\n\n\t\tif (!this.pane) {\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\n\t\t}\n\n\t\tlet m = new Underline(range, className, data, attributes);\n\t\tlet h = this.pane.addMark(m);\n\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\n\n\t\th.element.setAttribute(\"ref\", className);\n\t\th.element.addEventListener(\"click\", emitter);\n\t\th.element.addEventListener(\"touchstart\", emitter);\n\n\t\tif (cb) {\n\t\t\th.element.addEventListener(\"click\", cb);\n\t\t\th.element.addEventListener(\"touchstart\", cb);\n\t\t}\n\t\treturn h;\n\t}\n\n\tmark(cfiRange, data={}, cb) {\n\t\tif (!this.contents) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cfiRange in this.marks) {\n\t\t\tlet item = this.marks[cfiRange];\n\t\t\treturn item;\n\t\t}\n\n\t\tlet range = this.contents.range(cfiRange);\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tlet container = range.commonAncestorContainer;\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\n\n\t\tlet emitter = (e) => {\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\n\t\t};\n\n\t\tif (range.collapsed && container.nodeType === 1) {\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(container);\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\n\t\t\trange = new Range();\n\t\t\trange.selectNodeContents(parent);\n\t\t}\n\n\t\tlet mark = this.document.createElement(\"a\");\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\n\t\tmark.style.position = \"absolute\";\n\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\n\n\t\tif (data) {\n\t\t\tObject.keys(data).forEach((key) => {\n\t\t\t\tmark.dataset[key] = data[key];\n\t\t\t});\n\t\t}\n\n\t\tif (cb) {\n\t\t\tmark.addEventListener(\"click\", cb);\n\t\t\tmark.addEventListener(\"touchstart\", cb);\n\t\t}\n\n\t\tmark.addEventListener(\"click\", emitter);\n\t\tmark.addEventListener(\"touchstart\", emitter);\n\n\t\tthis.placeMark(mark, range);\n\n\t\tthis.element.appendChild(mark);\n\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\n\n\t\treturn parent;\n\t}\n\n\tplaceMark(element, range) {\n\t\tlet top, right, left;\n\n\t\tif(this.layout.name === \"pre-paginated\" ||\n\t\t\tthis.settings.axis !== \"horizontal\") {\n\t\t\tlet pos = range.getBoundingClientRect();\n\t\t\ttop = pos.top;\n\t\t\tright = pos.right;\n\t\t} else {\n\t\t\t// Element might break columns, so find the left most element\n\t\t\tlet rects = range.getClientRects();\n\n\t\t\tlet rect;\n\t\t\tfor (var i = 0; i != rects.length; i++) {\n\t\t\t\trect = rects[i];\n\t\t\t\tif (!left || rect.left < left) {\n\t\t\t\t\tleft = rect.left;\n\t\t\t\t\t// right = rect.right;\n\t\t\t\t\tright = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - (this.layout.gap / 2);\n\t\t\t\t\ttop = rect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.style.top = `${top}px`;\n\t\telement.style.left = `${right}px`;\n\t}\n\n\tunhighlight(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.highlights) {\n\t\t\titem = this.highlights[cfiRange];\n\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.highlights[cfiRange];\n\t\t}\n\t}\n\n\tununderline(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.underlines) {\n\t\t\titem = this.underlines[cfiRange];\n\t\t\tthis.pane.removeMark(item.mark);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.underlines[cfiRange];\n\t\t}\n\t}\n\n\tunmark(cfiRange) {\n\t\tlet item;\n\t\tif (cfiRange in this.marks) {\n\t\t\titem = this.marks[cfiRange];\n\t\t\tthis.element.removeChild(item.element);\n\t\t\titem.listeners.forEach((l) => {\n\t\t\t\tif (l) {\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\n\t\t\t\t};\n\t\t\t});\n\t\t\tdelete this.marks[cfiRange];\n\t\t}\n\t}\n\n\tdestroy() {\n\n\t\tfor (let cfiRange in this.highlights) {\n\t\t\tthis.unhighlight(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.underlines) {\n\t\t\tthis.ununderline(cfiRange);\n\t\t}\n\n\t\tfor (let cfiRange in this.marks) {\n\t\t\tthis.unmark(cfiRange);\n\t\t}\n\n\t\tif (this.blobUrl) {\n\t\t\trevokeBlobUrl(this.blobUrl);\n\t\t}\n\n\t\tif(this.displayed){\n\t\t\tthis.displayed = false;\n\n\t\t\tthis.removeListeners();\n\t\t\tthis.contents.destroy();\n\n\t\t\tthis.stopExpanding = true;\n\t\t\tthis.element.removeChild(this.iframe);\n\n\t\t\tif (this.pane) {\n\t\t\t\tthis.pane.element.remove();\n\t\t\t\tthis.pane = undefined;\n\t\t\t}\n\n\t\t\tthis.iframe = undefined;\n\t\t\tthis.contents = undefined;\n\n\t\t\tthis._textWidth = null;\n\t\t\tthis._textHeight = null;\n\t\t\tthis._width = null;\n\t\t\tthis._height = null;\n\t\t}\n\n\t\t// this.element.style.height = \"0px\";\n\t\t// this.element.style.width = \"0px\";\n\t}\n}\n\nEventEmitter(IframeView.prototype);\n\nexport default IframeView;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}