{"ast":null,"code":"import _classCallCheck from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport EventEmitter from \"event-emitter\";\nimport { isNumber, prefixed, borders, defaults } from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport { replaceLinks } from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\nvar hasNavigator = typeof navigator !== \"undefined\";\nvar isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nvar isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\nvar ELEMENT_NODE = 1;\nvar TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nvar Contents = /*#__PURE__*/function () {\n  function Contents(doc, content, cfiBase, sectionIndex) {\n    _classCallCheck(this, Contents);\n    // Blank Cfi for Parsing\n    this.epubcfi = new EpubCFI();\n    this.document = doc;\n    this.documentElement = this.document.documentElement;\n    this.content = content || this.document.body;\n    this.window = this.document.defaultView;\n    this._size = {\n      width: 0,\n      height: 0\n    };\n    this.sectionIndex = sectionIndex || 0;\n    this.cfiBase = cfiBase || \"\";\n    this.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n    this.called = 0;\n    this.active = true;\n    this.listeners();\n  }\n\n  /**\n  \t* Get DOM events that are listened for and passed along\n  \t*/\n  _createClass(Contents, [{\n    key: \"width\",\n    value:\n    /**\n    \t* Get or Set width\n    \t* @param {number} [w]\n    \t* @returns {number} width\n    \t*/\n    function width(w) {\n      // var frame = this.documentElement;\n      var frame = this.content;\n      if (w && isNumber(w)) {\n        w = w + \"px\";\n      }\n      if (w) {\n        frame.style.width = w;\n        // this.content.style.width = w;\n      }\n\n      return parseInt(this.window.getComputedStyle(frame)[\"width\"]);\n    }\n\n    /**\n    \t* Get or Set height\n    \t* @param {number} [h]\n    \t* @returns {number} height\n    \t*/\n  }, {\n    key: \"height\",\n    value: function height(h) {\n      // var frame = this.documentElement;\n      var frame = this.content;\n      if (h && isNumber(h)) {\n        h = h + \"px\";\n      }\n      if (h) {\n        frame.style.height = h;\n        // this.content.style.height = h;\n      }\n\n      return parseInt(this.window.getComputedStyle(frame)[\"height\"]);\n    }\n\n    /**\n    \t* Get or Set width of the contents\n    \t* @param {number} [w]\n    \t* @returns {number} width\n    \t*/\n  }, {\n    key: \"contentWidth\",\n    value: function contentWidth(w) {\n      var content = this.content || this.document.body;\n      if (w && isNumber(w)) {\n        w = w + \"px\";\n      }\n      if (w) {\n        content.style.width = w;\n      }\n      return parseInt(this.window.getComputedStyle(content)[\"width\"]);\n    }\n\n    /**\n    \t* Get or Set height of the contents\n    \t* @param {number} [h]\n    \t* @returns {number} height\n    \t*/\n  }, {\n    key: \"contentHeight\",\n    value: function contentHeight(h) {\n      var content = this.content || this.document.body;\n      if (h && isNumber(h)) {\n        h = h + \"px\";\n      }\n      if (h) {\n        content.style.height = h;\n      }\n      return parseInt(this.window.getComputedStyle(content)[\"height\"]);\n    }\n\n    /**\n    \t* Get the width of the text using Range\n    \t* @returns {number} width\n    \t*/\n  }, {\n    key: \"textWidth\",\n    value: function textWidth() {\n      var rect;\n      var width;\n      var range = this.document.createRange();\n      var content = this.content || this.document.body;\n      var border = borders(content);\n\n      // Select the contents of frame\n      range.selectNodeContents(content);\n\n      // get the width of the text content\n      rect = range.getBoundingClientRect();\n      width = rect.width;\n      if (border && border.width) {\n        width += border.width;\n      }\n      return Math.round(width);\n    }\n\n    /**\n    \t* Get the height of the text using Range\n    \t* @returns {number} height\n    \t*/\n  }, {\n    key: \"textHeight\",\n    value: function textHeight() {\n      var rect;\n      var height;\n      var range = this.document.createRange();\n      var content = this.content || this.document.body;\n      range.selectNodeContents(content);\n      rect = range.getBoundingClientRect();\n      height = rect.bottom;\n      return Math.round(height);\n    }\n\n    /**\n    \t* Get documentElement scrollWidth\n    \t* @returns {number} width\n    \t*/\n  }, {\n    key: \"scrollWidth\",\n    value: function scrollWidth() {\n      var width = this.documentElement.scrollWidth;\n      return width;\n    }\n\n    /**\n    \t* Get documentElement scrollHeight\n    \t* @returns {number} height\n    \t*/\n  }, {\n    key: \"scrollHeight\",\n    value: function scrollHeight() {\n      var height = this.documentElement.scrollHeight;\n      return height;\n    }\n\n    /**\n    \t* Set overflow css style of the contents\n    \t* @param {string} [overflow]\n    \t*/\n  }, {\n    key: \"overflow\",\n    value: function overflow(_overflow) {\n      if (_overflow) {\n        this.documentElement.style.overflow = _overflow;\n      }\n      return this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n    }\n\n    /**\n    \t* Set overflowX css style of the documentElement\n    \t* @param {string} [overflow]\n    \t*/\n  }, {\n    key: \"overflowX\",\n    value: function overflowX(overflow) {\n      if (overflow) {\n        this.documentElement.style.overflowX = overflow;\n      }\n      return this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n    }\n\n    /**\n    \t* Set overflowY css style of the documentElement\n    \t* @param {string} [overflow]\n    \t*/\n  }, {\n    key: \"overflowY\",\n    value: function overflowY(overflow) {\n      if (overflow) {\n        this.documentElement.style.overflowY = overflow;\n      }\n      return this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n    }\n\n    /**\n    \t* Set Css styles on the contents element (typically Body)\n    \t* @param {string} property\n    \t* @param {string} value\n    \t* @param {boolean} [priority] set as \"important\"\n    \t*/\n  }, {\n    key: \"css\",\n    value: function css(property, value, priority) {\n      var content = this.content || this.document.body;\n      if (value) {\n        content.style.setProperty(property, value, priority ? \"important\" : \"\");\n      } else {\n        content.style.removeProperty(property);\n      }\n      return this.window.getComputedStyle(content)[property];\n    }\n\n    /**\n    \t* Get or Set the viewport element\n    \t* @param {object} [options]\n    \t* @param {string} [options.width]\n    \t* @param {string} [options.height]\n    \t* @param {string} [options.scale]\n    \t* @param {string} [options.minimum]\n    \t* @param {string} [options.maximum]\n    \t* @param {string} [options.scalable]\n    \t*/\n  }, {\n    key: \"viewport\",\n    value: function viewport(options) {\n      var _width, _height, _scale, _minimum, _maximum, _scalable;\n      // var width, height, scale, minimum, maximum, scalable;\n      var $viewport = this.document.querySelector(\"meta[name='viewport']\");\n      var parsed = {\n        \"width\": undefined,\n        \"height\": undefined,\n        \"scale\": undefined,\n        \"minimum\": undefined,\n        \"maximum\": undefined,\n        \"scalable\": undefined\n      };\n      var newContent = [];\n      var settings = {};\n\n      /*\n      * check for the viewport size\n      * <meta name=\"viewport\" content=\"width=1024,height=697\" />\n      */\n      if ($viewport && $viewport.hasAttribute(\"content\")) {\n        var content = $viewport.getAttribute(\"content\");\n        var _width2 = content.match(/width\\s*=\\s*([^,]*)/);\n        var _height2 = content.match(/height\\s*=\\s*([^,]*)/);\n        var _scale2 = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n        var _minimum2 = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n        var _maximum2 = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n        var _scalable2 = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n        if (_width2 && _width2.length && typeof _width2[1] !== \"undefined\") {\n          parsed.width = _width2[1];\n        }\n        if (_height2 && _height2.length && typeof _height2[1] !== \"undefined\") {\n          parsed.height = _height2[1];\n        }\n        if (_scale2 && _scale2.length && typeof _scale2[1] !== \"undefined\") {\n          parsed.scale = _scale2[1];\n        }\n        if (_minimum2 && _minimum2.length && typeof _minimum2[1] !== \"undefined\") {\n          parsed.minimum = _minimum2[1];\n        }\n        if (_maximum2 && _maximum2.length && typeof _maximum2[1] !== \"undefined\") {\n          parsed.maximum = _maximum2[1];\n        }\n        if (_scalable2 && _scalable2.length && typeof _scalable2[1] !== \"undefined\") {\n          parsed.scalable = _scalable2[1];\n        }\n      }\n      settings = defaults(options || {}, parsed);\n      if (options) {\n        if (settings.width) {\n          newContent.push(\"width=\" + settings.width);\n        }\n        if (settings.height) {\n          newContent.push(\"height=\" + settings.height);\n        }\n        if (settings.scale) {\n          newContent.push(\"initial-scale=\" + settings.scale);\n        }\n        if (settings.scalable === \"no\") {\n          newContent.push(\"minimum-scale=\" + settings.scale);\n          newContent.push(\"maximum-scale=\" + settings.scale);\n          newContent.push(\"user-scalable=\" + settings.scalable);\n        } else {\n          if (settings.scalable) {\n            newContent.push(\"user-scalable=\" + settings.scalable);\n          }\n          if (settings.minimum) {\n            newContent.push(\"minimum-scale=\" + settings.minimum);\n          }\n          if (settings.maximum) {\n            newContent.push(\"minimum-scale=\" + settings.maximum);\n          }\n        }\n        if (!$viewport) {\n          $viewport = this.document.createElement(\"meta\");\n          $viewport.setAttribute(\"name\", \"viewport\");\n          this.document.querySelector(\"head\").appendChild($viewport);\n        }\n        $viewport.setAttribute(\"content\", newContent.join(\", \"));\n        this.window.scrollTo(0, 0);\n      }\n      return settings;\n    }\n\n    /**\n     * Event emitter for when the contents has expanded\n     * @private\n     */\n  }, {\n    key: \"expand\",\n    value: function expand() {\n      this.emit(EVENTS.CONTENTS.EXPAND);\n    }\n\n    /**\n     * Add DOM listeners\n     * @private\n     */\n  }, {\n    key: \"listeners\",\n    value: function listeners() {\n      this.imageLoadListeners();\n      this.mediaQueryListeners();\n\n      // this.fontLoadListeners();\n\n      this.addEventListeners();\n      this.addSelectionListeners();\n\n      // this.transitionListeners();\n\n      if (typeof ResizeObserver === \"undefined\") {\n        this.resizeListeners();\n        this.visibilityListeners();\n      } else {\n        this.resizeObservers();\n      }\n\n      // this.mutationObservers();\n\n      this.linksHandler();\n    }\n\n    /**\n     * Remove DOM listeners\n     * @private\n     */\n  }, {\n    key: \"removeListeners\",\n    value: function removeListeners() {\n      this.removeEventListeners();\n      this.removeSelectionListeners();\n      if (this.observer) {\n        this.observer.disconnect();\n      }\n      clearTimeout(this.expanding);\n    }\n\n    /**\n     * Check if size of contents has changed and\n     * emit 'resize' event if it has.\n     * @private\n     */\n  }, {\n    key: \"resizeCheck\",\n    value: function resizeCheck() {\n      var width = this.textWidth();\n      var height = this.textHeight();\n      if (width != this._size.width || height != this._size.height) {\n        this._size = {\n          width: width,\n          height: height\n        };\n        this.onResize && this.onResize(this._size);\n        this.emit(EVENTS.CONTENTS.RESIZE, this._size);\n      }\n    }\n\n    /**\n     * Poll for resize detection\n     * @private\n     */\n  }, {\n    key: \"resizeListeners\",\n    value: function resizeListeners() {\n      var width, height;\n      // Test size again\n      clearTimeout(this.expanding);\n      requestAnimationFrame(this.resizeCheck.bind(this));\n      this.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n    }\n\n    /**\n     * Listen for visibility of tab to change\n     * @private\n     */\n  }, {\n    key: \"visibilityListeners\",\n    value: function visibilityListeners() {\n      var _this = this;\n      document.addEventListener(\"visibilitychange\", function () {\n        if (document.visibilityState === \"visible\" && _this.active === false) {\n          _this.active = true;\n          _this.resizeListeners();\n        } else {\n          _this.active = false;\n          clearTimeout(_this.expanding);\n        }\n      });\n    }\n\n    /**\n     * Use css transitions to detect resize\n     * @private\n     */\n  }, {\n    key: \"transitionListeners\",\n    value: function transitionListeners() {\n      var body = this.content;\n      body.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n      body.style['transitionDuration'] = \"0.001ms\";\n      body.style['transitionTimingFunction'] = \"linear\";\n      body.style['transitionDelay'] = \"0\";\n      this._resizeCheck = this.resizeCheck.bind(this);\n      this.document.addEventListener('transitionend', this._resizeCheck);\n    }\n\n    /**\n     * Listen for media query changes and emit 'expand' event\n     * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n     * @private\n     */\n  }, {\n    key: \"mediaQueryListeners\",\n    value: function mediaQueryListeners() {\n      var sheets = this.document.styleSheets;\n      var mediaChangeHandler = function (m) {\n        if (m.matches && !this._expanding) {\n          setTimeout(this.expand.bind(this), 1);\n        }\n      }.bind(this);\n      for (var i = 0; i < sheets.length; i += 1) {\n        var rules;\n        // Firefox errors if we access cssRules cross-domain\n        try {\n          rules = sheets[i].cssRules;\n        } catch (e) {\n          return;\n        }\n        if (!rules) return; // Stylesheets changed\n        for (var j = 0; j < rules.length; j += 1) {\n          //if (rules[j].constructor === CSSMediaRule) {\n          if (rules[j].media) {\n            var mql = this.window.matchMedia(rules[j].media.mediaText);\n            mql.addListener(mediaChangeHandler);\n            //mql.onchange = mediaChangeHandler;\n          }\n        }\n      }\n    }\n\n    /**\n     * Use ResizeObserver to listen for changes in the DOM and check for resize\n     * @private\n     */\n  }, {\n    key: \"resizeObservers\",\n    value: function resizeObservers() {\n      var _this2 = this;\n      // create an observer instance\n      this.observer = new ResizeObserver(function (e) {\n        requestAnimationFrame(_this2.resizeCheck.bind(_this2));\n      });\n\n      // pass in the target node\n      this.observer.observe(this.document.documentElement);\n    }\n\n    /**\n     * Use MutationObserver to listen for changes in the DOM and check for resize\n     * @private\n     */\n  }, {\n    key: \"mutationObservers\",\n    value: function mutationObservers() {\n      var _this3 = this;\n      // create an observer instance\n      this.observer = new MutationObserver(function (mutations) {\n        _this3.resizeCheck();\n      });\n\n      // configuration of the observer:\n      var config = {\n        attributes: true,\n        childList: true,\n        characterData: true,\n        subtree: true\n      };\n\n      // pass in the target node, as well as the observer options\n      this.observer.observe(this.document, config);\n    }\n\n    /**\n     * Test if images are loaded or add listener for when they load\n     * @private\n     */\n  }, {\n    key: \"imageLoadListeners\",\n    value: function imageLoadListeners() {\n      var images = this.document.querySelectorAll(\"img\");\n      var img;\n      for (var i = 0; i < images.length; i++) {\n        img = images[i];\n        if (typeof img.naturalWidth !== \"undefined\" && img.naturalWidth === 0) {\n          img.onload = this.expand.bind(this);\n        }\n      }\n    }\n\n    /**\n     * Listen for font load and check for resize when loaded\n     * @private\n     */\n  }, {\n    key: \"fontLoadListeners\",\n    value: function fontLoadListeners() {\n      if (!this.document || !this.document.fonts) {\n        return;\n      }\n      this.document.fonts.ready.then(function () {\n        this.resizeCheck();\n      }.bind(this));\n    }\n\n    /**\n     * Get the documentElement\n     * @returns {element} documentElement\n     */\n  }, {\n    key: \"root\",\n    value: function root() {\n      if (!this.document) return null;\n      return this.document.documentElement;\n    }\n\n    /**\n     * Get the location offset of a EpubCFI or an #id\n     * @param {string | EpubCFI} target\n     * @param {string} [ignoreClass] for the cfi\n     * @returns { {left: Number, top: Number }\n     */\n  }, {\n    key: \"locationOf\",\n    value: function locationOf(target, ignoreClass) {\n      var position;\n      var targetPos = {\n        \"left\": 0,\n        \"top\": 0\n      };\n      if (!this.document) return targetPos;\n      if (this.epubcfi.isCfiString(target)) {\n        var range = new EpubCFI(target).toRange(this.document, ignoreClass);\n        if (range) {\n          try {\n            if (!range.endContainer || range.startContainer == range.endContainer && range.startOffset == range.endOffset) {\n              // If the end for the range is not set, it results in collapsed becoming\n              // true. This in turn leads to inconsistent behaviour when calling\n              // getBoundingRect. Wrong bounds lead to the wrong page being displayed.\n              // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/\n              var pos = range.startContainer.textContent.indexOf(\" \", range.startOffset);\n              if (pos == -1) {\n                pos = range.startContainer.textContent.length;\n              }\n              range.setEnd(range.startContainer, pos);\n            }\n          } catch (e) {\n            console.error(\"setting end offset to start container length failed\", e);\n          }\n          if (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n            position = range.startContainer.getBoundingClientRect();\n            targetPos.left = position.left;\n            targetPos.top = position.top;\n          } else {\n            // Webkit does not handle collapsed range bounds correctly\n            // https://bugs.webkit.org/show_bug.cgi?id=138949\n\n            // Construct a new non-collapsed range\n            if (isWebkit) {\n              var container = range.startContainer;\n              var newRange = new Range();\n              try {\n                if (container.nodeType === ELEMENT_NODE) {\n                  position = container.getBoundingClientRect();\n                } else if (range.startOffset + 2 < container.length) {\n                  newRange.setStart(container, range.startOffset);\n                  newRange.setEnd(container, range.startOffset + 2);\n                  position = newRange.getBoundingClientRect();\n                } else if (range.startOffset - 2 > 0) {\n                  newRange.setStart(container, range.startOffset - 2);\n                  newRange.setEnd(container, range.startOffset);\n                  position = newRange.getBoundingClientRect();\n                } else {\n                  // empty, return the parent element\n                  position = container.parentNode.getBoundingClientRect();\n                }\n              } catch (e) {\n                console.error(e, e.stack);\n              }\n            } else {\n              position = range.getBoundingClientRect();\n            }\n          }\n        }\n      } else if (typeof target === \"string\" && target.indexOf(\"#\") > -1) {\n        var id = target.substring(target.indexOf(\"#\") + 1);\n        var el = this.document.getElementById(id);\n        if (el) {\n          if (isWebkit) {\n            // Webkit reports incorrect bounding rects in Columns\n            var _newRange = new Range();\n            _newRange.selectNode(el);\n            position = _newRange.getBoundingClientRect();\n          } else {\n            position = el.getBoundingClientRect();\n          }\n        }\n      }\n      if (position) {\n        targetPos.left = position.left;\n        targetPos.top = position.top;\n      }\n      return targetPos;\n    }\n\n    /**\n     * Append a stylesheet link to the document head\n     * @param {string} src url\n     */\n  }, {\n    key: \"addStylesheet\",\n    value: function addStylesheet(src) {\n      return new Promise(function (resolve, reject) {\n        var $stylesheet;\n        var ready = false;\n        if (!this.document) {\n          resolve(false);\n          return;\n        }\n\n        // Check if link already exists\n        $stylesheet = this.document.querySelector(\"link[href='\" + src + \"']\");\n        if ($stylesheet) {\n          resolve(true);\n          return; // already present\n        }\n\n        $stylesheet = this.document.createElement(\"link\");\n        $stylesheet.type = \"text/css\";\n        $stylesheet.rel = \"stylesheet\";\n        $stylesheet.href = src;\n        $stylesheet.onload = $stylesheet.onreadystatechange = function () {\n          if (!ready && (!this.readyState || this.readyState == \"complete\")) {\n            ready = true;\n            // Let apply\n            setTimeout(function () {\n              resolve(true);\n            }, 1);\n          }\n        };\n        this.document.head.appendChild($stylesheet);\n      }.bind(this));\n    }\n  }, {\n    key: \"_getStylesheetNode\",\n    value: function _getStylesheetNode(key) {\n      var styleEl;\n      key = \"epubjs-inserted-css-\" + (key || '');\n      if (!this.document) return false;\n\n      // Check if link already exists\n      styleEl = this.document.getElementById(key);\n      if (!styleEl) {\n        styleEl = this.document.createElement(\"style\");\n        styleEl.id = key;\n        // Append style element to head\n        this.document.head.appendChild(styleEl);\n      }\n      return styleEl;\n    }\n\n    /**\n     * Append stylesheet css\n     * @param {string} serializedCss\n     * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n     */\n  }, {\n    key: \"addStylesheetCss\",\n    value: function addStylesheetCss(serializedCss, key) {\n      if (!this.document || !serializedCss) return false;\n      var styleEl;\n      styleEl = this._getStylesheetNode(key);\n      styleEl.innerHTML = serializedCss;\n      return true;\n    }\n\n    /**\n     * Append stylesheet rules to a generate stylesheet\n     * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n     * Object: https://github.com/desirable-objects/json-to-css\n     * @param {array | object} rules\n     * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n     */\n  }, {\n    key: \"addStylesheetRules\",\n    value: function addStylesheetRules(rules, key) {\n      var styleSheet;\n      if (!this.document || !rules || rules.length === 0) return;\n\n      // Grab style sheet\n      styleSheet = this._getStylesheetNode(key).sheet;\n      if (Object.prototype.toString.call(rules) === \"[object Array]\") {\n        for (var i = 0, rl = rules.length; i < rl; i++) {\n          var j = 1,\n            rule = rules[i],\n            selector = rules[i][0],\n            propStr = \"\";\n          // If the second argument of a rule is an array of arrays, correct our variables.\n          if (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n            rule = rule[1];\n            j = 0;\n          }\n          for (var pl = rule.length; j < pl; j++) {\n            var prop = rule[j];\n            propStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n          }\n\n          // Insert CSS Rule\n          styleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n        }\n      } else {\n        var selectors = Object.keys(rules);\n        selectors.forEach(function (selector) {\n          var definition = rules[selector];\n          if (Array.isArray(definition)) {\n            definition.forEach(function (item) {\n              var _rules = Object.keys(item);\n              var result = _rules.map(function (rule) {\n                return \"\".concat(rule, \":\").concat(item[rule]);\n              }).join(';');\n              styleSheet.insertRule(\"\".concat(selector, \"{\").concat(result, \"}\"), styleSheet.cssRules.length);\n            });\n          } else {\n            var _rules = Object.keys(definition);\n            var result = _rules.map(function (rule) {\n              return \"\".concat(rule, \":\").concat(definition[rule]);\n            }).join(';');\n            styleSheet.insertRule(\"\".concat(selector, \"{\").concat(result, \"}\"), styleSheet.cssRules.length);\n          }\n        });\n      }\n    }\n\n    /**\n     * Append a script tag to the document head\n     * @param {string} src url\n     * @returns {Promise} loaded\n     */\n  }, {\n    key: \"addScript\",\n    value: function addScript(src) {\n      return new Promise(function (resolve, reject) {\n        var $script;\n        var ready = false;\n        if (!this.document) {\n          resolve(false);\n          return;\n        }\n        $script = this.document.createElement(\"script\");\n        $script.type = \"text/javascript\";\n        $script.async = true;\n        $script.src = src;\n        $script.onload = $script.onreadystatechange = function () {\n          if (!ready && (!this.readyState || this.readyState == \"complete\")) {\n            ready = true;\n            setTimeout(function () {\n              resolve(true);\n            }, 1);\n          }\n        };\n        this.document.head.appendChild($script);\n      }.bind(this));\n    }\n\n    /**\n     * Add a class to the contents container\n     * @param {string} className\n     */\n  }, {\n    key: \"addClass\",\n    value: function addClass(className) {\n      var content;\n      if (!this.document) return;\n      content = this.content || this.document.body;\n      if (content) {\n        content.classList.add(className);\n      }\n    }\n\n    /**\n     * Remove a class from the contents container\n     * @param {string} removeClass\n     */\n  }, {\n    key: \"removeClass\",\n    value: function removeClass(className) {\n      var content;\n      if (!this.document) return;\n      content = this.content || this.document.body;\n      if (content) {\n        content.classList.remove(className);\n      }\n    }\n\n    /**\n     * Add DOM event listeners\n     * @private\n     */\n  }, {\n    key: \"addEventListeners\",\n    value: function addEventListeners() {\n      if (!this.document) {\n        return;\n      }\n      this._triggerEvent = this.triggerEvent.bind(this);\n      DOM_EVENTS.forEach(function (eventName) {\n        this.document.addEventListener(eventName, this._triggerEvent, {\n          passive: true\n        });\n      }, this);\n    }\n\n    /**\n     * Remove DOM event listeners\n     * @private\n     */\n  }, {\n    key: \"removeEventListeners\",\n    value: function removeEventListeners() {\n      if (!this.document) {\n        return;\n      }\n      DOM_EVENTS.forEach(function (eventName) {\n        this.document.removeEventListener(eventName, this._triggerEvent, {\n          passive: true\n        });\n      }, this);\n      this._triggerEvent = undefined;\n    }\n\n    /**\n     * Emit passed browser events\n     * @private\n     */\n  }, {\n    key: \"triggerEvent\",\n    value: function triggerEvent(e) {\n      this.emit(e.type, e);\n    }\n\n    /**\n     * Add listener for text selection\n     * @private\n     */\n  }, {\n    key: \"addSelectionListeners\",\n    value: function addSelectionListeners() {\n      if (!this.document) {\n        return;\n      }\n      this._onSelectionChange = this.onSelectionChange.bind(this);\n      this.document.addEventListener(\"selectionchange\", this._onSelectionChange, {\n        passive: true\n      });\n    }\n\n    /**\n     * Remove listener for text selection\n     * @private\n     */\n  }, {\n    key: \"removeSelectionListeners\",\n    value: function removeSelectionListeners() {\n      if (!this.document) {\n        return;\n      }\n      this.document.removeEventListener(\"selectionchange\", this._onSelectionChange, {\n        passive: true\n      });\n      this._onSelectionChange = undefined;\n    }\n\n    /**\n     * Handle getting text on selection\n     * @private\n     */\n  }, {\n    key: \"onSelectionChange\",\n    value: function onSelectionChange(e) {\n      if (this.selectionEndTimeout) {\n        clearTimeout(this.selectionEndTimeout);\n      }\n      this.selectionEndTimeout = setTimeout(function () {\n        var selection = this.window.getSelection();\n        this.triggerSelectedEvent(selection);\n      }.bind(this), 250);\n    }\n\n    /**\n     * Emit event on text selection\n     * @private\n     */\n  }, {\n    key: \"triggerSelectedEvent\",\n    value: function triggerSelectedEvent(selection) {\n      var range, cfirange;\n      if (selection && selection.rangeCount > 0) {\n        range = selection.getRangeAt(0);\n        if (!range.collapsed) {\n          // cfirange = this.section.cfiFromRange(range);\n          cfirange = new EpubCFI(range, this.cfiBase).toString();\n          this.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n          this.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n        }\n      }\n    }\n\n    /**\n     * Get a Dom Range from EpubCFI\n     * @param {EpubCFI} _cfi\n     * @param {string} [ignoreClass]\n     * @returns {Range} range\n     */\n  }, {\n    key: \"range\",\n    value: function range(_cfi, ignoreClass) {\n      var cfi = new EpubCFI(_cfi);\n      return cfi.toRange(this.document, ignoreClass);\n    }\n\n    /**\n     * Get an EpubCFI from a Dom Range\n     * @param {Range} range\n     * @param {string} [ignoreClass]\n     * @returns {EpubCFI} cfi\n     */\n  }, {\n    key: \"cfiFromRange\",\n    value: function cfiFromRange(range, ignoreClass) {\n      return new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n    }\n\n    /**\n     * Get an EpubCFI from a Dom node\n     * @param {node} node\n     * @param {string} [ignoreClass]\n     * @returns {EpubCFI} cfi\n     */\n  }, {\n    key: \"cfiFromNode\",\n    value: function cfiFromNode(node, ignoreClass) {\n      return new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n    }\n\n    // TODO: find where this is used - remove?\n  }, {\n    key: \"map\",\n    value: function map(layout) {\n      var map = new Mapping(layout);\n      return map.section();\n    }\n\n    /**\n     * Size the contents to a given width and height\n     * @param {number} [width]\n     * @param {number} [height]\n     */\n  }, {\n    key: \"size\",\n    value: function size(width, height) {\n      var viewport = {\n        scale: 1.0,\n        scalable: \"no\"\n      };\n      this.layoutStyle(\"scrolling\");\n      if (width >= 0) {\n        this.width(width);\n        viewport.width = width;\n        this.css(\"padding\", \"0 \" + width / 12 + \"px\");\n      }\n      if (height >= 0) {\n        this.height(height);\n        viewport.height = height;\n      }\n      this.css(\"margin\", \"0\");\n      this.css(\"box-sizing\", \"border-box\");\n      this.viewport(viewport);\n    }\n\n    /**\n     * Apply columns to the contents for pagination\n     * @param {number} width\n     * @param {number} height\n     * @param {number} columnWidth\n     * @param {number} gap\n     */\n  }, {\n    key: \"columns\",\n    value: function columns(width, height, columnWidth, gap, dir) {\n      var COLUMN_AXIS = prefixed(\"column-axis\");\n      var COLUMN_GAP = prefixed(\"column-gap\");\n      var COLUMN_WIDTH = prefixed(\"column-width\");\n      var COLUMN_FILL = prefixed(\"column-fill\");\n      var writingMode = this.writingMode();\n      var axis = writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n      this.layoutStyle(\"paginated\");\n      if (dir === \"rtl\" && axis === \"horizontal\") {\n        this.direction(dir);\n      }\n      this.width(width);\n      this.height(height);\n\n      // Deal with Mobile trying to scale to viewport\n      this.viewport({\n        width: width,\n        height: height,\n        scale: 1.0,\n        scalable: \"no\"\n      });\n\n      // TODO: inline-block needs more testing\n      // Fixes Safari column cut offs, but causes RTL issues\n      // this.css(\"display\", \"inline-block\");\n\n      this.css(\"overflow-y\", \"hidden\");\n      this.css(\"margin\", \"0\", true);\n      if (axis === \"vertical\") {\n        this.css(\"padding-top\", gap / 2 + \"px\", true);\n        this.css(\"padding-bottom\", gap / 2 + \"px\", true);\n        this.css(\"padding-left\", \"20px\");\n        this.css(\"padding-right\", \"20px\");\n        this.css(COLUMN_AXIS, \"vertical\");\n      } else {\n        this.css(\"padding-top\", \"20px\");\n        this.css(\"padding-bottom\", \"20px\");\n        this.css(\"padding-left\", gap / 2 + \"px\", true);\n        this.css(\"padding-right\", gap / 2 + \"px\", true);\n        this.css(COLUMN_AXIS, \"horizontal\");\n      }\n      this.css(\"box-sizing\", \"border-box\");\n      this.css(\"max-width\", \"inherit\");\n      this.css(COLUMN_FILL, \"auto\");\n      this.css(COLUMN_GAP, gap + \"px\");\n      this.css(COLUMN_WIDTH, columnWidth + \"px\");\n\n      // Fix glyph clipping in WebKit\n      // https://github.com/futurepress/epub.js/issues/983\n      this.css(\"-webkit-line-box-contain\", \"block glyphs replaced\");\n    }\n\n    /**\n     * Scale contents from center\n     * @param {number} scale\n     * @param {number} offsetX\n     * @param {number} offsetY\n     */\n  }, {\n    key: \"scaler\",\n    value: function scaler(scale, offsetX, offsetY) {\n      var scaleStr = \"scale(\" + scale + \")\";\n      var translateStr = \"\";\n      // this.css(\"position\", \"absolute\"));\n      this.css(\"transform-origin\", \"top left\");\n      if (offsetX >= 0 || offsetY >= 0) {\n        translateStr = \" translate(\" + (offsetX || 0) + \"px, \" + (offsetY || 0) + \"px )\";\n      }\n      this.css(\"transform\", scaleStr + translateStr);\n    }\n\n    /**\n     * Fit contents into a fixed width and height\n     * @param {number} width\n     * @param {number} height\n     */\n  }, {\n    key: \"fit\",\n    value: function fit(width, height, section) {\n      var viewport = this.viewport();\n      var viewportWidth = parseInt(viewport.width);\n      var viewportHeight = parseInt(viewport.height);\n      var widthScale = width / viewportWidth;\n      var heightScale = height / viewportHeight;\n      var scale = widthScale < heightScale ? widthScale : heightScale;\n\n      // the translate does not work as intended, elements can end up unaligned\n      // var offsetY = (height - (viewportHeight * scale)) / 2;\n      // var offsetX = 0;\n      // if (this.sectionIndex % 2 === 1) {\n      // \toffsetX = width - (viewportWidth * scale);\n      // }\n\n      this.layoutStyle(\"paginated\");\n\n      // scale needs width and height to be set\n      this.width(viewportWidth);\n      this.height(viewportHeight);\n      this.overflow(\"hidden\");\n\n      // Scale to the correct size\n      this.scaler(scale, 0, 0);\n      // this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n\n      // background images are not scaled by transform\n      this.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n      this.css(\"background-color\", \"transparent\");\n      if (section && section.properties.includes(\"page-spread-left\")) {\n        // set margin since scale is weird\n        var marginLeft = width - viewportWidth * scale;\n        this.css(\"margin-left\", marginLeft + \"px\");\n      }\n    }\n\n    /**\n     * Set the direction of the text\n     * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n     */\n  }, {\n    key: \"direction\",\n    value: function direction(dir) {\n      if (this.documentElement) {\n        this.documentElement.style[\"direction\"] = dir;\n      }\n    }\n  }, {\n    key: \"mapPage\",\n    value: function mapPage(cfiBase, layout, start, end, dev) {\n      var mapping = new Mapping(layout, dev);\n      return mapping.page(this, cfiBase, start, end);\n    }\n\n    /**\n     * Emit event when link in content is clicked\n     * @private\n     */\n  }, {\n    key: \"linksHandler\",\n    value: function linksHandler() {\n      var _this4 = this;\n      replaceLinks(this.content, function (href) {\n        _this4.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n      });\n    }\n\n    /**\n     * Set the writingMode of the text\n     * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n     */\n  }, {\n    key: \"writingMode\",\n    value: function writingMode(mode) {\n      var WRITING_MODE = prefixed(\"writing-mode\");\n      if (mode && this.documentElement) {\n        this.documentElement.style[WRITING_MODE] = mode;\n      }\n      return this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n    }\n\n    /**\n     * Set the layoutStyle of the content\n     * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n     * @private\n     */\n  }, {\n    key: \"layoutStyle\",\n    value: function layoutStyle(style) {\n      if (style) {\n        this._layoutStyle = style;\n        navigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n      }\n      return this._layoutStyle || \"paginated\";\n    }\n\n    /**\n     * Add the epubReadingSystem object to the navigator\n     * @param {string} name\n     * @param {string} version\n     * @private\n     */\n  }, {\n    key: \"epubReadingSystem\",\n    value: function epubReadingSystem(name, version) {\n      navigator.epubReadingSystem = {\n        name: name,\n        version: version,\n        layoutStyle: this.layoutStyle(),\n        hasFeature: function hasFeature(feature) {\n          switch (feature) {\n            case \"dom-manipulation\":\n              return true;\n            case \"layout-changes\":\n              return true;\n            case \"touch-events\":\n              return true;\n            case \"mouse-events\":\n              return true;\n            case \"keyboard-events\":\n              return true;\n            case \"spine-scripting\":\n              return false;\n            default:\n              return false;\n          }\n        }\n      };\n      return navigator.epubReadingSystem;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      // this.document.removeEventListener('transitionend', this._resizeCheck);\n\n      this.removeListeners();\n    }\n  }], [{\n    key: \"listenedEvents\",\n    get: function get() {\n      return DOM_EVENTS;\n    }\n  }]);\n  return Contents;\n}();\nEventEmitter(Contents.prototype);\nexport default Contents;","map":{"version":3,"names":["EventEmitter","isNumber","prefixed","borders","defaults","EpubCFI","Mapping","replaceLinks","EPUBJS_VERSION","EVENTS","DOM_EVENTS","hasNavigator","navigator","isChrome","test","userAgent","isWebkit","ELEMENT_NODE","TEXT_NODE","Contents","doc","content","cfiBase","sectionIndex","epubcfi","document","documentElement","body","window","defaultView","_size","width","height","epubReadingSystem","called","active","listeners","w","frame","style","parseInt","getComputedStyle","h","rect","range","createRange","border","selectNodeContents","getBoundingClientRect","Math","round","bottom","scrollWidth","scrollHeight","overflow","overflowX","overflowY","property","value","priority","setProperty","removeProperty","options","_width","_height","_scale","_minimum","_maximum","_scalable","$viewport","querySelector","parsed","undefined","newContent","settings","hasAttribute","getAttribute","match","length","scale","minimum","maximum","scalable","push","createElement","setAttribute","appendChild","join","scrollTo","emit","CONTENTS","EXPAND","imageLoadListeners","mediaQueryListeners","addEventListeners","addSelectionListeners","ResizeObserver","resizeListeners","visibilityListeners","resizeObservers","linksHandler","removeEventListeners","removeSelectionListeners","observer","disconnect","clearTimeout","expanding","textWidth","textHeight","onResize","RESIZE","requestAnimationFrame","resizeCheck","bind","setTimeout","addEventListener","visibilityState","_resizeCheck","sheets","styleSheets","mediaChangeHandler","m","matches","_expanding","expand","i","rules","cssRules","e","j","media","mql","matchMedia","mediaText","addListener","observe","MutationObserver","mutations","config","attributes","childList","characterData","subtree","images","querySelectorAll","img","naturalWidth","onload","fonts","ready","then","target","ignoreClass","position","targetPos","isCfiString","toRange","endContainer","startContainer","startOffset","endOffset","pos","textContent","indexOf","setEnd","console","error","nodeType","Node","left","top","container","newRange","Range","setStart","parentNode","stack","id","substring","el","getElementById","selectNode","src","Promise","resolve","reject","$stylesheet","type","rel","href","onreadystatechange","readyState","head","key","styleEl","serializedCss","_getStylesheetNode","innerHTML","styleSheet","sheet","Object","prototype","toString","call","rl","rule","selector","propStr","pl","prop","insertRule","selectors","keys","forEach","definition","Array","isArray","item","_rules","result","map","$script","async","className","classList","add","remove","_triggerEvent","triggerEvent","eventName","passive","removeEventListener","_onSelectionChange","onSelectionChange","selectionEndTimeout","selection","getSelection","triggerSelectedEvent","cfirange","rangeCount","getRangeAt","collapsed","SELECTED","SELECTED_RANGE","_cfi","cfi","node","layout","section","viewport","layoutStyle","css","columnWidth","gap","dir","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","writingMode","axis","direction","offsetX","offsetY","scaleStr","translateStr","viewportWidth","viewportHeight","widthScale","heightScale","scaler","properties","includes","marginLeft","start","end","dev","mapping","page","LINK_CLICKED","mode","WRITING_MODE","_layoutStyle","name","version","hasFeature","feature","removeListeners"],"sources":["/home/parallels/Downloads/read/node_modules/epubjs/src/contents.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {isNumber, prefixed, borders, defaults} from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport {replaceLinks} from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\nconst hasNavigator = typeof (navigator) !== \"undefined\";\n\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nclass Contents {\n\tconstructor(doc, content, cfiBase, sectionIndex) {\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.document = doc;\n\t\tthis.documentElement =  this.document.documentElement;\n\t\tthis.content = content || this.document.body;\n\t\tthis.window = this.document.defaultView;\n\n\t\tthis._size = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\tthis.sectionIndex = sectionIndex || 0;\n\t\tthis.cfiBase = cfiBase || \"\";\n\n\t\tthis.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n\t\tthis.called = 0;\n\t\tthis.active = true;\n\t\tthis.listeners();\n\t}\n\n\t/**\n\t\t* Get DOM events that are listened for and passed along\n\t\t*/\n\tstatic get listenedEvents() {\n\t\treturn DOM_EVENTS;\n\t}\n\n\t/**\n\t\t* Get or Set width\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\twidth(w) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tframe.style.width = w;\n\t\t\t// this.content.style.width = w;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(frame)[\"width\"]);\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\theight(h) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tframe.style.height = h;\n\t\t\t// this.content.style.height = h;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(frame)[\"height\"]);\n\n\t}\n\n\t/**\n\t\t* Get or Set width of the contents\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\tcontentWidth(w) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tcontent.style.width = w;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(content)[\"width\"]);\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height of the contents\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\tcontentHeight(h) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tcontent.style.height = h;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(content)[\"height\"]);\n\n\t}\n\n\t/**\n\t\t* Get the width of the text using Range\n\t\t* @returns {number} width\n\t\t*/\n\ttextWidth() {\n\t\tlet rect;\n\t\tlet width;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\t// Select the contents of frame\n\t\trange.selectNodeContents(content);\n\n\t\t// get the width of the text content\n\t\trect = range.getBoundingClientRect();\n\t\twidth = rect.width;\n\n\t\tif (border && border.width) {\n\t\t\twidth += border.width;\n\t\t}\n\n\t\treturn Math.round(width);\n\t}\n\n\t/**\n\t\t* Get the height of the text using Range\n\t\t* @returns {number} height\n\t\t*/\n\ttextHeight() {\n\t\tlet rect;\n\t\tlet height;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\n\t\trange.selectNodeContents(content);\n\n\t\trect = range.getBoundingClientRect();\n\t\theight = rect.bottom;\n\n\t\treturn Math.round(height);\n\t}\n\n\t/**\n\t\t* Get documentElement scrollWidth\n\t\t* @returns {number} width\n\t\t*/\n\tscrollWidth() {\n\t\tvar width = this.documentElement.scrollWidth;\n\n\t\treturn width;\n\t}\n\n\t/**\n\t\t* Get documentElement scrollHeight\n\t\t* @returns {number} height\n\t\t*/\n\tscrollHeight() {\n\t\tvar height = this.documentElement.scrollHeight;\n\n\t\treturn height;\n\t}\n\n\t/**\n\t\t* Set overflow css style of the contents\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflow(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflow = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n\t}\n\n\t/**\n\t\t* Set overflowX css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowX(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowX = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n\t}\n\n\t/**\n\t\t* Set overflowY css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowY(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowY = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n\t}\n\n\t/**\n\t\t* Set Css styles on the contents element (typically Body)\n\t\t* @param {string} property\n\t\t* @param {string} value\n\t\t* @param {boolean} [priority] set as \"important\"\n\t\t*/\n\tcss(property, value, priority) {\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (value) {\n\t\t\tcontent.style.setProperty(property, value, priority ? \"important\" : \"\");\n\t\t} else {\n\t\t\tcontent.style.removeProperty(property);\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[property];\n\t}\n\n\t/**\n\t\t* Get or Set the viewport element\n\t\t* @param {object} [options]\n\t\t* @param {string} [options.width]\n\t\t* @param {string} [options.height]\n\t\t* @param {string} [options.scale]\n\t\t* @param {string} [options.minimum]\n\t\t* @param {string} [options.maximum]\n\t\t* @param {string} [options.scalable]\n\t\t*/\n\tviewport(options) {\n\t\tvar _width, _height, _scale, _minimum, _maximum, _scalable;\n\t\t// var width, height, scale, minimum, maximum, scalable;\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar parsed = {\n\t\t\t\"width\": undefined,\n\t\t\t\"height\": undefined,\n\t\t\t\"scale\": undefined,\n\t\t\t\"minimum\": undefined,\n\t\t\t\"maximum\": undefined,\n\t\t\t\"scalable\": undefined\n\t\t};\n\t\tvar newContent = [];\n\t\tvar settings = {};\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tlet content = $viewport.getAttribute(\"content\");\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\n\t\t\t\tparsed.width = _width[1];\n\t\t\t}\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\n\t\t\t\tparsed.height = _height[1];\n\t\t\t}\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\n\t\t\t\tparsed.scale = _scale[1];\n\t\t\t}\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\n\t\t\t\tparsed.minimum = _minimum[1];\n\t\t\t}\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\n\t\t\t\tparsed.maximum = _maximum[1];\n\t\t\t}\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\n\t\t\t\tparsed.scalable = _scalable[1];\n\t\t\t}\n\t\t}\n\n\t\tsettings = defaults(options || {}, parsed);\n\n\t\tif (options) {\n\t\t\tif (settings.width) {\n\t\t\t\tnewContent.push(\"width=\" + settings.width);\n\t\t\t}\n\n\t\t\tif (settings.height) {\n\t\t\t\tnewContent.push(\"height=\" + settings.height);\n\t\t\t}\n\n\t\t\tif (settings.scale) {\n\t\t\t\tnewContent.push(\"initial-scale=\" + settings.scale);\n\t\t\t}\n\n\t\t\tif (settings.scalable === \"no\") {\n\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"maximum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t} else {\n\n\t\t\t\tif (settings.scalable) {\n\t\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t\t}\n\n\t\t\t\tif (settings.minimum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.minimum);\n\t\t\t\t}\n\n\t\t\t\tif (settings.maximum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.maximum);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!$viewport) {\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\n\t\t\t\tthis.document.querySelector(\"head\").appendChild($viewport);\n\t\t\t}\n\n\t\t\t$viewport.setAttribute(\"content\", newContent.join(\", \"));\n\n\t\t\tthis.window.scrollTo(0, 0);\n\t\t}\n\n\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Event emitter for when the contents has expanded\n\t * @private\n\t */\n\texpand() {\n\t\tthis.emit(EVENTS.CONTENTS.EXPAND);\n\t}\n\n\t/**\n\t * Add DOM listeners\n\t * @private\n\t */\n\tlisteners() {\n\t\tthis.imageLoadListeners();\n\n\t\tthis.mediaQueryListeners();\n\n\t\t// this.fontLoadListeners();\n\n\t\tthis.addEventListeners();\n\n\t\tthis.addSelectionListeners();\n\n\t\t// this.transitionListeners();\n\n\t\tif (typeof ResizeObserver === \"undefined\") {\n\t\t\tthis.resizeListeners();\n\t\t\tthis.visibilityListeners();\n\t\t} else {\n\t\t\tthis.resizeObservers();\n\t\t}\n\n\t\t// this.mutationObservers();\n\n\t\tthis.linksHandler();\n\t}\n\n\t/**\n\t * Remove DOM listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.removeSelectionListeners();\n\n\t\tif (this.observer) {\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tclearTimeout(this.expanding);\n\t}\n\n\t/**\n\t * Check if size of contents has changed and\n\t * emit 'resize' event if it has.\n\t * @private\n\t */\n\tresizeCheck() {\n\t\tlet width = this.textWidth();\n\t\tlet height = this.textHeight();\n\n\t\tif (width != this._size.width || height != this._size.height) {\n\n\t\t\tthis._size = {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\n\t\t\tthis.onResize && this.onResize(this._size);\n\t\t\tthis.emit(EVENTS.CONTENTS.RESIZE, this._size);\n\t\t}\n\t}\n\n\t/**\n\t * Poll for resize detection\n\t * @private\n\t */\n\tresizeListeners() {\n\t\tvar width, height;\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n\t}\n\n\t/**\n\t * Listen for visibility of tab to change\n\t * @private\n\t */\n\tvisibilityListeners() {\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (document.visibilityState === \"visible\" && this.active === false) {\n\t\t\t\tthis.active = true;\n\t\t\t\tthis.resizeListeners();\n\t\t\t} else {\n\t\t\t\tthis.active = false;\n\t\t\t\tclearTimeout(this.expanding);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Use css transitions to detect resize\n\t * @private\n\t */\n\ttransitionListeners() {\n\t\tlet body = this.content;\n\n\t\tbody.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n\t\tbody.style['transitionDuration'] = \"0.001ms\";\n\t\tbody.style['transitionTimingFunction'] = \"linear\";\n\t\tbody.style['transitionDelay'] = \"0\";\n\n\t\tthis._resizeCheck = this.resizeCheck.bind(this);\n\t\tthis.document.addEventListener('transitionend', this._resizeCheck);\n\t}\n\n\t/**\n\t * Listen for media query changes and emit 'expand' event\n\t * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n\t * @private\n\t */\n\tmediaQueryListeners() {\n\t\tvar sheets = this.document.styleSheets;\n\t\tvar mediaChangeHandler = function(m){\n\t\t\tif(m.matches && !this._expanding) {\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\n\t\t\tvar rules;\n\t\t\t// Firefox errors if we access cssRules cross-domain\n\t\t\ttry {\n\t\t\t\trules = sheets[i].cssRules;\n\t\t\t} catch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(!rules) return; // Stylesheets changed\n\t\t\tfor (var j = 0; j < rules.length; j += 1) {\n\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\n\t\t\t\tif(rules[j].media){\n\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\n\t\t\t\t\tmql.addListener(mediaChangeHandler);\n\t\t\t\t\t//mql.onchange = mediaChangeHandler;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Use ResizeObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tresizeObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new ResizeObserver((e) => {\n\t\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\t\t});\n\n\t\t// pass in the target node\n\t\tthis.observer.observe(this.document.documentElement);\n\t}\n\n\t/**\n\t * Use MutationObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tmutationObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new MutationObserver((mutations) => {\n\t\t\tthis.resizeCheck();\n\t\t});\n\n\t\t// configuration of the observer:\n\t\tlet config = { attributes: true, childList: true, characterData: true, subtree: true };\n\n\t\t// pass in the target node, as well as the observer options\n\t\tthis.observer.observe(this.document, config);\n\t}\n\n\t/**\n\t * Test if images are loaded or add listener for when they load\n\t * @private\n\t */\n\timageLoadListeners() {\n\t\tvar images = this.document.querySelectorAll(\"img\");\n\t\tvar img;\n\t\tfor (var i = 0; i < images.length; i++) {\n\t\t\timg = images[i];\n\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\n\t\t\t\t\timg.naturalWidth === 0) {\n\t\t\t\timg.onload = this.expand.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Listen for font load and check for resize when loaded\n\t * @private\n\t */\n\tfontLoadListeners() {\n\t\tif (!this.document || !this.document.fonts) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.document.fonts.ready.then(function () {\n\t\t\tthis.resizeCheck();\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Get the documentElement\n\t * @returns {element} documentElement\n\t */\n\troot() {\n\t\tif(!this.document) return null;\n\t\treturn this.document.documentElement;\n\t}\n\n\t/**\n\t * Get the location offset of a EpubCFI or an #id\n\t * @param {string | EpubCFI} target\n\t * @param {string} [ignoreClass] for the cfi\n\t * @returns { {left: Number, top: Number }\n\t */\n\tlocationOf(target, ignoreClass) {\n\t\tvar position;\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\n\n\t\tif(!this.document) return targetPos;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\tlet range = new EpubCFI(target).toRange(this.document, ignoreClass);\n\n\t\t\tif(range) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!range.endContainer ||\n\t\t\t\t\t\t(range.startContainer == range.endContainer\n\t\t\t\t\t\t&& range.startOffset == range.endOffset)) {\n\t\t\t\t\t\t// If the end for the range is not set, it results in collapsed becoming\n\t\t\t\t\t\t// true. This in turn leads to inconsistent behaviour when calling\n\t\t\t\t\t\t// getBoundingRect. Wrong bounds lead to the wrong page being displayed.\n\t\t\t\t\t\t// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/\n\t\t\t\t\t\tlet pos = range.startContainer.textContent.indexOf(\" \", range.startOffset);\n\t\t\t\t\t\tif (pos == -1) {\n\t\t\t\t\t\t\tpos = range.startContainer.textContent.length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trange.setEnd(range.startContainer, pos);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(\"setting end offset to start container length failed\", e);\n\t\t\t\t}\n\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t} else {\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\n\n\t\t\t\t\t// Construct a new non-collapsed range\n\t\t\t\t\tif (isWebkit) {\n\t\t\t\t\t\tlet container = range.startContainer;\n\t\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (container.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\t\t\tposition = container.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset + 2 < container.length) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset + 2);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset - 2 > 0) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset - 2);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else { // empty, return the parent element\n\t\t\t\t\t\t\t\tposition = container.parentNode.getBoundingClientRect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if(typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\n\t\t\tlet id = target.substring(target.indexOf(\"#\")+1);\n\t\t\tlet el = this.document.getElementById(id);\n\t\t\tif(el) {\n\t\t\t\tif (isWebkit) {\n\t\t\t\t\t// Webkit reports incorrect bounding rects in Columns\n\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\tnewRange.selectNode(el);\n\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\tposition = el.getBoundingClientRect();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (position) {\n\t\t\ttargetPos.left = position.left;\n\t\t\ttargetPos.top = position.top;\n\t\t}\n\n\t\treturn targetPos;\n\t}\n\n\t/**\n\t * Append a stylesheet link to the document head\n\t * @param {string} src url\n\t */\n\taddStylesheet(src) {\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $stylesheet;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if link already exists\n\t\t\t$stylesheet = this.document.querySelector(\"link[href='\"+src+\"']\");\n\t\t\tif ($stylesheet) {\n\t\t\t\tresolve(true);\n\t\t\t\treturn; // already present\n\t\t\t}\n\n\t\t\t$stylesheet = this.document.createElement(\"link\");\n\t\t\t$stylesheet.type = \"text/css\";\n\t\t\t$stylesheet.rel = \"stylesheet\";\n\t\t\t$stylesheet.href = src;\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\t// Let apply\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($stylesheet);\n\n\t\t}.bind(this));\n\t}\n\n\t_getStylesheetNode(key) {\n\t\tvar styleEl;\n\t\tkey = \"epubjs-inserted-css-\" + (key || '');\n\n\t\tif(!this.document) return false;\n\n\t\t// Check if link already exists\n\t\tstyleEl = this.document.getElementById(key);\n\t\tif (!styleEl) {\n\t\t\tstyleEl = this.document.createElement(\"style\");\n\t\t\tstyleEl.id = key;\n\t\t\t// Append style element to head\n\t\t\tthis.document.head.appendChild(styleEl);\n\t\t}\n\t\treturn styleEl;\n\t}\n\n\t/**\n\t * Append stylesheet css\n\t * @param {string} serializedCss\n\t * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n\t */\n\taddStylesheetCss(serializedCss, key) {\n\t\tif(!this.document || !serializedCss) return false;\n\n\t\tvar styleEl;\n\t\tstyleEl = this._getStylesheetNode(key);\n\t\tstyleEl.innerHTML = serializedCss;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Append stylesheet rules to a generate stylesheet\n\t * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n\t * Object: https://github.com/desirable-objects/json-to-css\n\t * @param {array | object} rules\n\t * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n\t */\n\taddStylesheetRules(rules, key) {\n\t\tvar styleSheet;\n\n\t\tif(!this.document || !rules || rules.length === 0) return;\n\n\t\t// Grab style sheet\n\t\tstyleSheet = this._getStylesheetNode(key).sheet;\n\n\t\tif (Object.prototype.toString.call(rules) === \"[object Array]\") {\n\t\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\n\t\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = \"\";\n\t\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\n\t\t\t\tif (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n\t\t\t\t\trule = rule[1];\n\t\t\t\t\tj = 0;\n\t\t\t\t}\n\n\t\t\t\tfor (var pl = rule.length; j < pl; j++) {\n\t\t\t\t\tvar prop = rule[j];\n\t\t\t\t\tpropStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n\t\t\t\t}\n\n\t\t\t\t// Insert CSS Rule\n\t\t\t\tstyleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n\t\t\t}\n\t\t} else {\n\t\t\tconst selectors = Object.keys(rules);\n\t\t\tselectors.forEach((selector) => {\n\t\t\t\tconst definition = rules[selector];\n\t\t\t\tif (Array.isArray(definition)) {\n\t\t\t\t\tdefinition.forEach((item) => {\n\t\t\t\t\t\tconst _rules = Object.keys(item);\n\t\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\t\treturn `${rule}:${item[rule]}`;\n\t\t\t\t\t\t}).join(';');\n\t\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst _rules = Object.keys(definition);\n\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\treturn `${rule}:${definition[rule]}`;\n\t\t\t\t\t}).join(';');\n\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Append a script tag to the document head\n\t * @param {string} src url\n\t * @returns {Promise} loaded\n\t */\n\taddScript(src) {\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $script;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$script = this.document.createElement(\"script\");\n\t\t\t$script.type = \"text/javascript\";\n\t\t\t$script.async = true;\n\t\t\t$script.src = src;\n\t\t\t$script.onload = $script.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($script);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Add a class to the contents container\n\t * @param {string} className\n\t */\n\taddClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.add(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Remove a class from the contents container\n\t * @param {string} removeClass\n\t */\n\tremoveClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.remove(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Add DOM event listeners\n\t * @private\n\t */\n\taddEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._triggerEvent = this.triggerEvent.bind(this);\n\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.addEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\n\t}\n\n\t/**\n\t * Remove DOM event listeners\n\t * @private\n\t */\n\tremoveEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.removeEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\t\tthis._triggerEvent = undefined;\n\t}\n\n\t/**\n\t * Emit passed browser events\n\t * @private\n\t */\n\ttriggerEvent(e){\n\t\tthis.emit(e.type, e);\n\t}\n\n\t/**\n\t * Add listener for text selection\n\t * @private\n\t */\n\taddSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectionChange = this.onSelectionChange.bind(this);\n\t\tthis.document.addEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t}\n\n\t/**\n\t * Remove listener for text selection\n\t * @private\n\t */\n\tremoveSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.removeEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t\tthis._onSelectionChange = undefined;\n\t}\n\n\t/**\n\t * Handle getting text on selection\n\t * @private\n\t */\n\tonSelectionChange(e){\n\t\tif (this.selectionEndTimeout) {\n\t\t\tclearTimeout(this.selectionEndTimeout);\n\t\t}\n\t\tthis.selectionEndTimeout = setTimeout(function() {\n\t\t\tvar selection = this.window.getSelection();\n\t\t\tthis.triggerSelectedEvent(selection);\n\t\t}.bind(this), 250);\n\t}\n\n\t/**\n\t * Emit event on text selection\n\t * @private\n\t */\n\ttriggerSelectedEvent(selection){\n\t\tvar range, cfirange;\n\n\t\tif (selection && selection.rangeCount > 0) {\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed) {\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get a Dom Range from EpubCFI\n\t * @param {EpubCFI} _cfi\n\t * @param {string} [ignoreClass]\n\t * @returns {Range} range\n\t */\n\trange(_cfi, ignoreClass){\n\t\tvar cfi = new EpubCFI(_cfi);\n\t\treturn cfi.toRange(this.document, ignoreClass);\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom Range\n\t * @param {Range} range\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromRange(range, ignoreClass){\n\t\treturn new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom node\n\t * @param {node} node\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromNode(node, ignoreClass){\n\t\treturn new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t// TODO: find where this is used - remove?\n\tmap(layout){\n\t\tvar map = new Mapping(layout);\n\t\treturn map.section();\n\t}\n\n\t/**\n\t * Size the contents to a given width and height\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tsize(width, height){\n\t\tvar viewport = { scale: 1.0, scalable: \"no\" };\n\n\t\tthis.layoutStyle(\"scrolling\");\n\n\t\tif (width >= 0) {\n\t\t\tthis.width(width);\n\t\t\tviewport.width = width;\n\t\t\tthis.css(\"padding\", \"0 \"+(width/12)+\"px\");\n\t\t}\n\n\t\tif (height >= 0) {\n\t\t\tthis.height(height);\n\t\t\tviewport.height = height;\n\t\t}\n\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\n\n\t\tthis.viewport(viewport);\n\t}\n\n\t/**\n\t * Apply columns to the contents for pagination\n\t * @param {number} width\n\t * @param {number} height\n\t * @param {number} columnWidth\n\t * @param {number} gap\n\t */\n\tcolumns(width, height, columnWidth, gap, dir){\n\t\tlet COLUMN_AXIS = prefixed(\"column-axis\");\n\t\tlet COLUMN_GAP = prefixed(\"column-gap\");\n\t\tlet COLUMN_WIDTH = prefixed(\"column-width\");\n\t\tlet COLUMN_FILL = prefixed(\"column-fill\");\n\n\t\tlet writingMode = this.writingMode();\n\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\tif (dir === \"rtl\" && axis === \"horizontal\") {\n\t\t\tthis.direction(dir);\n\t\t}\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ width: width, height: height, scale: 1.0, scalable: \"no\" });\n\n\t\t// TODO: inline-block needs more testing\n\t\t// Fixes Safari column cut offs, but causes RTL issues\n\t\t// this.css(\"display\", \"inline-block\");\n\n\t\tthis.css(\"overflow-y\", \"hidden\");\n\t\tthis.css(\"margin\", \"0\", true);\n\n\t\tif (axis === \"vertical\") {\n\t\t\tthis.css(\"padding-top\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-bottom\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-left\", \"20px\");\n\t\t\tthis.css(\"padding-right\", \"20px\");\n\t\t\tthis.css(COLUMN_AXIS, \"vertical\");\n\t\t} else {\n\t\t\tthis.css(\"padding-top\", \"20px\");\n\t\t\tthis.css(\"padding-bottom\", \"20px\");\n\t\t\tthis.css(\"padding-left\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-right\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(COLUMN_AXIS, \"horizontal\");\n\t\t}\n\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\t\tthis.css(\"max-width\", \"inherit\");\n\n\t\tthis.css(COLUMN_FILL, \"auto\");\n\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\n\n\t\t// Fix glyph clipping in WebKit\n\t\t// https://github.com/futurepress/epub.js/issues/983\n\t\tthis.css(\"-webkit-line-box-contain\", \"block glyphs replaced\");\n\t}\n\n\t/**\n\t * Scale contents from center\n\t * @param {number} scale\n\t * @param {number} offsetX\n\t * @param {number} offsetY\n\t */\n\tscaler(scale, offsetX, offsetY){\n\t\tvar scaleStr = \"scale(\" + scale + \")\";\n\t\tvar translateStr = \"\";\n\t\t// this.css(\"position\", \"absolute\"));\n\t\tthis.css(\"transform-origin\", \"top left\");\n\n\t\tif (offsetX >= 0 || offsetY >= 0) {\n\t\t\ttranslateStr = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\n\t\t}\n\n\t\tthis.css(\"transform\", scaleStr + translateStr);\n\t}\n\n\t/**\n\t * Fit contents into a fixed width and height\n\t * @param {number} width\n\t * @param {number} height\n\t */\n\tfit(width, height, section){\n\t\tvar viewport = this.viewport();\n\t\tvar viewportWidth = parseInt(viewport.width);\n\t\tvar viewportHeight = parseInt(viewport.height);\n\t\tvar widthScale = width / viewportWidth;\n\t\tvar heightScale = height / viewportHeight;\n\t\tvar scale = widthScale < heightScale ? widthScale : heightScale;\n\n\t\t// the translate does not work as intended, elements can end up unaligned\n\t\t// var offsetY = (height - (viewportHeight * scale)) / 2;\n\t\t// var offsetX = 0;\n\t\t// if (this.sectionIndex % 2 === 1) {\n\t\t// \toffsetX = width - (viewportWidth * scale);\n\t\t// }\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// scale needs width and height to be set\n\t\tthis.width(viewportWidth);\n\t\tthis.height(viewportHeight);\n\t\tthis.overflow(\"hidden\");\n\n\t\t// Scale to the correct size\n\t\tthis.scaler(scale, 0, 0);\n\t\t// this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n\n\t\t// background images are not scaled by transform\n\t\tthis.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n\n\t\tthis.css(\"background-color\", \"transparent\");\n\t\tif (section && section.properties.includes(\"page-spread-left\")) {\n\t\t\t// set margin since scale is weird\n\t\t\tvar marginLeft = width - (viewportWidth * scale);\n\t\t\tthis.css(\"margin-left\", marginLeft + \"px\");\n\t\t}\n\t}\n\n\t/**\n\t * Set the direction of the text\n\t * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n\t */\n\tdirection(dir) {\n\t\tif (this.documentElement) {\n\t\t\tthis.documentElement.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\tmapPage(cfiBase, layout, start, end, dev) {\n\t\tvar mapping = new Mapping(layout, dev);\n\n\t\treturn mapping.page(this, cfiBase, start, end);\n\t}\n\n\t/**\n\t * Emit event when link in content is clicked\n\t * @private\n\t */\n\tlinksHandler() {\n\t\treplaceLinks(this.content, (href) => {\n\t\t\tthis.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n\t\t});\n\t}\n\n\t/**\n\t * Set the writingMode of the text\n\t * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n\t */\n\twritingMode(mode) {\n\t\tlet WRITING_MODE = prefixed(\"writing-mode\");\n\n\t\tif (mode && this.documentElement) {\n\t\t\tthis.documentElement.style[WRITING_MODE] = mode;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n\t}\n\n\t/**\n\t * Set the layoutStyle of the content\n\t * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n\t * @private\n\t */\n\tlayoutStyle(style) {\n\n\t\tif (style) {\n\t\t\tthis._layoutStyle = style;\n\t\t\tnavigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n\t\t}\n\n\t\treturn this._layoutStyle || \"paginated\";\n\t}\n\n\t/**\n\t * Add the epubReadingSystem object to the navigator\n\t * @param {string} name\n\t * @param {string} version\n\t * @private\n\t */\n\tepubReadingSystem(name, version) {\n\t\tnavigator.epubReadingSystem = {\n\t\t\tname: name,\n\t\t\tversion: version,\n\t\t\tlayoutStyle: this.layoutStyle(),\n\t\t\thasFeature: function (feature) {\n\t\t\t\tswitch (feature) {\n\t\t\t\t\tcase \"dom-manipulation\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"layout-changes\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"touch-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"mouse-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"keyboard-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"spine-scripting\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn navigator.epubReadingSystem;\n\t}\n\n\tdestroy() {\n\t\t// this.document.removeEventListener('transitionend', this._resizeCheck);\n\n\t\tthis.removeListeners();\n\n\t}\n}\n\nEventEmitter(Contents.prototype);\n\nexport default Contents;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}