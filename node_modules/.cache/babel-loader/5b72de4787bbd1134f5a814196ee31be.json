{"ast":null,"code":"import _classCallCheck from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n/**\n * Core Utilities and Helpers\n * @module Core\n*/\nimport { DOMParser as XMLDOMParser } from \"@xmldom/xmldom\";\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nexport var requestAnimationFrame = typeof window != \"undefined\" ? window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame : false;\nvar ELEMENT_NODE = 1;\nvar TEXT_NODE = 3;\nvar COMMENT_NODE = 8;\nvar DOCUMENT_NODE = 9;\nvar _URL = typeof URL != \"undefined\" ? URL : typeof window != \"undefined\" ? window.URL || window.webkitURL || window.mozURL : undefined;\n\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\nexport function uuid() {\n  var d = new Date().getTime();\n  var uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == \"x\" ? r : r & 0x7 | 0x8).toString(16);\n  });\n  return uuid;\n}\n\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\nexport function documentHeight() {\n  return Math.max(document.documentElement.clientHeight, document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight);\n}\n\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\nexport function isElement(obj) {\n  return !!(obj && obj.nodeType == 1);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isNumber(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isFloat(n) {\n  var f = parseFloat(n);\n  if (isNumber(n) === false) {\n    return false;\n  }\n  if (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n    return true;\n  }\n  return Math.floor(f) !== f;\n}\n\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\nexport function prefixed(unprefixed) {\n  var vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\"];\n  var prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n  var lower = unprefixed.toLowerCase();\n  var length = vendors.length;\n  if (typeof document === \"undefined\" || typeof document.body.style[lower] != \"undefined\") {\n    return unprefixed;\n  }\n  for (var i = 0; i < length; i++) {\n    if (typeof document.body.style[prefixes[i] + lower] != \"undefined\") {\n      return prefixes[i] + lower;\n    }\n  }\n  return unprefixed;\n}\n\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\nexport function defaults(obj) {\n  for (var i = 1, length = arguments.length; i < length; i++) {\n    var source = arguments[i];\n    for (var prop in source) {\n      if (obj[prop] === void 0) obj[prop] = source[prop];\n    }\n  }\n  return obj;\n}\n\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\nexport function extend(target) {\n  var sources = [].slice.call(arguments, 1);\n  sources.forEach(function (source) {\n    if (!source) return;\n    Object.getOwnPropertyNames(source).forEach(function (propName) {\n      Object.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n    });\n  });\n  return target;\n}\n\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function insert(item, array, compareFunction) {\n  var location = locationOf(item, array, compareFunction);\n  array.splice(location, 0, item);\n  return location;\n}\n\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function locationOf(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n  if (!compareFunction) {\n    compareFunction = function compareFunction(a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n  if (end - start <= 0) {\n    return pivot;\n  }\n  compared = compareFunction(array[pivot], item);\n  if (end - start === 1) {\n    return compared >= 0 ? pivot : pivot + 1;\n  }\n  if (compared === 0) {\n    return pivot;\n  }\n  if (compared === -1) {\n    return locationOf(item, array, compareFunction, pivot, end);\n  } else {\n    return locationOf(item, array, compareFunction, start, pivot);\n  }\n}\n\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n  var start = _start || 0;\n  var end = _end || array.length;\n  var pivot = parseInt(start + (end - start) / 2);\n  var compared;\n  if (!compareFunction) {\n    compareFunction = function compareFunction(a, b) {\n      if (a > b) return 1;\n      if (a < b) return -1;\n      if (a == b) return 0;\n    };\n  }\n  if (end - start <= 0) {\n    return -1; // Not found\n  }\n\n  compared = compareFunction(array[pivot], item);\n  if (end - start === 1) {\n    return compared === 0 ? pivot : -1;\n  }\n  if (compared === 0) {\n    return pivot; // Found\n  }\n\n  if (compared === -1) {\n    return indexOfSorted(item, array, compareFunction, pivot, end);\n  } else {\n    return indexOfSorted(item, array, compareFunction, start, pivot);\n  }\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function bounds(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function borders(el) {\n  var style = window.getComputedStyle(el);\n  var widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n  var heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n  var width = 0;\n  var height = 0;\n  widthProps.forEach(function (prop) {\n    width += parseFloat(style[prop]) || 0;\n  });\n  heightProps.forEach(function (prop) {\n    height += parseFloat(style[prop]) || 0;\n  });\n  return {\n    height: height,\n    width: width\n  };\n}\n\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\nexport function nodeBounds(node) {\n  var elPos;\n  var doc = node.ownerDocument;\n  if (node.nodeType == Node.TEXT_NODE) {\n    var elRange = doc.createRange();\n    elRange.selectNodeContents(node);\n    elPos = elRange.getBoundingClientRect();\n  } else {\n    elPos = node.getBoundingClientRect();\n  }\n  return elPos;\n}\n\n/**\n * Find the equivalent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\nexport function windowBounds() {\n  var width = window.innerWidth;\n  var height = window.innerHeight;\n  return {\n    top: 0,\n    left: 0,\n    right: width,\n    bottom: height,\n    width: width,\n    height: height\n  };\n}\n\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\nexport function indexOfNode(node, typeId) {\n  var parent = node.parentNode;\n  var children = parent.childNodes;\n  var sib;\n  var index = -1;\n  for (var i = 0; i < children.length; i++) {\n    sib = children[i];\n    if (sib.nodeType === typeId) {\n      index++;\n    }\n    if (sib == node) break;\n  }\n  return index;\n}\n\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfTextNode(textNode) {\n  return indexOfNode(textNode, TEXT_NODE);\n}\n\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfElementNode(elementNode) {\n  return indexOfNode(elementNode, ELEMENT_NODE);\n}\n\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\nexport function isXml(ext) {\n  return [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\nexport function createBlob(content, mime) {\n  return new Blob([content], {\n    type: mime\n  });\n}\n\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBlobUrl(content, mime) {\n  var tempUrl;\n  var blob = createBlob(content, mime);\n  tempUrl = _URL.createObjectURL(blob);\n  return tempUrl;\n}\n\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\nexport function revokeBlobUrl(url) {\n  return _URL.revokeObjectURL(url);\n}\n\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBase64Url(content, mime) {\n  var data;\n  var datauri;\n  if (typeof content !== \"string\") {\n    // Only handles strings\n    return;\n  }\n  data = btoa(content);\n  datauri = \"data:\" + mime + \";base64,\" + data;\n  return datauri;\n}\n\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\nexport function type(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1);\n}\n\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\nexport function parse(markup, mime, forceXMLDom) {\n  var doc;\n  var Parser;\n  if (typeof DOMParser === \"undefined\" || forceXMLDom) {\n    Parser = XMLDOMParser;\n  } else {\n    Parser = DOMParser;\n  }\n\n  // Remove byte order mark before parsing\n  // https://www.w3.org/International/questions/qa-byte-order-mark\n  if (markup.charCodeAt(0) === 0xFEFF) {\n    markup = markup.slice(1);\n  }\n  doc = new Parser().parseFromString(markup, mime);\n  return doc;\n}\n\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\nexport function qs(el, sel) {\n  var elements;\n  if (!el) {\n    throw new Error(\"No Element Provided\");\n  }\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelector(sel);\n  } else {\n    elements = el.getElementsByTagName(sel);\n    if (elements.length) {\n      return elements[0];\n    }\n  }\n}\n\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsa(el, sel) {\n  if (typeof el.querySelector != \"undefined\") {\n    return el.querySelectorAll(sel);\n  } else {\n    return el.getElementsByTagName(sel);\n  }\n}\n\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsp(el, sel, props) {\n  var q, filtered;\n  if (typeof el.querySelector != \"undefined\") {\n    sel += \"[\";\n    for (var prop in props) {\n      sel += prop + \"~='\" + props[prop] + \"'\";\n    }\n    sel += \"]\";\n    return el.querySelector(sel);\n  } else {\n    q = el.getElementsByTagName(sel);\n    filtered = Array.prototype.slice.call(q, 0).filter(function (el) {\n      for (var prop in props) {\n        if (el.getAttribute(prop) === props[prop]) {\n          return true;\n        }\n      }\n      return false;\n    });\n    if (filtered) {\n      return filtered[0];\n    }\n  }\n}\n\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n  var doc = root.ownerDocument || root;\n  if (typeof doc.createTreeWalker !== \"undefined\") {\n    treeWalker(root, func, NodeFilter.SHOW_TEXT);\n  } else {\n    walk(root, function (node) {\n      if (node && node.nodeType === 3) {\n        // Node.TEXT_NODE\n        func(node);\n      }\n    }, true);\n  }\n}\n\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter function or object to filter with\n */\nexport function treeWalker(root, func, filter) {\n  var treeWalker = document.createTreeWalker(root, filter, null, false);\n  var node;\n  while (node = treeWalker.nextNode()) {\n    func(node);\n  }\n}\n\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\nexport function walk(node, callback) {\n  if (callback(node)) {\n    return true;\n  }\n  node = node.firstChild;\n  if (node) {\n    do {\n      var walked = walk(node, callback);\n      if (walked) {\n        return true;\n      }\n      node = node.nextSibling;\n    } while (node);\n  }\n}\n\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\nexport function blob2base64(blob) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.readAsDataURL(blob);\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n  });\n}\n\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\nexport function defer() {\n  var _this = this;\n  /* A method to resolve the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} value : This value is used to resolve the promise\n   * If the value is a Promise then the associated promise assumes the state\n   * of Promise passed as value.\n   */\n  this.resolve = null;\n\n  /* A method to reject the associated Promise with the value passed.\n   * If the promise is already settled it does nothing.\n   *\n   * @param {anything} reason: The reason for the rejection of the Promise.\n   * Generally its an Error object. If however a Promise is passed, then the Promise\n   * itself will be the reason for rejection no matter the state of the Promise.\n   */\n  this.reject = null;\n  this.id = uuid();\n\n  /* A newly created Pomise object.\n   * Initially in pending state.\n   */\n  this.promise = new Promise(function (resolve, reject) {\n    _this.resolve = resolve;\n    _this.reject = reject;\n  });\n  Object.freeze(this);\n}\n\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function querySelectorByType(html, element, type) {\n  var query;\n  if (typeof html.querySelector != \"undefined\") {\n    query = html.querySelector(\"\".concat(element, \"[*|type=\\\"\").concat(type, \"\\\"]\"));\n  }\n  // Handle IE not supporting namespaced epub:type in querySelector\n  if (!query || query.length === 0) {\n    query = qsa(html, element);\n    for (var i = 0; i < query.length; i++) {\n      if (query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type || query[i].getAttribute(\"epub:type\") === type) {\n        return query[i];\n      }\n    }\n  } else {\n    return query;\n  }\n}\n\n/**\n * Find direct descendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\nexport function findChildren(el) {\n  var result = [];\n  var childNodes = el.childNodes;\n  for (var i = 0; i < childNodes.length; i++) {\n    var node = childNodes[i];\n    if (node.nodeType === 1) {\n      result.push(node);\n    }\n  }\n  return result;\n}\n\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function parents(node) {\n  var nodes = [node];\n  for (; node; node = node.parentNode) {\n    nodes.unshift(node);\n  }\n  return nodes;\n}\n\n/**\n * Find all direct descendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\nexport function filterChildren(el, nodeName, single) {\n  var result = [];\n  var childNodes = el.childNodes;\n  for (var i = 0; i < childNodes.length; i++) {\n    var node = childNodes[i];\n    if (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n      if (single) {\n        return node;\n      } else {\n        result.push(node);\n      }\n    }\n  }\n  if (!single) {\n    return result;\n  }\n}\n\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function getParentByTagName(node, tagname) {\n  var parent;\n  if (node === null || tagname === '') return;\n  parent = node.parentNode;\n  while (parent.nodeType === 1) {\n    if (parent.tagName.toLowerCase() === tagname) {\n      return parent;\n    }\n    parent = parent.parentNode;\n  }\n}\n\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\nexport var RangeObject = /*#__PURE__*/function () {\n  function RangeObject() {\n    _classCallCheck(this, RangeObject);\n    this.collapsed = false;\n    this.commonAncestorContainer = undefined;\n    this.endContainer = undefined;\n    this.endOffset = undefined;\n    this.startContainer = undefined;\n    this.startOffset = undefined;\n  }\n  _createClass(RangeObject, [{\n    key: \"setStart\",\n    value: function setStart(startNode, startOffset) {\n      this.startContainer = startNode;\n      this.startOffset = startOffset;\n      if (!this.endContainer) {\n        this.collapse(true);\n      } else {\n        this.commonAncestorContainer = this._commonAncestorContainer();\n      }\n      this._checkCollapsed();\n    }\n  }, {\n    key: \"setEnd\",\n    value: function setEnd(endNode, endOffset) {\n      this.endContainer = endNode;\n      this.endOffset = endOffset;\n      if (!this.startContainer) {\n        this.collapse(false);\n      } else {\n        this.collapsed = false;\n        this.commonAncestorContainer = this._commonAncestorContainer();\n      }\n      this._checkCollapsed();\n    }\n  }, {\n    key: \"collapse\",\n    value: function collapse(toStart) {\n      this.collapsed = true;\n      if (toStart) {\n        this.endContainer = this.startContainer;\n        this.endOffset = this.startOffset;\n        this.commonAncestorContainer = this.startContainer.parentNode;\n      } else {\n        this.startContainer = this.endContainer;\n        this.startOffset = this.endOffset;\n        this.commonAncestorContainer = this.endOffset.parentNode;\n      }\n    }\n  }, {\n    key: \"selectNode\",\n    value: function selectNode(referenceNode) {\n      var parent = referenceNode.parentNode;\n      var index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n      this.setStart(parent, index);\n      this.setEnd(parent, index + 1);\n    }\n  }, {\n    key: \"selectNodeContents\",\n    value: function selectNodeContents(referenceNode) {\n      var end = referenceNode.childNodes[referenceNode.childNodes - 1];\n      var endIndex = referenceNode.nodeType === 3 ? referenceNode.textContent.length : parent.childNodes.length;\n      this.setStart(referenceNode, 0);\n      this.setEnd(referenceNode, endIndex);\n    }\n  }, {\n    key: \"_commonAncestorContainer\",\n    value: function _commonAncestorContainer(startContainer, endContainer) {\n      var startParents = parents(startContainer || this.startContainer);\n      var endParents = parents(endContainer || this.endContainer);\n      if (startParents[0] != endParents[0]) return undefined;\n      for (var i = 0; i < startParents.length; i++) {\n        if (startParents[i] != endParents[i]) {\n          return startParents[i - 1];\n        }\n      }\n    }\n  }, {\n    key: \"_checkCollapsed\",\n    value: function _checkCollapsed() {\n      if (this.startContainer === this.endContainer && this.startOffset === this.endOffset) {\n        this.collapsed = true;\n      } else {\n        this.collapsed = false;\n      }\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      // TODO: implement walking between start and end to find text\n    }\n  }]);\n  return RangeObject;\n}();","map":{"version":3,"names":["DOMParser","XMLDOMParser","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","ELEMENT_NODE","TEXT_NODE","COMMENT_NODE","DOCUMENT_NODE","_URL","URL","webkitURL","mozURL","undefined","uuid","d","Date","getTime","replace","c","r","Math","random","floor","toString","documentHeight","max","document","documentElement","clientHeight","body","scrollHeight","offsetHeight","isElement","obj","nodeType","isNumber","n","isNaN","parseFloat","isFinite","isFloat","f","indexOf","prefixed","unprefixed","vendors","prefixes","lower","toLowerCase","length","style","i","defaults","arguments","source","prop","extend","target","sources","slice","call","forEach","Object","getOwnPropertyNames","propName","defineProperty","getOwnPropertyDescriptor","insert","item","array","compareFunction","location","locationOf","splice","_start","_end","start","end","pivot","parseInt","compared","a","b","indexOfSorted","bounds","el","getComputedStyle","widthProps","heightProps","width","height","borders","nodeBounds","node","elPos","doc","ownerDocument","Node","elRange","createRange","selectNodeContents","getBoundingClientRect","windowBounds","innerWidth","innerHeight","top","left","right","bottom","indexOfNode","typeId","parent","parentNode","children","childNodes","sib","index","indexOfTextNode","textNode","indexOfElementNode","elementNode","isXml","ext","createBlob","content","mime","Blob","type","createBlobUrl","tempUrl","blob","createObjectURL","revokeBlobUrl","url","revokeObjectURL","createBase64Url","data","datauri","btoa","prototype","parse","markup","forceXMLDom","Parser","charCodeAt","parseFromString","qs","sel","elements","Error","querySelector","getElementsByTagName","qsa","querySelectorAll","qsp","props","q","filtered","Array","filter","getAttribute","sprint","root","func","createTreeWalker","treeWalker","NodeFilter","SHOW_TEXT","walk","nextNode","callback","firstChild","walked","nextSibling","blob2base64","Promise","resolve","reject","reader","FileReader","readAsDataURL","onloadend","result","defer","id","promise","freeze","querySelectorByType","html","element","query","getAttributeNS","findChildren","push","parents","nodes","unshift","filterChildren","nodeName","single","getParentByTagName","tagname","tagName","RangeObject","collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset","startNode","collapse","_commonAncestorContainer","_checkCollapsed","endNode","toStart","referenceNode","setStart","setEnd","endIndex","textContent","startParents","endParents"],"sources":["/home/parallels/Downloads/read/node_modules/epubjs/src/utils/core.js"],"sourcesContent":["/**\n * Core Utilities and Helpers\n * @module Core\n*/\nimport { DOMParser as XMLDOMParser } from \"@xmldom/xmldom\";\n\n/**\n * Vendor prefixed requestAnimationFrame\n * @returns {function} requestAnimationFrame\n * @memberof Core\n */\nexport const requestAnimationFrame = (typeof window != \"undefined\") ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nconst DOCUMENT_NODE = 9;\nconst _URL = typeof URL != \"undefined\" ? URL : (typeof window != \"undefined\" ? (window.URL || window.webkitURL || window.mozURL) : undefined);\n\n/**\n * Generates a UUID\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n * @returns {string} uuid\n * @memberof Core\n */\nexport function uuid() {\n\tvar d = new Date().getTime();\n\tvar uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n\t\tvar r = (d + Math.random()*16)%16 | 0;\n\t\td = Math.floor(d/16);\n\t\treturn (c==\"x\" ? r : (r&0x7|0x8)).toString(16);\n\t});\n\treturn uuid;\n}\n\n/**\n * Gets the height of a document\n * @returns {number} height\n * @memberof Core\n */\nexport function documentHeight() {\n\treturn Math.max(\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight,\n\t\t\tdocument.documentElement.offsetHeight\n\t);\n}\n\n/**\n * Checks if a node is an element\n * @param {object} obj\n * @returns {boolean}\n * @memberof Core\n */\nexport function isElement(obj) {\n\treturn !!(obj && obj.nodeType == 1);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isNumber(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * @param {any} n\n * @returns {boolean}\n * @memberof Core\n */\nexport function isFloat(n) {\n\tlet f = parseFloat(n);\n\n\tif (isNumber(n) === false) {\n\t\treturn false;\n\t}\n\n\tif (typeof n === \"string\" && n.indexOf(\".\") > -1) {\n\t\treturn true;\n\t}\n\n\treturn Math.floor(f) !== f;\n}\n\n/**\n * Get a prefixed css property\n * @param {string} unprefixed\n * @returns {string}\n * @memberof Core\n */\nexport function prefixed(unprefixed) {\n\tvar vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\" ];\n\tvar prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\n\tvar lower = unprefixed.toLowerCase();\n\tvar length = vendors.length;\n\n\tif (typeof(document) === \"undefined\" || typeof(document.body.style[lower]) != \"undefined\") {\n\t\treturn unprefixed;\n\t}\n\n\tfor (var i = 0; i < length; i++) {\n\t\tif (typeof(document.body.style[prefixes[i] + lower]) != \"undefined\") {\n\t\t\treturn prefixes[i] + lower;\n\t\t}\n\t}\n\n\treturn unprefixed;\n}\n\n/**\n * Apply defaults to an object\n * @param {object} obj\n * @returns {object}\n * @memberof Core\n */\nexport function defaults(obj) {\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\n\t\tvar source = arguments[i];\n\t\tfor (var prop in source) {\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\n\t\t}\n\t}\n\treturn obj;\n}\n\n/**\n * Extend properties of an object\n * @param {object} target\n * @returns {object}\n * @memberof Core\n */\nexport function extend(target) {\n\tvar sources = [].slice.call(arguments, 1);\n\tsources.forEach(function (source) {\n\t\tif(!source) return;\n\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\n\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\n\t\t});\n\t});\n\treturn target;\n}\n\n/**\n * Fast quicksort insert for sorted array -- based on:\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function insert(item, array, compareFunction) {\n\tvar location = locationOf(item, array, compareFunction);\n\tarray.splice(location, 0, item);\n\n\treturn location;\n}\n\n/**\n * Finds where something would fit into a sorted array\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} location (in array)\n * @memberof Core\n */\nexport function locationOf(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn pivot;\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared >= 0 ? pivot : pivot + 1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot;\n\t}\n\tif(compared === -1) {\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\n\t}\n}\n\n/**\n * Finds index of something in a sorted array\n * Returns -1 if not found\n * @param {any} item\n * @param {array} array\n * @param {function} [compareFunction]\n * @param {function} [_start]\n * @param {function} [_end]\n * @returns {number} index (in array) or -1\n * @memberof Core\n */\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\n\tvar start = _start || 0;\n\tvar end = _end || array.length;\n\tvar pivot = parseInt(start + (end - start) / 2);\n\tvar compared;\n\tif(!compareFunction){\n\t\tcompareFunction = function(a, b) {\n\t\t\tif(a > b) return 1;\n\t\t\tif(a < b) return -1;\n\t\t\tif(a == b) return 0;\n\t\t};\n\t}\n\tif(end-start <= 0) {\n\t\treturn -1; // Not found\n\t}\n\n\tcompared = compareFunction(array[pivot], item);\n\tif(end-start === 1) {\n\t\treturn compared === 0 ? pivot : -1;\n\t}\n\tif(compared === 0) {\n\t\treturn pivot; // Found\n\t}\n\tif(compared === -1) {\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\n\t} else{\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\n\t}\n}\n/**\n * Find the bounds of an element\n * taking padding and margin into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function bounds(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of an element\n * taking padding, margin and borders into account\n * @param {element} el\n * @returns {{ width: Number, height: Number}}\n * @memberof Core\n */\nexport function borders(el) {\n\n\tvar style = window.getComputedStyle(el);\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\n\n\tvar width = 0;\n\tvar height = 0;\n\n\twidthProps.forEach(function(prop){\n\t\twidth += parseFloat(style[prop]) || 0;\n\t});\n\n\theightProps.forEach(function(prop){\n\t\theight += parseFloat(style[prop]) || 0;\n\t});\n\n\treturn {\n\t\theight: height,\n\t\twidth: width\n\t};\n\n}\n\n/**\n * Find the bounds of any node\n * allows for getting bounds of text nodes by wrapping them in a range\n * @param {node} node\n * @returns {BoundingClientRect}\n * @memberof Core\n */\nexport function nodeBounds(node) {\n\tlet elPos;\n\tlet doc = node.ownerDocument;\n\tif(node.nodeType == Node.TEXT_NODE){\n\t\tlet elRange = doc.createRange();\n\t\telRange.selectNodeContents(node);\n\t\telPos = elRange.getBoundingClientRect();\n\t} else {\n\t\telPos = node.getBoundingClientRect();\n\t}\n\treturn elPos;\n}\n\n/**\n * Find the equivalent of getBoundingClientRect of a browser window\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\n * @memberof Core\n */\nexport function windowBounds() {\n\n\tvar width = window.innerWidth;\n\tvar height = window.innerHeight;\n\n\treturn {\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tright: width,\n\t\tbottom: height,\n\t\twidth: width,\n\t\theight: height\n\t};\n\n}\n\n/**\n * Gets the index of a node in its parent\n * @param {Node} node\n * @param {string} typeId\n * @return {number} index\n * @memberof Core\n */\nexport function indexOfNode(node, typeId) {\n\tvar parent = node.parentNode;\n\tvar children = parent.childNodes;\n\tvar sib;\n\tvar index = -1;\n\tfor (var i = 0; i < children.length; i++) {\n\t\tsib = children[i];\n\t\tif (sib.nodeType === typeId) {\n\t\t\tindex++;\n\t\t}\n\t\tif (sib == node) break;\n\t}\n\n\treturn index;\n}\n\n/**\n * Gets the index of a text node in its parent\n * @param {node} textNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfTextNode(textNode) {\n\treturn indexOfNode(textNode, TEXT_NODE);\n}\n\n/**\n * Gets the index of an element node in its parent\n * @param {element} elementNode\n * @returns {number} index\n * @memberof Core\n */\nexport function indexOfElementNode(elementNode) {\n\treturn indexOfNode(elementNode, ELEMENT_NODE);\n}\n\n/**\n * Check if extension is xml\n * @param {string} ext\n * @returns {boolean}\n * @memberof Core\n */\nexport function isXml(ext) {\n\treturn [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\n}\n\n/**\n * Create a new blob\n * @param {any} content\n * @param {string} mime\n * @returns {Blob}\n * @memberof Core\n */\nexport function createBlob(content, mime){\n\treturn new Blob([content], {type : mime });\n}\n\n/**\n * Create a new blob url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBlobUrl(content, mime){\n\tvar tempUrl;\n\tvar blob = createBlob(content, mime);\n\n\ttempUrl = _URL.createObjectURL(blob);\n\n\treturn tempUrl;\n}\n\n/**\n * Remove a blob url\n * @param {string} url\n * @memberof Core\n */\nexport function revokeBlobUrl(url){\n\treturn _URL.revokeObjectURL(url);\n}\n\n/**\n * Create a new base64 encoded url\n * @param {any} content\n * @param {string} mime\n * @returns {string} url\n * @memberof Core\n */\nexport function createBase64Url(content, mime){\n\tvar data;\n\tvar datauri;\n\n\tif (typeof(content) !== \"string\") {\n\t\t// Only handles strings\n\t\treturn;\n\t}\n\n\tdata = btoa(content);\n\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\n\n\treturn datauri;\n}\n\n/**\n * Get type of an object\n * @param {object} obj\n * @returns {string} type\n * @memberof Core\n */\nexport function type(obj){\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\n}\n\n/**\n * Parse xml (or html) markup\n * @param {string} markup\n * @param {string} mime\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\n * @returns {document} document\n * @memberof Core\n */\nexport function parse(markup, mime, forceXMLDom) {\n\tvar doc;\n\tvar Parser;\n\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\n\t\tParser = XMLDOMParser;\n\t} else {\n\t\tParser = DOMParser;\n\t}\n\n\t// Remove byte order mark before parsing\n\t// https://www.w3.org/International/questions/qa-byte-order-mark\n\tif(markup.charCodeAt(0) === 0xFEFF) {\n\t\tmarkup = markup.slice(1);\n\t}\n\n\tdoc = new Parser().parseFromString(markup, mime);\n\n\treturn doc;\n}\n\n/**\n * querySelector polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element} element\n * @memberof Core\n */\nexport function qs(el, sel) {\n\tvar elements;\n\tif (!el) {\n\t\tthrow new Error(\"No Element Provided\");\n\t}\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\telements = el.getElementsByTagName(sel);\n\t\tif (elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\t}\n}\n\n/**\n * querySelectorAll polyfill\n * @param {element} el\n * @param {string} sel selector string\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsa(el, sel) {\n\n\tif (typeof el.querySelector != \"undefined\") {\n\t\treturn el.querySelectorAll(sel);\n\t} else {\n\t\treturn el.getElementsByTagName(sel);\n\t}\n}\n\n/**\n * querySelector by property\n * @param {element} el\n * @param {string} sel selector string\n * @param {object[]} props\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function qsp(el, sel, props) {\n\tvar q, filtered;\n\tif (typeof el.querySelector != \"undefined\") {\n\t\tsel += \"[\";\n\t\tfor (var prop in props) {\n\t\t\tsel += prop + \"~='\" + props[prop] + \"'\";\n\t\t}\n\t\tsel += \"]\";\n\t\treturn el.querySelector(sel);\n\t} else {\n\t\tq = el.getElementsByTagName(sel);\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\n\t\t\tfor (var prop in props) {\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tif (filtered) {\n\t\t\treturn filtered[0];\n\t\t}\n\t}\n}\n\n/**\n * Sprint through all text nodes in a document\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n */\nexport function sprint(root, func) {\n\tvar doc = root.ownerDocument || root;\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\n\t} else {\n\t\twalk(root, function(node) {\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\n\t\t\t\tfunc(node);\n\t\t\t}\n\t\t}, true);\n\t}\n}\n\n/**\n * Create a treeWalker\n * @memberof Core\n * @param  {element} root element to start with\n * @param  {function} func function to run on each element\n * @param  {function | object} filter function or object to filter with\n */\nexport function treeWalker(root, func, filter) {\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\n\tlet node;\n\twhile ((node = treeWalker.nextNode())) {\n\t\tfunc(node);\n\t}\n}\n\n/**\n * @memberof Core\n * @param {node} node\n * @param {callback} return false for continue,true for break inside callback\n */\nexport function walk(node,callback){\n\tif(callback(node)){\n\t\treturn true;\n\t}\n\tnode = node.firstChild;\n\tif(node){\n\t\tdo{\n\t\t\tlet walked = walk(node,callback);\n\t\t\tif(walked){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tnode = node.nextSibling;\n\t\t} while(node);\n\t}\n}\n\n/**\n * Convert a blob to a base64 encoded string\n * @param {Blog} blob\n * @returns {string}\n * @memberof Core\n */\nexport function blob2base64(blob) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar reader = new FileReader();\n\t\treader.readAsDataURL(blob);\n\t\treader.onloadend = function() {\n\t\t\tresolve(reader.result);\n\t\t};\n\t});\n}\n\n\n/**\n * Creates a new pending promise and provides methods to resolve or reject it.\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\n * @memberof Core\n */\nexport function defer() {\n\t/* A method to resolve the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} value : This value is used to resolve the promise\n\t * If the value is a Promise then the associated promise assumes the state\n\t * of Promise passed as value.\n\t */\n\tthis.resolve = null;\n\n\t/* A method to reject the associated Promise with the value passed.\n\t * If the promise is already settled it does nothing.\n\t *\n\t * @param {anything} reason: The reason for the rejection of the Promise.\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\n\t * itself will be the reason for rejection no matter the state of the Promise.\n\t */\n\tthis.reject = null;\n\n\tthis.id = uuid();\n\n\t/* A newly created Pomise object.\n\t * Initially in pending state.\n\t */\n\tthis.promise = new Promise((resolve, reject) => {\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t});\n\tObject.freeze(this);\n}\n\n/**\n * querySelector with filter by epub type\n * @param {element} html\n * @param {string} element element type to find\n * @param {string} type epub type to find\n * @returns {element[]} elements\n * @memberof Core\n */\nexport function querySelectorByType(html, element, type){\n\tvar query;\n\tif (typeof html.querySelector != \"undefined\") {\n\t\tquery = html.querySelector(`${element}[*|type=\"${type}\"]`);\n\t}\n\t// Handle IE not supporting namespaced epub:type in querySelector\n\tif(!query || query.length === 0) {\n\t\tquery = qsa(html, element);\n\t\tfor (var i = 0; i < query.length; i++) {\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type ||\n\t\t\t\t query[i].getAttribute(\"epub:type\") === type) {\n\t\t\t\treturn query[i];\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn query;\n\t}\n}\n\n/**\n * Find direct descendents of an element\n * @param {element} el\n * @returns {element[]} children\n * @memberof Core\n */\nexport function findChildren(el) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Find all parents (ancestors) of an element\n * @param {element} node\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function parents(node) {\n\tvar nodes = [node];\n\tfor (; node; node = node.parentNode) {\n\t\tnodes.unshift(node);\n\t}\n\treturn nodes\n}\n\n/**\n * Find all direct descendents of a specific type\n * @param {element} el\n * @param {string} nodeName\n * @param {boolean} [single]\n * @returns {element[]} children\n * @memberof Core\n */\nexport function filterChildren(el, nodeName, single) {\n\tvar result = [];\n\tvar childNodes = el.childNodes;\n\tfor (var i = 0; i < childNodes.length; i++) {\n\t\tlet node = childNodes[i];\n\t\tif (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\n\t\t\tif (single) {\n\t\t\t\treturn node;\n\t\t\t} else {\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t}\n\t}\n\tif (!single) {\n\t\treturn result;\n\t}\n}\n\n/**\n * Filter all parents (ancestors) with tag name\n * @param {element} node\n * @param {string} tagname\n * @returns {element[]} parents\n * @memberof Core\n */\nexport function getParentByTagName(node, tagname) {\n\tlet parent;\n\tif (node === null || tagname === '') return;\n\tparent = node.parentNode;\n\twhile (parent.nodeType === 1) {\n\t\tif (parent.tagName.toLowerCase() === tagname) {\n\t\t\treturn parent;\n\t\t}\n\t\tparent = parent.parentNode;\n\t}\n}\n\n/**\n * Lightweight Polyfill for DOM Range\n * @class\n * @memberof Core\n */\nexport class RangeObject {\n\tconstructor() {\n\t\tthis.collapsed = false;\n\t\tthis.commonAncestorContainer = undefined;\n\t\tthis.endContainer = undefined;\n\t\tthis.endOffset = undefined;\n\t\tthis.startContainer = undefined;\n\t\tthis.startOffset = undefined;\n\t}\n\n\tsetStart(startNode, startOffset) {\n\t\tthis.startContainer = startNode;\n\t\tthis.startOffset = startOffset;\n\n\t\tif (!this.endContainer) {\n\t\t\tthis.collapse(true);\n\t\t} else {\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tsetEnd(endNode, endOffset) {\n\t\tthis.endContainer = endNode;\n\t\tthis.endOffset = endOffset;\n\n\t\tif (!this.startContainer) {\n\t\t\tthis.collapse(false);\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\n\t\t}\n\n\t\tthis._checkCollapsed();\n\t}\n\n\tcollapse(toStart) {\n\t\tthis.collapsed = true;\n\t\tif (toStart) {\n\t\t\tthis.endContainer = this.startContainer;\n\t\t\tthis.endOffset = this.startOffset;\n\t\t\tthis.commonAncestorContainer = this.startContainer.parentNode;\n\t\t} else {\n\t\t\tthis.startContainer = this.endContainer;\n\t\t\tthis.startOffset = this.endOffset;\n\t\t\tthis.commonAncestorContainer = this.endOffset.parentNode;\n\t\t}\n\t}\n\n\tselectNode(referenceNode) {\n\t\tlet parent = referenceNode.parentNode;\n\t\tlet index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\n\t\tthis.setStart(parent, index);\n\t\tthis.setEnd(parent, index + 1);\n\t}\n\n\tselectNodeContents(referenceNode) {\n\t\tlet end = referenceNode.childNodes[referenceNode.childNodes - 1];\n\t\tlet endIndex = (referenceNode.nodeType === 3) ?\n\t\t\t\treferenceNode.textContent.length : parent.childNodes.length;\n\t\tthis.setStart(referenceNode, 0);\n\t\tthis.setEnd(referenceNode, endIndex);\n\t}\n\n\t_commonAncestorContainer(startContainer, endContainer) {\n\t\tvar startParents = parents(startContainer || this.startContainer);\n\t\tvar endParents = parents(endContainer || this.endContainer);\n\n\t\tif (startParents[0] != endParents[0]) return undefined;\n\n\t\tfor (var i = 0; i < startParents.length; i++) {\n\t\t\tif (startParents[i] != endParents[i]) {\n\t\t\t\treturn startParents[i - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\t_checkCollapsed() {\n\t\tif (this.startContainer === this.endContainer &&\n\t\t\t\tthis.startOffset === this.endOffset) {\n\t\t\tthis.collapsed = true;\n\t\t} else {\n\t\t\tthis.collapsed = false;\n\t\t}\n\t}\n\n\ttoString() {\n\t\t// TODO: implement walking between start and end to find text\n\t}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}