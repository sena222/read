{"ast":null,"code":"import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n * @param {string} [options.defaultDirection='ltr'] default text direction\n * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content\n * @param {boolean} [options.allowPopups=false] enable opening popup in content\n */\nclass Rendition {\n  constructor(book, options) {\n    this.settings = extend(this.settings || {}, {\n      width: null,\n      height: null,\n      ignoreClass: \"\",\n      manager: \"default\",\n      view: \"iframe\",\n      flow: null,\n      layout: null,\n      spread: null,\n      minSpreadWidth: 800,\n      stylesheet: null,\n      resizeOnOrientationChange: true,\n      script: null,\n      snap: false,\n      defaultDirection: \"ltr\",\n      allowScriptedContent: false,\n      allowPopups: false\n    });\n    extend(this.settings, options);\n    if (typeof this.settings.manager === \"object\") {\n      this.manager = this.settings.manager;\n    }\n    this.book = book;\n\n    /**\n     * Adds Hook methods to the Rendition prototype\n     * @member {object} hooks\n     * @property {Hook} hooks.content\n     * @memberof Rendition\n     */\n    this.hooks = {};\n    this.hooks.display = new Hook(this);\n    this.hooks.serialize = new Hook(this);\n    this.hooks.content = new Hook(this);\n    this.hooks.unloaded = new Hook(this);\n    this.hooks.layout = new Hook(this);\n    this.hooks.render = new Hook(this);\n    this.hooks.show = new Hook(this);\n    this.hooks.content.register(this.handleLinks.bind(this));\n    this.hooks.content.register(this.passEvents.bind(this));\n    this.hooks.content.register(this.adjustImages.bind(this));\n    this.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n    if (this.settings.stylesheet) {\n      this.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n    }\n    if (this.settings.script) {\n      this.book.spine.hooks.content.register(this.injectScript.bind(this));\n    }\n\n    /**\n     * @member {Themes} themes\n     * @memberof Rendition\n     */\n    this.themes = new Themes(this);\n\n    /**\n     * @member {Annotations} annotations\n     * @memberof Rendition\n     */\n    this.annotations = new Annotations(this);\n    this.epubcfi = new EpubCFI();\n    this.q = new Queue(this);\n\n    /**\n     * A Rendered Location Range\n     * @typedef location\n     * @type {Object}\n     * @property {object} start\n     * @property {string} start.index\n     * @property {string} start.href\n     * @property {object} start.displayed\n     * @property {EpubCFI} start.cfi\n     * @property {number} start.location\n     * @property {number} start.percentage\n     * @property {number} start.displayed.page\n     * @property {number} start.displayed.total\n     * @property {object} end\n     * @property {string} end.index\n     * @property {string} end.href\n     * @property {object} end.displayed\n     * @property {EpubCFI} end.cfi\n     * @property {number} end.location\n     * @property {number} end.percentage\n     * @property {number} end.displayed.page\n     * @property {number} end.displayed.total\n     * @property {boolean} atStart\n     * @property {boolean} atEnd\n     * @memberof Rendition\n     */\n    this.location = undefined;\n\n    // Hold queue until book is opened\n    this.q.enqueue(this.book.opened);\n    this.starting = new defer();\n    /**\n     * @member {promise} started returns after the rendition has started\n     * @memberof Rendition\n     */\n    this.started = this.starting.promise;\n\n    // Block the queue until rendering is started\n    this.q.enqueue(this.start);\n  }\n\n  /**\n   * Set the manager function\n   * @param {function} manager\n   */\n  setManager(manager) {\n    this.manager = manager;\n  }\n\n  /**\n   * Require the manager from passed string, or as a class function\n   * @param  {string|object} manager [description]\n   * @return {method}\n   */\n  requireManager(manager) {\n    var viewManager;\n\n    // If manager is a string, try to load from imported managers\n    if (typeof manager === \"string\" && manager === \"default\") {\n      viewManager = DefaultViewManager;\n    } else if (typeof manager === \"string\" && manager === \"continuous\") {\n      viewManager = ContinuousViewManager;\n    } else {\n      // otherwise, assume we were passed a class function\n      viewManager = manager;\n    }\n    return viewManager;\n  }\n\n  /**\n   * Require the view from passed string, or as a class function\n   * @param  {string|object} view\n   * @return {view}\n   */\n  requireView(view) {\n    var View;\n\n    // If view is a string, try to load from imported views,\n    if (typeof view == \"string\" && view === \"iframe\") {\n      View = IframeView;\n    } else {\n      // otherwise, assume we were passed a class function\n      View = view;\n    }\n    return View;\n  }\n\n  /**\n   * Start the rendering\n   * @return {Promise} rendering has started\n   */\n  start() {\n    if (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\n      this.settings.layout = \"pre-paginated\";\n    }\n    switch (this.book.package.metadata.spread) {\n      case 'none':\n        this.settings.spread = 'none';\n        break;\n      case 'both':\n        this.settings.spread = true;\n        break;\n    }\n    if (!this.manager) {\n      this.ViewManager = this.requireManager(this.settings.manager);\n      this.View = this.requireView(this.settings.view);\n      this.manager = new this.ViewManager({\n        view: this.View,\n        queue: this.q,\n        request: this.book.load.bind(this.book),\n        settings: this.settings\n      });\n    }\n    this.direction(this.book.package.metadata.direction || this.settings.defaultDirection);\n\n    // Parse metadata to get layout props\n    this.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n    this.flow(this.settings.globalLayoutProperties.flow);\n    this.layout(this.settings.globalLayoutProperties);\n\n    // Listen for displayed views\n    this.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n    this.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n    // Listen for resizing\n    this.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n    // Listen for rotation\n    this.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n    // Listen for scroll changes\n    this.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n    /**\n     * Emit that rendering has started\n     * @event started\n     * @memberof Rendition\n     */\n    this.emit(EVENTS.RENDITION.STARTED);\n\n    // Start processing queue\n    this.starting.resolve();\n  }\n\n  /**\n   * Call to attach the container to an element in the dom\n   * Container must be attached before rendering can begin\n   * @param  {element} element to attach to\n   * @return {Promise}\n   */\n  attachTo(element) {\n    return this.q.enqueue(function () {\n      // Start rendering\n      this.manager.render(element, {\n        \"width\": this.settings.width,\n        \"height\": this.settings.height\n      });\n\n      /**\n       * Emit that rendering has attached to an element\n       * @event attached\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.ATTACHED);\n    }.bind(this));\n  }\n\n  /**\n   * Display a point in the book\n   * The request will be added to the rendering Queue,\n   * so it will wait until book is opened, rendering started\n   * and all other rendering tasks have finished to be called.\n   * @param  {string} target Url or EpubCFI\n   * @return {Promise}\n   */\n  display(target) {\n    if (this.displaying) {\n      this.displaying.resolve();\n    }\n    return this.q.enqueue(this._display, target);\n  }\n\n  /**\n   * Tells the manager what to display immediately\n   * @private\n   * @param  {string} target Url or EpubCFI\n   * @return {Promise}\n   */\n  _display(target) {\n    if (!this.book) {\n      return;\n    }\n    var isCfiString = this.epubcfi.isCfiString(target);\n    var displaying = new defer();\n    var displayed = displaying.promise;\n    var section;\n    var moveTo;\n    this.displaying = displaying;\n\n    // Check if this is a book percentage\n    if (this.book.locations.length() && isFloat(target)) {\n      target = this.book.locations.cfiFromPercentage(parseFloat(target));\n    }\n    section = this.book.spine.get(target);\n    if (!section) {\n      displaying.reject(new Error(\"No Section Found\"));\n      return displayed;\n    }\n    this.manager.display(section, target).then(() => {\n      displaying.resolve(section);\n      this.displaying = undefined;\n\n      /**\n       * Emit that a section has been displayed\n       * @event displayed\n       * @param {Section} section\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.DISPLAYED, section);\n      this.reportLocation();\n    }, err => {\n      /**\n       * Emit that has been an error displaying\n       * @event displayError\n       * @param {Section} section\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n    });\n    return displayed;\n  }\n\n  /*\n  render(view, show) {\n  \t\t// view.onLayout = this.layout.format.bind(this.layout);\n  \tview.create();\n  \t\t// Fit to size of the container, apply padding\n  \tthis.manager.resizeView(view);\n  \t\t// Render Chain\n  \treturn view.section.render(this.book.request)\n  \t\t.then(function(contents){\n  \t\t\treturn view.load(contents);\n  \t\t}.bind(this))\n  \t\t.then(function(doc){\n  \t\t\treturn this.hooks.content.trigger(view, this);\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\tthis.layout.format(view.contents);\n  \t\t\treturn this.hooks.layout.trigger(view, this);\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\treturn view.display();\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\treturn this.hooks.render.trigger(view, this);\n  \t\t}.bind(this))\n  \t\t.then(function(){\n  \t\t\tif(show !== false) {\n  \t\t\t\tthis.q.enqueue(function(view){\n  \t\t\t\t\tview.show();\n  \t\t\t\t}, view);\n  \t\t\t}\n  \t\t\t// this.map = new Map(view, this.layout);\n  \t\t\tthis.hooks.show.trigger(view, this);\n  \t\t\tthis.trigger(\"rendered\", view.section);\n  \t\t\t}.bind(this))\n  \t\t.catch(function(e){\n  \t\t\tthis.trigger(\"loaderror\", e);\n  \t\t}.bind(this));\n  \t}\n  */\n\n  /**\n   * Report what section has been displayed\n   * @private\n   * @param  {*} view\n   */\n  afterDisplayed(view) {\n    view.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view.contents));\n    this.hooks.render.trigger(view, this).then(() => {\n      if (view.contents) {\n        this.hooks.content.trigger(view.contents, this).then(() => {\n          /**\n           * Emit that a section has been rendered\n           * @event rendered\n           * @param {Section} section\n           * @param {View} view\n           * @memberof Rendition\n           */\n          this.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n        });\n      } else {\n        this.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n      }\n    });\n  }\n\n  /**\n   * Report what has been removed\n   * @private\n   * @param  {*} view\n   */\n  afterRemoved(view) {\n    this.hooks.unloaded.trigger(view, this).then(() => {\n      /**\n       * Emit that a section has been removed\n       * @event removed\n       * @param {Section} section\n       * @param {View} view\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n    });\n  }\n\n  /**\n   * Report resize events and display the last seen location\n   * @private\n   */\n  onResized(size, epubcfi) {\n    /**\n     * Emit that the rendition has been resized\n     * @event resized\n     * @param {number} width\n     * @param {height} height\n     * @param {string} epubcfi (optional)\n     * @memberof Rendition\n     */\n    this.emit(EVENTS.RENDITION.RESIZED, {\n      width: size.width,\n      height: size.height\n    }, epubcfi);\n    if (this.location && this.location.start) {\n      this.display(epubcfi || this.location.start.cfi);\n    }\n  }\n\n  /**\n   * Report orientation events and display the last seen location\n   * @private\n   */\n  onOrientationChange(orientation) {\n    /**\n     * Emit that the rendition has been rotated\n     * @event orientationchange\n     * @param {string} orientation\n     * @memberof Rendition\n     */\n    this.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n  }\n\n  /**\n   * Move the Rendition to a specific offset\n   * Usually you would be better off calling display()\n   * @param {object} offset\n   */\n  moveTo(offset) {\n    this.manager.moveTo(offset);\n  }\n\n  /**\n   * Trigger a resize of the views\n   * @param {number} [width]\n   * @param {number} [height]\n   * @param {string} [epubcfi] (optional)\n   */\n  resize(width, height, epubcfi) {\n    if (width) {\n      this.settings.width = width;\n    }\n    if (height) {\n      this.settings.height = height;\n    }\n    this.manager.resize(width, height, epubcfi);\n  }\n\n  /**\n   * Clear all rendered views\n   */\n  clear() {\n    this.manager.clear();\n  }\n\n  /**\n   * Go to the next \"page\" in the rendition\n   * @return {Promise}\n   */\n  next() {\n    return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this));\n  }\n\n  /**\n   * Go to the previous \"page\" in the rendition\n   * @return {Promise}\n   */\n  prev() {\n    return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this));\n  }\n\n  //-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n  /**\n   * Determine the Layout properties from metadata and settings\n   * @private\n   * @param  {object} metadata\n   * @return {object} properties\n   */\n  determineLayoutProperties(metadata) {\n    var properties;\n    var layout = this.settings.layout || metadata.layout || \"reflowable\";\n    var spread = this.settings.spread || metadata.spread || \"auto\";\n    var orientation = this.settings.orientation || metadata.orientation || \"auto\";\n    var flow = this.settings.flow || metadata.flow || \"auto\";\n    var viewport = metadata.viewport || \"\";\n    var minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n    var direction = this.settings.direction || metadata.direction || \"ltr\";\n    if ((this.settings.width === 0 || this.settings.width > 0) && (this.settings.height === 0 || this.settings.height > 0)) {\n      // viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n    }\n    properties = {\n      layout: layout,\n      spread: spread,\n      orientation: orientation,\n      flow: flow,\n      viewport: viewport,\n      minSpreadWidth: minSpreadWidth,\n      direction: direction\n    };\n    return properties;\n  }\n\n  /**\n   * Adjust the flow of the rendition to paginated or scrolled\n   * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n   * @param  {string} flow\n   */\n  flow(flow) {\n    var _flow = flow;\n    if (flow === \"scrolled\" || flow === \"scrolled-doc\" || flow === \"scrolled-continuous\") {\n      _flow = \"scrolled\";\n    }\n    if (flow === \"auto\" || flow === \"paginated\") {\n      _flow = \"paginated\";\n    }\n    this.settings.flow = flow;\n    if (this._layout) {\n      this._layout.flow(_flow);\n    }\n    if (this.manager && this._layout) {\n      this.manager.applyLayout(this._layout);\n    }\n    if (this.manager) {\n      this.manager.updateFlow(_flow);\n    }\n    if (this.manager && this.manager.isRendered() && this.location) {\n      this.manager.clear();\n      this.display(this.location.start.cfi);\n    }\n  }\n\n  /**\n   * Adjust the layout of the rendition to reflowable or pre-paginated\n   * @param  {object} settings\n   */\n  layout(settings) {\n    if (settings) {\n      this._layout = new Layout(settings);\n      this._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n      // this.mapping = new Mapping(this._layout.props);\n\n      this._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n        this.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n      });\n    }\n    if (this.manager && this._layout) {\n      this.manager.applyLayout(this._layout);\n    }\n    return this._layout;\n  }\n\n  /**\n   * Adjust if the rendition uses spreads\n   * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n   * @param  {int} [min] min width to use spreads at\n   */\n  spread(spread, min) {\n    this.settings.spread = spread;\n    if (min) {\n      this.settings.minSpreadWidth = min;\n    }\n    if (this._layout) {\n      this._layout.spread(spread, min);\n    }\n    if (this.manager && this.manager.isRendered()) {\n      this.manager.updateLayout();\n    }\n  }\n\n  /**\n   * Adjust the direction of the rendition\n   * @param  {string} dir\n   */\n  direction(dir) {\n    this.settings.direction = dir || \"ltr\";\n    if (this.manager) {\n      this.manager.direction(this.settings.direction);\n    }\n    if (this.manager && this.manager.isRendered() && this.location) {\n      this.manager.clear();\n      this.display(this.location.start.cfi);\n    }\n  }\n\n  /**\n   * Report the current location\n   * @fires relocated\n   * @fires locationChanged\n   */\n  reportLocation() {\n    return this.q.enqueue(function reportedLocation() {\n      requestAnimationFrame(function reportedLocationAfterRAF() {\n        var location = this.manager.currentLocation();\n        if (location && location.then && typeof location.then === \"function\") {\n          location.then(function (result) {\n            let located = this.located(result);\n            if (!located || !located.start || !located.end) {\n              return;\n            }\n            this.location = located;\n            this.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n              index: this.location.start.index,\n              href: this.location.start.href,\n              start: this.location.start.cfi,\n              end: this.location.end.cfi,\n              percentage: this.location.start.percentage\n            });\n            this.emit(EVENTS.RENDITION.RELOCATED, this.location);\n          }.bind(this));\n        } else if (location) {\n          let located = this.located(location);\n          if (!located || !located.start || !located.end) {\n            return;\n          }\n          this.location = located;\n\n          /**\n           * @event locationChanged\n           * @deprecated\n           * @type {object}\n           * @property {number} index\n           * @property {string} href\n           * @property {EpubCFI} start\n           * @property {EpubCFI} end\n           * @property {number} percentage\n           * @memberof Rendition\n           */\n          this.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n            index: this.location.start.index,\n            href: this.location.start.href,\n            start: this.location.start.cfi,\n            end: this.location.end.cfi,\n            percentage: this.location.start.percentage\n          });\n\n          /**\n           * @event relocated\n           * @type {displayedLocation}\n           * @memberof Rendition\n           */\n          this.emit(EVENTS.RENDITION.RELOCATED, this.location);\n        }\n      }.bind(this));\n    }.bind(this));\n  }\n\n  /**\n   * Get the Current Location object\n   * @return {displayedLocation | promise} location (may be a promise)\n   */\n  currentLocation() {\n    var location = this.manager.currentLocation();\n    if (location && location.then && typeof location.then === \"function\") {\n      location.then(function (result) {\n        let located = this.located(result);\n        return located;\n      }.bind(this));\n    } else if (location) {\n      let located = this.located(location);\n      return located;\n    }\n  }\n\n  /**\n   * Creates a Rendition#locationRange from location\n   * passed by the Manager\n   * @returns {displayedLocation}\n   * @private\n   */\n  located(location) {\n    if (!location.length) {\n      return {};\n    }\n    let start = location[0];\n    let end = location[location.length - 1];\n    let located = {\n      start: {\n        index: start.index,\n        href: start.href,\n        cfi: start.mapping.start,\n        displayed: {\n          page: start.pages[0] || 1,\n          total: start.totalPages\n        }\n      },\n      end: {\n        index: end.index,\n        href: end.href,\n        cfi: end.mapping.end,\n        displayed: {\n          page: end.pages[end.pages.length - 1] || 1,\n          total: end.totalPages\n        }\n      }\n    };\n    let locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n    let locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n    if (locationStart != null) {\n      located.start.location = locationStart;\n      located.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n    }\n    if (locationEnd != null) {\n      located.end.location = locationEnd;\n      located.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n    }\n    let pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n    let pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n    if (pageStart != -1) {\n      located.start.page = pageStart;\n    }\n    if (pageEnd != -1) {\n      located.end.page = pageEnd;\n    }\n    if (end.index === this.book.spine.last().index && located.end.displayed.page >= located.end.displayed.total) {\n      located.atEnd = true;\n    }\n    if (start.index === this.book.spine.first().index && located.start.displayed.page === 1) {\n      located.atStart = true;\n    }\n    return located;\n  }\n\n  /**\n   * Remove and Clean Up the Rendition\n   */\n  destroy() {\n    // Clear the queue\n    // this.q.clear();\n    // this.q = undefined;\n\n    this.manager && this.manager.destroy();\n    this.book = undefined;\n\n    // this.views = null;\n\n    // this.hooks.display.clear();\n    // this.hooks.serialize.clear();\n    // this.hooks.content.clear();\n    // this.hooks.layout.clear();\n    // this.hooks.render.clear();\n    // this.hooks.show.clear();\n    // this.hooks = {};\n\n    // this.themes.destroy();\n    // this.themes = undefined;\n\n    // this.epubcfi = undefined;\n\n    // this.starting = undefined;\n    // this.started = undefined;\n  }\n\n  /**\n   * Pass the events from a view's Contents\n   * @private\n   * @param  {Contents} view contents\n   */\n  passEvents(contents) {\n    DOM_EVENTS.forEach(e => {\n      contents.on(e, ev => this.triggerViewEvent(ev, contents));\n    });\n    contents.on(EVENTS.CONTENTS.SELECTED, e => this.triggerSelectedEvent(e, contents));\n  }\n\n  /**\n   * Emit events passed by a view\n   * @private\n   * @param  {event} e\n   */\n  triggerViewEvent(e, contents) {\n    this.emit(e.type, e, contents);\n  }\n\n  /**\n   * Emit a selection event's CFI Range passed from a a view\n   * @private\n   * @param  {string} cfirange\n   */\n  triggerSelectedEvent(cfirange, contents) {\n    /**\n     * Emit that a text selection has occurred\n     * @event selected\n     * @param {string} cfirange\n     * @param {Contents} contents\n     * @memberof Rendition\n     */\n    this.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n  }\n\n  /**\n   * Emit a markClicked event with the cfiRange and data from a mark\n   * @private\n   * @param  {EpubCFI} cfirange\n   */\n  triggerMarkEvent(cfiRange, data, contents) {\n    /**\n     * Emit that a mark was clicked\n     * @event markClicked\n     * @param {EpubCFI} cfirange\n     * @param {object} data\n     * @param {Contents} contents\n     * @memberof Rendition\n     */\n    this.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n  }\n\n  /**\n   * Get a Range from a Visible CFI\n   * @param  {string} cfi EpubCfi String\n   * @param  {string} ignoreClass\n   * @return {range}\n   */\n  getRange(cfi, ignoreClass) {\n    var _cfi = new EpubCFI(cfi);\n    var found = this.manager.visible().filter(function (view) {\n      if (_cfi.spinePos === view.index) return true;\n    });\n\n    // Should only every return 1 item\n    if (found.length) {\n      return found[0].contents.range(_cfi, ignoreClass);\n    }\n  }\n\n  /**\n   * Hook to adjust images to fit in columns\n   * @param  {Contents} contents\n   * @private\n   */\n  adjustImages(contents) {\n    if (this._layout.name === \"pre-paginated\") {\n      return new Promise(function (resolve) {\n        resolve();\n      });\n    }\n    let computed = contents.window.getComputedStyle(contents.content, null);\n    let height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n    let horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\n    contents.addStylesheetRules({\n      \"img\": {\n        \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth - horizontalPadding + \"px\" : \"100%\") + \"!important\",\n        \"max-height\": height + \"px\" + \"!important\",\n        \"object-fit\": \"contain\",\n        \"page-break-inside\": \"avoid\",\n        \"break-inside\": \"avoid\",\n        \"box-sizing\": \"border-box\"\n      },\n      \"svg\": {\n        \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth - horizontalPadding + \"px\" : \"100%\") + \"!important\",\n        \"max-height\": height + \"px\" + \"!important\",\n        \"page-break-inside\": \"avoid\",\n        \"break-inside\": \"avoid\"\n      }\n    });\n    return new Promise(function (resolve, reject) {\n      // Wait to apply\n      setTimeout(function () {\n        resolve();\n      }, 1);\n    });\n  }\n\n  /**\n   * Get the Contents object of each rendered view\n   * @returns {Contents[]}\n   */\n  getContents() {\n    return this.manager ? this.manager.getContents() : [];\n  }\n\n  /**\n   * Get the views member from the manager\n   * @returns {Views}\n   */\n  views() {\n    let views = this.manager ? this.manager.views : undefined;\n    return views || [];\n  }\n\n  /**\n   * Hook to handle link clicks in rendered content\n   * @param  {Contents} contents\n   * @private\n   */\n  handleLinks(contents) {\n    if (contents) {\n      contents.on(EVENTS.CONTENTS.LINK_CLICKED, href => {\n        let relative = this.book.path.relative(href);\n        this.display(relative);\n      });\n    }\n  }\n\n  /**\n   * Hook to handle injecting stylesheet before\n   * a Section is serialized\n   * @param  {document} doc\n   * @param  {Section} section\n   * @private\n   */\n  injectStylesheet(doc, section) {\n    let style = doc.createElement(\"link\");\n    style.setAttribute(\"type\", \"text/css\");\n    style.setAttribute(\"rel\", \"stylesheet\");\n    style.setAttribute(\"href\", this.settings.stylesheet);\n    doc.getElementsByTagName(\"head\")[0].appendChild(style);\n  }\n\n  /**\n   * Hook to handle injecting scripts before\n   * a Section is serialized\n   * @param  {document} doc\n   * @param  {Section} section\n   * @private\n   */\n  injectScript(doc, section) {\n    let script = doc.createElement(\"script\");\n    script.setAttribute(\"type\", \"text/javascript\");\n    script.setAttribute(\"src\", this.settings.script);\n    script.textContent = \" \"; // Needed to prevent self closing tag\n    doc.getElementsByTagName(\"head\")[0].appendChild(script);\n  }\n\n  /**\n   * Hook to handle the document identifier before\n   * a Section is serialized\n   * @param  {document} doc\n   * @param  {Section} section\n   * @private\n   */\n  injectIdentifier(doc, section) {\n    let ident = this.book.packaging.metadata.identifier;\n    let meta = doc.createElement(\"meta\");\n    meta.setAttribute(\"name\", \"dc.relation.ispartof\");\n    if (ident) {\n      meta.setAttribute(\"content\", ident);\n    }\n    doc.getElementsByTagName(\"head\")[0].appendChild(meta);\n  }\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\nexport default Rendition;","map":{"version":3,"names":["EventEmitter","extend","defer","isFloat","Hook","EpubCFI","Queue","Layout","Themes","Contents","Annotations","EVENTS","DOM_EVENTS","IframeView","DefaultViewManager","ContinuousViewManager","Rendition","constructor","book","options","settings","width","height","ignoreClass","manager","view","flow","layout","spread","minSpreadWidth","stylesheet","resizeOnOrientationChange","script","snap","defaultDirection","allowScriptedContent","allowPopups","hooks","display","serialize","content","unloaded","render","show","register","handleLinks","bind","passEvents","adjustImages","spine","injectIdentifier","injectStylesheet","injectScript","themes","annotations","epubcfi","q","location","undefined","enqueue","opened","starting","started","promise","start","setManager","requireManager","viewManager","requireView","View","package","metadata","displayOptions","fixedLayout","ViewManager","queue","request","load","direction","globalLayoutProperties","determineLayoutProperties","on","MANAGERS","ADDED","afterDisplayed","REMOVED","afterRemoved","RESIZED","onResized","ORIENTATION_CHANGE","onOrientationChange","SCROLLED","reportLocation","emit","RENDITION","STARTED","resolve","attachTo","element","ATTACHED","target","displaying","_display","isCfiString","displayed","section","moveTo","locations","length","cfiFromPercentage","parseFloat","get","reject","Error","then","DISPLAYED","err","DISPLAY_ERROR","VIEWS","MARK_CLICKED","cfiRange","data","triggerMarkEvent","contents","trigger","RENDERED","size","cfi","orientation","offset","resize","clear","next","prev","properties","viewport","_flow","_layout","applyLayout","updateFlow","isRendered","LAYOUT","UPDATED","props","changed","min","updateLayout","dir","reportedLocation","requestAnimationFrame","reportedLocationAfterRAF","currentLocation","result","located","end","LOCATION_CHANGED","index","href","percentage","RELOCATED","mapping","page","pages","total","totalPages","locationStart","locationFromCfi","locationEnd","percentageFromLocation","pageStart","pageList","pageFromCfi","pageEnd","last","atEnd","first","atStart","destroy","forEach","e","ev","triggerViewEvent","CONTENTS","SELECTED","triggerSelectedEvent","type","cfirange","getRange","_cfi","found","visible","filter","spinePos","range","name","Promise","computed","window","getComputedStyle","offsetHeight","paddingTop","paddingBottom","horizontalPadding","paddingLeft","paddingRight","addStylesheetRules","columnWidth","setTimeout","getContents","views","LINK_CLICKED","relative","path","doc","style","createElement","setAttribute","getElementsByTagName","appendChild","textContent","ident","packaging","identifier","meta","prototype"],"sources":["/home/parallels/Downloads/react-epub-viewer-demo/node_modules/epubjs/src/rendition.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n * @param {string} [options.defaultDirection='ltr'] default text direction\n * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content\n * @param {boolean} [options.allowPopups=false] enable opening popup in content\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: \"\",\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800,\n\t\t\tstylesheet: null,\n\t\t\tresizeOnOrientationChange: true,\n\t\t\tscript: null,\n\t\t\tsnap: false,\n\t\t\tdefaultDirection: \"ltr\",\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.book = book;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @member {object} hooks\n\t\t * @property {Hook} hooks.content\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.unloaded = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\n\n\t\tthis.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n\n\t\tif (this.settings.stylesheet) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n\t\t}\n\n\t\tif (this.settings.script) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectScript.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * @member {Themes} themes\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.themes = new Themes(this);\n\n\t\t/**\n\t\t * @member {Annotations} annotations\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.annotations = new Annotations(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\t/**\n\t\t * A Rendered Location Range\n\t\t * @typedef location\n\t\t * @type {Object}\n\t\t * @property {object} start\n\t\t * @property {string} start.index\n\t\t * @property {string} start.href\n\t\t * @property {object} start.displayed\n\t\t * @property {EpubCFI} start.cfi\n\t\t * @property {number} start.location\n\t\t * @property {number} start.percentage\n\t\t * @property {number} start.displayed.page\n\t\t * @property {number} start.displayed.total\n\t\t * @property {object} end\n\t\t * @property {string} end.index\n\t\t * @property {string} end.href\n\t\t * @property {object} end.displayed\n\t\t * @property {EpubCFI} end.cfi\n\t\t * @property {number} end.location\n\t\t * @property {number} end.percentage\n\t\t * @property {number} end.displayed.page\n\t\t * @property {number} end.displayed.total\n\t\t * @property {boolean} atStart\n\t\t * @property {boolean} atEnd\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.location = undefined;\n\n\t\t// Hold queue until book is opened\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\tthis.starting = new defer();\n\t\t/**\n\t\t * @member {promise} started returns after the rendition has started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.started = this.starting.promise;\n\n\t\t// Block the queue until rendering is started\n\t\tthis.q.enqueue(this.start);\n\t}\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t}\n\n\t/**\n\t * Require the manager from passed string, or as a class function\n\t * @param  {string|object} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from imported managers\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\n\t\t\tviewManager = DefaultViewManager;\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\n\t\t\tviewManager = ContinuousViewManager;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tviewManager = manager;\n\t\t}\n\n\t\treturn viewManager;\n\t}\n\n\t/**\n\t * Require the view from passed string, or as a class function\n\t * @param  {string|object} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\t// If view is a string, try to load from imported views,\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\n\t\t\tView = IframeView;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tView = view;\n\t\t}\n\n\t\treturn View;\n\t}\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\t\tif (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\n\t\t\tthis.settings.layout = \"pre-paginated\";\n\t\t}\n\t\tswitch(this.book.package.metadata.spread) {\n\t\t\tcase 'none':\n\t\t\t\tthis.settings.spread = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 'both':\n\t\t\t\tthis.settings.spread = true;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\tthis.direction(this.book.package.metadata.direction || this.settings.defaultDirection);\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n\t\t// Listen for rotation\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n\t\t/**\n\t\t * Emit that rendering has started\n\t\t * @event started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t}\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Emit that rendering has attached to an element\n\t\t\t * @event attached\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\n\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\t\tif (this.displaying) {\n\t\t\tthis.displaying.resolve();\n\t\t}\n\t\treturn this.q.enqueue(this._display, target);\n\t}\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tif (!this.book) {\n\t\t\treturn;\n\t\t}\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\tthis.displaying = displaying;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length() && isFloat(target)) {\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\tthis.manager.display(section, target)\n\t\t\t.then(() => {\n\t\t\t\tdisplaying.resolve(section);\n\t\t\t\tthis.displaying = undefined;\n\n\t\t\t\t/**\n\t\t\t\t * Emit that a section has been displayed\n\t\t\t\t * @event displayed\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\n\t\t\t\tthis.reportLocation();\n\t\t\t}, (err) => {\n\t\t\t\t/**\n\t\t\t\t * Emit that has been an error displaying\n\t\t\t\t * @event displayError\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n\t\t\t});\n\n\t\treturn displayed;\n\t}\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t}\n\t*/\n\n\t/**\n\t * Report what section has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view.contents));\n\n\t\tthis.hooks.render.trigger(view, this)\n\t\t\t.then(() => {\n\t\t\t\tif (view.contents) {\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Emit that a section has been rendered\n\t\t\t\t\t\t * @event rendered\n\t\t\t\t\t\t * @param {Section} section\n\t\t\t\t\t\t * @param {View} view\n\t\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t\t */\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Report what has been removed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterRemoved(view){\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\n\t\t\t/**\n\t\t\t * Emit that a section has been removed\n\t\t\t * @event removed\n\t\t\t * @param {Section} section\n\t\t\t * @param {View} view\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n\t\t});\n\t}\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size, epubcfi){\n\n\t\t/**\n\t\t * Emit that the rendition has been resized\n\t\t * @event resized\n\t\t * @param {number} width\n\t\t * @param {height} height\n\t\t * @param {string} epubcfi (optional)\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t}, epubcfi);\n\n\t\tif (this.location && this.location.start) {\n\t\t\tthis.display(epubcfi || this.location.start.cfi);\n\t\t}\n\n\t}\n\n\t/**\n\t * Report orientation events and display the last seen location\n\t * @private\n\t */\n\tonOrientationChange(orientation){\n\t\t/**\n\t\t * Emit that the rendition has been rotated\n\t\t * @event orientationchange\n\t\t * @param {string} orientation\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n\t}\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t}\n\n\t/**\n\t * Trigger a resize of the views\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t * @param {string} [epubcfi] (optional)\n\t */\n\tresize(width, height, epubcfi){\n\t\tif (width) {\n\t\t\tthis.settings.width = width;\n\t\t}\n\t\tif (height) {\n\t\t\tthis.settings.height = height;\n\t\t}\n\t\tthis.manager.resize(width, height, epubcfi);\n\t}\n\n\t/**\n\t * Clear all rendered views\n\t */\n\tclear(){\n\t\tthis.manager.clear();\n\t}\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\n\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\n\t\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth,\n\t\t\tdirection: direction\n\t\t};\n\n\t\treturn properties;\n\t}\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled\" ||\n\t\t\t\tflow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tthis.settings.flow = flow;\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\t// this.mapping = new Mapping(this._layout.props);\n\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n\t\t\t})\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t}\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} [min] min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis.settings.spread = spread;\n\n\t\tif (min) {\n\t\t\tthis.settings.minSpreadWidth = min;\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.spread(spread, min);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the direction of the rendition\n\t * @param  {string} dir\n\t */\n\tdirection(dir){\n\n\t\tthis.settings.direction = dir || \"ltr\";\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.direction(this.settings.direction);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Report the current location\n\t * @fires relocated\n\t * @fires locationChanged\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function reportedLocation(){\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\n\t\t\t\tvar location = this.manager.currentLocation();\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\t\tlet located = this.located(result);\n\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else if (location) {\n\t\t\t\t\tlet located = this.located(location);\n\n\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event locationChanged\n\t\t\t\t\t * @deprecated\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t * @property {number} index\n\t\t\t\t\t * @property {string} href\n\t\t\t\t\t * @property {EpubCFI} start\n\t\t\t\t\t * @property {EpubCFI} end\n\t\t\t\t\t * @property {number} percentage\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t});\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event relocated\n\t\t\t\t\t * @type {displayedLocation}\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get the Current Location object\n\t * @return {displayedLocation | promise} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tlet located = this.located(result);\n\t\t\t\treturn located;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tlet located = this.located(location);\n\t\t\treturn located;\n\t\t}\n\t}\n\n\t/**\n\t * Creates a Rendition#locationRange from location\n\t * passed by the Manager\n\t * @returns {displayedLocation}\n\t * @private\n\t */\n\tlocated(location){\n\t\tif (!location.length) {\n\t\t\treturn {};\n\t\t}\n\t\tlet start = location[0];\n\t\tlet end = location[location.length-1];\n\n\t\tlet located = {\n\t\t\tstart: {\n\t\t\t\tindex: start.index,\n\t\t\t\thref: start.href,\n\t\t\t\tcfi: start.mapping.start,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: start.pages[0] || 1,\n\t\t\t\t\ttotal: start.totalPages\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tindex: end.index,\n\t\t\t\thref: end.href,\n\t\t\t\tcfi: end.mapping.end,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: end.pages[end.pages.length-1] || 1,\n\t\t\t\t\ttotal: end.totalPages\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n\t\tif (locationStart != null) {\n\t\t\tlocated.start.location = locationStart;\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n\t\t}\n\t\tif (locationEnd != null) {\n\t\t\tlocated.end.location = locationEnd;\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n\t\t}\n\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n\t\tif (pageStart != -1) {\n\t\t\tlocated.start.page = pageStart;\n\t\t}\n\t\tif (pageEnd != -1) {\n\t\t\tlocated.end.page = pageEnd;\n\t\t}\n\n\t\tif (end.index === this.book.spine.last().index &&\n\t\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\n\t\t\tlocated.atEnd = true;\n\t\t}\n\n\t\tif (start.index === this.book.spine.first().index &&\n\t\t\t\tlocated.start.displayed.page === 1) {\n\t\t\tlocated.atStart = true;\n\t\t}\n\n\t\treturn located;\n\t}\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\t// this.q.clear();\n\t\t// this.q = undefined;\n\n\t\tthis.manager && this.manager.destroy();\n\n\t\tthis.book = undefined;\n\n\t\t// this.views = null;\n\n\t\t// this.hooks.display.clear();\n\t\t// this.hooks.serialize.clear();\n\t\t// this.hooks.content.clear();\n\t\t// this.hooks.layout.clear();\n\t\t// this.hooks.render.clear();\n\t\t// this.hooks.show.clear();\n\t\t// this.hooks = {};\n\n\t\t// this.themes.destroy();\n\t\t// this.themes = undefined;\n\n\t\t// this.epubcfi = undefined;\n\n\t\t// this.starting = undefined;\n\t\t// this.started = undefined;\n\n\n\t}\n\n\t/**\n\t * Pass the events from a view's Contents\n\t * @private\n\t * @param  {Contents} view contents\n\t */\n\tpassEvents(contents){\n\t\tDOM_EVENTS.forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\n\t}\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {string} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange, contents){\n\t\t/**\n\t\t * Emit that a text selection has occurred\n\t\t * @event selected\n\t\t * @param {string} cfirange\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n\t}\n\n\t/**\n\t * Emit a markClicked event with the cfiRange and data from a mark\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerMarkEvent(cfiRange, data, contents){\n\t\t/**\n\t\t * Emit that a mark was clicked\n\t\t * @event markClicked\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {object} data\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n\t}\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\tgetRange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.manager.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\n\t\t}\n\t}\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\tadjustImages(contents) {\n\n\t\tif (this._layout.name === \"pre-paginated\") {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n\t\tlet horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\n\n\t\tcontents.addStylesheetRules({\n\t\t\t\"img\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"object-fit\": \"contain\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\",\n\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t},\n\t\t\t\"svg\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\"\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Get the Contents object of each rendered view\n\t * @returns {Contents[]}\n\t */\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t}\n\n\t/**\n\t * Get the views member from the manager\n\t * @returns {Views}\n\t */\n\tviews () {\n\t\tlet views = this.manager ? this.manager.views : undefined;\n\t\treturn views || [];\n\t}\n\n\t/**\n\t * Hook to handle link clicks in rendered content\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\thandleLinks(contents) {\n\t\tif (contents) {\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\n\t\t\t\tlet relative = this.book.path.relative(href);\n\t\t\t\tthis.display(relative);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook to handle injecting stylesheet before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectStylesheet(doc, section) {\n\t\tlet style = doc.createElement(\"link\");\n\t\tstyle.setAttribute(\"type\", \"text/css\");\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\n\t}\n\n\t/**\n\t * Hook to handle injecting scripts before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectScript(doc, section) {\n\t\tlet script = doc.createElement(\"script\");\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", this.settings.script);\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n\t/**\n\t * Hook to handle the document identifier before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectIdentifier(doc, section) {\n\t\tlet ident = this.book.packaging.metadata.identifier;\n\t\tlet meta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\t\tif (ident) {\n\t\t\tmeta.setAttribute(\"content\", ident);\n\t\t}\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\n\t}\n\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n"],"mappings":"AAAA,OAAOA,YAAY,MAAM,eAAe;AACxC,SAASC,MAAM,EAAEC,KAAK,EAAEC,OAAO,QAAQ,cAAc;AACrD,OAAOC,IAAI,MAAM,cAAc;AAC/B,OAAOC,OAAO,MAAM,WAAW;AAC/B,OAAOC,KAAK,MAAM,eAAe;AACjC,OAAOC,MAAM,MAAM,UAAU;AAC7B;AACA,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAOC,QAAQ,MAAM,YAAY;AACjC,OAAOC,WAAW,MAAM,eAAe;AACvC,SAASC,MAAM,EAAEC,UAAU,QAAQ,mBAAmB;;AAEtD;AACA,OAAOC,UAAU,MAAM,yBAAyB;;AAEhD;AACA,OAAOC,kBAAkB,MAAM,0BAA0B;AACzD,OAAOC,qBAAqB,MAAM,6BAA6B;;AAE/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,SAAS,CAAC;EACfC,WAAW,CAACC,IAAI,EAAEC,OAAO,EAAE;IAE1B,IAAI,CAACC,QAAQ,GAAGnB,MAAM,CAAC,IAAI,CAACmB,QAAQ,IAAI,CAAC,CAAC,EAAE;MAC3CC,KAAK,EAAE,IAAI;MACXC,MAAM,EAAE,IAAI;MACZC,WAAW,EAAE,EAAE;MACfC,OAAO,EAAE,SAAS;MAClBC,IAAI,EAAE,QAAQ;MACdC,IAAI,EAAE,IAAI;MACVC,MAAM,EAAE,IAAI;MACZC,MAAM,EAAE,IAAI;MACZC,cAAc,EAAE,GAAG;MACnBC,UAAU,EAAE,IAAI;MAChBC,yBAAyB,EAAE,IAAI;MAC/BC,MAAM,EAAE,IAAI;MACZC,IAAI,EAAE,KAAK;MACXC,gBAAgB,EAAE,KAAK;MACvBC,oBAAoB,EAAE,KAAK;MAC3BC,WAAW,EAAE;IACd,CAAC,CAAC;IAEFnC,MAAM,CAAC,IAAI,CAACmB,QAAQ,EAAED,OAAO,CAAC;IAE9B,IAAI,OAAO,IAAI,CAACC,QAAQ,CAACI,OAAQ,KAAK,QAAQ,EAAE;MAC/C,IAAI,CAACA,OAAO,GAAG,IAAI,CAACJ,QAAQ,CAACI,OAAO;IACrC;IAEA,IAAI,CAACN,IAAI,GAAGA,IAAI;;IAEhB;AACF;AACA;AACA;AACA;AACA;IACE,IAAI,CAACmB,KAAK,GAAG,CAAC,CAAC;IACf,IAAI,CAACA,KAAK,CAACC,OAAO,GAAG,IAAIlC,IAAI,CAAC,IAAI,CAAC;IACnC,IAAI,CAACiC,KAAK,CAACE,SAAS,GAAG,IAAInC,IAAI,CAAC,IAAI,CAAC;IACrC,IAAI,CAACiC,KAAK,CAACG,OAAO,GAAG,IAAIpC,IAAI,CAAC,IAAI,CAAC;IACnC,IAAI,CAACiC,KAAK,CAACI,QAAQ,GAAG,IAAIrC,IAAI,CAAC,IAAI,CAAC;IACpC,IAAI,CAACiC,KAAK,CAACV,MAAM,GAAG,IAAIvB,IAAI,CAAC,IAAI,CAAC;IAClC,IAAI,CAACiC,KAAK,CAACK,MAAM,GAAG,IAAItC,IAAI,CAAC,IAAI,CAAC;IAClC,IAAI,CAACiC,KAAK,CAACM,IAAI,GAAG,IAAIvC,IAAI,CAAC,IAAI,CAAC;IAEhC,IAAI,CAACiC,KAAK,CAACG,OAAO,CAACI,QAAQ,CAAC,IAAI,CAACC,WAAW,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;IACxD,IAAI,CAACT,KAAK,CAACG,OAAO,CAACI,QAAQ,CAAC,IAAI,CAACG,UAAU,CAACD,IAAI,CAAC,IAAI,CAAC,CAAC;IACvD,IAAI,CAACT,KAAK,CAACG,OAAO,CAACI,QAAQ,CAAC,IAAI,CAACI,YAAY,CAACF,IAAI,CAAC,IAAI,CAAC,CAAC;IAEzD,IAAI,CAAC5B,IAAI,CAAC+B,KAAK,CAACZ,KAAK,CAACG,OAAO,CAACI,QAAQ,CAAC,IAAI,CAACM,gBAAgB,CAACJ,IAAI,CAAC,IAAI,CAAC,CAAC;IAExE,IAAI,IAAI,CAAC1B,QAAQ,CAACU,UAAU,EAAE;MAC7B,IAAI,CAACZ,IAAI,CAAC+B,KAAK,CAACZ,KAAK,CAACG,OAAO,CAACI,QAAQ,CAAC,IAAI,CAACO,gBAAgB,CAACL,IAAI,CAAC,IAAI,CAAC,CAAC;IACzE;IAEA,IAAI,IAAI,CAAC1B,QAAQ,CAACY,MAAM,EAAE;MACzB,IAAI,CAACd,IAAI,CAAC+B,KAAK,CAACZ,KAAK,CAACG,OAAO,CAACI,QAAQ,CAAC,IAAI,CAACQ,YAAY,CAACN,IAAI,CAAC,IAAI,CAAC,CAAC;IACrE;;IAEA;AACF;AACA;AACA;IACE,IAAI,CAACO,MAAM,GAAG,IAAI7C,MAAM,CAAC,IAAI,CAAC;;IAE9B;AACF;AACA;AACA;IACE,IAAI,CAAC8C,WAAW,GAAG,IAAI5C,WAAW,CAAC,IAAI,CAAC;IAExC,IAAI,CAAC6C,OAAO,GAAG,IAAIlD,OAAO,EAAE;IAE5B,IAAI,CAACmD,CAAC,GAAG,IAAIlD,KAAK,CAAC,IAAI,CAAC;;IAExB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACE,IAAI,CAACmD,QAAQ,GAAGC,SAAS;;IAEzB;IACA,IAAI,CAACF,CAAC,CAACG,OAAO,CAAC,IAAI,CAACzC,IAAI,CAAC0C,MAAM,CAAC;IAEhC,IAAI,CAACC,QAAQ,GAAG,IAAI3D,KAAK,EAAE;IAC3B;AACF;AACA;AACA;IACE,IAAI,CAAC4D,OAAO,GAAG,IAAI,CAACD,QAAQ,CAACE,OAAO;;IAEpC;IACA,IAAI,CAACP,CAAC,CAACG,OAAO,CAAC,IAAI,CAACK,KAAK,CAAC;EAC3B;;EAEA;AACD;AACA;AACA;EACCC,UAAU,CAACzC,OAAO,EAAE;IACnB,IAAI,CAACA,OAAO,GAAGA,OAAO;EACvB;;EAEA;AACD;AACA;AACA;AACA;EACC0C,cAAc,CAAC1C,OAAO,EAAE;IACvB,IAAI2C,WAAW;;IAEf;IACA,IAAI,OAAO3C,OAAO,KAAK,QAAQ,IAAIA,OAAO,KAAK,SAAS,EAAE;MACzD2C,WAAW,GAAGrD,kBAAkB;IACjC,CAAC,MAAM,IAAI,OAAOU,OAAO,KAAK,QAAQ,IAAIA,OAAO,KAAK,YAAY,EAAE;MACnE2C,WAAW,GAAGpD,qBAAqB;IACpC,CAAC,MAAM;MACN;MACAoD,WAAW,GAAG3C,OAAO;IACtB;IAEA,OAAO2C,WAAW;EACnB;;EAEA;AACD;AACA;AACA;AACA;EACCC,WAAW,CAAC3C,IAAI,EAAE;IACjB,IAAI4C,IAAI;;IAER;IACA,IAAI,OAAO5C,IAAI,IAAI,QAAQ,IAAIA,IAAI,KAAK,QAAQ,EAAE;MACjD4C,IAAI,GAAGxD,UAAU;IAClB,CAAC,MAAM;MACN;MACAwD,IAAI,GAAG5C,IAAI;IACZ;IAEA,OAAO4C,IAAI;EACZ;;EAEA;AACD;AACA;AACA;EACCL,KAAK,GAAE;IACN,IAAI,CAAC,IAAI,CAAC5C,QAAQ,CAACO,MAAM,KAAK,IAAI,CAACT,IAAI,CAACoD,OAAO,CAACC,QAAQ,CAAC5C,MAAM,KAAK,eAAe,IAAI,IAAI,CAACT,IAAI,CAACsD,cAAc,CAACC,WAAW,KAAK,MAAM,CAAC,EAAE;MACxI,IAAI,CAACrD,QAAQ,CAACO,MAAM,GAAG,eAAe;IACvC;IACA,QAAO,IAAI,CAACT,IAAI,CAACoD,OAAO,CAACC,QAAQ,CAAC3C,MAAM;MACvC,KAAK,MAAM;QACV,IAAI,CAACR,QAAQ,CAACQ,MAAM,GAAG,MAAM;QAC7B;MACD,KAAK,MAAM;QACV,IAAI,CAACR,QAAQ,CAACQ,MAAM,GAAG,IAAI;QAC3B;IAAM;IAGR,IAAG,CAAC,IAAI,CAACJ,OAAO,EAAE;MACjB,IAAI,CAACkD,WAAW,GAAG,IAAI,CAACR,cAAc,CAAC,IAAI,CAAC9C,QAAQ,CAACI,OAAO,CAAC;MAC7D,IAAI,CAAC6C,IAAI,GAAG,IAAI,CAACD,WAAW,CAAC,IAAI,CAAChD,QAAQ,CAACK,IAAI,CAAC;MAEhD,IAAI,CAACD,OAAO,GAAG,IAAI,IAAI,CAACkD,WAAW,CAAC;QACnCjD,IAAI,EAAE,IAAI,CAAC4C,IAAI;QACfM,KAAK,EAAE,IAAI,CAACnB,CAAC;QACboB,OAAO,EAAE,IAAI,CAAC1D,IAAI,CAAC2D,IAAI,CAAC/B,IAAI,CAAC,IAAI,CAAC5B,IAAI,CAAC;QACvCE,QAAQ,EAAE,IAAI,CAACA;MAChB,CAAC,CAAC;IACH;IAEA,IAAI,CAAC0D,SAAS,CAAC,IAAI,CAAC5D,IAAI,CAACoD,OAAO,CAACC,QAAQ,CAACO,SAAS,IAAI,IAAI,CAAC1D,QAAQ,CAACc,gBAAgB,CAAC;;IAEtF;IACA,IAAI,CAACd,QAAQ,CAAC2D,sBAAsB,GAAG,IAAI,CAACC,yBAAyB,CAAC,IAAI,CAAC9D,IAAI,CAACoD,OAAO,CAACC,QAAQ,CAAC;IAEjG,IAAI,CAAC7C,IAAI,CAAC,IAAI,CAACN,QAAQ,CAAC2D,sBAAsB,CAACrD,IAAI,CAAC;IAEpD,IAAI,CAACC,MAAM,CAAC,IAAI,CAACP,QAAQ,CAAC2D,sBAAsB,CAAC;;IAEjD;IACA,IAAI,CAACvD,OAAO,CAACyD,EAAE,CAACtE,MAAM,CAACuE,QAAQ,CAACC,KAAK,EAAE,IAAI,CAACC,cAAc,CAACtC,IAAI,CAAC,IAAI,CAAC,CAAC;IACtE,IAAI,CAACtB,OAAO,CAACyD,EAAE,CAACtE,MAAM,CAACuE,QAAQ,CAACG,OAAO,EAAE,IAAI,CAACC,YAAY,CAACxC,IAAI,CAAC,IAAI,CAAC,CAAC;;IAEtE;IACA,IAAI,CAACtB,OAAO,CAACyD,EAAE,CAACtE,MAAM,CAACuE,QAAQ,CAACK,OAAO,EAAE,IAAI,CAACC,SAAS,CAAC1C,IAAI,CAAC,IAAI,CAAC,CAAC;;IAEnE;IACA,IAAI,CAACtB,OAAO,CAACyD,EAAE,CAACtE,MAAM,CAACuE,QAAQ,CAACO,kBAAkB,EAAE,IAAI,CAACC,mBAAmB,CAAC5C,IAAI,CAAC,IAAI,CAAC,CAAC;;IAExF;IACA,IAAI,CAACtB,OAAO,CAACyD,EAAE,CAACtE,MAAM,CAACuE,QAAQ,CAACS,QAAQ,EAAE,IAAI,CAACC,cAAc,CAAC9C,IAAI,CAAC,IAAI,CAAC,CAAC;;IAEzE;AACF;AACA;AACA;AACA;IACE,IAAI,CAAC+C,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACC,OAAO,CAAC;;IAEnC;IACA,IAAI,CAAClC,QAAQ,CAACmC,OAAO,EAAE;EACxB;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCC,QAAQ,CAACC,OAAO,EAAC;IAEhB,OAAO,IAAI,CAAC1C,CAAC,CAACG,OAAO,CAAC,YAAY;MAEjC;MACA,IAAI,CAACnC,OAAO,CAACkB,MAAM,CAACwD,OAAO,EAAE;QAC5B,OAAO,EAAI,IAAI,CAAC9E,QAAQ,CAACC,KAAK;QAC9B,QAAQ,EAAG,IAAI,CAACD,QAAQ,CAACE;MAC1B,CAAC,CAAC;;MAEF;AACH;AACA;AACA;AACA;MACG,IAAI,CAACuE,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACK,QAAQ,CAAC;IAErC,CAAC,CAACrD,IAAI,CAAC,IAAI,CAAC,CAAC;EAEd;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACCR,OAAO,CAAC8D,MAAM,EAAC;IACd,IAAI,IAAI,CAACC,UAAU,EAAE;MACpB,IAAI,CAACA,UAAU,CAACL,OAAO,EAAE;IAC1B;IACA,OAAO,IAAI,CAACxC,CAAC,CAACG,OAAO,CAAC,IAAI,CAAC2C,QAAQ,EAAEF,MAAM,CAAC;EAC7C;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCE,QAAQ,CAACF,MAAM,EAAC;IACf,IAAI,CAAC,IAAI,CAAClF,IAAI,EAAE;MACf;IACD;IACA,IAAIqF,WAAW,GAAG,IAAI,CAAChD,OAAO,CAACgD,WAAW,CAACH,MAAM,CAAC;IAClD,IAAIC,UAAU,GAAG,IAAInG,KAAK,EAAE;IAC5B,IAAIsG,SAAS,GAAGH,UAAU,CAACtC,OAAO;IAClC,IAAI0C,OAAO;IACX,IAAIC,MAAM;IAEV,IAAI,CAACL,UAAU,GAAGA,UAAU;;IAE5B;IACA,IAAI,IAAI,CAACnF,IAAI,CAACyF,SAAS,CAACC,MAAM,EAAE,IAAIzG,OAAO,CAACiG,MAAM,CAAC,EAAE;MACpDA,MAAM,GAAG,IAAI,CAAClF,IAAI,CAACyF,SAAS,CAACE,iBAAiB,CAACC,UAAU,CAACV,MAAM,CAAC,CAAC;IACnE;IAEAK,OAAO,GAAG,IAAI,CAACvF,IAAI,CAAC+B,KAAK,CAAC8D,GAAG,CAACX,MAAM,CAAC;IAErC,IAAG,CAACK,OAAO,EAAC;MACXJ,UAAU,CAACW,MAAM,CAAC,IAAIC,KAAK,CAAC,kBAAkB,CAAC,CAAC;MAChD,OAAOT,SAAS;IACjB;IAEA,IAAI,CAAChF,OAAO,CAACc,OAAO,CAACmE,OAAO,EAAEL,MAAM,CAAC,CACnCc,IAAI,CAAC,MAAM;MACXb,UAAU,CAACL,OAAO,CAACS,OAAO,CAAC;MAC3B,IAAI,CAACJ,UAAU,GAAG3C,SAAS;;MAE3B;AACJ;AACA;AACA;AACA;AACA;MACI,IAAI,CAACmC,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACqB,SAAS,EAAEV,OAAO,CAAC;MAC9C,IAAI,CAACb,cAAc,EAAE;IACtB,CAAC,EAAGwB,GAAG,IAAK;MACX;AACJ;AACA;AACA;AACA;AACA;MACI,IAAI,CAACvB,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACuB,aAAa,EAAED,GAAG,CAAC;IAC/C,CAAC,CAAC;IAEH,OAAOZ,SAAS;EACjB;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;EAOC;AACD;AACA;AACA;AACA;EACCpB,cAAc,CAAC3D,IAAI,EAAC;IAEnBA,IAAI,CAACwD,EAAE,CAACtE,MAAM,CAAC2G,KAAK,CAACC,YAAY,EAAE,CAACC,QAAQ,EAAEC,IAAI,KAAK,IAAI,CAACC,gBAAgB,CAACF,QAAQ,EAAEC,IAAI,EAAEhG,IAAI,CAACkG,QAAQ,CAAC,CAAC;IAE5G,IAAI,CAACtF,KAAK,CAACK,MAAM,CAACkF,OAAO,CAACnG,IAAI,EAAE,IAAI,CAAC,CACnCyF,IAAI,CAAC,MAAM;MACX,IAAIzF,IAAI,CAACkG,QAAQ,EAAE;QAClB,IAAI,CAACtF,KAAK,CAACG,OAAO,CAACoF,OAAO,CAACnG,IAAI,CAACkG,QAAQ,EAAE,IAAI,CAAC,CAACT,IAAI,CAAC,MAAM;UAC1D;AACN;AACA;AACA;AACA;AACA;AACA;UACM,IAAI,CAACrB,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAAC+B,QAAQ,EAAEpG,IAAI,CAACgF,OAAO,EAAEhF,IAAI,CAAC;QACzD,CAAC,CAAC;MACH,CAAC,MAAM;QACN,IAAI,CAACoE,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAAC+B,QAAQ,EAAEpG,IAAI,CAACgF,OAAO,EAAEhF,IAAI,CAAC;MACzD;IACD,CAAC,CAAC;EAEJ;;EAEA;AACD;AACA;AACA;AACA;EACC6D,YAAY,CAAC7D,IAAI,EAAC;IACjB,IAAI,CAACY,KAAK,CAACI,QAAQ,CAACmF,OAAO,CAACnG,IAAI,EAAE,IAAI,CAAC,CAACyF,IAAI,CAAC,MAAM;MAClD;AACH;AACA;AACA;AACA;AACA;AACA;MACG,IAAI,CAACrB,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACT,OAAO,EAAE5D,IAAI,CAACgF,OAAO,EAAEhF,IAAI,CAAC;IACxD,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;EACC+D,SAAS,CAACsC,IAAI,EAAEvE,OAAO,EAAC;IAEvB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;IACE,IAAI,CAACsC,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACP,OAAO,EAAE;MACnClE,KAAK,EAAEyG,IAAI,CAACzG,KAAK;MACjBC,MAAM,EAAEwG,IAAI,CAACxG;IACd,CAAC,EAAEiC,OAAO,CAAC;IAEX,IAAI,IAAI,CAACE,QAAQ,IAAI,IAAI,CAACA,QAAQ,CAACO,KAAK,EAAE;MACzC,IAAI,CAAC1B,OAAO,CAACiB,OAAO,IAAI,IAAI,CAACE,QAAQ,CAACO,KAAK,CAAC+D,GAAG,CAAC;IACjD;EAED;;EAEA;AACD;AACA;AACA;EACCrC,mBAAmB,CAACsC,WAAW,EAAC;IAC/B;AACF;AACA;AACA;AACA;AACA;IACE,IAAI,CAACnC,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACL,kBAAkB,EAAEuC,WAAW,CAAC;EAC5D;;EAEA;AACD;AACA;AACA;AACA;EACCtB,MAAM,CAACuB,MAAM,EAAC;IACb,IAAI,CAACzG,OAAO,CAACkF,MAAM,CAACuB,MAAM,CAAC;EAC5B;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCC,MAAM,CAAC7G,KAAK,EAAEC,MAAM,EAAEiC,OAAO,EAAC;IAC7B,IAAIlC,KAAK,EAAE;MACV,IAAI,CAACD,QAAQ,CAACC,KAAK,GAAGA,KAAK;IAC5B;IACA,IAAIC,MAAM,EAAE;MACX,IAAI,CAACF,QAAQ,CAACE,MAAM,GAAGA,MAAM;IAC9B;IACA,IAAI,CAACE,OAAO,CAAC0G,MAAM,CAAC7G,KAAK,EAAEC,MAAM,EAAEiC,OAAO,CAAC;EAC5C;;EAEA;AACD;AACA;EACC4E,KAAK,GAAE;IACN,IAAI,CAAC3G,OAAO,CAAC2G,KAAK,EAAE;EACrB;;EAEA;AACD;AACA;AACA;EACCC,IAAI,GAAE;IACL,OAAO,IAAI,CAAC5E,CAAC,CAACG,OAAO,CAAC,IAAI,CAACnC,OAAO,CAAC4G,IAAI,CAACtF,IAAI,CAAC,IAAI,CAACtB,OAAO,CAAC,CAAC,CACzD0F,IAAI,CAAC,IAAI,CAACtB,cAAc,CAAC9C,IAAI,CAAC,IAAI,CAAC,CAAC;EACvC;;EAEA;AACD;AACA;AACA;EACCuF,IAAI,GAAE;IACL,OAAO,IAAI,CAAC7E,CAAC,CAACG,OAAO,CAAC,IAAI,CAACnC,OAAO,CAAC6G,IAAI,CAACvF,IAAI,CAAC,IAAI,CAACtB,OAAO,CAAC,CAAC,CACzD0F,IAAI,CAAC,IAAI,CAACtB,cAAc,CAAC9C,IAAI,CAAC,IAAI,CAAC,CAAC;EACvC;;EAEA;EACA;AACD;AACA;AACA;AACA;AACA;EACCkC,yBAAyB,CAACT,QAAQ,EAAC;IAClC,IAAI+D,UAAU;IACd,IAAI3G,MAAM,GAAG,IAAI,CAACP,QAAQ,CAACO,MAAM,IAAI4C,QAAQ,CAAC5C,MAAM,IAAI,YAAY;IACpE,IAAIC,MAAM,GAAG,IAAI,CAACR,QAAQ,CAACQ,MAAM,IAAI2C,QAAQ,CAAC3C,MAAM,IAAI,MAAM;IAC9D,IAAIoG,WAAW,GAAG,IAAI,CAAC5G,QAAQ,CAAC4G,WAAW,IAAIzD,QAAQ,CAACyD,WAAW,IAAI,MAAM;IAC7E,IAAItG,IAAI,GAAG,IAAI,CAACN,QAAQ,CAACM,IAAI,IAAI6C,QAAQ,CAAC7C,IAAI,IAAI,MAAM;IACxD,IAAI6G,QAAQ,GAAGhE,QAAQ,CAACgE,QAAQ,IAAI,EAAE;IACtC,IAAI1G,cAAc,GAAG,IAAI,CAACT,QAAQ,CAACS,cAAc,IAAI0C,QAAQ,CAAC1C,cAAc,IAAI,GAAG;IACnF,IAAIiD,SAAS,GAAG,IAAI,CAAC1D,QAAQ,CAAC0D,SAAS,IAAIP,QAAQ,CAACO,SAAS,IAAI,KAAK;IAEtE,IAAI,CAAC,IAAI,CAAC1D,QAAQ,CAACC,KAAK,KAAK,CAAC,IAAI,IAAI,CAACD,QAAQ,CAACC,KAAK,GAAG,CAAC,MACtD,IAAI,CAACD,QAAQ,CAACE,MAAM,KAAK,CAAC,IAAI,IAAI,CAACF,QAAQ,CAACE,MAAM,GAAG,CAAC,CAAC,EAAE;MAC3D;IAAA;IAGDgH,UAAU,GAAG;MACZ3G,MAAM,EAAGA,MAAM;MACfC,MAAM,EAAGA,MAAM;MACfoG,WAAW,EAAGA,WAAW;MACzBtG,IAAI,EAAGA,IAAI;MACX6G,QAAQ,EAAGA,QAAQ;MACnB1G,cAAc,EAAGA,cAAc;MAC/BiD,SAAS,EAAEA;IACZ,CAAC;IAED,OAAOwD,UAAU;EAClB;;EAEA;AACD;AACA;AACA;AACA;EACC5G,IAAI,CAACA,IAAI,EAAC;IACT,IAAI8G,KAAK,GAAG9G,IAAI;IAChB,IAAIA,IAAI,KAAK,UAAU,IACrBA,IAAI,KAAK,cAAc,IACvBA,IAAI,KAAK,qBAAqB,EAAE;MACjC8G,KAAK,GAAG,UAAU;IACnB;IAEA,IAAI9G,IAAI,KAAK,MAAM,IAAIA,IAAI,KAAK,WAAW,EAAE;MAC5C8G,KAAK,GAAG,WAAW;IACpB;IAEA,IAAI,CAACpH,QAAQ,CAACM,IAAI,GAAGA,IAAI;IAEzB,IAAI,IAAI,CAAC+G,OAAO,EAAE;MACjB,IAAI,CAACA,OAAO,CAAC/G,IAAI,CAAC8G,KAAK,CAAC;IACzB;IAEA,IAAI,IAAI,CAAChH,OAAO,IAAI,IAAI,CAACiH,OAAO,EAAE;MACjC,IAAI,CAACjH,OAAO,CAACkH,WAAW,CAAC,IAAI,CAACD,OAAO,CAAC;IACvC;IAEA,IAAI,IAAI,CAACjH,OAAO,EAAE;MACjB,IAAI,CAACA,OAAO,CAACmH,UAAU,CAACH,KAAK,CAAC;IAC/B;IAEA,IAAI,IAAI,CAAChH,OAAO,IAAI,IAAI,CAACA,OAAO,CAACoH,UAAU,EAAE,IAAI,IAAI,CAACnF,QAAQ,EAAE;MAC/D,IAAI,CAACjC,OAAO,CAAC2G,KAAK,EAAE;MACpB,IAAI,CAAC7F,OAAO,CAAC,IAAI,CAACmB,QAAQ,CAACO,KAAK,CAAC+D,GAAG,CAAC;IACtC;EACD;;EAEA;AACD;AACA;AACA;EACCpG,MAAM,CAACP,QAAQ,EAAC;IACf,IAAIA,QAAQ,EAAE;MACb,IAAI,CAACqH,OAAO,GAAG,IAAIlI,MAAM,CAACa,QAAQ,CAAC;MACnC,IAAI,CAACqH,OAAO,CAAC7G,MAAM,CAACR,QAAQ,CAACQ,MAAM,EAAE,IAAI,CAACR,QAAQ,CAACS,cAAc,CAAC;;MAElE;;MAEA,IAAI,CAAC4G,OAAO,CAACxD,EAAE,CAACtE,MAAM,CAACkI,MAAM,CAACC,OAAO,EAAE,CAACC,KAAK,EAAEC,OAAO,KAAK;QAC1D,IAAI,CAACnD,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAAC+C,MAAM,EAAEE,KAAK,EAAEC,OAAO,CAAC;MACnD,CAAC,CAAC;IACH;IAEA,IAAI,IAAI,CAACxH,OAAO,IAAI,IAAI,CAACiH,OAAO,EAAE;MACjC,IAAI,CAACjH,OAAO,CAACkH,WAAW,CAAC,IAAI,CAACD,OAAO,CAAC;IACvC;IAEA,OAAO,IAAI,CAACA,OAAO;EACpB;;EAEA;AACD;AACA;AACA;AACA;EACC7G,MAAM,CAACA,MAAM,EAAEqH,GAAG,EAAC;IAElB,IAAI,CAAC7H,QAAQ,CAACQ,MAAM,GAAGA,MAAM;IAE7B,IAAIqH,GAAG,EAAE;MACR,IAAI,CAAC7H,QAAQ,CAACS,cAAc,GAAGoH,GAAG;IACnC;IAEA,IAAI,IAAI,CAACR,OAAO,EAAE;MACjB,IAAI,CAACA,OAAO,CAAC7G,MAAM,CAACA,MAAM,EAAEqH,GAAG,CAAC;IACjC;IAEA,IAAI,IAAI,CAACzH,OAAO,IAAI,IAAI,CAACA,OAAO,CAACoH,UAAU,EAAE,EAAE;MAC9C,IAAI,CAACpH,OAAO,CAAC0H,YAAY,EAAE;IAC5B;EACD;;EAEA;AACD;AACA;AACA;EACCpE,SAAS,CAACqE,GAAG,EAAC;IAEb,IAAI,CAAC/H,QAAQ,CAAC0D,SAAS,GAAGqE,GAAG,IAAI,KAAK;IAEtC,IAAI,IAAI,CAAC3H,OAAO,EAAE;MACjB,IAAI,CAACA,OAAO,CAACsD,SAAS,CAAC,IAAI,CAAC1D,QAAQ,CAAC0D,SAAS,CAAC;IAChD;IAEA,IAAI,IAAI,CAACtD,OAAO,IAAI,IAAI,CAACA,OAAO,CAACoH,UAAU,EAAE,IAAI,IAAI,CAACnF,QAAQ,EAAE;MAC/D,IAAI,CAACjC,OAAO,CAAC2G,KAAK,EAAE;MACpB,IAAI,CAAC7F,OAAO,CAAC,IAAI,CAACmB,QAAQ,CAACO,KAAK,CAAC+D,GAAG,CAAC;IACtC;EACD;;EAEA;AACD;AACA;AACA;AACA;EACCnC,cAAc,GAAE;IACf,OAAO,IAAI,CAACpC,CAAC,CAACG,OAAO,CAAC,SAASyF,gBAAgB,GAAE;MAChDC,qBAAqB,CAAC,SAASC,wBAAwB,GAAG;QACzD,IAAI7F,QAAQ,GAAG,IAAI,CAACjC,OAAO,CAAC+H,eAAe,EAAE;QAC7C,IAAI9F,QAAQ,IAAIA,QAAQ,CAACyD,IAAI,IAAI,OAAOzD,QAAQ,CAACyD,IAAI,KAAK,UAAU,EAAE;UACrEzD,QAAQ,CAACyD,IAAI,CAAC,UAASsC,MAAM,EAAE;YAC9B,IAAIC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACD,MAAM,CAAC;YAElC,IAAI,CAACC,OAAO,IAAI,CAACA,OAAO,CAACzF,KAAK,IAAI,CAACyF,OAAO,CAACC,GAAG,EAAE;cAC/C;YACD;YAEA,IAAI,CAACjG,QAAQ,GAAGgG,OAAO;YAEvB,IAAI,CAAC5D,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAAC6D,gBAAgB,EAAE;cAC5CC,KAAK,EAAE,IAAI,CAACnG,QAAQ,CAACO,KAAK,CAAC4F,KAAK;cAChCC,IAAI,EAAE,IAAI,CAACpG,QAAQ,CAACO,KAAK,CAAC6F,IAAI;cAC9B7F,KAAK,EAAE,IAAI,CAACP,QAAQ,CAACO,KAAK,CAAC+D,GAAG;cAC9B2B,GAAG,EAAE,IAAI,CAACjG,QAAQ,CAACiG,GAAG,CAAC3B,GAAG;cAC1B+B,UAAU,EAAE,IAAI,CAACrG,QAAQ,CAACO,KAAK,CAAC8F;YACjC,CAAC,CAAC;YAEF,IAAI,CAACjE,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACiE,SAAS,EAAE,IAAI,CAACtG,QAAQ,CAAC;UACrD,CAAC,CAACX,IAAI,CAAC,IAAI,CAAC,CAAC;QACd,CAAC,MAAM,IAAIW,QAAQ,EAAE;UACpB,IAAIgG,OAAO,GAAG,IAAI,CAACA,OAAO,CAAChG,QAAQ,CAAC;UAEpC,IAAI,CAACgG,OAAO,IAAI,CAACA,OAAO,CAACzF,KAAK,IAAI,CAACyF,OAAO,CAACC,GAAG,EAAE;YAC/C;UACD;UAEA,IAAI,CAACjG,QAAQ,GAAGgG,OAAO;;UAEvB;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;UACK,IAAI,CAAC5D,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAAC6D,gBAAgB,EAAE;YAC5CC,KAAK,EAAE,IAAI,CAACnG,QAAQ,CAACO,KAAK,CAAC4F,KAAK;YAChCC,IAAI,EAAE,IAAI,CAACpG,QAAQ,CAACO,KAAK,CAAC6F,IAAI;YAC9B7F,KAAK,EAAE,IAAI,CAACP,QAAQ,CAACO,KAAK,CAAC+D,GAAG;YAC9B2B,GAAG,EAAE,IAAI,CAACjG,QAAQ,CAACiG,GAAG,CAAC3B,GAAG;YAC1B+B,UAAU,EAAE,IAAI,CAACrG,QAAQ,CAACO,KAAK,CAAC8F;UACjC,CAAC,CAAC;;UAEF;AACL;AACA;AACA;AACA;UACK,IAAI,CAACjE,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACiE,SAAS,EAAE,IAAI,CAACtG,QAAQ,CAAC;QACrD;MACD,CAAC,CAACX,IAAI,CAAC,IAAI,CAAC,CAAC;IACd,CAAC,CAACA,IAAI,CAAC,IAAI,CAAC,CAAC;EACd;;EAEA;AACD;AACA;AACA;EACCyG,eAAe,GAAE;IAChB,IAAI9F,QAAQ,GAAG,IAAI,CAACjC,OAAO,CAAC+H,eAAe,EAAE;IAC7C,IAAI9F,QAAQ,IAAIA,QAAQ,CAACyD,IAAI,IAAI,OAAOzD,QAAQ,CAACyD,IAAI,KAAK,UAAU,EAAE;MACrEzD,QAAQ,CAACyD,IAAI,CAAC,UAASsC,MAAM,EAAE;QAC9B,IAAIC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACD,MAAM,CAAC;QAClC,OAAOC,OAAO;MACf,CAAC,CAAC3G,IAAI,CAAC,IAAI,CAAC,CAAC;IACd,CAAC,MAAM,IAAIW,QAAQ,EAAE;MACpB,IAAIgG,OAAO,GAAG,IAAI,CAACA,OAAO,CAAChG,QAAQ,CAAC;MACpC,OAAOgG,OAAO;IACf;EACD;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCA,OAAO,CAAChG,QAAQ,EAAC;IAChB,IAAI,CAACA,QAAQ,CAACmD,MAAM,EAAE;MACrB,OAAO,CAAC,CAAC;IACV;IACA,IAAI5C,KAAK,GAAGP,QAAQ,CAAC,CAAC,CAAC;IACvB,IAAIiG,GAAG,GAAGjG,QAAQ,CAACA,QAAQ,CAACmD,MAAM,GAAC,CAAC,CAAC;IAErC,IAAI6C,OAAO,GAAG;MACbzF,KAAK,EAAE;QACN4F,KAAK,EAAE5F,KAAK,CAAC4F,KAAK;QAClBC,IAAI,EAAE7F,KAAK,CAAC6F,IAAI;QAChB9B,GAAG,EAAE/D,KAAK,CAACgG,OAAO,CAAChG,KAAK;QACxBwC,SAAS,EAAE;UACVyD,IAAI,EAAEjG,KAAK,CAACkG,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;UACzBC,KAAK,EAAEnG,KAAK,CAACoG;QACd;MACD,CAAC;MACDV,GAAG,EAAE;QACJE,KAAK,EAAEF,GAAG,CAACE,KAAK;QAChBC,IAAI,EAAEH,GAAG,CAACG,IAAI;QACd9B,GAAG,EAAE2B,GAAG,CAACM,OAAO,CAACN,GAAG;QACpBlD,SAAS,EAAE;UACVyD,IAAI,EAAEP,GAAG,CAACQ,KAAK,CAACR,GAAG,CAACQ,KAAK,CAACtD,MAAM,GAAC,CAAC,CAAC,IAAI,CAAC;UACxCuD,KAAK,EAAET,GAAG,CAACU;QACZ;MACD;IACD,CAAC;IAED,IAAIC,aAAa,GAAG,IAAI,CAACnJ,IAAI,CAACyF,SAAS,CAAC2D,eAAe,CAACtG,KAAK,CAACgG,OAAO,CAAChG,KAAK,CAAC;IAC5E,IAAIuG,WAAW,GAAG,IAAI,CAACrJ,IAAI,CAACyF,SAAS,CAAC2D,eAAe,CAACZ,GAAG,CAACM,OAAO,CAACN,GAAG,CAAC;IAEtE,IAAIW,aAAa,IAAI,IAAI,EAAE;MAC1BZ,OAAO,CAACzF,KAAK,CAACP,QAAQ,GAAG4G,aAAa;MACtCZ,OAAO,CAACzF,KAAK,CAAC8F,UAAU,GAAG,IAAI,CAAC5I,IAAI,CAACyF,SAAS,CAAC6D,sBAAsB,CAACH,aAAa,CAAC;IACrF;IACA,IAAIE,WAAW,IAAI,IAAI,EAAE;MACxBd,OAAO,CAACC,GAAG,CAACjG,QAAQ,GAAG8G,WAAW;MAClCd,OAAO,CAACC,GAAG,CAACI,UAAU,GAAG,IAAI,CAAC5I,IAAI,CAACyF,SAAS,CAAC6D,sBAAsB,CAACD,WAAW,CAAC;IACjF;IAEA,IAAIE,SAAS,GAAG,IAAI,CAACvJ,IAAI,CAACwJ,QAAQ,CAACC,WAAW,CAAC3G,KAAK,CAACgG,OAAO,CAAChG,KAAK,CAAC;IACnE,IAAI4G,OAAO,GAAG,IAAI,CAAC1J,IAAI,CAACwJ,QAAQ,CAACC,WAAW,CAACjB,GAAG,CAACM,OAAO,CAACN,GAAG,CAAC;IAE7D,IAAIe,SAAS,IAAI,CAAC,CAAC,EAAE;MACpBhB,OAAO,CAACzF,KAAK,CAACiG,IAAI,GAAGQ,SAAS;IAC/B;IACA,IAAIG,OAAO,IAAI,CAAC,CAAC,EAAE;MAClBnB,OAAO,CAACC,GAAG,CAACO,IAAI,GAAGW,OAAO;IAC3B;IAEA,IAAIlB,GAAG,CAACE,KAAK,KAAK,IAAI,CAAC1I,IAAI,CAAC+B,KAAK,CAAC4H,IAAI,EAAE,CAACjB,KAAK,IAC5CH,OAAO,CAACC,GAAG,CAAClD,SAAS,CAACyD,IAAI,IAAIR,OAAO,CAACC,GAAG,CAAClD,SAAS,CAAC2D,KAAK,EAAE;MAC5DV,OAAO,CAACqB,KAAK,GAAG,IAAI;IACrB;IAEA,IAAI9G,KAAK,CAAC4F,KAAK,KAAK,IAAI,CAAC1I,IAAI,CAAC+B,KAAK,CAAC8H,KAAK,EAAE,CAACnB,KAAK,IAC/CH,OAAO,CAACzF,KAAK,CAACwC,SAAS,CAACyD,IAAI,KAAK,CAAC,EAAE;MACrCR,OAAO,CAACuB,OAAO,GAAG,IAAI;IACvB;IAEA,OAAOvB,OAAO;EACf;;EAEA;AACD;AACA;EACCwB,OAAO,GAAE;IACR;IACA;IACA;;IAEA,IAAI,CAACzJ,OAAO,IAAI,IAAI,CAACA,OAAO,CAACyJ,OAAO,EAAE;IAEtC,IAAI,CAAC/J,IAAI,GAAGwC,SAAS;;IAErB;;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;;IAEA;IACA;;IAEA;;IAEA;IACA;EAGD;;EAEA;AACD;AACA;AACA;AACA;EACCX,UAAU,CAAC4E,QAAQ,EAAC;IACnB/G,UAAU,CAACsK,OAAO,CAAEC,CAAC,IAAK;MACzBxD,QAAQ,CAAC1C,EAAE,CAACkG,CAAC,EAAGC,EAAE,IAAK,IAAI,CAACC,gBAAgB,CAACD,EAAE,EAAEzD,QAAQ,CAAC,CAAC;IAC5D,CAAC,CAAC;IAEFA,QAAQ,CAAC1C,EAAE,CAACtE,MAAM,CAAC2K,QAAQ,CAACC,QAAQ,EAAGJ,CAAC,IAAK,IAAI,CAACK,oBAAoB,CAACL,CAAC,EAAExD,QAAQ,CAAC,CAAC;EACrF;;EAEA;AACD;AACA;AACA;AACA;EACC0D,gBAAgB,CAACF,CAAC,EAAExD,QAAQ,EAAC;IAC5B,IAAI,CAAC9B,IAAI,CAACsF,CAAC,CAACM,IAAI,EAAEN,CAAC,EAAExD,QAAQ,CAAC;EAC/B;;EAEA;AACD;AACA;AACA;AACA;EACC6D,oBAAoB,CAACE,QAAQ,EAAE/D,QAAQ,EAAC;IACvC;AACF;AACA;AACA;AACA;AACA;AACA;IACE,IAAI,CAAC9B,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACyF,QAAQ,EAAEG,QAAQ,EAAE/D,QAAQ,CAAC;EACzD;;EAEA;AACD;AACA;AACA;AACA;EACCD,gBAAgB,CAACF,QAAQ,EAAEC,IAAI,EAAEE,QAAQ,EAAC;IACzC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;IACE,IAAI,CAAC9B,IAAI,CAAClF,MAAM,CAACmF,SAAS,CAACyB,YAAY,EAAEC,QAAQ,EAAEC,IAAI,EAAEE,QAAQ,CAAC;EACnE;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCgE,QAAQ,CAAC5D,GAAG,EAAExG,WAAW,EAAC;IACzB,IAAIqK,IAAI,GAAG,IAAIvL,OAAO,CAAC0H,GAAG,CAAC;IAC3B,IAAI8D,KAAK,GAAG,IAAI,CAACrK,OAAO,CAACsK,OAAO,EAAE,CAACC,MAAM,CAAC,UAAUtK,IAAI,EAAE;MACzD,IAAGmK,IAAI,CAACI,QAAQ,KAAKvK,IAAI,CAACmI,KAAK,EAAE,OAAO,IAAI;IAC7C,CAAC,CAAC;;IAEF;IACA,IAAIiC,KAAK,CAACjF,MAAM,EAAE;MACjB,OAAOiF,KAAK,CAAC,CAAC,CAAC,CAAClE,QAAQ,CAACsE,KAAK,CAACL,IAAI,EAAErK,WAAW,CAAC;IAClD;EACD;;EAEA;AACD;AACA;AACA;AACA;EACCyB,YAAY,CAAC2E,QAAQ,EAAE;IAEtB,IAAI,IAAI,CAACc,OAAO,CAACyD,IAAI,KAAK,eAAe,EAAE;MAC1C,OAAO,IAAIC,OAAO,CAAC,UAASnG,OAAO,EAAC;QACnCA,OAAO,EAAE;MACV,CAAC,CAAC;IACH;IAEA,IAAIoG,QAAQ,GAAGzE,QAAQ,CAAC0E,MAAM,CAACC,gBAAgB,CAAC3E,QAAQ,CAACnF,OAAO,EAAE,IAAI,CAAC;IACvE,IAAIlB,MAAM,GAAG,CAACqG,QAAQ,CAACnF,OAAO,CAAC+J,YAAY,IAAIzF,UAAU,CAACsF,QAAQ,CAACI,UAAU,CAAC,GAAG1F,UAAU,CAACsF,QAAQ,CAACK,aAAa,CAAC,CAAC,IAAI,GAAG;IAC3H,IAAIC,iBAAiB,GAAG5F,UAAU,CAACsF,QAAQ,CAACO,WAAW,CAAC,GAAG7F,UAAU,CAACsF,QAAQ,CAACQ,YAAY,CAAC;IAE5FjF,QAAQ,CAACkF,kBAAkB,CAAC;MAC3B,KAAK,EAAG;QACP,WAAW,EAAE,CAAC,IAAI,CAACpE,OAAO,CAACqE,WAAW,GAAI,IAAI,CAACrE,OAAO,CAACqE,WAAW,GAAGJ,iBAAiB,GAAI,IAAI,GAAG,MAAM,IAAI,YAAY;QACvH,YAAY,EAAEpL,MAAM,GAAG,IAAI,GAAG,YAAY;QAC1C,YAAY,EAAE,SAAS;QACvB,mBAAmB,EAAE,OAAO;QAC5B,cAAc,EAAE,OAAO;QACvB,YAAY,EAAE;MACf,CAAC;MACD,KAAK,EAAG;QACP,WAAW,EAAE,CAAC,IAAI,CAACmH,OAAO,CAACqE,WAAW,GAAI,IAAI,CAACrE,OAAO,CAACqE,WAAW,GAAGJ,iBAAiB,GAAI,IAAI,GAAG,MAAM,IAAI,YAAY;QACvH,YAAY,EAAEpL,MAAM,GAAG,IAAI,GAAG,YAAY;QAC1C,mBAAmB,EAAE,OAAO;QAC5B,cAAc,EAAE;MACjB;IACD,CAAC,CAAC;IAEF,OAAO,IAAI6K,OAAO,CAAC,UAASnG,OAAO,EAAEgB,MAAM,EAAC;MAC3C;MACA+F,UAAU,CAAC,YAAW;QACrB/G,OAAO,EAAE;MACV,CAAC,EAAE,CAAC,CAAC;IACN,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;EACCgH,WAAW,GAAI;IACd,OAAO,IAAI,CAACxL,OAAO,GAAG,IAAI,CAACA,OAAO,CAACwL,WAAW,EAAE,GAAG,EAAE;EACtD;;EAEA;AACD;AACA;AACA;EACCC,KAAK,GAAI;IACR,IAAIA,KAAK,GAAG,IAAI,CAACzL,OAAO,GAAG,IAAI,CAACA,OAAO,CAACyL,KAAK,GAAGvJ,SAAS;IACzD,OAAOuJ,KAAK,IAAI,EAAE;EACnB;;EAEA;AACD;AACA;AACA;AACA;EACCpK,WAAW,CAAC8E,QAAQ,EAAE;IACrB,IAAIA,QAAQ,EAAE;MACbA,QAAQ,CAAC1C,EAAE,CAACtE,MAAM,CAAC2K,QAAQ,CAAC4B,YAAY,EAAGrD,IAAI,IAAK;QACnD,IAAIsD,QAAQ,GAAG,IAAI,CAACjM,IAAI,CAACkM,IAAI,CAACD,QAAQ,CAACtD,IAAI,CAAC;QAC5C,IAAI,CAACvH,OAAO,CAAC6K,QAAQ,CAAC;MACvB,CAAC,CAAC;IACH;EACD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACChK,gBAAgB,CAACkK,GAAG,EAAE5G,OAAO,EAAE;IAC9B,IAAI6G,KAAK,GAAGD,GAAG,CAACE,aAAa,CAAC,MAAM,CAAC;IACrCD,KAAK,CAACE,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC;IACtCF,KAAK,CAACE,YAAY,CAAC,KAAK,EAAE,YAAY,CAAC;IACvCF,KAAK,CAACE,YAAY,CAAC,MAAM,EAAE,IAAI,CAACpM,QAAQ,CAACU,UAAU,CAAC;IACpDuL,GAAG,CAACI,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAACC,WAAW,CAACJ,KAAK,CAAC;EACvD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACClK,YAAY,CAACiK,GAAG,EAAE5G,OAAO,EAAE;IAC1B,IAAIzE,MAAM,GAAGqL,GAAG,CAACE,aAAa,CAAC,QAAQ,CAAC;IACxCvL,MAAM,CAACwL,YAAY,CAAC,MAAM,EAAE,iBAAiB,CAAC;IAC9CxL,MAAM,CAACwL,YAAY,CAAC,KAAK,EAAE,IAAI,CAACpM,QAAQ,CAACY,MAAM,CAAC;IAChDA,MAAM,CAAC2L,WAAW,GAAG,GAAG,CAAC,CAAC;IAC1BN,GAAG,CAACI,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAACC,WAAW,CAAC1L,MAAM,CAAC;EACxD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACCkB,gBAAgB,CAACmK,GAAG,EAAE5G,OAAO,EAAE;IAC9B,IAAImH,KAAK,GAAG,IAAI,CAAC1M,IAAI,CAAC2M,SAAS,CAACtJ,QAAQ,CAACuJ,UAAU;IACnD,IAAIC,IAAI,GAAGV,GAAG,CAACE,aAAa,CAAC,MAAM,CAAC;IACpCQ,IAAI,CAACP,YAAY,CAAC,MAAM,EAAE,sBAAsB,CAAC;IACjD,IAAII,KAAK,EAAE;MACVG,IAAI,CAACP,YAAY,CAAC,SAAS,EAAEI,KAAK,CAAC;IACpC;IACAP,GAAG,CAACI,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAACC,WAAW,CAACK,IAAI,CAAC;EACtD;AAED;;AAEA;AACA/N,YAAY,CAACgB,SAAS,CAACgN,SAAS,CAAC;AAEjC,eAAehN,SAAS"},"metadata":{},"sourceType":"module"}