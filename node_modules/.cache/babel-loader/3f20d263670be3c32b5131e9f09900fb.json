{"ast":null,"code":"import _slicedToArray from\"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback,useRef}from'react';// style\nimport styles from'../../modules/epubViewer/styles';// types\nimport epub from'epubjs';/**\n * EpubViewer Module\n * @class\n * @param props\n * @param props.url Epub path\n * @param props.epubFileOptions Epub file option\n * @param props.epubOptions Epub viewer option\n * @param props.style Epub Wrapper style\n * @param props.location Epub CFI or href\n * @param props.bookChanged Run when book changed\n * @param props.rendtionChanged Run when rendition changed\n * @param props.pageChanged Run when page changed\n * @param props.tocChanged Run when toc changed\n * @param props.selectionChanged Run when selected\n * @param props.loadingView Loading Component\n * @param ref Viewer ref\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EpubViewer=function EpubViewer(_ref,ref){var _rendition$themes;var url=_ref.url,epubFileOptions=_ref.epubFileOptions,epubOptions=_ref.epubOptions,style=_ref.style,location=_ref.location,bookChanged=_ref.bookChanged,rendtionChanged=_ref.rendtionChanged,pageChanged=_ref.pageChanged,tocChanged=_ref.tocChanged,selectionChanged=_ref.selectionChanged,loadingView=_ref.loadingView;// TODO Fix the ref type correctly instead 'any' type.\nvar viewerStyle=style?_objectSpread(_objectSpread({},styles),style):styles;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoaded=_useState2[0],setIsLoaded=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),newBook=_useState4[0],setNewBook=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),book=_useState6[0],setBook=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),rendition=_useState8[0],setRendition=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),update=_useState10[0],setUpdate=_useState10[1];var currentCfi=useRef('');/**\n   * Move page\n   * @method\n   * @param type direction\n   */var movePage=useCallback(function(type){if(!rendition)return;if(type==='PREV')rendition.prev();else rendition.next();},[rendition,newBook]);/**\n   * Move page by arrow key\n   * @method\n   * @param props Keyboard Event\n   * @param props.key\n   */var handleKeyPress=useCallback(function(_ref2){var key=_ref2.key;key&&key==='ArrowLeft'&&movePage('PREV');key&&key==='ArrowRight'&&movePage('NEXT');},[movePage,newBook]);/**\n   * Run when location changed\n   * @method\n   * @param loc\n   * - Set location state\n   * - Run 'locationChanged()' through startCFI\n   */var onLocationChange=useCallback(function(loc){var startCfi=loc&&loc.start;var endCfi=loc&&loc.end;var base=loc&&loc.start.slice(8).split('!')[0];if(!book)return;var spineItem=book.spine.get(startCfi);var navItem=book.navigation.get(spineItem.href);var chapterName=navItem&&navItem.label.trim();var locations=book.locations;var currentPage=locations.locationFromCfi(startCfi);var totalPage=locations.total;pageChanged&&pageChanged({chapterName:chapterName,currentPage:currentPage,totalPage:totalPage,startCfi:startCfi,endCfi:endCfi,base:base});currentCfi.current=startCfi;},[book,pageChanged,newBook]);/**\n   * Highlight function\n   * @param cfiRange Selected CFIRange\n   * @param callback Highlight callback function when click it\n   * @param color Highlight color\n   */var onHighlight=useCallback(function(cfiRange,callback,color){if(!rendition)return;rendition.annotations.remove(cfiRange,'highlight');rendition.annotations.highlight(cfiRange,{},callback,'epub-highlight',{fill:color||'#fdf183'});},[rendition]);/**\n   * Highlight remove function\n   * @param cfiRange Selected CFIRange\n   */var onRemoveHighlight=useCallback(function(cfiRange){if(!rendition)return;rendition.annotations.remove(cfiRange,'highlight');},[rendition,newBook]);/**\n   * Register viewer control function\n   * @method\n   * - REF.CURRENT.prevPage() : Move prev page\n   * - REF.CURRENT.nextPage() : Move next page\n   * - REF.CURRENT.getCurrentCfi() : Get current CFI\n   * - REF.CURRENT.onHighlight(): Set highlight\n   * - REF.CURRENT.offHighlight(): Remove specific highliht\n   * - REF.CURRENT.seLocation(): Move to specific cfi or href\n   */var registerGlobalFunc=useCallback(function(){if(!ref.current)return;if(movePage){ref.current.prevPage=function(){return movePage('PREV');};ref.current.nextPage=function(){return movePage('NEXT');};}ref.current.getCurrentCfi=function(){return currentCfi.current;};if(onHighlight){ref.current.onHighlight=onHighlight;}if(onRemoveHighlight){ref.current.offHighlight=onRemoveHighlight;}if(rendition){ref.current.setLocation=function(location){return rendition.display(location);};}},[ref,rendition,movePage,onHighlight,onRemoveHighlight,newBook]);/** Ref Checker */useEffect(function(){if(!ref){throw new Error('[React-Epub-Viewer] Put a ref argument that has a ViewerRef type.');}},[ref]);/** Epub init options Changed */useEffect(function(){// if (!url) return;\nvar mounted=true;var book_=null;// if (!mounted) return;\nif(book_){book_.destroy();}// @ts-ignore\nbook_=epub(newBook,epubOptions);console.log(newBook,'newBook');// @ts-ignore\nbook===null||book===void 0?void 0:book.open(newBook,'binary');setBook(book_);setTimeout(function(){setUpdate(function(update){return!update;});},2000);return function(){mounted=false;};},[url,epubFileOptions,setBook,setIsLoaded,newBook]);rendition===null||rendition===void 0?void 0:(_rendition$themes=rendition.themes)===null||_rendition$themes===void 0?void 0:_rendition$themes.font('Fira code');/** Book Changed */useEffect(function(){if(!book)return;if(bookChanged)bookChanged(book);book.loaded.navigation.then(function(_ref3){var toc=_ref3.toc;var toc_=toc.map(function(t){return{label:t.label,href:t.href};});setIsLoaded(true);if(tocChanged)tocChanged(toc_);});book.ready.then(function(){if(!book)return;var stored=localStorage.getItem(book.key()+'-locations');if(stored){return book.locations.load(stored);}else{return book.locations.generate(1024);}}).then(function(){if(!book)return;localStorage.setItem(book.key()+'-locations',book.locations.save());});},[book,bookChanged,tocChanged,update,newBook]);/** Rendition Changed */useEffect(function(){if(!rendition)return;if(rendtionChanged)rendtionChanged(rendition);},[rendition,rendtionChanged,update]);/** Viewer Option Changed */useEffect(function(){var mounted=true;if(!book)return;var node=ref.current;if(!node)return;node.innerHTML='';book.ready.then(function(){if(!mounted)return;if(book.spine){var _book$rendition,_book$rendition$locat,_book$rendition$locat2;var loc=(_book$rendition=book.rendition)===null||_book$rendition===void 0?void 0:(_book$rendition$locat=_book$rendition.location)===null||_book$rendition$locat===void 0?void 0:(_book$rendition$locat2=_book$rendition$locat.start)===null||_book$rendition$locat2===void 0?void 0:_book$rendition$locat2.cfi;// if (book.rendition) book.rendition.destroy();\nvar rendition_=book.renderTo(node,_objectSpread({width:'100%',height:'100%'},epubOptions));setRendition(rendition_);if(loc){rendition_.display(loc);}else{rendition_.display();}}});return function(){mounted=false;};},[ref,book,epubOptions,style,setRendition,update]);/** Location Changed */useEffect(function(){if(!ref.current||!location)return;if(ref.current.setLocation)ref.current.setLocation(location);},[ref,location,update]);/**\n   * Emit Viewer Event\n   * - Register move event\n   * - Register location changed event\n   * - Register selection event\n   */ /* eslint-disable */useEffect(function(){if(!rendition)return;// Emit global control function\nregisterGlobalFunc();document.addEventListener('keyup',handleKeyPress,false);rendition.on('keyup',handleKeyPress);rendition.on('locationChanged',onLocationChange);selectionChanged&&rendition.on('selected',selectionChanged);return function(){document.removeEventListener('keyup',handleKeyPress,false);rendition.off('keyup',handleKeyPress);rendition.off('locationChanged',onLocationChange);selectionChanged&&rendition.off('selected',selectionChanged);};},[rendition,registerGlobalFunc,handleKeyPress,update]);/* eslint-enable */var openBook=function openBook(e){setNewBook(e.target.result);};var changeShit=function changeShit(e){var _e$target;var file=e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:_e$target.files[0];if(window.FileReader){var reader=new FileReader();reader.onload=openBook;reader.readAsArrayBuffer(file);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{style:{position:\"absolute\",right:'-320px',zIndex:'20'},onChange:changeShit,id:\"input\",type:\"file\"}),!isLoaded&&loadingView,/*#__PURE__*/_jsx(\"div\",{ref:ref,style:viewerStyle})]});};export default/*#__PURE__*/React.forwardRef(EpubViewer);","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","styles","epub","EpubViewer","ref","url","epubFileOptions","epubOptions","style","location","bookChanged","rendtionChanged","pageChanged","tocChanged","selectionChanged","loadingView","viewerStyle","isLoaded","setIsLoaded","newBook","setNewBook","book","setBook","rendition","setRendition","update","setUpdate","currentCfi","movePage","type","prev","next","handleKeyPress","key","onLocationChange","loc","startCfi","start","endCfi","end","base","slice","split","spineItem","spine","get","navItem","navigation","href","chapterName","label","trim","locations","currentPage","locationFromCfi","totalPage","total","current","onHighlight","cfiRange","callback","color","annotations","remove","highlight","fill","onRemoveHighlight","registerGlobalFunc","prevPage","nextPage","getCurrentCfi","offHighlight","setLocation","display","Error","mounted","book_","destroy","console","log","open","setTimeout","themes","font","loaded","then","toc","toc_","map","t","ready","stored","localStorage","getItem","load","generate","setItem","save","node","innerHTML","cfi","rendition_","renderTo","width","height","document","addEventListener","on","removeEventListener","off","openBook","e","target","result","changeShit","file","files","window","FileReader","reader","onload","readAsArrayBuffer","position","right","zIndex","forwardRef"],"sources":["/home/parallels/Downloads/read/src/react-viewer/modules/epubViewer/EpubViewer.tsx"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useCallback,\n  useRef,\n  CSSProperties,\n} from 'react';\nimport { Book, Rendition } from 'epubjs';\n// style\nimport styles from '../../modules/epubViewer/styles';\n// types\nimport { EpubViewerProps, ViewerRef } from 'types';\nimport Toc from 'types/toc';\nimport Loc from 'types/loc';\nimport epub from 'epubjs';\n\n/**\n * EpubViewer Module\n * @class\n * @param props\n * @param props.url Epub path\n * @param props.epubFileOptions Epub file option\n * @param props.epubOptions Epub viewer option\n * @param props.style Epub Wrapper style\n * @param props.location Epub CFI or href\n * @param props.bookChanged Run when book changed\n * @param props.rendtionChanged Run when rendition changed\n * @param props.pageChanged Run when page changed\n * @param props.tocChanged Run when toc changed\n * @param props.selectionChanged Run when selected\n * @param props.loadingView Loading Component\n * @param ref Viewer ref\n */\nconst EpubViewer = (\n  {\n    url,\n    epubFileOptions,\n    epubOptions,\n    style,\n    location,\n    bookChanged,\n    rendtionChanged,\n    pageChanged,\n    tocChanged,\n    selectionChanged,\n    loadingView,\n  }: EpubViewerProps,\n  ref: React.RefObject<ViewerRef> | any,\n) => {\n  // TODO Fix the ref type correctly instead 'any' type.\n  const viewerStyle: CSSProperties = style ? { ...styles, ...style } : styles;\n\n  const [isLoaded, setIsLoaded] = useState(false);\nconst [newBook, setNewBook] = useState(null)\n  const [book, setBook] = useState<Book | null>(null);\n\n  const [rendition, setRendition] = useState<Rendition | null>(null);\n  const [update, setUpdate] = useState(false)\n\n  const currentCfi = useRef<string>('');\n\n  /**\n   * Move page\n   * @method\n   * @param type direction\n   */\n  const movePage = useCallback(\n    (type: 'PREV' | 'NEXT') => {\n      if (!rendition) return;\n      if (type === 'PREV') rendition.prev();\n      else rendition.next();\n    },\n    [rendition, newBook],\n  );\n\n  /**\n   * Move page by arrow key\n   * @method\n   * @param props Keyboard Event\n   * @param props.key\n   */\n  const handleKeyPress = useCallback(\n    ({ key }: any) => {\n      key && key === 'ArrowLeft' && movePage('PREV');\n      key && key === 'ArrowRight' && movePage('NEXT');\n    },\n    [movePage, newBook],\n  );\n\n  /**\n   * Run when location changed\n   * @method\n   * @param loc\n   * - Set location state\n   * - Run 'locationChanged()' through startCFI\n   */\n  const onLocationChange = useCallback(\n    (loc: Loc) => {\n      const startCfi = loc && loc.start;\n      const endCfi = loc && loc.end;\n      const base = loc && loc.start.slice(8).split('!')[0];\n\n      if (!book) return;\n\n      const spineItem = book.spine.get(startCfi);\n      const navItem = book.navigation.get(spineItem.href);\n      const chapterName = navItem && navItem.label.trim();\n\n      const locations: any = book.locations;\n      const currentPage = locations.locationFromCfi(startCfi);\n      const totalPage = locations.total;\n\n      pageChanged &&\n        pageChanged({\n          chapterName,\n          currentPage,\n          totalPage,\n          startCfi,\n          endCfi,\n          base,\n        });\n\n      currentCfi.current = startCfi;\n    },\n    [book, pageChanged, newBook],\n  );\n\n  /**\n   * Highlight function\n   * @param cfiRange Selected CFIRange\n   * @param callback Highlight callback function when click it\n   * @param color Highlight color\n   */\n  const onHighlight = useCallback(\n    (cfiRange: string, callback?: (e: any) => void, color?: string) => {\n      if (!rendition) return;\n\n      rendition.annotations.remove(cfiRange, 'highlight');\n      rendition.annotations.highlight(\n        cfiRange,\n        {},\n        callback,\n        'epub-highlight',\n        {\n          fill: color || '#fdf183',\n        },\n      );\n    },\n    [rendition],\n  );\n\n  /**\n   * Highlight remove function\n   * @param cfiRange Selected CFIRange\n   */\n  const onRemoveHighlight = useCallback(\n    (cfiRange: string) => {\n      if (!rendition) return;\n\n      rendition.annotations.remove(cfiRange, 'highlight');\n    },\n    [rendition, newBook],\n  );\n\n  /**\n   * Register viewer control function\n   * @method\n   * - REF.CURRENT.prevPage() : Move prev page\n   * - REF.CURRENT.nextPage() : Move next page\n   * - REF.CURRENT.getCurrentCfi() : Get current CFI\n   * - REF.CURRENT.onHighlight(): Set highlight\n   * - REF.CURRENT.offHighlight(): Remove specific highliht\n   * - REF.CURRENT.seLocation(): Move to specific cfi or href\n   */\n  const registerGlobalFunc = useCallback(() => {\n    if (!ref.current) return;\n    if (movePage) {\n      ref.current.prevPage = () => movePage('PREV');\n      ref.current.nextPage = () => movePage('NEXT');\n    }\n    ref.current.getCurrentCfi = () => currentCfi.current;\n    if (onHighlight) {\n      ref.current.onHighlight = onHighlight;\n    }\n    if (onRemoveHighlight) {\n      ref.current.offHighlight = onRemoveHighlight;\n    }\n    if (rendition) {\n      ref.current.setLocation = (location: string) =>\n        rendition.display(location);\n    }\n  }, [ref, rendition, movePage, onHighlight, onRemoveHighlight, newBook]);\n\n  /** Ref Checker */\n  useEffect(() => {\n    if (!ref) {\n      throw new Error(\n        '[React-Epub-Viewer] Put a ref argument that has a ViewerRef type.',\n      );\n    }\n  }, [ref]);\n\n  /** Epub init options Changed */\n  useEffect(() => {\n    // if (!url) return;\n\n    let mounted: boolean = true;\n    let book_: Book | any = null;\n\n    // if (!mounted) return;\n\n    if (book_) {\n      book_.destroy();\n    }\n\n// @ts-ignore\n    book_ = epub(newBook,epubOptions);\n    console.log(newBook, 'newBook')\n    // @ts-ignore\n    book?.open(newBook, 'binary')\n    setBook(book_);\n    setTimeout(() => {\n      setUpdate((update) => !update)\n    }, 2000);\n  \n   \n\n    return () => {\n      mounted = false;\n    };\n  }, [url, epubFileOptions, setBook, setIsLoaded, newBook]);\n rendition?.themes?.font('Fira code')\n  /** Book Changed */\n  useEffect(() => {\n    if (!book) return;\n\n    if (bookChanged) bookChanged(book);\n\n    book.loaded.navigation.then(({ toc }) => {\n      const toc_: Toc[] = toc.map(t => ({\n        label: t.label,\n        href: t.href,\n      }));\n\n      setIsLoaded(true);\n      if (tocChanged) tocChanged(toc_);\n    });\n\n    book.ready\n      .then(function () {\n        if (!book) return;\n\n        const stored = localStorage.getItem(book.key() + '-locations');\n        if (stored) {\n          return book.locations.load(stored);\n        } else {\n          return book.locations.generate(1024);\n        }\n      })\n      .then(() => {\n        if (!book) return;\n        localStorage.setItem(book.key() + '-locations', book.locations.save());\n      });\n  }, [book, bookChanged, tocChanged, update, newBook]);\n\n  /** Rendition Changed */\n  useEffect(() => {\n    if (!rendition) return;\n\n    if (rendtionChanged) rendtionChanged(rendition);\n  }, [rendition, rendtionChanged, update]);\n\n  /** Viewer Option Changed */\n  useEffect(() => {\n    let mounted = true;\n    if (!book) return;\n\n    const node = ref.current;\n    if (!node) return;\n    node.innerHTML = '';\n\n    book.ready.then(function () {\n      if (!mounted) return;\n\n      if (book.spine) {\n        const loc = book.rendition?.location?.start?.cfi;\n\n        // if (book.rendition) book.rendition.destroy();\n\n        const rendition_ = book.renderTo(node, {\n          width: '100%',\n          height: '100%',\n          ...epubOptions,\n        });\n        setRendition(rendition_);\n\n        if (loc) {\n          rendition_.display(loc);\n        } else {\n          rendition_.display();\n        }\n      }\n    });\n\n    return () => {\n      mounted = false;\n    };\n  }, [ref, book, epubOptions, style, setRendition, update]);\n\n  /** Location Changed */\n  useEffect(() => {\n    if (!ref.current || !location) return;\n    if (ref.current.setLocation) ref.current.setLocation(location);\n  }, [ref, location, update]);\n\n  /**\n   * Emit Viewer Event\n   * - Register move event\n   * - Register location changed event\n   * - Register selection event\n   */\n  /* eslint-disable */\n  useEffect(() => {\n    if (!rendition) return;\n\n    // Emit global control function\n    registerGlobalFunc();\n\n    document.addEventListener('keyup', handleKeyPress, false);\n    rendition.on('keyup', handleKeyPress);\n    rendition.on('locationChanged', onLocationChange);\n    selectionChanged && rendition.on('selected', selectionChanged);\n\n    return () => {\n      document.removeEventListener('keyup', handleKeyPress, false);\n      rendition.off('keyup', handleKeyPress);\n      rendition.off('locationChanged', onLocationChange);\n      selectionChanged && rendition.off('selected', selectionChanged);\n    };\n  }, [rendition, registerGlobalFunc, handleKeyPress, update]);\n  /* eslint-enable */\n  const openBook = (e: any) => {\n    setNewBook(e.target.result)\n}\n\n\nconst changeShit = (e:any) =>{\n  var file = e?.target?.files[0];\n\n  if (window.FileReader) {\n      var reader = new FileReader();\n      reader.onload = openBook;\n      reader.readAsArrayBuffer(file);\n  }\n\n}\n\n\n  return (\n    <>\n     <input style={{position:\"absolute\", right:'-320px', zIndex: '20'}} onChange={changeShit} id='input' type='file' />\n      {!isLoaded && loadingView}\n      <div ref={ref} style={viewerStyle} />\n    </>\n  );\n};\n\nexport default React.forwardRef(EpubViewer);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}