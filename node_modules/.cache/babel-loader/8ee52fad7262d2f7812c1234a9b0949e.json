{"ast":null,"code":"import EventEmitter from \"event-emitter\";\nimport { isNumber, prefixed, borders, defaults } from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport { replaceLinks } from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\nconst hasNavigator = typeof navigator !== \"undefined\";\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nclass Contents {\n  constructor(doc, content, cfiBase, sectionIndex) {\n    // Blank Cfi for Parsing\n    this.epubcfi = new EpubCFI();\n    this.document = doc;\n    this.documentElement = this.document.documentElement;\n    this.content = content || this.document.body;\n    this.window = this.document.defaultView;\n    this._size = {\n      width: 0,\n      height: 0\n    };\n    this.sectionIndex = sectionIndex || 0;\n    this.cfiBase = cfiBase || \"\";\n    this.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n    this.called = 0;\n    this.active = true;\n    this.listeners();\n  }\n\n  /**\n  \t* Get DOM events that are listened for and passed along\n  \t*/\n  static get listenedEvents() {\n    return DOM_EVENTS;\n  }\n\n  /**\n  \t* Get or Set width\n  \t* @param {number} [w]\n  \t* @returns {number} width\n  \t*/\n  width(w) {\n    // var frame = this.documentElement;\n    var frame = this.content;\n    if (w && isNumber(w)) {\n      w = w + \"px\";\n    }\n    if (w) {\n      frame.style.width = w;\n      // this.content.style.width = w;\n    }\n\n    return parseInt(this.window.getComputedStyle(frame)[\"width\"]);\n  }\n\n  /**\n  \t* Get or Set height\n  \t* @param {number} [h]\n  \t* @returns {number} height\n  \t*/\n  height(h) {\n    // var frame = this.documentElement;\n    var frame = this.content;\n    if (h && isNumber(h)) {\n      h = h + \"px\";\n    }\n    if (h) {\n      frame.style.height = h;\n      // this.content.style.height = h;\n    }\n\n    return parseInt(this.window.getComputedStyle(frame)[\"height\"]);\n  }\n\n  /**\n  \t* Get or Set width of the contents\n  \t* @param {number} [w]\n  \t* @returns {number} width\n  \t*/\n  contentWidth(w) {\n    var content = this.content || this.document.body;\n    if (w && isNumber(w)) {\n      w = w + \"px\";\n    }\n    if (w) {\n      content.style.width = w;\n    }\n    return parseInt(this.window.getComputedStyle(content)[\"width\"]);\n  }\n\n  /**\n  \t* Get or Set height of the contents\n  \t* @param {number} [h]\n  \t* @returns {number} height\n  \t*/\n  contentHeight(h) {\n    var content = this.content || this.document.body;\n    if (h && isNumber(h)) {\n      h = h + \"px\";\n    }\n    if (h) {\n      content.style.height = h;\n    }\n    return parseInt(this.window.getComputedStyle(content)[\"height\"]);\n  }\n\n  /**\n  \t* Get the width of the text using Range\n  \t* @returns {number} width\n  \t*/\n  textWidth() {\n    let rect;\n    let width;\n    let range = this.document.createRange();\n    let content = this.content || this.document.body;\n    let border = borders(content);\n\n    // Select the contents of frame\n    range.selectNodeContents(content);\n\n    // get the width of the text content\n    rect = range.getBoundingClientRect();\n    width = rect.width;\n    if (border && border.width) {\n      width += border.width;\n    }\n    return Math.round(width);\n  }\n\n  /**\n  \t* Get the height of the text using Range\n  \t* @returns {number} height\n  \t*/\n  textHeight() {\n    let rect;\n    let height;\n    let range = this.document.createRange();\n    let content = this.content || this.document.body;\n    range.selectNodeContents(content);\n    rect = range.getBoundingClientRect();\n    height = rect.bottom;\n    return Math.round(height);\n  }\n\n  /**\n  \t* Get documentElement scrollWidth\n  \t* @returns {number} width\n  \t*/\n  scrollWidth() {\n    var width = this.documentElement.scrollWidth;\n    return width;\n  }\n\n  /**\n  \t* Get documentElement scrollHeight\n  \t* @returns {number} height\n  \t*/\n  scrollHeight() {\n    var height = this.documentElement.scrollHeight;\n    return height;\n  }\n\n  /**\n  \t* Set overflow css style of the contents\n  \t* @param {string} [overflow]\n  \t*/\n  overflow(overflow) {\n    if (overflow) {\n      this.documentElement.style.overflow = overflow;\n    }\n    return this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n  }\n\n  /**\n  \t* Set overflowX css style of the documentElement\n  \t* @param {string} [overflow]\n  \t*/\n  overflowX(overflow) {\n    if (overflow) {\n      this.documentElement.style.overflowX = overflow;\n    }\n    return this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n  }\n\n  /**\n  \t* Set overflowY css style of the documentElement\n  \t* @param {string} [overflow]\n  \t*/\n  overflowY(overflow) {\n    if (overflow) {\n      this.documentElement.style.overflowY = overflow;\n    }\n    return this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n  }\n\n  /**\n  \t* Set Css styles on the contents element (typically Body)\n  \t* @param {string} property\n  \t* @param {string} value\n  \t* @param {boolean} [priority] set as \"important\"\n  \t*/\n  css(property, value, priority) {\n    var content = this.content || this.document.body;\n    if (value) {\n      content.style.setProperty(property, value, priority ? \"important\" : \"\");\n    } else {\n      content.style.removeProperty(property);\n    }\n    return this.window.getComputedStyle(content)[property];\n  }\n\n  /**\n  \t* Get or Set the viewport element\n  \t* @param {object} [options]\n  \t* @param {string} [options.width]\n  \t* @param {string} [options.height]\n  \t* @param {string} [options.scale]\n  \t* @param {string} [options.minimum]\n  \t* @param {string} [options.maximum]\n  \t* @param {string} [options.scalable]\n  \t*/\n  viewport(options) {\n    var _width, _height, _scale, _minimum, _maximum, _scalable;\n    // var width, height, scale, minimum, maximum, scalable;\n    var $viewport = this.document.querySelector(\"meta[name='viewport']\");\n    var parsed = {\n      \"width\": undefined,\n      \"height\": undefined,\n      \"scale\": undefined,\n      \"minimum\": undefined,\n      \"maximum\": undefined,\n      \"scalable\": undefined\n    };\n    var newContent = [];\n    var settings = {};\n\n    /*\n    * check for the viewport size\n    * <meta name=\"viewport\" content=\"width=1024,height=697\" />\n    */\n    if ($viewport && $viewport.hasAttribute(\"content\")) {\n      let content = $viewport.getAttribute(\"content\");\n      let _width = content.match(/width\\s*=\\s*([^,]*)/);\n      let _height = content.match(/height\\s*=\\s*([^,]*)/);\n      let _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n      let _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n      let _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n      let _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n      if (_width && _width.length && typeof _width[1] !== \"undefined\") {\n        parsed.width = _width[1];\n      }\n      if (_height && _height.length && typeof _height[1] !== \"undefined\") {\n        parsed.height = _height[1];\n      }\n      if (_scale && _scale.length && typeof _scale[1] !== \"undefined\") {\n        parsed.scale = _scale[1];\n      }\n      if (_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\") {\n        parsed.minimum = _minimum[1];\n      }\n      if (_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\") {\n        parsed.maximum = _maximum[1];\n      }\n      if (_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\") {\n        parsed.scalable = _scalable[1];\n      }\n    }\n    settings = defaults(options || {}, parsed);\n    if (options) {\n      if (settings.width) {\n        newContent.push(\"width=\" + settings.width);\n      }\n      if (settings.height) {\n        newContent.push(\"height=\" + settings.height);\n      }\n      if (settings.scale) {\n        newContent.push(\"initial-scale=\" + settings.scale);\n      }\n      if (settings.scalable === \"no\") {\n        newContent.push(\"minimum-scale=\" + settings.scale);\n        newContent.push(\"maximum-scale=\" + settings.scale);\n        newContent.push(\"user-scalable=\" + settings.scalable);\n      } else {\n        if (settings.scalable) {\n          newContent.push(\"user-scalable=\" + settings.scalable);\n        }\n        if (settings.minimum) {\n          newContent.push(\"minimum-scale=\" + settings.minimum);\n        }\n        if (settings.maximum) {\n          newContent.push(\"minimum-scale=\" + settings.maximum);\n        }\n      }\n      if (!$viewport) {\n        $viewport = this.document.createElement(\"meta\");\n        $viewport.setAttribute(\"name\", \"viewport\");\n        this.document.querySelector(\"head\").appendChild($viewport);\n      }\n      $viewport.setAttribute(\"content\", newContent.join(\", \"));\n      this.window.scrollTo(0, 0);\n    }\n    return settings;\n  }\n\n  /**\n   * Event emitter for when the contents has expanded\n   * @private\n   */\n  expand() {\n    this.emit(EVENTS.CONTENTS.EXPAND);\n  }\n\n  /**\n   * Add DOM listeners\n   * @private\n   */\n  listeners() {\n    this.imageLoadListeners();\n    this.mediaQueryListeners();\n\n    // this.fontLoadListeners();\n\n    this.addEventListeners();\n    this.addSelectionListeners();\n\n    // this.transitionListeners();\n\n    if (typeof ResizeObserver === \"undefined\") {\n      this.resizeListeners();\n      this.visibilityListeners();\n    } else {\n      this.resizeObservers();\n    }\n\n    // this.mutationObservers();\n\n    this.linksHandler();\n  }\n\n  /**\n   * Remove DOM listeners\n   * @private\n   */\n  removeListeners() {\n    this.removeEventListeners();\n    this.removeSelectionListeners();\n    if (this.observer) {\n      this.observer.disconnect();\n    }\n    clearTimeout(this.expanding);\n  }\n\n  /**\n   * Check if size of contents has changed and\n   * emit 'resize' event if it has.\n   * @private\n   */\n  resizeCheck() {\n    let width = this.textWidth();\n    let height = this.textHeight();\n    if (width != this._size.width || height != this._size.height) {\n      this._size = {\n        width: width,\n        height: height\n      };\n      this.onResize && this.onResize(this._size);\n      this.emit(EVENTS.CONTENTS.RESIZE, this._size);\n    }\n  }\n\n  /**\n   * Poll for resize detection\n   * @private\n   */\n  resizeListeners() {\n    var width, height;\n    // Test size again\n    clearTimeout(this.expanding);\n    requestAnimationFrame(this.resizeCheck.bind(this));\n    this.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n  }\n\n  /**\n   * Listen for visibility of tab to change\n   * @private\n   */\n  visibilityListeners() {\n    document.addEventListener(\"visibilitychange\", () => {\n      if (document.visibilityState === \"visible\" && this.active === false) {\n        this.active = true;\n        this.resizeListeners();\n      } else {\n        this.active = false;\n        clearTimeout(this.expanding);\n      }\n    });\n  }\n\n  /**\n   * Use css transitions to detect resize\n   * @private\n   */\n  transitionListeners() {\n    let body = this.content;\n    body.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n    body.style['transitionDuration'] = \"0.001ms\";\n    body.style['transitionTimingFunction'] = \"linear\";\n    body.style['transitionDelay'] = \"0\";\n    this._resizeCheck = this.resizeCheck.bind(this);\n    this.document.addEventListener('transitionend', this._resizeCheck);\n  }\n\n  /**\n   * Listen for media query changes and emit 'expand' event\n   * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n   * @private\n   */\n  mediaQueryListeners() {\n    var sheets = this.document.styleSheets;\n    var mediaChangeHandler = function (m) {\n      if (m.matches && !this._expanding) {\n        setTimeout(this.expand.bind(this), 1);\n      }\n    }.bind(this);\n    for (var i = 0; i < sheets.length; i += 1) {\n      var rules;\n      // Firefox errors if we access cssRules cross-domain\n      try {\n        rules = sheets[i].cssRules;\n      } catch (e) {\n        return;\n      }\n      if (!rules) return; // Stylesheets changed\n      for (var j = 0; j < rules.length; j += 1) {\n        //if (rules[j].constructor === CSSMediaRule) {\n        if (rules[j].media) {\n          var mql = this.window.matchMedia(rules[j].media.mediaText);\n          mql.addListener(mediaChangeHandler);\n          //mql.onchange = mediaChangeHandler;\n        }\n      }\n    }\n  }\n\n  /**\n   * Use ResizeObserver to listen for changes in the DOM and check for resize\n   * @private\n   */\n  resizeObservers() {\n    // create an observer instance\n    this.observer = new ResizeObserver(e => {\n      requestAnimationFrame(this.resizeCheck.bind(this));\n    });\n\n    // pass in the target node\n    this.observer.observe(this.document.documentElement);\n  }\n\n  /**\n   * Use MutationObserver to listen for changes in the DOM and check for resize\n   * @private\n   */\n  mutationObservers() {\n    // create an observer instance\n    this.observer = new MutationObserver(mutations => {\n      this.resizeCheck();\n    });\n\n    // configuration of the observer:\n    let config = {\n      attributes: true,\n      childList: true,\n      characterData: true,\n      subtree: true\n    };\n\n    // pass in the target node, as well as the observer options\n    this.observer.observe(this.document, config);\n  }\n\n  /**\n   * Test if images are loaded or add listener for when they load\n   * @private\n   */\n  imageLoadListeners() {\n    var images = this.document.querySelectorAll(\"img\");\n    var img;\n    for (var i = 0; i < images.length; i++) {\n      img = images[i];\n      if (typeof img.naturalWidth !== \"undefined\" && img.naturalWidth === 0) {\n        img.onload = this.expand.bind(this);\n      }\n    }\n  }\n\n  /**\n   * Listen for font load and check for resize when loaded\n   * @private\n   */\n  fontLoadListeners() {\n    if (!this.document || !this.document.fonts) {\n      return;\n    }\n    this.document.fonts.ready.then(function () {\n      this.resizeCheck();\n    }.bind(this));\n  }\n\n  /**\n   * Get the documentElement\n   * @returns {element} documentElement\n   */\n  root() {\n    if (!this.document) return null;\n    return this.document.documentElement;\n  }\n\n  /**\n   * Get the location offset of a EpubCFI or an #id\n   * @param {string | EpubCFI} target\n   * @param {string} [ignoreClass] for the cfi\n   * @returns { {left: Number, top: Number }\n   */\n  locationOf(target, ignoreClass) {\n    var position;\n    var targetPos = {\n      \"left\": 0,\n      \"top\": 0\n    };\n    if (!this.document) return targetPos;\n    if (this.epubcfi.isCfiString(target)) {\n      let range = new EpubCFI(target).toRange(this.document, ignoreClass);\n      if (range) {\n        try {\n          if (!range.endContainer || range.startContainer == range.endContainer && range.startOffset == range.endOffset) {\n            // If the end for the range is not set, it results in collapsed becoming\n            // true. This in turn leads to inconsistent behaviour when calling\n            // getBoundingRect. Wrong bounds lead to the wrong page being displayed.\n            // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/\n            let pos = range.startContainer.textContent.indexOf(\" \", range.startOffset);\n            if (pos == -1) {\n              pos = range.startContainer.textContent.length;\n            }\n            range.setEnd(range.startContainer, pos);\n          }\n        } catch (e) {\n          console.error(\"setting end offset to start container length failed\", e);\n        }\n        if (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n          position = range.startContainer.getBoundingClientRect();\n          targetPos.left = position.left;\n          targetPos.top = position.top;\n        } else {\n          // Webkit does not handle collapsed range bounds correctly\n          // https://bugs.webkit.org/show_bug.cgi?id=138949\n\n          // Construct a new non-collapsed range\n          if (isWebkit) {\n            let container = range.startContainer;\n            let newRange = new Range();\n            try {\n              if (container.nodeType === ELEMENT_NODE) {\n                position = container.getBoundingClientRect();\n              } else if (range.startOffset + 2 < container.length) {\n                newRange.setStart(container, range.startOffset);\n                newRange.setEnd(container, range.startOffset + 2);\n                position = newRange.getBoundingClientRect();\n              } else if (range.startOffset - 2 > 0) {\n                newRange.setStart(container, range.startOffset - 2);\n                newRange.setEnd(container, range.startOffset);\n                position = newRange.getBoundingClientRect();\n              } else {\n                // empty, return the parent element\n                position = container.parentNode.getBoundingClientRect();\n              }\n            } catch (e) {\n              console.error(e, e.stack);\n            }\n          } else {\n            position = range.getBoundingClientRect();\n          }\n        }\n      }\n    } else if (typeof target === \"string\" && target.indexOf(\"#\") > -1) {\n      let id = target.substring(target.indexOf(\"#\") + 1);\n      let el = this.document.getElementById(id);\n      if (el) {\n        if (isWebkit) {\n          // Webkit reports incorrect bounding rects in Columns\n          let newRange = new Range();\n          newRange.selectNode(el);\n          position = newRange.getBoundingClientRect();\n        } else {\n          position = el.getBoundingClientRect();\n        }\n      }\n    }\n    if (position) {\n      targetPos.left = position.left;\n      targetPos.top = position.top;\n    }\n    return targetPos;\n  }\n\n  /**\n   * Append a stylesheet link to the document head\n   * @param {string} src url\n   */\n  addStylesheet(src) {\n    return new Promise(function (resolve, reject) {\n      var $stylesheet;\n      var ready = false;\n      if (!this.document) {\n        resolve(false);\n        return;\n      }\n\n      // Check if link already exists\n      $stylesheet = this.document.querySelector(\"link[href='\" + src + \"']\");\n      if ($stylesheet) {\n        resolve(true);\n        return; // already present\n      }\n\n      $stylesheet = this.document.createElement(\"link\");\n      $stylesheet.type = \"text/css\";\n      $stylesheet.rel = \"stylesheet\";\n      $stylesheet.href = src;\n      $stylesheet.onload = $stylesheet.onreadystatechange = function () {\n        if (!ready && (!this.readyState || this.readyState == \"complete\")) {\n          ready = true;\n          // Let apply\n          setTimeout(() => {\n            resolve(true);\n          }, 1);\n        }\n      };\n      this.document.head.appendChild($stylesheet);\n    }.bind(this));\n  }\n  _getStylesheetNode(key) {\n    var styleEl;\n    key = \"epubjs-inserted-css-\" + (key || '');\n    if (!this.document) return false;\n\n    // Check if link already exists\n    styleEl = this.document.getElementById(key);\n    if (!styleEl) {\n      styleEl = this.document.createElement(\"style\");\n      styleEl.id = key;\n      // Append style element to head\n      this.document.head.appendChild(styleEl);\n    }\n    return styleEl;\n  }\n\n  /**\n   * Append stylesheet css\n   * @param {string} serializedCss\n   * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n   */\n  addStylesheetCss(serializedCss, key) {\n    if (!this.document || !serializedCss) return false;\n    var styleEl;\n    styleEl = this._getStylesheetNode(key);\n    styleEl.innerHTML = serializedCss;\n    return true;\n  }\n\n  /**\n   * Append stylesheet rules to a generate stylesheet\n   * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n   * Object: https://github.com/desirable-objects/json-to-css\n   * @param {array | object} rules\n   * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n   */\n  addStylesheetRules(rules, key) {\n    var styleSheet;\n    if (!this.document || !rules || rules.length === 0) return;\n\n    // Grab style sheet\n    styleSheet = this._getStylesheetNode(key).sheet;\n    if (Object.prototype.toString.call(rules) === \"[object Array]\") {\n      for (var i = 0, rl = rules.length; i < rl; i++) {\n        var j = 1,\n          rule = rules[i],\n          selector = rules[i][0],\n          propStr = \"\";\n        // If the second argument of a rule is an array of arrays, correct our variables.\n        if (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n          rule = rule[1];\n          j = 0;\n        }\n        for (var pl = rule.length; j < pl; j++) {\n          var prop = rule[j];\n          propStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n        }\n\n        // Insert CSS Rule\n        styleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n      }\n    } else {\n      const selectors = Object.keys(rules);\n      selectors.forEach(selector => {\n        const definition = rules[selector];\n        if (Array.isArray(definition)) {\n          definition.forEach(item => {\n            const _rules = Object.keys(item);\n            const result = _rules.map(rule => {\n              return `${rule}:${item[rule]}`;\n            }).join(';');\n            styleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n          });\n        } else {\n          const _rules = Object.keys(definition);\n          const result = _rules.map(rule => {\n            return `${rule}:${definition[rule]}`;\n          }).join(';');\n          styleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n        }\n      });\n    }\n  }\n\n  /**\n   * Append a script tag to the document head\n   * @param {string} src url\n   * @returns {Promise} loaded\n   */\n  addScript(src) {\n    return new Promise(function (resolve, reject) {\n      var $script;\n      var ready = false;\n      if (!this.document) {\n        resolve(false);\n        return;\n      }\n      $script = this.document.createElement(\"script\");\n      $script.type = \"text/javascript\";\n      $script.async = true;\n      $script.src = src;\n      $script.onload = $script.onreadystatechange = function () {\n        if (!ready && (!this.readyState || this.readyState == \"complete\")) {\n          ready = true;\n          setTimeout(function () {\n            resolve(true);\n          }, 1);\n        }\n      };\n      this.document.head.appendChild($script);\n    }.bind(this));\n  }\n\n  /**\n   * Add a class to the contents container\n   * @param {string} className\n   */\n  addClass(className) {\n    var content;\n    if (!this.document) return;\n    content = this.content || this.document.body;\n    if (content) {\n      content.classList.add(className);\n    }\n  }\n\n  /**\n   * Remove a class from the contents container\n   * @param {string} removeClass\n   */\n  removeClass(className) {\n    var content;\n    if (!this.document) return;\n    content = this.content || this.document.body;\n    if (content) {\n      content.classList.remove(className);\n    }\n  }\n\n  /**\n   * Add DOM event listeners\n   * @private\n   */\n  addEventListeners() {\n    if (!this.document) {\n      return;\n    }\n    this._triggerEvent = this.triggerEvent.bind(this);\n    DOM_EVENTS.forEach(function (eventName) {\n      this.document.addEventListener(eventName, this._triggerEvent, {\n        passive: true\n      });\n    }, this);\n  }\n\n  /**\n   * Remove DOM event listeners\n   * @private\n   */\n  removeEventListeners() {\n    if (!this.document) {\n      return;\n    }\n    DOM_EVENTS.forEach(function (eventName) {\n      this.document.removeEventListener(eventName, this._triggerEvent, {\n        passive: true\n      });\n    }, this);\n    this._triggerEvent = undefined;\n  }\n\n  /**\n   * Emit passed browser events\n   * @private\n   */\n  triggerEvent(e) {\n    this.emit(e.type, e);\n  }\n\n  /**\n   * Add listener for text selection\n   * @private\n   */\n  addSelectionListeners() {\n    if (!this.document) {\n      return;\n    }\n    this._onSelectionChange = this.onSelectionChange.bind(this);\n    this.document.addEventListener(\"selectionchange\", this._onSelectionChange, {\n      passive: true\n    });\n  }\n\n  /**\n   * Remove listener for text selection\n   * @private\n   */\n  removeSelectionListeners() {\n    if (!this.document) {\n      return;\n    }\n    this.document.removeEventListener(\"selectionchange\", this._onSelectionChange, {\n      passive: true\n    });\n    this._onSelectionChange = undefined;\n  }\n\n  /**\n   * Handle getting text on selection\n   * @private\n   */\n  onSelectionChange(e) {\n    if (this.selectionEndTimeout) {\n      clearTimeout(this.selectionEndTimeout);\n    }\n    this.selectionEndTimeout = setTimeout(function () {\n      var selection = this.window.getSelection();\n      this.triggerSelectedEvent(selection);\n    }.bind(this), 250);\n  }\n\n  /**\n   * Emit event on text selection\n   * @private\n   */\n  triggerSelectedEvent(selection) {\n    var range, cfirange;\n    if (selection && selection.rangeCount > 0) {\n      range = selection.getRangeAt(0);\n      if (!range.collapsed) {\n        // cfirange = this.section.cfiFromRange(range);\n        cfirange = new EpubCFI(range, this.cfiBase).toString();\n        this.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n        this.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n      }\n    }\n  }\n\n  /**\n   * Get a Dom Range from EpubCFI\n   * @param {EpubCFI} _cfi\n   * @param {string} [ignoreClass]\n   * @returns {Range} range\n   */\n  range(_cfi, ignoreClass) {\n    var cfi = new EpubCFI(_cfi);\n    return cfi.toRange(this.document, ignoreClass);\n  }\n\n  /**\n   * Get an EpubCFI from a Dom Range\n   * @param {Range} range\n   * @param {string} [ignoreClass]\n   * @returns {EpubCFI} cfi\n   */\n  cfiFromRange(range, ignoreClass) {\n    return new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n  }\n\n  /**\n   * Get an EpubCFI from a Dom node\n   * @param {node} node\n   * @param {string} [ignoreClass]\n   * @returns {EpubCFI} cfi\n   */\n  cfiFromNode(node, ignoreClass) {\n    return new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n  }\n\n  // TODO: find where this is used - remove?\n  map(layout) {\n    var map = new Mapping(layout);\n    return map.section();\n  }\n\n  /**\n   * Size the contents to a given width and height\n   * @param {number} [width]\n   * @param {number} [height]\n   */\n  size(width, height) {\n    var viewport = {\n      scale: 1.0,\n      scalable: \"no\"\n    };\n    this.layoutStyle(\"scrolling\");\n    if (width >= 0) {\n      this.width(width);\n      viewport.width = width;\n      this.css(\"padding\", \"0 \" + width / 12 + \"px\");\n    }\n    if (height >= 0) {\n      this.height(height);\n      viewport.height = height;\n    }\n    this.css(\"margin\", \"0\");\n    this.css(\"box-sizing\", \"border-box\");\n    this.viewport(viewport);\n  }\n\n  /**\n   * Apply columns to the contents for pagination\n   * @param {number} width\n   * @param {number} height\n   * @param {number} columnWidth\n   * @param {number} gap\n   */\n  columns(width, height, columnWidth, gap, dir) {\n    let COLUMN_AXIS = prefixed(\"column-axis\");\n    let COLUMN_GAP = prefixed(\"column-gap\");\n    let COLUMN_WIDTH = prefixed(\"column-width\");\n    let COLUMN_FILL = prefixed(\"column-fill\");\n    let writingMode = this.writingMode();\n    let axis = writingMode.indexOf(\"vertical\") === 0 ? \"vertical\" : \"horizontal\";\n    this.layoutStyle(\"paginated\");\n    if (dir === \"rtl\" && axis === \"horizontal\") {\n      this.direction(dir);\n    }\n    this.width(width);\n    this.height(height);\n\n    // Deal with Mobile trying to scale to viewport\n    this.viewport({\n      width: width,\n      height: height,\n      scale: 1.0,\n      scalable: \"no\"\n    });\n\n    // TODO: inline-block needs more testing\n    // Fixes Safari column cut offs, but causes RTL issues\n    // this.css(\"display\", \"inline-block\");\n\n    this.css(\"overflow-y\", \"hidden\");\n    this.css(\"margin\", \"0\", true);\n    if (axis === \"vertical\") {\n      this.css(\"padding-top\", gap / 2 + \"px\", true);\n      this.css(\"padding-bottom\", gap / 2 + \"px\", true);\n      this.css(\"padding-left\", \"20px\");\n      this.css(\"padding-right\", \"20px\");\n      this.css(COLUMN_AXIS, \"vertical\");\n    } else {\n      this.css(\"padding-top\", \"20px\");\n      this.css(\"padding-bottom\", \"20px\");\n      this.css(\"padding-left\", gap / 2 + \"px\", true);\n      this.css(\"padding-right\", gap / 2 + \"px\", true);\n      this.css(COLUMN_AXIS, \"horizontal\");\n    }\n    this.css(\"box-sizing\", \"border-box\");\n    this.css(\"max-width\", \"inherit\");\n    this.css(COLUMN_FILL, \"auto\");\n    this.css(COLUMN_GAP, gap + \"px\");\n    this.css(COLUMN_WIDTH, columnWidth + \"px\");\n\n    // Fix glyph clipping in WebKit\n    // https://github.com/futurepress/epub.js/issues/983\n    this.css(\"-webkit-line-box-contain\", \"block glyphs replaced\");\n  }\n\n  /**\n   * Scale contents from center\n   * @param {number} scale\n   * @param {number} offsetX\n   * @param {number} offsetY\n   */\n  scaler(scale, offsetX, offsetY) {\n    var scaleStr = \"scale(\" + scale + \")\";\n    var translateStr = \"\";\n    // this.css(\"position\", \"absolute\"));\n    this.css(\"transform-origin\", \"top left\");\n    if (offsetX >= 0 || offsetY >= 0) {\n      translateStr = \" translate(\" + (offsetX || 0) + \"px, \" + (offsetY || 0) + \"px )\";\n    }\n    this.css(\"transform\", scaleStr + translateStr);\n  }\n\n  /**\n   * Fit contents into a fixed width and height\n   * @param {number} width\n   * @param {number} height\n   */\n  fit(width, height, section) {\n    var viewport = this.viewport();\n    var viewportWidth = parseInt(viewport.width);\n    var viewportHeight = parseInt(viewport.height);\n    var widthScale = width / viewportWidth;\n    var heightScale = height / viewportHeight;\n    var scale = widthScale < heightScale ? widthScale : heightScale;\n\n    // the translate does not work as intended, elements can end up unaligned\n    // var offsetY = (height - (viewportHeight * scale)) / 2;\n    // var offsetX = 0;\n    // if (this.sectionIndex % 2 === 1) {\n    // \toffsetX = width - (viewportWidth * scale);\n    // }\n\n    this.layoutStyle(\"paginated\");\n\n    // scale needs width and height to be set\n    this.width(viewportWidth);\n    this.height(viewportHeight);\n    this.overflow(\"hidden\");\n\n    // Scale to the correct size\n    this.scaler(scale, 0, 0);\n    // this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n\n    // background images are not scaled by transform\n    this.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n    this.css(\"background-color\", \"transparent\");\n    if (section && section.properties.includes(\"page-spread-left\")) {\n      // set margin since scale is weird\n      var marginLeft = width - viewportWidth * scale;\n      this.css(\"margin-left\", marginLeft + \"px\");\n    }\n  }\n\n  /**\n   * Set the direction of the text\n   * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n   */\n  direction(dir) {\n    if (this.documentElement) {\n      this.documentElement.style[\"direction\"] = dir;\n    }\n  }\n  mapPage(cfiBase, layout, start, end, dev) {\n    var mapping = new Mapping(layout, dev);\n    return mapping.page(this, cfiBase, start, end);\n  }\n\n  /**\n   * Emit event when link in content is clicked\n   * @private\n   */\n  linksHandler() {\n    replaceLinks(this.content, href => {\n      this.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n    });\n  }\n\n  /**\n   * Set the writingMode of the text\n   * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n   */\n  writingMode(mode) {\n    let WRITING_MODE = prefixed(\"writing-mode\");\n    if (mode && this.documentElement) {\n      this.documentElement.style[WRITING_MODE] = mode;\n    }\n    return this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n  }\n\n  /**\n   * Set the layoutStyle of the content\n   * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n   * @private\n   */\n  layoutStyle(style) {\n    if (style) {\n      this._layoutStyle = style;\n      navigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n    }\n    return this._layoutStyle || \"paginated\";\n  }\n\n  /**\n   * Add the epubReadingSystem object to the navigator\n   * @param {string} name\n   * @param {string} version\n   * @private\n   */\n  epubReadingSystem(name, version) {\n    navigator.epubReadingSystem = {\n      name: name,\n      version: version,\n      layoutStyle: this.layoutStyle(),\n      hasFeature: function (feature) {\n        switch (feature) {\n          case \"dom-manipulation\":\n            return true;\n          case \"layout-changes\":\n            return true;\n          case \"touch-events\":\n            return true;\n          case \"mouse-events\":\n            return true;\n          case \"keyboard-events\":\n            return true;\n          case \"spine-scripting\":\n            return false;\n          default:\n            return false;\n        }\n      }\n    };\n    return navigator.epubReadingSystem;\n  }\n  destroy() {\n    // this.document.removeEventListener('transitionend', this._resizeCheck);\n\n    this.removeListeners();\n  }\n}\nEventEmitter(Contents.prototype);\nexport default Contents;","map":{"version":3,"names":["EventEmitter","isNumber","prefixed","borders","defaults","EpubCFI","Mapping","replaceLinks","EPUBJS_VERSION","EVENTS","DOM_EVENTS","hasNavigator","navigator","isChrome","test","userAgent","isWebkit","ELEMENT_NODE","TEXT_NODE","Contents","constructor","doc","content","cfiBase","sectionIndex","epubcfi","document","documentElement","body","window","defaultView","_size","width","height","epubReadingSystem","called","active","listeners","listenedEvents","w","frame","style","parseInt","getComputedStyle","h","contentWidth","contentHeight","textWidth","rect","range","createRange","border","selectNodeContents","getBoundingClientRect","Math","round","textHeight","bottom","scrollWidth","scrollHeight","overflow","overflowX","overflowY","css","property","value","priority","setProperty","removeProperty","viewport","options","_width","_height","_scale","_minimum","_maximum","_scalable","$viewport","querySelector","parsed","undefined","newContent","settings","hasAttribute","getAttribute","match","length","scale","minimum","maximum","scalable","push","createElement","setAttribute","appendChild","join","scrollTo","expand","emit","CONTENTS","EXPAND","imageLoadListeners","mediaQueryListeners","addEventListeners","addSelectionListeners","ResizeObserver","resizeListeners","visibilityListeners","resizeObservers","linksHandler","removeListeners","removeEventListeners","removeSelectionListeners","observer","disconnect","clearTimeout","expanding","resizeCheck","onResize","RESIZE","requestAnimationFrame","bind","setTimeout","addEventListener","visibilityState","transitionListeners","_resizeCheck","sheets","styleSheets","mediaChangeHandler","m","matches","_expanding","i","rules","cssRules","e","j","media","mql","matchMedia","mediaText","addListener","observe","mutationObservers","MutationObserver","mutations","config","attributes","childList","characterData","subtree","images","querySelectorAll","img","naturalWidth","onload","fontLoadListeners","fonts","ready","then","root","locationOf","target","ignoreClass","position","targetPos","isCfiString","toRange","endContainer","startContainer","startOffset","endOffset","pos","textContent","indexOf","setEnd","console","error","nodeType","Node","left","top","container","newRange","Range","setStart","parentNode","stack","id","substring","el","getElementById","selectNode","addStylesheet","src","Promise","resolve","reject","$stylesheet","type","rel","href","onreadystatechange","readyState","head","_getStylesheetNode","key","styleEl","addStylesheetCss","serializedCss","innerHTML","addStylesheetRules","styleSheet","sheet","Object","prototype","toString","call","rl","rule","selector","propStr","pl","prop","insertRule","selectors","keys","forEach","definition","Array","isArray","item","_rules","result","map","addScript","$script","async","addClass","className","classList","add","removeClass","remove","_triggerEvent","triggerEvent","eventName","passive","removeEventListener","_onSelectionChange","onSelectionChange","selectionEndTimeout","selection","getSelection","triggerSelectedEvent","cfirange","rangeCount","getRangeAt","collapsed","SELECTED","SELECTED_RANGE","_cfi","cfi","cfiFromRange","cfiFromNode","node","layout","section","size","layoutStyle","columns","columnWidth","gap","dir","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","writingMode","axis","direction","scaler","offsetX","offsetY","scaleStr","translateStr","fit","viewportWidth","viewportHeight","widthScale","heightScale","properties","includes","marginLeft","mapPage","start","end","dev","mapping","page","LINK_CLICKED","mode","WRITING_MODE","_layoutStyle","name","version","hasFeature","feature","destroy"],"sources":["/home/parallels/Downloads/react-epub-viewer-demo/node_modules/epubjs/src/contents.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport {isNumber, prefixed, borders, defaults} from \"./utils/core\";\nimport EpubCFI from \"./epubcfi\";\nimport Mapping from \"./mapping\";\nimport {replaceLinks} from \"./utils/replacements\";\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\nconst hasNavigator = typeof (navigator) !== \"undefined\";\n\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\n\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\n\n/**\n\t* Handles DOM manipulation, queries and events for View contents\n\t* @class\n\t* @param {document} doc Document\n\t* @param {element} content Parent Element (typically Body)\n\t* @param {string} cfiBase Section component of CFIs\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\n\t*/\nclass Contents {\n\tconstructor(doc, content, cfiBase, sectionIndex) {\n\t\t// Blank Cfi for Parsing\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.document = doc;\n\t\tthis.documentElement =  this.document.documentElement;\n\t\tthis.content = content || this.document.body;\n\t\tthis.window = this.document.defaultView;\n\n\t\tthis._size = {\n\t\t\twidth: 0,\n\t\t\theight: 0\n\t\t};\n\n\t\tthis.sectionIndex = sectionIndex || 0;\n\t\tthis.cfiBase = cfiBase || \"\";\n\n\t\tthis.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\n\t\tthis.called = 0;\n\t\tthis.active = true;\n\t\tthis.listeners();\n\t}\n\n\t/**\n\t\t* Get DOM events that are listened for and passed along\n\t\t*/\n\tstatic get listenedEvents() {\n\t\treturn DOM_EVENTS;\n\t}\n\n\t/**\n\t\t* Get or Set width\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\twidth(w) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tframe.style.width = w;\n\t\t\t// this.content.style.width = w;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(frame)[\"width\"]);\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\theight(h) {\n\t\t// var frame = this.documentElement;\n\t\tvar frame = this.content;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tframe.style.height = h;\n\t\t\t// this.content.style.height = h;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(frame)[\"height\"]);\n\n\t}\n\n\t/**\n\t\t* Get or Set width of the contents\n\t\t* @param {number} [w]\n\t\t* @returns {number} width\n\t\t*/\n\tcontentWidth(w) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (w && isNumber(w)) {\n\t\t\tw = w + \"px\";\n\t\t}\n\n\t\tif (w) {\n\t\t\tcontent.style.width = w;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(content)[\"width\"]);\n\n\n\t}\n\n\t/**\n\t\t* Get or Set height of the contents\n\t\t* @param {number} [h]\n\t\t* @returns {number} height\n\t\t*/\n\tcontentHeight(h) {\n\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (h && isNumber(h)) {\n\t\t\th = h + \"px\";\n\t\t}\n\n\t\tif (h) {\n\t\t\tcontent.style.height = h;\n\t\t}\n\n\t\treturn parseInt(this.window.getComputedStyle(content)[\"height\"]);\n\n\t}\n\n\t/**\n\t\t* Get the width of the text using Range\n\t\t* @returns {number} width\n\t\t*/\n\ttextWidth() {\n\t\tlet rect;\n\t\tlet width;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\t\tlet border = borders(content);\n\n\t\t// Select the contents of frame\n\t\trange.selectNodeContents(content);\n\n\t\t// get the width of the text content\n\t\trect = range.getBoundingClientRect();\n\t\twidth = rect.width;\n\n\t\tif (border && border.width) {\n\t\t\twidth += border.width;\n\t\t}\n\n\t\treturn Math.round(width);\n\t}\n\n\t/**\n\t\t* Get the height of the text using Range\n\t\t* @returns {number} height\n\t\t*/\n\ttextHeight() {\n\t\tlet rect;\n\t\tlet height;\n\t\tlet range = this.document.createRange();\n\t\tlet content = this.content || this.document.body;\n\n\t\trange.selectNodeContents(content);\n\n\t\trect = range.getBoundingClientRect();\n\t\theight = rect.bottom;\n\n\t\treturn Math.round(height);\n\t}\n\n\t/**\n\t\t* Get documentElement scrollWidth\n\t\t* @returns {number} width\n\t\t*/\n\tscrollWidth() {\n\t\tvar width = this.documentElement.scrollWidth;\n\n\t\treturn width;\n\t}\n\n\t/**\n\t\t* Get documentElement scrollHeight\n\t\t* @returns {number} height\n\t\t*/\n\tscrollHeight() {\n\t\tvar height = this.documentElement.scrollHeight;\n\n\t\treturn height;\n\t}\n\n\t/**\n\t\t* Set overflow css style of the contents\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflow(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflow = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflow\"];\n\t}\n\n\t/**\n\t\t* Set overflowX css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowX(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowX = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\n\t}\n\n\t/**\n\t\t* Set overflowY css style of the documentElement\n\t\t* @param {string} [overflow]\n\t\t*/\n\toverflowY(overflow) {\n\n\t\tif (overflow) {\n\t\t\tthis.documentElement.style.overflowY = overflow;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\n\t}\n\n\t/**\n\t\t* Set Css styles on the contents element (typically Body)\n\t\t* @param {string} property\n\t\t* @param {string} value\n\t\t* @param {boolean} [priority] set as \"important\"\n\t\t*/\n\tcss(property, value, priority) {\n\t\tvar content = this.content || this.document.body;\n\n\t\tif (value) {\n\t\t\tcontent.style.setProperty(property, value, priority ? \"important\" : \"\");\n\t\t} else {\n\t\t\tcontent.style.removeProperty(property);\n\t\t}\n\n\t\treturn this.window.getComputedStyle(content)[property];\n\t}\n\n\t/**\n\t\t* Get or Set the viewport element\n\t\t* @param {object} [options]\n\t\t* @param {string} [options.width]\n\t\t* @param {string} [options.height]\n\t\t* @param {string} [options.scale]\n\t\t* @param {string} [options.minimum]\n\t\t* @param {string} [options.maximum]\n\t\t* @param {string} [options.scalable]\n\t\t*/\n\tviewport(options) {\n\t\tvar _width, _height, _scale, _minimum, _maximum, _scalable;\n\t\t// var width, height, scale, minimum, maximum, scalable;\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\n\t\tvar parsed = {\n\t\t\t\"width\": undefined,\n\t\t\t\"height\": undefined,\n\t\t\t\"scale\": undefined,\n\t\t\t\"minimum\": undefined,\n\t\t\t\"maximum\": undefined,\n\t\t\t\"scalable\": undefined\n\t\t};\n\t\tvar newContent = [];\n\t\tvar settings = {};\n\n\t\t/*\n\t\t* check for the viewport size\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\n\t\t*/\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\n\t\t\tlet content = $viewport.getAttribute(\"content\");\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\n\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\n\t\t\t\tparsed.width = _width[1];\n\t\t\t}\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\n\t\t\t\tparsed.height = _height[1];\n\t\t\t}\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\n\t\t\t\tparsed.scale = _scale[1];\n\t\t\t}\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\n\t\t\t\tparsed.minimum = _minimum[1];\n\t\t\t}\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\n\t\t\t\tparsed.maximum = _maximum[1];\n\t\t\t}\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\n\t\t\t\tparsed.scalable = _scalable[1];\n\t\t\t}\n\t\t}\n\n\t\tsettings = defaults(options || {}, parsed);\n\n\t\tif (options) {\n\t\t\tif (settings.width) {\n\t\t\t\tnewContent.push(\"width=\" + settings.width);\n\t\t\t}\n\n\t\t\tif (settings.height) {\n\t\t\t\tnewContent.push(\"height=\" + settings.height);\n\t\t\t}\n\n\t\t\tif (settings.scale) {\n\t\t\t\tnewContent.push(\"initial-scale=\" + settings.scale);\n\t\t\t}\n\n\t\t\tif (settings.scalable === \"no\") {\n\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"maximum-scale=\" + settings.scale);\n\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t} else {\n\n\t\t\t\tif (settings.scalable) {\n\t\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\n\t\t\t\t}\n\n\t\t\t\tif (settings.minimum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.minimum);\n\t\t\t\t}\n\n\t\t\t\tif (settings.maximum) {\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.maximum);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!$viewport) {\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\n\t\t\t\tthis.document.querySelector(\"head\").appendChild($viewport);\n\t\t\t}\n\n\t\t\t$viewport.setAttribute(\"content\", newContent.join(\", \"));\n\n\t\t\tthis.window.scrollTo(0, 0);\n\t\t}\n\n\n\t\treturn settings;\n\t}\n\n\t/**\n\t * Event emitter for when the contents has expanded\n\t * @private\n\t */\n\texpand() {\n\t\tthis.emit(EVENTS.CONTENTS.EXPAND);\n\t}\n\n\t/**\n\t * Add DOM listeners\n\t * @private\n\t */\n\tlisteners() {\n\t\tthis.imageLoadListeners();\n\n\t\tthis.mediaQueryListeners();\n\n\t\t// this.fontLoadListeners();\n\n\t\tthis.addEventListeners();\n\n\t\tthis.addSelectionListeners();\n\n\t\t// this.transitionListeners();\n\n\t\tif (typeof ResizeObserver === \"undefined\") {\n\t\t\tthis.resizeListeners();\n\t\t\tthis.visibilityListeners();\n\t\t} else {\n\t\t\tthis.resizeObservers();\n\t\t}\n\n\t\t// this.mutationObservers();\n\n\t\tthis.linksHandler();\n\t}\n\n\t/**\n\t * Remove DOM listeners\n\t * @private\n\t */\n\tremoveListeners() {\n\n\t\tthis.removeEventListeners();\n\n\t\tthis.removeSelectionListeners();\n\n\t\tif (this.observer) {\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tclearTimeout(this.expanding);\n\t}\n\n\t/**\n\t * Check if size of contents has changed and\n\t * emit 'resize' event if it has.\n\t * @private\n\t */\n\tresizeCheck() {\n\t\tlet width = this.textWidth();\n\t\tlet height = this.textHeight();\n\n\t\tif (width != this._size.width || height != this._size.height) {\n\n\t\t\tthis._size = {\n\t\t\t\twidth: width,\n\t\t\t\theight: height\n\t\t\t};\n\n\t\t\tthis.onResize && this.onResize(this._size);\n\t\t\tthis.emit(EVENTS.CONTENTS.RESIZE, this._size);\n\t\t}\n\t}\n\n\t/**\n\t * Poll for resize detection\n\t * @private\n\t */\n\tresizeListeners() {\n\t\tvar width, height;\n\t\t// Test size again\n\t\tclearTimeout(this.expanding);\n\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\n\t}\n\n\t/**\n\t * Listen for visibility of tab to change\n\t * @private\n\t */\n\tvisibilityListeners() {\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\n\t\t\tif (document.visibilityState === \"visible\" && this.active === false) {\n\t\t\t\tthis.active = true;\n\t\t\t\tthis.resizeListeners();\n\t\t\t} else {\n\t\t\t\tthis.active = false;\n\t\t\t\tclearTimeout(this.expanding);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Use css transitions to detect resize\n\t * @private\n\t */\n\ttransitionListeners() {\n\t\tlet body = this.content;\n\n\t\tbody.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\n\t\tbody.style['transitionDuration'] = \"0.001ms\";\n\t\tbody.style['transitionTimingFunction'] = \"linear\";\n\t\tbody.style['transitionDelay'] = \"0\";\n\n\t\tthis._resizeCheck = this.resizeCheck.bind(this);\n\t\tthis.document.addEventListener('transitionend', this._resizeCheck);\n\t}\n\n\t/**\n\t * Listen for media query changes and emit 'expand' event\n\t * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\n\t * @private\n\t */\n\tmediaQueryListeners() {\n\t\tvar sheets = this.document.styleSheets;\n\t\tvar mediaChangeHandler = function(m){\n\t\t\tif(m.matches && !this._expanding) {\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\n\t\t\tvar rules;\n\t\t\t// Firefox errors if we access cssRules cross-domain\n\t\t\ttry {\n\t\t\t\trules = sheets[i].cssRules;\n\t\t\t} catch (e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(!rules) return; // Stylesheets changed\n\t\t\tfor (var j = 0; j < rules.length; j += 1) {\n\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\n\t\t\t\tif(rules[j].media){\n\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\n\t\t\t\t\tmql.addListener(mediaChangeHandler);\n\t\t\t\t\t//mql.onchange = mediaChangeHandler;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Use ResizeObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tresizeObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new ResizeObserver((e) => {\n\t\t\trequestAnimationFrame(this.resizeCheck.bind(this));\n\t\t});\n\n\t\t// pass in the target node\n\t\tthis.observer.observe(this.document.documentElement);\n\t}\n\n\t/**\n\t * Use MutationObserver to listen for changes in the DOM and check for resize\n\t * @private\n\t */\n\tmutationObservers() {\n\t\t// create an observer instance\n\t\tthis.observer = new MutationObserver((mutations) => {\n\t\t\tthis.resizeCheck();\n\t\t});\n\n\t\t// configuration of the observer:\n\t\tlet config = { attributes: true, childList: true, characterData: true, subtree: true };\n\n\t\t// pass in the target node, as well as the observer options\n\t\tthis.observer.observe(this.document, config);\n\t}\n\n\t/**\n\t * Test if images are loaded or add listener for when they load\n\t * @private\n\t */\n\timageLoadListeners() {\n\t\tvar images = this.document.querySelectorAll(\"img\");\n\t\tvar img;\n\t\tfor (var i = 0; i < images.length; i++) {\n\t\t\timg = images[i];\n\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\n\t\t\t\t\timg.naturalWidth === 0) {\n\t\t\t\timg.onload = this.expand.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Listen for font load and check for resize when loaded\n\t * @private\n\t */\n\tfontLoadListeners() {\n\t\tif (!this.document || !this.document.fonts) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.document.fonts.ready.then(function () {\n\t\t\tthis.resizeCheck();\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Get the documentElement\n\t * @returns {element} documentElement\n\t */\n\troot() {\n\t\tif(!this.document) return null;\n\t\treturn this.document.documentElement;\n\t}\n\n\t/**\n\t * Get the location offset of a EpubCFI or an #id\n\t * @param {string | EpubCFI} target\n\t * @param {string} [ignoreClass] for the cfi\n\t * @returns { {left: Number, top: Number }\n\t */\n\tlocationOf(target, ignoreClass) {\n\t\tvar position;\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\n\n\t\tif(!this.document) return targetPos;\n\n\t\tif(this.epubcfi.isCfiString(target)) {\n\t\t\tlet range = new EpubCFI(target).toRange(this.document, ignoreClass);\n\n\t\t\tif(range) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!range.endContainer ||\n\t\t\t\t\t\t(range.startContainer == range.endContainer\n\t\t\t\t\t\t&& range.startOffset == range.endOffset)) {\n\t\t\t\t\t\t// If the end for the range is not set, it results in collapsed becoming\n\t\t\t\t\t\t// true. This in turn leads to inconsistent behaviour when calling\n\t\t\t\t\t\t// getBoundingRect. Wrong bounds lead to the wrong page being displayed.\n\t\t\t\t\t\t// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/\n\t\t\t\t\t\tlet pos = range.startContainer.textContent.indexOf(\" \", range.startOffset);\n\t\t\t\t\t\tif (pos == -1) {\n\t\t\t\t\t\t\tpos = range.startContainer.textContent.length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trange.setEnd(range.startContainer, pos);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(\"setting end offset to start container length failed\", e);\n\t\t\t\t}\n\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\n\t\t\t\t\ttargetPos.left = position.left;\n\t\t\t\t\ttargetPos.top = position.top;\n\t\t\t\t} else {\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\n\n\t\t\t\t\t// Construct a new non-collapsed range\n\t\t\t\t\tif (isWebkit) {\n\t\t\t\t\t\tlet container = range.startContainer;\n\t\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (container.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\t\t\tposition = container.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset + 2 < container.length) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset + 2);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else if (range.startOffset - 2 > 0) {\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset - 2);\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset);\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t\t\t\t} else { // empty, return the parent element\n\t\t\t\t\t\t\t\tposition = container.parentNode.getBoundingClientRect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.error(e, e.stack);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if(typeof target === \"string\" &&\n\t\t\ttarget.indexOf(\"#\") > -1) {\n\n\t\t\tlet id = target.substring(target.indexOf(\"#\")+1);\n\t\t\tlet el = this.document.getElementById(id);\n\t\t\tif(el) {\n\t\t\t\tif (isWebkit) {\n\t\t\t\t\t// Webkit reports incorrect bounding rects in Columns\n\t\t\t\t\tlet newRange = new Range();\n\t\t\t\t\tnewRange.selectNode(el);\n\t\t\t\t\tposition = newRange.getBoundingClientRect();\n\t\t\t\t} else {\n\t\t\t\t\tposition = el.getBoundingClientRect();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (position) {\n\t\t\ttargetPos.left = position.left;\n\t\t\ttargetPos.top = position.top;\n\t\t}\n\n\t\treturn targetPos;\n\t}\n\n\t/**\n\t * Append a stylesheet link to the document head\n\t * @param {string} src url\n\t */\n\taddStylesheet(src) {\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $stylesheet;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if link already exists\n\t\t\t$stylesheet = this.document.querySelector(\"link[href='\"+src+\"']\");\n\t\t\tif ($stylesheet) {\n\t\t\t\tresolve(true);\n\t\t\t\treturn; // already present\n\t\t\t}\n\n\t\t\t$stylesheet = this.document.createElement(\"link\");\n\t\t\t$stylesheet.type = \"text/css\";\n\t\t\t$stylesheet.rel = \"stylesheet\";\n\t\t\t$stylesheet.href = src;\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\t// Let apply\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($stylesheet);\n\n\t\t}.bind(this));\n\t}\n\n\t_getStylesheetNode(key) {\n\t\tvar styleEl;\n\t\tkey = \"epubjs-inserted-css-\" + (key || '');\n\n\t\tif(!this.document) return false;\n\n\t\t// Check if link already exists\n\t\tstyleEl = this.document.getElementById(key);\n\t\tif (!styleEl) {\n\t\t\tstyleEl = this.document.createElement(\"style\");\n\t\t\tstyleEl.id = key;\n\t\t\t// Append style element to head\n\t\t\tthis.document.head.appendChild(styleEl);\n\t\t}\n\t\treturn styleEl;\n\t}\n\n\t/**\n\t * Append stylesheet css\n\t * @param {string} serializedCss\n\t * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n\t */\n\taddStylesheetCss(serializedCss, key) {\n\t\tif(!this.document || !serializedCss) return false;\n\n\t\tvar styleEl;\n\t\tstyleEl = this._getStylesheetNode(key);\n\t\tstyleEl.innerHTML = serializedCss;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Append stylesheet rules to a generate stylesheet\n\t * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\n\t * Object: https://github.com/desirable-objects/json-to-css\n\t * @param {array | object} rules\n\t * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\n\t */\n\taddStylesheetRules(rules, key) {\n\t\tvar styleSheet;\n\n\t\tif(!this.document || !rules || rules.length === 0) return;\n\n\t\t// Grab style sheet\n\t\tstyleSheet = this._getStylesheetNode(key).sheet;\n\n\t\tif (Object.prototype.toString.call(rules) === \"[object Array]\") {\n\t\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\n\t\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = \"\";\n\t\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\n\t\t\t\tif (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\n\t\t\t\t\trule = rule[1];\n\t\t\t\t\tj = 0;\n\t\t\t\t}\n\n\t\t\t\tfor (var pl = rule.length; j < pl; j++) {\n\t\t\t\t\tvar prop = rule[j];\n\t\t\t\t\tpropStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\n\t\t\t\t}\n\n\t\t\t\t// Insert CSS Rule\n\t\t\t\tstyleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\n\t\t\t}\n\t\t} else {\n\t\t\tconst selectors = Object.keys(rules);\n\t\t\tselectors.forEach((selector) => {\n\t\t\t\tconst definition = rules[selector];\n\t\t\t\tif (Array.isArray(definition)) {\n\t\t\t\t\tdefinition.forEach((item) => {\n\t\t\t\t\t\tconst _rules = Object.keys(item);\n\t\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\t\treturn `${rule}:${item[rule]}`;\n\t\t\t\t\t\t}).join(';');\n\t\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst _rules = Object.keys(definition);\n\t\t\t\t\tconst result = _rules.map((rule) => {\n\t\t\t\t\t\treturn `${rule}:${definition[rule]}`;\n\t\t\t\t\t}).join(';');\n\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Append a script tag to the document head\n\t * @param {string} src url\n\t * @returns {Promise} loaded\n\t */\n\taddScript(src) {\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\tvar $script;\n\t\t\tvar ready = false;\n\n\t\t\tif(!this.document) {\n\t\t\t\tresolve(false);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$script = this.document.createElement(\"script\");\n\t\t\t$script.type = \"text/javascript\";\n\t\t\t$script.async = true;\n\t\t\t$script.src = src;\n\t\t\t$script.onload = $script.onreadystatechange = function() {\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\n\t\t\t\t\tready = true;\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.document.head.appendChild($script);\n\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Add a class to the contents container\n\t * @param {string} className\n\t */\n\taddClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.add(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Remove a class from the contents container\n\t * @param {string} removeClass\n\t */\n\tremoveClass(className) {\n\t\tvar content;\n\n\t\tif(!this.document) return;\n\n\t\tcontent = this.content || this.document.body;\n\n\t\tif (content) {\n\t\t\tcontent.classList.remove(className);\n\t\t}\n\n\t}\n\n\t/**\n\t * Add DOM event listeners\n\t * @private\n\t */\n\taddEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._triggerEvent = this.triggerEvent.bind(this);\n\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.addEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\n\t}\n\n\t/**\n\t * Remove DOM event listeners\n\t * @private\n\t */\n\tremoveEventListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tDOM_EVENTS.forEach(function(eventName){\n\t\t\tthis.document.removeEventListener(eventName, this._triggerEvent, { passive: true });\n\t\t}, this);\n\t\tthis._triggerEvent = undefined;\n\t}\n\n\t/**\n\t * Emit passed browser events\n\t * @private\n\t */\n\ttriggerEvent(e){\n\t\tthis.emit(e.type, e);\n\t}\n\n\t/**\n\t * Add listener for text selection\n\t * @private\n\t */\n\taddSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectionChange = this.onSelectionChange.bind(this);\n\t\tthis.document.addEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t}\n\n\t/**\n\t * Remove listener for text selection\n\t * @private\n\t */\n\tremoveSelectionListeners(){\n\t\tif(!this.document) {\n\t\t\treturn;\n\t\t}\n\t\tthis.document.removeEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\n\t\tthis._onSelectionChange = undefined;\n\t}\n\n\t/**\n\t * Handle getting text on selection\n\t * @private\n\t */\n\tonSelectionChange(e){\n\t\tif (this.selectionEndTimeout) {\n\t\t\tclearTimeout(this.selectionEndTimeout);\n\t\t}\n\t\tthis.selectionEndTimeout = setTimeout(function() {\n\t\t\tvar selection = this.window.getSelection();\n\t\t\tthis.triggerSelectedEvent(selection);\n\t\t}.bind(this), 250);\n\t}\n\n\t/**\n\t * Emit event on text selection\n\t * @private\n\t */\n\ttriggerSelectedEvent(selection){\n\t\tvar range, cfirange;\n\n\t\tif (selection && selection.rangeCount > 0) {\n\t\t\trange = selection.getRangeAt(0);\n\t\t\tif(!range.collapsed) {\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED, cfirange);\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get a Dom Range from EpubCFI\n\t * @param {EpubCFI} _cfi\n\t * @param {string} [ignoreClass]\n\t * @returns {Range} range\n\t */\n\trange(_cfi, ignoreClass){\n\t\tvar cfi = new EpubCFI(_cfi);\n\t\treturn cfi.toRange(this.document, ignoreClass);\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom Range\n\t * @param {Range} range\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromRange(range, ignoreClass){\n\t\treturn new EpubCFI(range, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t/**\n\t * Get an EpubCFI from a Dom node\n\t * @param {node} node\n\t * @param {string} [ignoreClass]\n\t * @returns {EpubCFI} cfi\n\t */\n\tcfiFromNode(node, ignoreClass){\n\t\treturn new EpubCFI(node, this.cfiBase, ignoreClass).toString();\n\t}\n\n\t// TODO: find where this is used - remove?\n\tmap(layout){\n\t\tvar map = new Mapping(layout);\n\t\treturn map.section();\n\t}\n\n\t/**\n\t * Size the contents to a given width and height\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t */\n\tsize(width, height){\n\t\tvar viewport = { scale: 1.0, scalable: \"no\" };\n\n\t\tthis.layoutStyle(\"scrolling\");\n\n\t\tif (width >= 0) {\n\t\t\tthis.width(width);\n\t\t\tviewport.width = width;\n\t\t\tthis.css(\"padding\", \"0 \"+(width/12)+\"px\");\n\t\t}\n\n\t\tif (height >= 0) {\n\t\t\tthis.height(height);\n\t\t\tviewport.height = height;\n\t\t}\n\n\t\tthis.css(\"margin\", \"0\");\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\n\n\t\tthis.viewport(viewport);\n\t}\n\n\t/**\n\t * Apply columns to the contents for pagination\n\t * @param {number} width\n\t * @param {number} height\n\t * @param {number} columnWidth\n\t * @param {number} gap\n\t */\n\tcolumns(width, height, columnWidth, gap, dir){\n\t\tlet COLUMN_AXIS = prefixed(\"column-axis\");\n\t\tlet COLUMN_GAP = prefixed(\"column-gap\");\n\t\tlet COLUMN_WIDTH = prefixed(\"column-width\");\n\t\tlet COLUMN_FILL = prefixed(\"column-fill\");\n\n\t\tlet writingMode = this.writingMode();\n\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\tif (dir === \"rtl\" && axis === \"horizontal\") {\n\t\t\tthis.direction(dir);\n\t\t}\n\n\t\tthis.width(width);\n\t\tthis.height(height);\n\n\t\t// Deal with Mobile trying to scale to viewport\n\t\tthis.viewport({ width: width, height: height, scale: 1.0, scalable: \"no\" });\n\n\t\t// TODO: inline-block needs more testing\n\t\t// Fixes Safari column cut offs, but causes RTL issues\n\t\t// this.css(\"display\", \"inline-block\");\n\n\t\tthis.css(\"overflow-y\", \"hidden\");\n\t\tthis.css(\"margin\", \"0\", true);\n\n\t\tif (axis === \"vertical\") {\n\t\t\tthis.css(\"padding-top\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-bottom\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-left\", \"20px\");\n\t\t\tthis.css(\"padding-right\", \"20px\");\n\t\t\tthis.css(COLUMN_AXIS, \"vertical\");\n\t\t} else {\n\t\t\tthis.css(\"padding-top\", \"20px\");\n\t\t\tthis.css(\"padding-bottom\", \"20px\");\n\t\t\tthis.css(\"padding-left\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(\"padding-right\", (gap / 2) + \"px\", true);\n\t\t\tthis.css(COLUMN_AXIS, \"horizontal\");\n\t\t}\n\n\t\tthis.css(\"box-sizing\", \"border-box\");\n\t\tthis.css(\"max-width\", \"inherit\");\n\n\t\tthis.css(COLUMN_FILL, \"auto\");\n\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\n\n\t\t// Fix glyph clipping in WebKit\n\t\t// https://github.com/futurepress/epub.js/issues/983\n\t\tthis.css(\"-webkit-line-box-contain\", \"block glyphs replaced\");\n\t}\n\n\t/**\n\t * Scale contents from center\n\t * @param {number} scale\n\t * @param {number} offsetX\n\t * @param {number} offsetY\n\t */\n\tscaler(scale, offsetX, offsetY){\n\t\tvar scaleStr = \"scale(\" + scale + \")\";\n\t\tvar translateStr = \"\";\n\t\t// this.css(\"position\", \"absolute\"));\n\t\tthis.css(\"transform-origin\", \"top left\");\n\n\t\tif (offsetX >= 0 || offsetY >= 0) {\n\t\t\ttranslateStr = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\n\t\t}\n\n\t\tthis.css(\"transform\", scaleStr + translateStr);\n\t}\n\n\t/**\n\t * Fit contents into a fixed width and height\n\t * @param {number} width\n\t * @param {number} height\n\t */\n\tfit(width, height, section){\n\t\tvar viewport = this.viewport();\n\t\tvar viewportWidth = parseInt(viewport.width);\n\t\tvar viewportHeight = parseInt(viewport.height);\n\t\tvar widthScale = width / viewportWidth;\n\t\tvar heightScale = height / viewportHeight;\n\t\tvar scale = widthScale < heightScale ? widthScale : heightScale;\n\n\t\t// the translate does not work as intended, elements can end up unaligned\n\t\t// var offsetY = (height - (viewportHeight * scale)) / 2;\n\t\t// var offsetX = 0;\n\t\t// if (this.sectionIndex % 2 === 1) {\n\t\t// \toffsetX = width - (viewportWidth * scale);\n\t\t// }\n\n\t\tthis.layoutStyle(\"paginated\");\n\n\t\t// scale needs width and height to be set\n\t\tthis.width(viewportWidth);\n\t\tthis.height(viewportHeight);\n\t\tthis.overflow(\"hidden\");\n\n\t\t// Scale to the correct size\n\t\tthis.scaler(scale, 0, 0);\n\t\t// this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\n\n\t\t// background images are not scaled by transform\n\t\tthis.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\n\n\t\tthis.css(\"background-color\", \"transparent\");\n\t\tif (section && section.properties.includes(\"page-spread-left\")) {\n\t\t\t// set margin since scale is weird\n\t\t\tvar marginLeft = width - (viewportWidth * scale);\n\t\t\tthis.css(\"margin-left\", marginLeft + \"px\");\n\t\t}\n\t}\n\n\t/**\n\t * Set the direction of the text\n\t * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\n\t */\n\tdirection(dir) {\n\t\tif (this.documentElement) {\n\t\t\tthis.documentElement.style[\"direction\"] = dir;\n\t\t}\n\t}\n\n\tmapPage(cfiBase, layout, start, end, dev) {\n\t\tvar mapping = new Mapping(layout, dev);\n\n\t\treturn mapping.page(this, cfiBase, start, end);\n\t}\n\n\t/**\n\t * Emit event when link in content is clicked\n\t * @private\n\t */\n\tlinksHandler() {\n\t\treplaceLinks(this.content, (href) => {\n\t\t\tthis.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\n\t\t});\n\t}\n\n\t/**\n\t * Set the writingMode of the text\n\t * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\n\t */\n\twritingMode(mode) {\n\t\tlet WRITING_MODE = prefixed(\"writing-mode\");\n\n\t\tif (mode && this.documentElement) {\n\t\t\tthis.documentElement.style[WRITING_MODE] = mode;\n\t\t}\n\n\t\treturn this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\n\t}\n\n\t/**\n\t * Set the layoutStyle of the content\n\t * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\n\t * @private\n\t */\n\tlayoutStyle(style) {\n\n\t\tif (style) {\n\t\t\tthis._layoutStyle = style;\n\t\t\tnavigator.epubReadingSystem.layoutStyle = this._layoutStyle;\n\t\t}\n\n\t\treturn this._layoutStyle || \"paginated\";\n\t}\n\n\t/**\n\t * Add the epubReadingSystem object to the navigator\n\t * @param {string} name\n\t * @param {string} version\n\t * @private\n\t */\n\tepubReadingSystem(name, version) {\n\t\tnavigator.epubReadingSystem = {\n\t\t\tname: name,\n\t\t\tversion: version,\n\t\t\tlayoutStyle: this.layoutStyle(),\n\t\t\thasFeature: function (feature) {\n\t\t\t\tswitch (feature) {\n\t\t\t\t\tcase \"dom-manipulation\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"layout-changes\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"touch-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"mouse-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"keyboard-events\":\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tcase \"spine-scripting\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn navigator.epubReadingSystem;\n\t}\n\n\tdestroy() {\n\t\t// this.document.removeEventListener('transitionend', this._resizeCheck);\n\n\t\tthis.removeListeners();\n\n\t}\n}\n\nEventEmitter(Contents.prototype);\n\nexport default Contents;\n"],"mappings":"AAAA,OAAOA,YAAY,MAAM,eAAe;AACxC,SAAQC,QAAQ,EAAEC,QAAQ,EAAEC,OAAO,EAAEC,QAAQ,QAAO,cAAc;AAClE,OAAOC,OAAO,MAAM,WAAW;AAC/B,OAAOC,OAAO,MAAM,WAAW;AAC/B,SAAQC,YAAY,QAAO,sBAAsB;AACjD,SAASC,cAAc,EAAEC,MAAM,EAAEC,UAAU,QAAQ,mBAAmB;AAEtE,MAAMC,YAAY,GAAG,OAAQC,SAAU,KAAK,WAAW;AAEvD,MAAMC,QAAQ,GAAGF,YAAY,IAAI,QAAQ,CAACG,IAAI,CAACF,SAAS,CAACG,SAAS,CAAC;AACnE,MAAMC,QAAQ,GAAGL,YAAY,IAAI,CAACE,QAAQ,IAAI,aAAa,CAACC,IAAI,CAACF,SAAS,CAACG,SAAS,CAAC;AAErF,MAAME,YAAY,GAAG,CAAC;AACtB,MAAMC,SAAS,GAAG,CAAC;;AAEnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,QAAQ,CAAC;EACdC,WAAW,CAACC,GAAG,EAAEC,OAAO,EAAEC,OAAO,EAAEC,YAAY,EAAE;IAChD;IACA,IAAI,CAACC,OAAO,GAAG,IAAIpB,OAAO,EAAE;IAE5B,IAAI,CAACqB,QAAQ,GAAGL,GAAG;IACnB,IAAI,CAACM,eAAe,GAAI,IAAI,CAACD,QAAQ,CAACC,eAAe;IACrD,IAAI,CAACL,OAAO,GAAGA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAC5C,IAAI,CAACC,MAAM,GAAG,IAAI,CAACH,QAAQ,CAACI,WAAW;IAEvC,IAAI,CAACC,KAAK,GAAG;MACZC,KAAK,EAAE,CAAC;MACRC,MAAM,EAAE;IACT,CAAC;IAED,IAAI,CAACT,YAAY,GAAGA,YAAY,IAAI,CAAC;IACrC,IAAI,CAACD,OAAO,GAAGA,OAAO,IAAI,EAAE;IAE5B,IAAI,CAACW,iBAAiB,CAAC,SAAS,EAAE1B,cAAc,CAAC;IACjD,IAAI,CAAC2B,MAAM,GAAG,CAAC;IACf,IAAI,CAACC,MAAM,GAAG,IAAI;IAClB,IAAI,CAACC,SAAS,EAAE;EACjB;;EAEA;AACD;AACA;EACC,WAAWC,cAAc,GAAG;IAC3B,OAAO5B,UAAU;EAClB;;EAEA;AACD;AACA;AACA;AACA;EACCsB,KAAK,CAACO,CAAC,EAAE;IACR;IACA,IAAIC,KAAK,GAAG,IAAI,CAAClB,OAAO;IAExB,IAAIiB,CAAC,IAAItC,QAAQ,CAACsC,CAAC,CAAC,EAAE;MACrBA,CAAC,GAAGA,CAAC,GAAG,IAAI;IACb;IAEA,IAAIA,CAAC,EAAE;MACNC,KAAK,CAACC,KAAK,CAACT,KAAK,GAAGO,CAAC;MACrB;IACD;;IAEA,OAAOG,QAAQ,CAAC,IAAI,CAACb,MAAM,CAACc,gBAAgB,CAACH,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC;EAG9D;;EAEA;AACD;AACA;AACA;AACA;EACCP,MAAM,CAACW,CAAC,EAAE;IACT;IACA,IAAIJ,KAAK,GAAG,IAAI,CAAClB,OAAO;IAExB,IAAIsB,CAAC,IAAI3C,QAAQ,CAAC2C,CAAC,CAAC,EAAE;MACrBA,CAAC,GAAGA,CAAC,GAAG,IAAI;IACb;IAEA,IAAIA,CAAC,EAAE;MACNJ,KAAK,CAACC,KAAK,CAACR,MAAM,GAAGW,CAAC;MACtB;IACD;;IAEA,OAAOF,QAAQ,CAAC,IAAI,CAACb,MAAM,CAACc,gBAAgB,CAACH,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC;EAE/D;;EAEA;AACD;AACA;AACA;AACA;EACCK,YAAY,CAACN,CAAC,EAAE;IAEf,IAAIjB,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAEhD,IAAIW,CAAC,IAAItC,QAAQ,CAACsC,CAAC,CAAC,EAAE;MACrBA,CAAC,GAAGA,CAAC,GAAG,IAAI;IACb;IAEA,IAAIA,CAAC,EAAE;MACNjB,OAAO,CAACmB,KAAK,CAACT,KAAK,GAAGO,CAAC;IACxB;IAEA,OAAOG,QAAQ,CAAC,IAAI,CAACb,MAAM,CAACc,gBAAgB,CAACrB,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC;EAGhE;;EAEA;AACD;AACA;AACA;AACA;EACCwB,aAAa,CAACF,CAAC,EAAE;IAEhB,IAAItB,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAEhD,IAAIgB,CAAC,IAAI3C,QAAQ,CAAC2C,CAAC,CAAC,EAAE;MACrBA,CAAC,GAAGA,CAAC,GAAG,IAAI;IACb;IAEA,IAAIA,CAAC,EAAE;MACNtB,OAAO,CAACmB,KAAK,CAACR,MAAM,GAAGW,CAAC;IACzB;IAEA,OAAOF,QAAQ,CAAC,IAAI,CAACb,MAAM,CAACc,gBAAgB,CAACrB,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;EAEjE;;EAEA;AACD;AACA;AACA;EACCyB,SAAS,GAAG;IACX,IAAIC,IAAI;IACR,IAAIhB,KAAK;IACT,IAAIiB,KAAK,GAAG,IAAI,CAACvB,QAAQ,CAACwB,WAAW,EAAE;IACvC,IAAI5B,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAChD,IAAIuB,MAAM,GAAGhD,OAAO,CAACmB,OAAO,CAAC;;IAE7B;IACA2B,KAAK,CAACG,kBAAkB,CAAC9B,OAAO,CAAC;;IAEjC;IACA0B,IAAI,GAAGC,KAAK,CAACI,qBAAqB,EAAE;IACpCrB,KAAK,GAAGgB,IAAI,CAAChB,KAAK;IAElB,IAAImB,MAAM,IAAIA,MAAM,CAACnB,KAAK,EAAE;MAC3BA,KAAK,IAAImB,MAAM,CAACnB,KAAK;IACtB;IAEA,OAAOsB,IAAI,CAACC,KAAK,CAACvB,KAAK,CAAC;EACzB;;EAEA;AACD;AACA;AACA;EACCwB,UAAU,GAAG;IACZ,IAAIR,IAAI;IACR,IAAIf,MAAM;IACV,IAAIgB,KAAK,GAAG,IAAI,CAACvB,QAAQ,CAACwB,WAAW,EAAE;IACvC,IAAI5B,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAEhDqB,KAAK,CAACG,kBAAkB,CAAC9B,OAAO,CAAC;IAEjC0B,IAAI,GAAGC,KAAK,CAACI,qBAAqB,EAAE;IACpCpB,MAAM,GAAGe,IAAI,CAACS,MAAM;IAEpB,OAAOH,IAAI,CAACC,KAAK,CAACtB,MAAM,CAAC;EAC1B;;EAEA;AACD;AACA;AACA;EACCyB,WAAW,GAAG;IACb,IAAI1B,KAAK,GAAG,IAAI,CAACL,eAAe,CAAC+B,WAAW;IAE5C,OAAO1B,KAAK;EACb;;EAEA;AACD;AACA;AACA;EACC2B,YAAY,GAAG;IACd,IAAI1B,MAAM,GAAG,IAAI,CAACN,eAAe,CAACgC,YAAY;IAE9C,OAAO1B,MAAM;EACd;;EAEA;AACD;AACA;AACA;EACC2B,QAAQ,CAACA,QAAQ,EAAE;IAElB,IAAIA,QAAQ,EAAE;MACb,IAAI,CAACjC,eAAe,CAACc,KAAK,CAACmB,QAAQ,GAAGA,QAAQ;IAC/C;IAEA,OAAO,IAAI,CAAC/B,MAAM,CAACc,gBAAgB,CAAC,IAAI,CAAChB,eAAe,CAAC,CAAC,UAAU,CAAC;EACtE;;EAEA;AACD;AACA;AACA;EACCkC,SAAS,CAACD,QAAQ,EAAE;IAEnB,IAAIA,QAAQ,EAAE;MACb,IAAI,CAACjC,eAAe,CAACc,KAAK,CAACoB,SAAS,GAAGD,QAAQ;IAChD;IAEA,OAAO,IAAI,CAAC/B,MAAM,CAACc,gBAAgB,CAAC,IAAI,CAAChB,eAAe,CAAC,CAAC,WAAW,CAAC;EACvE;;EAEA;AACD;AACA;AACA;EACCmC,SAAS,CAACF,QAAQ,EAAE;IAEnB,IAAIA,QAAQ,EAAE;MACb,IAAI,CAACjC,eAAe,CAACc,KAAK,CAACqB,SAAS,GAAGF,QAAQ;IAChD;IAEA,OAAO,IAAI,CAAC/B,MAAM,CAACc,gBAAgB,CAAC,IAAI,CAAChB,eAAe,CAAC,CAAC,WAAW,CAAC;EACvE;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCoC,GAAG,CAACC,QAAQ,EAAEC,KAAK,EAAEC,QAAQ,EAAE;IAC9B,IAAI5C,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAEhD,IAAIqC,KAAK,EAAE;MACV3C,OAAO,CAACmB,KAAK,CAAC0B,WAAW,CAACH,QAAQ,EAAEC,KAAK,EAAEC,QAAQ,GAAG,WAAW,GAAG,EAAE,CAAC;IACxE,CAAC,MAAM;MACN5C,OAAO,CAACmB,KAAK,CAAC2B,cAAc,CAACJ,QAAQ,CAAC;IACvC;IAEA,OAAO,IAAI,CAACnC,MAAM,CAACc,gBAAgB,CAACrB,OAAO,CAAC,CAAC0C,QAAQ,CAAC;EACvD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACCK,QAAQ,CAACC,OAAO,EAAE;IACjB,IAAIC,MAAM,EAAEC,OAAO,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,SAAS;IAC1D;IACA,IAAIC,SAAS,GAAG,IAAI,CAACnD,QAAQ,CAACoD,aAAa,CAAC,uBAAuB,CAAC;IACpE,IAAIC,MAAM,GAAG;MACZ,OAAO,EAAEC,SAAS;MAClB,QAAQ,EAAEA,SAAS;MACnB,OAAO,EAAEA,SAAS;MAClB,SAAS,EAAEA,SAAS;MACpB,SAAS,EAAEA,SAAS;MACpB,UAAU,EAAEA;IACb,CAAC;IACD,IAAIC,UAAU,GAAG,EAAE;IACnB,IAAIC,QAAQ,GAAG,CAAC,CAAC;;IAEjB;AACF;AACA;AACA;IACE,IAAGL,SAAS,IAAIA,SAAS,CAACM,YAAY,CAAC,SAAS,CAAC,EAAE;MAClD,IAAI7D,OAAO,GAAGuD,SAAS,CAACO,YAAY,CAAC,SAAS,CAAC;MAC/C,IAAIb,MAAM,GAAGjD,OAAO,CAAC+D,KAAK,CAAC,qBAAqB,CAAC;MACjD,IAAIb,OAAO,GAAGlD,OAAO,CAAC+D,KAAK,CAAC,sBAAsB,CAAC;MACnD,IAAIZ,MAAM,GAAGnD,OAAO,CAAC+D,KAAK,CAAC,6BAA6B,CAAC;MACzD,IAAIX,QAAQ,GAAGpD,OAAO,CAAC+D,KAAK,CAAC,6BAA6B,CAAC;MAC3D,IAAIV,QAAQ,GAAGrD,OAAO,CAAC+D,KAAK,CAAC,6BAA6B,CAAC;MAC3D,IAAIT,SAAS,GAAGtD,OAAO,CAAC+D,KAAK,CAAC,6BAA6B,CAAC;MAE5D,IAAGd,MAAM,IAAIA,MAAM,CAACe,MAAM,IAAI,OAAOf,MAAM,CAAC,CAAC,CAAC,KAAK,WAAW,EAAC;QAC9DQ,MAAM,CAAC/C,KAAK,GAAGuC,MAAM,CAAC,CAAC,CAAC;MACzB;MACA,IAAGC,OAAO,IAAIA,OAAO,CAACc,MAAM,IAAI,OAAOd,OAAO,CAAC,CAAC,CAAC,KAAK,WAAW,EAAC;QACjEO,MAAM,CAAC9C,MAAM,GAAGuC,OAAO,CAAC,CAAC,CAAC;MAC3B;MACA,IAAGC,MAAM,IAAIA,MAAM,CAACa,MAAM,IAAI,OAAOb,MAAM,CAAC,CAAC,CAAC,KAAK,WAAW,EAAC;QAC9DM,MAAM,CAACQ,KAAK,GAAGd,MAAM,CAAC,CAAC,CAAC;MACzB;MACA,IAAGC,QAAQ,IAAIA,QAAQ,CAACY,MAAM,IAAI,OAAOZ,QAAQ,CAAC,CAAC,CAAC,KAAK,WAAW,EAAC;QACpEK,MAAM,CAACS,OAAO,GAAGd,QAAQ,CAAC,CAAC,CAAC;MAC7B;MACA,IAAGC,QAAQ,IAAIA,QAAQ,CAACW,MAAM,IAAI,OAAOX,QAAQ,CAAC,CAAC,CAAC,KAAK,WAAW,EAAC;QACpEI,MAAM,CAACU,OAAO,GAAGd,QAAQ,CAAC,CAAC,CAAC;MAC7B;MACA,IAAGC,SAAS,IAAIA,SAAS,CAACU,MAAM,IAAI,OAAOV,SAAS,CAAC,CAAC,CAAC,KAAK,WAAW,EAAC;QACvEG,MAAM,CAACW,QAAQ,GAAGd,SAAS,CAAC,CAAC,CAAC;MAC/B;IACD;IAEAM,QAAQ,GAAG9E,QAAQ,CAACkE,OAAO,IAAI,CAAC,CAAC,EAAES,MAAM,CAAC;IAE1C,IAAIT,OAAO,EAAE;MACZ,IAAIY,QAAQ,CAAClD,KAAK,EAAE;QACnBiD,UAAU,CAACU,IAAI,CAAC,QAAQ,GAAGT,QAAQ,CAAClD,KAAK,CAAC;MAC3C;MAEA,IAAIkD,QAAQ,CAACjD,MAAM,EAAE;QACpBgD,UAAU,CAACU,IAAI,CAAC,SAAS,GAAGT,QAAQ,CAACjD,MAAM,CAAC;MAC7C;MAEA,IAAIiD,QAAQ,CAACK,KAAK,EAAE;QACnBN,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACK,KAAK,CAAC;MACnD;MAEA,IAAIL,QAAQ,CAACQ,QAAQ,KAAK,IAAI,EAAE;QAC/BT,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACK,KAAK,CAAC;QAClDN,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACK,KAAK,CAAC;QAClDN,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACQ,QAAQ,CAAC;MACtD,CAAC,MAAM;QAEN,IAAIR,QAAQ,CAACQ,QAAQ,EAAE;UACtBT,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACQ,QAAQ,CAAC;QACtD;QAEA,IAAIR,QAAQ,CAACM,OAAO,EAAE;UACrBP,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACM,OAAO,CAAC;QACrD;QAEA,IAAIN,QAAQ,CAACO,OAAO,EAAE;UACrBR,UAAU,CAACU,IAAI,CAAC,gBAAgB,GAAGT,QAAQ,CAACO,OAAO,CAAC;QACrD;MACD;MAEA,IAAI,CAACZ,SAAS,EAAE;QACfA,SAAS,GAAG,IAAI,CAACnD,QAAQ,CAACkE,aAAa,CAAC,MAAM,CAAC;QAC/Cf,SAAS,CAACgB,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC;QAC1C,IAAI,CAACnE,QAAQ,CAACoD,aAAa,CAAC,MAAM,CAAC,CAACgB,WAAW,CAACjB,SAAS,CAAC;MAC3D;MAEAA,SAAS,CAACgB,YAAY,CAAC,SAAS,EAAEZ,UAAU,CAACc,IAAI,CAAC,IAAI,CAAC,CAAC;MAExD,IAAI,CAAClE,MAAM,CAACmE,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;IAC3B;IAGA,OAAOd,QAAQ;EAChB;;EAEA;AACD;AACA;AACA;EACCe,MAAM,GAAG;IACR,IAAI,CAACC,IAAI,CAACzF,MAAM,CAAC0F,QAAQ,CAACC,MAAM,CAAC;EAClC;;EAEA;AACD;AACA;AACA;EACC/D,SAAS,GAAG;IACX,IAAI,CAACgE,kBAAkB,EAAE;IAEzB,IAAI,CAACC,mBAAmB,EAAE;;IAE1B;;IAEA,IAAI,CAACC,iBAAiB,EAAE;IAExB,IAAI,CAACC,qBAAqB,EAAE;;IAE5B;;IAEA,IAAI,OAAOC,cAAc,KAAK,WAAW,EAAE;MAC1C,IAAI,CAACC,eAAe,EAAE;MACtB,IAAI,CAACC,mBAAmB,EAAE;IAC3B,CAAC,MAAM;MACN,IAAI,CAACC,eAAe,EAAE;IACvB;;IAEA;;IAEA,IAAI,CAACC,YAAY,EAAE;EACpB;;EAEA;AACD;AACA;AACA;EACCC,eAAe,GAAG;IAEjB,IAAI,CAACC,oBAAoB,EAAE;IAE3B,IAAI,CAACC,wBAAwB,EAAE;IAE/B,IAAI,IAAI,CAACC,QAAQ,EAAE;MAClB,IAAI,CAACA,QAAQ,CAACC,UAAU,EAAE;IAC3B;IAEAC,YAAY,CAAC,IAAI,CAACC,SAAS,CAAC;EAC7B;;EAEA;AACD;AACA;AACA;AACA;EACCC,WAAW,GAAG;IACb,IAAIrF,KAAK,GAAG,IAAI,CAACe,SAAS,EAAE;IAC5B,IAAId,MAAM,GAAG,IAAI,CAACuB,UAAU,EAAE;IAE9B,IAAIxB,KAAK,IAAI,IAAI,CAACD,KAAK,CAACC,KAAK,IAAIC,MAAM,IAAI,IAAI,CAACF,KAAK,CAACE,MAAM,EAAE;MAE7D,IAAI,CAACF,KAAK,GAAG;QACZC,KAAK,EAAEA,KAAK;QACZC,MAAM,EAAEA;MACT,CAAC;MAED,IAAI,CAACqF,QAAQ,IAAI,IAAI,CAACA,QAAQ,CAAC,IAAI,CAACvF,KAAK,CAAC;MAC1C,IAAI,CAACmE,IAAI,CAACzF,MAAM,CAAC0F,QAAQ,CAACoB,MAAM,EAAE,IAAI,CAACxF,KAAK,CAAC;IAC9C;EACD;;EAEA;AACD;AACA;AACA;EACC2E,eAAe,GAAG;IACjB,IAAI1E,KAAK,EAAEC,MAAM;IACjB;IACAkF,YAAY,CAAC,IAAI,CAACC,SAAS,CAAC;IAC5BI,qBAAqB,CAAC,IAAI,CAACH,WAAW,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC;IAClD,IAAI,CAACL,SAAS,GAAGM,UAAU,CAAC,IAAI,CAAChB,eAAe,CAACe,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC;EAClE;;EAEA;AACD;AACA;AACA;EACCd,mBAAmB,GAAG;IACrBjF,QAAQ,CAACiG,gBAAgB,CAAC,kBAAkB,EAAE,MAAM;MACnD,IAAIjG,QAAQ,CAACkG,eAAe,KAAK,SAAS,IAAI,IAAI,CAACxF,MAAM,KAAK,KAAK,EAAE;QACpE,IAAI,CAACA,MAAM,GAAG,IAAI;QAClB,IAAI,CAACsE,eAAe,EAAE;MACvB,CAAC,MAAM;QACN,IAAI,CAACtE,MAAM,GAAG,KAAK;QACnB+E,YAAY,CAAC,IAAI,CAACC,SAAS,CAAC;MAC7B;IACD,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;EACCS,mBAAmB,GAAG;IACrB,IAAIjG,IAAI,GAAG,IAAI,CAACN,OAAO;IAEvBM,IAAI,CAACa,KAAK,CAAC,oBAAoB,CAAC,GAAG,sGAAsG;IACzIb,IAAI,CAACa,KAAK,CAAC,oBAAoB,CAAC,GAAG,SAAS;IAC5Cb,IAAI,CAACa,KAAK,CAAC,0BAA0B,CAAC,GAAG,QAAQ;IACjDb,IAAI,CAACa,KAAK,CAAC,iBAAiB,CAAC,GAAG,GAAG;IAEnC,IAAI,CAACqF,YAAY,GAAG,IAAI,CAACT,WAAW,CAACI,IAAI,CAAC,IAAI,CAAC;IAC/C,IAAI,CAAC/F,QAAQ,CAACiG,gBAAgB,CAAC,eAAe,EAAE,IAAI,CAACG,YAAY,CAAC;EACnE;;EAEA;AACD;AACA;AACA;AACA;EACCxB,mBAAmB,GAAG;IACrB,IAAIyB,MAAM,GAAG,IAAI,CAACrG,QAAQ,CAACsG,WAAW;IACtC,IAAIC,kBAAkB,GAAG,UAASC,CAAC,EAAC;MACnC,IAAGA,CAAC,CAACC,OAAO,IAAI,CAAC,IAAI,CAACC,UAAU,EAAE;QACjCV,UAAU,CAAC,IAAI,CAACzB,MAAM,CAACwB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;MACtC;IACD,CAAC,CAACA,IAAI,CAAC,IAAI,CAAC;IAEZ,KAAK,IAAIY,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGN,MAAM,CAACzC,MAAM,EAAE+C,CAAC,IAAI,CAAC,EAAE;MAC1C,IAAIC,KAAK;MACT;MACA,IAAI;QACHA,KAAK,GAAGP,MAAM,CAACM,CAAC,CAAC,CAACE,QAAQ;MAC3B,CAAC,CAAC,OAAOC,CAAC,EAAE;QACX;MACD;MACA,IAAG,CAACF,KAAK,EAAE,OAAO,CAAC;MACnB,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,KAAK,CAAChD,MAAM,EAAEmD,CAAC,IAAI,CAAC,EAAE;QACzC;QACA,IAAGH,KAAK,CAACG,CAAC,CAAC,CAACC,KAAK,EAAC;UACjB,IAAIC,GAAG,GAAG,IAAI,CAAC9G,MAAM,CAAC+G,UAAU,CAACN,KAAK,CAACG,CAAC,CAAC,CAACC,KAAK,CAACG,SAAS,CAAC;UAC1DF,GAAG,CAACG,WAAW,CAACb,kBAAkB,CAAC;UACnC;QACD;MACD;IACD;EACD;;EAEA;AACD;AACA;AACA;EACCrB,eAAe,GAAG;IACjB;IACA,IAAI,CAACK,QAAQ,GAAG,IAAIR,cAAc,CAAE+B,CAAC,IAAK;MACzChB,qBAAqB,CAAC,IAAI,CAACH,WAAW,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC;IACnD,CAAC,CAAC;;IAEF;IACA,IAAI,CAACR,QAAQ,CAAC8B,OAAO,CAAC,IAAI,CAACrH,QAAQ,CAACC,eAAe,CAAC;EACrD;;EAEA;AACD;AACA;AACA;EACCqH,iBAAiB,GAAG;IACnB;IACA,IAAI,CAAC/B,QAAQ,GAAG,IAAIgC,gBAAgB,CAAEC,SAAS,IAAK;MACnD,IAAI,CAAC7B,WAAW,EAAE;IACnB,CAAC,CAAC;;IAEF;IACA,IAAI8B,MAAM,GAAG;MAAEC,UAAU,EAAE,IAAI;MAAEC,SAAS,EAAE,IAAI;MAAEC,aAAa,EAAE,IAAI;MAAEC,OAAO,EAAE;IAAK,CAAC;;IAEtF;IACA,IAAI,CAACtC,QAAQ,CAAC8B,OAAO,CAAC,IAAI,CAACrH,QAAQ,EAAEyH,MAAM,CAAC;EAC7C;;EAEA;AACD;AACA;AACA;EACC9C,kBAAkB,GAAG;IACpB,IAAImD,MAAM,GAAG,IAAI,CAAC9H,QAAQ,CAAC+H,gBAAgB,CAAC,KAAK,CAAC;IAClD,IAAIC,GAAG;IACP,KAAK,IAAIrB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGmB,MAAM,CAAClE,MAAM,EAAE+C,CAAC,EAAE,EAAE;MACvCqB,GAAG,GAAGF,MAAM,CAACnB,CAAC,CAAC;MAEf,IAAI,OAAOqB,GAAG,CAACC,YAAY,KAAK,WAAW,IACzCD,GAAG,CAACC,YAAY,KAAK,CAAC,EAAE;QACzBD,GAAG,CAACE,MAAM,GAAG,IAAI,CAAC3D,MAAM,CAACwB,IAAI,CAAC,IAAI,CAAC;MACpC;IACD;EACD;;EAEA;AACD;AACA;AACA;EACCoC,iBAAiB,GAAG;IACnB,IAAI,CAAC,IAAI,CAACnI,QAAQ,IAAI,CAAC,IAAI,CAACA,QAAQ,CAACoI,KAAK,EAAE;MAC3C;IACD;IAEA,IAAI,CAACpI,QAAQ,CAACoI,KAAK,CAACC,KAAK,CAACC,IAAI,CAAC,YAAY;MAC1C,IAAI,CAAC3C,WAAW,EAAE;IACnB,CAAC,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC;EAEd;;EAEA;AACD;AACA;AACA;EACCwC,IAAI,GAAG;IACN,IAAG,CAAC,IAAI,CAACvI,QAAQ,EAAE,OAAO,IAAI;IAC9B,OAAO,IAAI,CAACA,QAAQ,CAACC,eAAe;EACrC;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCuI,UAAU,CAACC,MAAM,EAAEC,WAAW,EAAE;IAC/B,IAAIC,QAAQ;IACZ,IAAIC,SAAS,GAAG;MAAC,MAAM,EAAE,CAAC;MAAE,KAAK,EAAE;IAAC,CAAC;IAErC,IAAG,CAAC,IAAI,CAAC5I,QAAQ,EAAE,OAAO4I,SAAS;IAEnC,IAAG,IAAI,CAAC7I,OAAO,CAAC8I,WAAW,CAACJ,MAAM,CAAC,EAAE;MACpC,IAAIlH,KAAK,GAAG,IAAI5C,OAAO,CAAC8J,MAAM,CAAC,CAACK,OAAO,CAAC,IAAI,CAAC9I,QAAQ,EAAE0I,WAAW,CAAC;MAEnE,IAAGnH,KAAK,EAAE;QACT,IAAI;UACH,IAAI,CAACA,KAAK,CAACwH,YAAY,IACrBxH,KAAK,CAACyH,cAAc,IAAIzH,KAAK,CAACwH,YAAY,IACxCxH,KAAK,CAAC0H,WAAW,IAAI1H,KAAK,CAAC2H,SAAU,EAAE;YAC1C;YACA;YACA;YACA;YACA,IAAIC,GAAG,GAAG5H,KAAK,CAACyH,cAAc,CAACI,WAAW,CAACC,OAAO,CAAC,GAAG,EAAE9H,KAAK,CAAC0H,WAAW,CAAC;YAC1E,IAAIE,GAAG,IAAI,CAAC,CAAC,EAAE;cACdA,GAAG,GAAG5H,KAAK,CAACyH,cAAc,CAACI,WAAW,CAACxF,MAAM;YAC9C;YACArC,KAAK,CAAC+H,MAAM,CAAC/H,KAAK,CAACyH,cAAc,EAAEG,GAAG,CAAC;UACxC;QACD,CAAC,CAAC,OAAOrC,CAAC,EAAE;UACXyC,OAAO,CAACC,KAAK,CAAC,qDAAqD,EAAE1C,CAAC,CAAC;QACxE;QAEA,IAAIvF,KAAK,CAACyH,cAAc,CAACS,QAAQ,KAAKC,IAAI,CAACnK,YAAY,EAAE;UACxDoJ,QAAQ,GAAGpH,KAAK,CAACyH,cAAc,CAACrH,qBAAqB,EAAE;UACvDiH,SAAS,CAACe,IAAI,GAAGhB,QAAQ,CAACgB,IAAI;UAC9Bf,SAAS,CAACgB,GAAG,GAAGjB,QAAQ,CAACiB,GAAG;QAC7B,CAAC,MAAM;UACN;UACA;;UAEA;UACA,IAAItK,QAAQ,EAAE;YACb,IAAIuK,SAAS,GAAGtI,KAAK,CAACyH,cAAc;YACpC,IAAIc,QAAQ,GAAG,IAAIC,KAAK,EAAE;YAC1B,IAAI;cACH,IAAIF,SAAS,CAACJ,QAAQ,KAAKlK,YAAY,EAAE;gBACxCoJ,QAAQ,GAAGkB,SAAS,CAAClI,qBAAqB,EAAE;cAC7C,CAAC,MAAM,IAAIJ,KAAK,CAAC0H,WAAW,GAAG,CAAC,GAAGY,SAAS,CAACjG,MAAM,EAAE;gBACpDkG,QAAQ,CAACE,QAAQ,CAACH,SAAS,EAAEtI,KAAK,CAAC0H,WAAW,CAAC;gBAC/Ca,QAAQ,CAACR,MAAM,CAACO,SAAS,EAAEtI,KAAK,CAAC0H,WAAW,GAAG,CAAC,CAAC;gBACjDN,QAAQ,GAAGmB,QAAQ,CAACnI,qBAAqB,EAAE;cAC5C,CAAC,MAAM,IAAIJ,KAAK,CAAC0H,WAAW,GAAG,CAAC,GAAG,CAAC,EAAE;gBACrCa,QAAQ,CAACE,QAAQ,CAACH,SAAS,EAAEtI,KAAK,CAAC0H,WAAW,GAAG,CAAC,CAAC;gBACnDa,QAAQ,CAACR,MAAM,CAACO,SAAS,EAAEtI,KAAK,CAAC0H,WAAW,CAAC;gBAC7CN,QAAQ,GAAGmB,QAAQ,CAACnI,qBAAqB,EAAE;cAC5C,CAAC,MAAM;gBAAE;gBACRgH,QAAQ,GAAGkB,SAAS,CAACI,UAAU,CAACtI,qBAAqB,EAAE;cACxD;YACD,CAAC,CAAC,OAAOmF,CAAC,EAAE;cACXyC,OAAO,CAACC,KAAK,CAAC1C,CAAC,EAAEA,CAAC,CAACoD,KAAK,CAAC;YAC1B;UACD,CAAC,MAAM;YACNvB,QAAQ,GAAGpH,KAAK,CAACI,qBAAqB,EAAE;UACzC;QACD;MACD;IAED,CAAC,MAAM,IAAG,OAAO8G,MAAM,KAAK,QAAQ,IACnCA,MAAM,CAACY,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE;MAE1B,IAAIc,EAAE,GAAG1B,MAAM,CAAC2B,SAAS,CAAC3B,MAAM,CAACY,OAAO,CAAC,GAAG,CAAC,GAAC,CAAC,CAAC;MAChD,IAAIgB,EAAE,GAAG,IAAI,CAACrK,QAAQ,CAACsK,cAAc,CAACH,EAAE,CAAC;MACzC,IAAGE,EAAE,EAAE;QACN,IAAI/K,QAAQ,EAAE;UACb;UACA,IAAIwK,QAAQ,GAAG,IAAIC,KAAK,EAAE;UAC1BD,QAAQ,CAACS,UAAU,CAACF,EAAE,CAAC;UACvB1B,QAAQ,GAAGmB,QAAQ,CAACnI,qBAAqB,EAAE;QAC5C,CAAC,MAAM;UACNgH,QAAQ,GAAG0B,EAAE,CAAC1I,qBAAqB,EAAE;QACtC;MACD;IACD;IAEA,IAAIgH,QAAQ,EAAE;MACbC,SAAS,CAACe,IAAI,GAAGhB,QAAQ,CAACgB,IAAI;MAC9Bf,SAAS,CAACgB,GAAG,GAAGjB,QAAQ,CAACiB,GAAG;IAC7B;IAEA,OAAOhB,SAAS;EACjB;;EAEA;AACD;AACA;AACA;EACC4B,aAAa,CAACC,GAAG,EAAE;IAClB,OAAO,IAAIC,OAAO,CAAC,UAASC,OAAO,EAAEC,MAAM,EAAC;MAC3C,IAAIC,WAAW;MACf,IAAIxC,KAAK,GAAG,KAAK;MAEjB,IAAG,CAAC,IAAI,CAACrI,QAAQ,EAAE;QAClB2K,OAAO,CAAC,KAAK,CAAC;QACd;MACD;;MAEA;MACAE,WAAW,GAAG,IAAI,CAAC7K,QAAQ,CAACoD,aAAa,CAAC,aAAa,GAACqH,GAAG,GAAC,IAAI,CAAC;MACjE,IAAII,WAAW,EAAE;QAChBF,OAAO,CAAC,IAAI,CAAC;QACb,OAAO,CAAC;MACT;;MAEAE,WAAW,GAAG,IAAI,CAAC7K,QAAQ,CAACkE,aAAa,CAAC,MAAM,CAAC;MACjD2G,WAAW,CAACC,IAAI,GAAG,UAAU;MAC7BD,WAAW,CAACE,GAAG,GAAG,YAAY;MAC9BF,WAAW,CAACG,IAAI,GAAGP,GAAG;MACtBI,WAAW,CAAC3C,MAAM,GAAG2C,WAAW,CAACI,kBAAkB,GAAG,YAAW;QAChE,IAAK,CAAC5C,KAAK,KAAK,CAAC,IAAI,CAAC6C,UAAU,IAAI,IAAI,CAACA,UAAU,IAAI,UAAU,CAAC,EAAG;UACpE7C,KAAK,GAAG,IAAI;UACZ;UACArC,UAAU,CAAC,MAAM;YAChB2E,OAAO,CAAC,IAAI,CAAC;UACd,CAAC,EAAE,CAAC,CAAC;QACN;MACD,CAAC;MAED,IAAI,CAAC3K,QAAQ,CAACmL,IAAI,CAAC/G,WAAW,CAACyG,WAAW,CAAC;IAE5C,CAAC,CAAC9E,IAAI,CAAC,IAAI,CAAC,CAAC;EACd;EAEAqF,kBAAkB,CAACC,GAAG,EAAE;IACvB,IAAIC,OAAO;IACXD,GAAG,GAAG,sBAAsB,IAAIA,GAAG,IAAI,EAAE,CAAC;IAE1C,IAAG,CAAC,IAAI,CAACrL,QAAQ,EAAE,OAAO,KAAK;;IAE/B;IACAsL,OAAO,GAAG,IAAI,CAACtL,QAAQ,CAACsK,cAAc,CAACe,GAAG,CAAC;IAC3C,IAAI,CAACC,OAAO,EAAE;MACbA,OAAO,GAAG,IAAI,CAACtL,QAAQ,CAACkE,aAAa,CAAC,OAAO,CAAC;MAC9CoH,OAAO,CAACnB,EAAE,GAAGkB,GAAG;MAChB;MACA,IAAI,CAACrL,QAAQ,CAACmL,IAAI,CAAC/G,WAAW,CAACkH,OAAO,CAAC;IACxC;IACA,OAAOA,OAAO;EACf;;EAEA;AACD;AACA;AACA;AACA;EACCC,gBAAgB,CAACC,aAAa,EAAEH,GAAG,EAAE;IACpC,IAAG,CAAC,IAAI,CAACrL,QAAQ,IAAI,CAACwL,aAAa,EAAE,OAAO,KAAK;IAEjD,IAAIF,OAAO;IACXA,OAAO,GAAG,IAAI,CAACF,kBAAkB,CAACC,GAAG,CAAC;IACtCC,OAAO,CAACG,SAAS,GAAGD,aAAa;IAEjC,OAAO,IAAI;EACZ;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACCE,kBAAkB,CAAC9E,KAAK,EAAEyE,GAAG,EAAE;IAC9B,IAAIM,UAAU;IAEd,IAAG,CAAC,IAAI,CAAC3L,QAAQ,IAAI,CAAC4G,KAAK,IAAIA,KAAK,CAAChD,MAAM,KAAK,CAAC,EAAE;;IAEnD;IACA+H,UAAU,GAAG,IAAI,CAACP,kBAAkB,CAACC,GAAG,CAAC,CAACO,KAAK;IAE/C,IAAIC,MAAM,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACpF,KAAK,CAAC,KAAK,gBAAgB,EAAE;MAC/D,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEsF,EAAE,GAAGrF,KAAK,CAAChD,MAAM,EAAE+C,CAAC,GAAGsF,EAAE,EAAEtF,CAAC,EAAE,EAAE;QAC/C,IAAII,CAAC,GAAG,CAAC;UAAEmF,IAAI,GAAGtF,KAAK,CAACD,CAAC,CAAC;UAAEwF,QAAQ,GAAGvF,KAAK,CAACD,CAAC,CAAC,CAAC,CAAC,CAAC;UAAEyF,OAAO,GAAG,EAAE;QAChE;QACA,IAAIP,MAAM,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,gBAAgB,EAAE;UACpEA,IAAI,GAAGA,IAAI,CAAC,CAAC,CAAC;UACdnF,CAAC,GAAG,CAAC;QACN;QAEA,KAAK,IAAIsF,EAAE,GAAGH,IAAI,CAACtI,MAAM,EAAEmD,CAAC,GAAGsF,EAAE,EAAEtF,CAAC,EAAE,EAAE;UACvC,IAAIuF,IAAI,GAAGJ,IAAI,CAACnF,CAAC,CAAC;UAClBqF,OAAO,IAAIE,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGA,IAAI,CAAC,CAAC,CAAC,IAAIA,IAAI,CAAC,CAAC,CAAC,GAAG,aAAa,GAAG,EAAE,CAAC,GAAG,KAAK;QAC5E;;QAEA;QACAX,UAAU,CAACY,UAAU,CAACJ,QAAQ,GAAG,GAAG,GAAGC,OAAO,GAAG,GAAG,EAAET,UAAU,CAAC9E,QAAQ,CAACjD,MAAM,CAAC;MAClF;IACD,CAAC,MAAM;MACN,MAAM4I,SAAS,GAAGX,MAAM,CAACY,IAAI,CAAC7F,KAAK,CAAC;MACpC4F,SAAS,CAACE,OAAO,CAAEP,QAAQ,IAAK;QAC/B,MAAMQ,UAAU,GAAG/F,KAAK,CAACuF,QAAQ,CAAC;QAClC,IAAIS,KAAK,CAACC,OAAO,CAACF,UAAU,CAAC,EAAE;UAC9BA,UAAU,CAACD,OAAO,CAAEI,IAAI,IAAK;YAC5B,MAAMC,MAAM,GAAGlB,MAAM,CAACY,IAAI,CAACK,IAAI,CAAC;YAChC,MAAME,MAAM,GAAGD,MAAM,CAACE,GAAG,CAAEf,IAAI,IAAK;cACnC,OAAQ,GAAEA,IAAK,IAAGY,IAAI,CAACZ,IAAI,CAAE,EAAC;YAC/B,CAAC,CAAC,CAAC7H,IAAI,CAAC,GAAG,CAAC;YACZsH,UAAU,CAACY,UAAU,CAAE,GAAEJ,QAAS,IAAGa,MAAO,GAAE,EAAErB,UAAU,CAAC9E,QAAQ,CAACjD,MAAM,CAAC;UAC5E,CAAC,CAAC;QACH,CAAC,MAAM;UACN,MAAMmJ,MAAM,GAAGlB,MAAM,CAACY,IAAI,CAACE,UAAU,CAAC;UACtC,MAAMK,MAAM,GAAGD,MAAM,CAACE,GAAG,CAAEf,IAAI,IAAK;YACnC,OAAQ,GAAEA,IAAK,IAAGS,UAAU,CAACT,IAAI,CAAE,EAAC;UACrC,CAAC,CAAC,CAAC7H,IAAI,CAAC,GAAG,CAAC;UACZsH,UAAU,CAACY,UAAU,CAAE,GAAEJ,QAAS,IAAGa,MAAO,GAAE,EAAErB,UAAU,CAAC9E,QAAQ,CAACjD,MAAM,CAAC;QAC5E;MACD,CAAC,CAAC;IACH;EACD;;EAEA;AACD;AACA;AACA;AACA;EACCsJ,SAAS,CAACzC,GAAG,EAAE;IAEd,OAAO,IAAIC,OAAO,CAAC,UAASC,OAAO,EAAEC,MAAM,EAAC;MAC3C,IAAIuC,OAAO;MACX,IAAI9E,KAAK,GAAG,KAAK;MAEjB,IAAG,CAAC,IAAI,CAACrI,QAAQ,EAAE;QAClB2K,OAAO,CAAC,KAAK,CAAC;QACd;MACD;MAEAwC,OAAO,GAAG,IAAI,CAACnN,QAAQ,CAACkE,aAAa,CAAC,QAAQ,CAAC;MAC/CiJ,OAAO,CAACrC,IAAI,GAAG,iBAAiB;MAChCqC,OAAO,CAACC,KAAK,GAAG,IAAI;MACpBD,OAAO,CAAC1C,GAAG,GAAGA,GAAG;MACjB0C,OAAO,CAACjF,MAAM,GAAGiF,OAAO,CAAClC,kBAAkB,GAAG,YAAW;QACxD,IAAK,CAAC5C,KAAK,KAAK,CAAC,IAAI,CAAC6C,UAAU,IAAI,IAAI,CAACA,UAAU,IAAI,UAAU,CAAC,EAAG;UACpE7C,KAAK,GAAG,IAAI;UACZrC,UAAU,CAAC,YAAU;YACpB2E,OAAO,CAAC,IAAI,CAAC;UACd,CAAC,EAAE,CAAC,CAAC;QACN;MACD,CAAC;MAED,IAAI,CAAC3K,QAAQ,CAACmL,IAAI,CAAC/G,WAAW,CAAC+I,OAAO,CAAC;IAExC,CAAC,CAACpH,IAAI,CAAC,IAAI,CAAC,CAAC;EACd;;EAEA;AACD;AACA;AACA;EACCsH,QAAQ,CAACC,SAAS,EAAE;IACnB,IAAI1N,OAAO;IAEX,IAAG,CAAC,IAAI,CAACI,QAAQ,EAAE;IAEnBJ,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAE5C,IAAIN,OAAO,EAAE;MACZA,OAAO,CAAC2N,SAAS,CAACC,GAAG,CAACF,SAAS,CAAC;IACjC;EAED;;EAEA;AACD;AACA;AACA;EACCG,WAAW,CAACH,SAAS,EAAE;IACtB,IAAI1N,OAAO;IAEX,IAAG,CAAC,IAAI,CAACI,QAAQ,EAAE;IAEnBJ,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,IAAI,CAACI,QAAQ,CAACE,IAAI;IAE5C,IAAIN,OAAO,EAAE;MACZA,OAAO,CAAC2N,SAAS,CAACG,MAAM,CAACJ,SAAS,CAAC;IACpC;EAED;;EAEA;AACD;AACA;AACA;EACCzI,iBAAiB,GAAE;IAClB,IAAG,CAAC,IAAI,CAAC7E,QAAQ,EAAE;MAClB;IACD;IAEA,IAAI,CAAC2N,aAAa,GAAG,IAAI,CAACC,YAAY,CAAC7H,IAAI,CAAC,IAAI,CAAC;IAEjD/G,UAAU,CAAC0N,OAAO,CAAC,UAASmB,SAAS,EAAC;MACrC,IAAI,CAAC7N,QAAQ,CAACiG,gBAAgB,CAAC4H,SAAS,EAAE,IAAI,CAACF,aAAa,EAAE;QAAEG,OAAO,EAAE;MAAK,CAAC,CAAC;IACjF,CAAC,EAAE,IAAI,CAAC;EAET;;EAEA;AACD;AACA;AACA;EACCzI,oBAAoB,GAAE;IACrB,IAAG,CAAC,IAAI,CAACrF,QAAQ,EAAE;MAClB;IACD;IACAhB,UAAU,CAAC0N,OAAO,CAAC,UAASmB,SAAS,EAAC;MACrC,IAAI,CAAC7N,QAAQ,CAAC+N,mBAAmB,CAACF,SAAS,EAAE,IAAI,CAACF,aAAa,EAAE;QAAEG,OAAO,EAAE;MAAK,CAAC,CAAC;IACpF,CAAC,EAAE,IAAI,CAAC;IACR,IAAI,CAACH,aAAa,GAAGrK,SAAS;EAC/B;;EAEA;AACD;AACA;AACA;EACCsK,YAAY,CAAC9G,CAAC,EAAC;IACd,IAAI,CAACtC,IAAI,CAACsC,CAAC,CAACgE,IAAI,EAAEhE,CAAC,CAAC;EACrB;;EAEA;AACD;AACA;AACA;EACChC,qBAAqB,GAAE;IACtB,IAAG,CAAC,IAAI,CAAC9E,QAAQ,EAAE;MAClB;IACD;IACA,IAAI,CAACgO,kBAAkB,GAAG,IAAI,CAACC,iBAAiB,CAAClI,IAAI,CAAC,IAAI,CAAC;IAC3D,IAAI,CAAC/F,QAAQ,CAACiG,gBAAgB,CAAC,iBAAiB,EAAE,IAAI,CAAC+H,kBAAkB,EAAE;MAAEF,OAAO,EAAE;IAAK,CAAC,CAAC;EAC9F;;EAEA;AACD;AACA;AACA;EACCxI,wBAAwB,GAAE;IACzB,IAAG,CAAC,IAAI,CAACtF,QAAQ,EAAE;MAClB;IACD;IACA,IAAI,CAACA,QAAQ,CAAC+N,mBAAmB,CAAC,iBAAiB,EAAE,IAAI,CAACC,kBAAkB,EAAE;MAAEF,OAAO,EAAE;IAAK,CAAC,CAAC;IAChG,IAAI,CAACE,kBAAkB,GAAG1K,SAAS;EACpC;;EAEA;AACD;AACA;AACA;EACC2K,iBAAiB,CAACnH,CAAC,EAAC;IACnB,IAAI,IAAI,CAACoH,mBAAmB,EAAE;MAC7BzI,YAAY,CAAC,IAAI,CAACyI,mBAAmB,CAAC;IACvC;IACA,IAAI,CAACA,mBAAmB,GAAGlI,UAAU,CAAC,YAAW;MAChD,IAAImI,SAAS,GAAG,IAAI,CAAChO,MAAM,CAACiO,YAAY,EAAE;MAC1C,IAAI,CAACC,oBAAoB,CAACF,SAAS,CAAC;IACrC,CAAC,CAACpI,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC;EACnB;;EAEA;AACD;AACA;AACA;EACCsI,oBAAoB,CAACF,SAAS,EAAC;IAC9B,IAAI5M,KAAK,EAAE+M,QAAQ;IAEnB,IAAIH,SAAS,IAAIA,SAAS,CAACI,UAAU,GAAG,CAAC,EAAE;MAC1ChN,KAAK,GAAG4M,SAAS,CAACK,UAAU,CAAC,CAAC,CAAC;MAC/B,IAAG,CAACjN,KAAK,CAACkN,SAAS,EAAE;QACpB;QACAH,QAAQ,GAAG,IAAI3P,OAAO,CAAC4C,KAAK,EAAE,IAAI,CAAC1B,OAAO,CAAC,CAACkM,QAAQ,EAAE;QACtD,IAAI,CAACvH,IAAI,CAACzF,MAAM,CAAC0F,QAAQ,CAACiK,QAAQ,EAAEJ,QAAQ,CAAC;QAC7C,IAAI,CAAC9J,IAAI,CAACzF,MAAM,CAAC0F,QAAQ,CAACkK,cAAc,EAAEpN,KAAK,CAAC;MACjD;IACD;EACD;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCA,KAAK,CAACqN,IAAI,EAAElG,WAAW,EAAC;IACvB,IAAImG,GAAG,GAAG,IAAIlQ,OAAO,CAACiQ,IAAI,CAAC;IAC3B,OAAOC,GAAG,CAAC/F,OAAO,CAAC,IAAI,CAAC9I,QAAQ,EAAE0I,WAAW,CAAC;EAC/C;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCoG,YAAY,CAACvN,KAAK,EAAEmH,WAAW,EAAC;IAC/B,OAAO,IAAI/J,OAAO,CAAC4C,KAAK,EAAE,IAAI,CAAC1B,OAAO,EAAE6I,WAAW,CAAC,CAACqD,QAAQ,EAAE;EAChE;;EAEA;AACD;AACA;AACA;AACA;AACA;EACCgD,WAAW,CAACC,IAAI,EAAEtG,WAAW,EAAC;IAC7B,OAAO,IAAI/J,OAAO,CAACqQ,IAAI,EAAE,IAAI,CAACnP,OAAO,EAAE6I,WAAW,CAAC,CAACqD,QAAQ,EAAE;EAC/D;;EAEA;EACAkB,GAAG,CAACgC,MAAM,EAAC;IACV,IAAIhC,GAAG,GAAG,IAAIrO,OAAO,CAACqQ,MAAM,CAAC;IAC7B,OAAOhC,GAAG,CAACiC,OAAO,EAAE;EACrB;;EAEA;AACD;AACA;AACA;AACA;EACCC,IAAI,CAAC7O,KAAK,EAAEC,MAAM,EAAC;IAClB,IAAIoC,QAAQ,GAAG;MAAEkB,KAAK,EAAE,GAAG;MAAEG,QAAQ,EAAE;IAAK,CAAC;IAE7C,IAAI,CAACoL,WAAW,CAAC,WAAW,CAAC;IAE7B,IAAI9O,KAAK,IAAI,CAAC,EAAE;MACf,IAAI,CAACA,KAAK,CAACA,KAAK,CAAC;MACjBqC,QAAQ,CAACrC,KAAK,GAAGA,KAAK;MACtB,IAAI,CAAC+B,GAAG,CAAC,SAAS,EAAE,IAAI,GAAE/B,KAAK,GAAC,EAAG,GAAC,IAAI,CAAC;IAC1C;IAEA,IAAIC,MAAM,IAAI,CAAC,EAAE;MAChB,IAAI,CAACA,MAAM,CAACA,MAAM,CAAC;MACnBoC,QAAQ,CAACpC,MAAM,GAAGA,MAAM;IACzB;IAEA,IAAI,CAAC8B,GAAG,CAAC,QAAQ,EAAE,GAAG,CAAC;IACvB,IAAI,CAACA,GAAG,CAAC,YAAY,EAAE,YAAY,CAAC;IAGpC,IAAI,CAACM,QAAQ,CAACA,QAAQ,CAAC;EACxB;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACC0M,OAAO,CAAC/O,KAAK,EAAEC,MAAM,EAAE+O,WAAW,EAAEC,GAAG,EAAEC,GAAG,EAAC;IAC5C,IAAIC,WAAW,GAAGjR,QAAQ,CAAC,aAAa,CAAC;IACzC,IAAIkR,UAAU,GAAGlR,QAAQ,CAAC,YAAY,CAAC;IACvC,IAAImR,YAAY,GAAGnR,QAAQ,CAAC,cAAc,CAAC;IAC3C,IAAIoR,WAAW,GAAGpR,QAAQ,CAAC,aAAa,CAAC;IAEzC,IAAIqR,WAAW,GAAG,IAAI,CAACA,WAAW,EAAE;IACpC,IAAIC,IAAI,GAAID,WAAW,CAACxG,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,GAAI,UAAU,GAAG,YAAY;IAE9E,IAAI,CAAC+F,WAAW,CAAC,WAAW,CAAC;IAE7B,IAAII,GAAG,KAAK,KAAK,IAAIM,IAAI,KAAK,YAAY,EAAE;MAC3C,IAAI,CAACC,SAAS,CAACP,GAAG,CAAC;IACpB;IAEA,IAAI,CAAClP,KAAK,CAACA,KAAK,CAAC;IACjB,IAAI,CAACC,MAAM,CAACA,MAAM,CAAC;;IAEnB;IACA,IAAI,CAACoC,QAAQ,CAAC;MAAErC,KAAK,EAAEA,KAAK;MAAEC,MAAM,EAAEA,MAAM;MAAEsD,KAAK,EAAE,GAAG;MAAEG,QAAQ,EAAE;IAAK,CAAC,CAAC;;IAE3E;IACA;IACA;;IAEA,IAAI,CAAC3B,GAAG,CAAC,YAAY,EAAE,QAAQ,CAAC;IAChC,IAAI,CAACA,GAAG,CAAC,QAAQ,EAAE,GAAG,EAAE,IAAI,CAAC;IAE7B,IAAIyN,IAAI,KAAK,UAAU,EAAE;MACxB,IAAI,CAACzN,GAAG,CAAC,aAAa,EAAGkN,GAAG,GAAG,CAAC,GAAI,IAAI,EAAE,IAAI,CAAC;MAC/C,IAAI,CAAClN,GAAG,CAAC,gBAAgB,EAAGkN,GAAG,GAAG,CAAC,GAAI,IAAI,EAAE,IAAI,CAAC;MAClD,IAAI,CAAClN,GAAG,CAAC,cAAc,EAAE,MAAM,CAAC;MAChC,IAAI,CAACA,GAAG,CAAC,eAAe,EAAE,MAAM,CAAC;MACjC,IAAI,CAACA,GAAG,CAACoN,WAAW,EAAE,UAAU,CAAC;IAClC,CAAC,MAAM;MACN,IAAI,CAACpN,GAAG,CAAC,aAAa,EAAE,MAAM,CAAC;MAC/B,IAAI,CAACA,GAAG,CAAC,gBAAgB,EAAE,MAAM,CAAC;MAClC,IAAI,CAACA,GAAG,CAAC,cAAc,EAAGkN,GAAG,GAAG,CAAC,GAAI,IAAI,EAAE,IAAI,CAAC;MAChD,IAAI,CAAClN,GAAG,CAAC,eAAe,EAAGkN,GAAG,GAAG,CAAC,GAAI,IAAI,EAAE,IAAI,CAAC;MACjD,IAAI,CAAClN,GAAG,CAACoN,WAAW,EAAE,YAAY,CAAC;IACpC;IAEA,IAAI,CAACpN,GAAG,CAAC,YAAY,EAAE,YAAY,CAAC;IACpC,IAAI,CAACA,GAAG,CAAC,WAAW,EAAE,SAAS,CAAC;IAEhC,IAAI,CAACA,GAAG,CAACuN,WAAW,EAAE,MAAM,CAAC;IAE7B,IAAI,CAACvN,GAAG,CAACqN,UAAU,EAAEH,GAAG,GAAC,IAAI,CAAC;IAC9B,IAAI,CAAClN,GAAG,CAACsN,YAAY,EAAEL,WAAW,GAAC,IAAI,CAAC;;IAExC;IACA;IACA,IAAI,CAACjN,GAAG,CAAC,0BAA0B,EAAE,uBAAuB,CAAC;EAC9D;;EAEA;AACD;AACA;AACA;AACA;AACA;EACC2N,MAAM,CAACnM,KAAK,EAAEoM,OAAO,EAAEC,OAAO,EAAC;IAC9B,IAAIC,QAAQ,GAAG,QAAQ,GAAGtM,KAAK,GAAG,GAAG;IACrC,IAAIuM,YAAY,GAAG,EAAE;IACrB;IACA,IAAI,CAAC/N,GAAG,CAAC,kBAAkB,EAAE,UAAU,CAAC;IAExC,IAAI4N,OAAO,IAAI,CAAC,IAAIC,OAAO,IAAI,CAAC,EAAE;MACjCE,YAAY,GAAG,aAAa,IAAIH,OAAO,IAAI,CAAC,CAAE,GAAE,MAAM,IAAIC,OAAO,IAAI,CAAC,CAAE,GAAE,MAAM;IACjF;IAEA,IAAI,CAAC7N,GAAG,CAAC,WAAW,EAAE8N,QAAQ,GAAGC,YAAY,CAAC;EAC/C;;EAEA;AACD;AACA;AACA;AACA;EACCC,GAAG,CAAC/P,KAAK,EAAEC,MAAM,EAAE2O,OAAO,EAAC;IAC1B,IAAIvM,QAAQ,GAAG,IAAI,CAACA,QAAQ,EAAE;IAC9B,IAAI2N,aAAa,GAAGtP,QAAQ,CAAC2B,QAAQ,CAACrC,KAAK,CAAC;IAC5C,IAAIiQ,cAAc,GAAGvP,QAAQ,CAAC2B,QAAQ,CAACpC,MAAM,CAAC;IAC9C,IAAIiQ,UAAU,GAAGlQ,KAAK,GAAGgQ,aAAa;IACtC,IAAIG,WAAW,GAAGlQ,MAAM,GAAGgQ,cAAc;IACzC,IAAI1M,KAAK,GAAG2M,UAAU,GAAGC,WAAW,GAAGD,UAAU,GAAGC,WAAW;;IAE/D;IACA;IACA;IACA;IACA;IACA;;IAEA,IAAI,CAACrB,WAAW,CAAC,WAAW,CAAC;;IAE7B;IACA,IAAI,CAAC9O,KAAK,CAACgQ,aAAa,CAAC;IACzB,IAAI,CAAC/P,MAAM,CAACgQ,cAAc,CAAC;IAC3B,IAAI,CAACrO,QAAQ,CAAC,QAAQ,CAAC;;IAEvB;IACA,IAAI,CAAC8N,MAAM,CAACnM,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;IACxB;;IAEA;IACA,IAAI,CAACxB,GAAG,CAAC,iBAAiB,EAAEiO,aAAa,GAAGzM,KAAK,GAAG,KAAK,GAAG0M,cAAc,GAAG1M,KAAK,GAAG,IAAI,CAAC;IAE1F,IAAI,CAACxB,GAAG,CAAC,kBAAkB,EAAE,aAAa,CAAC;IAC3C,IAAI6M,OAAO,IAAIA,OAAO,CAACwB,UAAU,CAACC,QAAQ,CAAC,kBAAkB,CAAC,EAAE;MAC/D;MACA,IAAIC,UAAU,GAAGtQ,KAAK,GAAIgQ,aAAa,GAAGzM,KAAM;MAChD,IAAI,CAACxB,GAAG,CAAC,aAAa,EAAEuO,UAAU,GAAG,IAAI,CAAC;IAC3C;EACD;;EAEA;AACD;AACA;AACA;EACCb,SAAS,CAACP,GAAG,EAAE;IACd,IAAI,IAAI,CAACvP,eAAe,EAAE;MACzB,IAAI,CAACA,eAAe,CAACc,KAAK,CAAC,WAAW,CAAC,GAAGyO,GAAG;IAC9C;EACD;EAEAqB,OAAO,CAAChR,OAAO,EAAEoP,MAAM,EAAE6B,KAAK,EAAEC,GAAG,EAAEC,GAAG,EAAE;IACzC,IAAIC,OAAO,GAAG,IAAIrS,OAAO,CAACqQ,MAAM,EAAE+B,GAAG,CAAC;IAEtC,OAAOC,OAAO,CAACC,IAAI,CAAC,IAAI,EAAErR,OAAO,EAAEiR,KAAK,EAAEC,GAAG,CAAC;EAC/C;;EAEA;AACD;AACA;AACA;EACC5L,YAAY,GAAG;IACdtG,YAAY,CAAC,IAAI,CAACe,OAAO,EAAGoL,IAAI,IAAK;MACpC,IAAI,CAACxG,IAAI,CAACzF,MAAM,CAAC0F,QAAQ,CAAC0M,YAAY,EAAEnG,IAAI,CAAC;IAC9C,CAAC,CAAC;EACH;;EAEA;AACD;AACA;AACA;EACC6E,WAAW,CAACuB,IAAI,EAAE;IACjB,IAAIC,YAAY,GAAG7S,QAAQ,CAAC,cAAc,CAAC;IAE3C,IAAI4S,IAAI,IAAI,IAAI,CAACnR,eAAe,EAAE;MACjC,IAAI,CAACA,eAAe,CAACc,KAAK,CAACsQ,YAAY,CAAC,GAAGD,IAAI;IAChD;IAEA,OAAO,IAAI,CAACjR,MAAM,CAACc,gBAAgB,CAAC,IAAI,CAAChB,eAAe,CAAC,CAACoR,YAAY,CAAC,IAAI,EAAE;EAC9E;;EAEA;AACD;AACA;AACA;AACA;EACCjC,WAAW,CAACrO,KAAK,EAAE;IAElB,IAAIA,KAAK,EAAE;MACV,IAAI,CAACuQ,YAAY,GAAGvQ,KAAK;MACzB7B,SAAS,CAACsB,iBAAiB,CAAC4O,WAAW,GAAG,IAAI,CAACkC,YAAY;IAC5D;IAEA,OAAO,IAAI,CAACA,YAAY,IAAI,WAAW;EACxC;;EAEA;AACD;AACA;AACA;AACA;AACA;EACC9Q,iBAAiB,CAAC+Q,IAAI,EAAEC,OAAO,EAAE;IAChCtS,SAAS,CAACsB,iBAAiB,GAAG;MAC7B+Q,IAAI,EAAEA,IAAI;MACVC,OAAO,EAAEA,OAAO;MAChBpC,WAAW,EAAE,IAAI,CAACA,WAAW,EAAE;MAC/BqC,UAAU,EAAE,UAAUC,OAAO,EAAE;QAC9B,QAAQA,OAAO;UACd,KAAK,kBAAkB;YACtB,OAAO,IAAI;UACZ,KAAK,gBAAgB;YACpB,OAAO,IAAI;UACZ,KAAK,cAAc;YAClB,OAAO,IAAI;UACZ,KAAK,cAAc;YAClB,OAAO,IAAI;UACZ,KAAK,iBAAiB;YACrB,OAAO,IAAI;UACZ,KAAK,iBAAiB;YACrB,OAAO,KAAK;UACb;YACC,OAAO,KAAK;QAAC;MAEhB;IACD,CAAC;IACD,OAAOxS,SAAS,CAACsB,iBAAiB;EACnC;EAEAmR,OAAO,GAAG;IACT;;IAEA,IAAI,CAACvM,eAAe,EAAE;EAEvB;AACD;AAEA9G,YAAY,CAACmB,QAAQ,CAACqM,SAAS,CAAC;AAEhC,eAAerM,QAAQ"},"metadata":{},"sourceType":"module"}