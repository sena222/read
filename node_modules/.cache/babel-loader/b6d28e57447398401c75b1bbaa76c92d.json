{"ast":null,"code":"import _classCallCheck from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/parallels/Downloads/read/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n * @param {string} [options.defaultDirection='ltr'] default text direction\n * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content\n * @param {boolean} [options.allowPopups=false] enable opening popup in content\n */\nvar Rendition = /*#__PURE__*/function () {\n  function Rendition(book, options) {\n    _classCallCheck(this, Rendition);\n    this.settings = extend(this.settings || {}, {\n      width: null,\n      height: null,\n      ignoreClass: \"\",\n      manager: \"default\",\n      view: \"iframe\",\n      flow: null,\n      layout: null,\n      spread: null,\n      minSpreadWidth: 800,\n      stylesheet: null,\n      resizeOnOrientationChange: true,\n      script: null,\n      snap: false,\n      defaultDirection: \"ltr\",\n      allowScriptedContent: false,\n      allowPopups: false\n    });\n    extend(this.settings, options);\n    if (typeof this.settings.manager === \"object\") {\n      this.manager = this.settings.manager;\n    }\n    this.book = book;\n\n    /**\n     * Adds Hook methods to the Rendition prototype\n     * @member {object} hooks\n     * @property {Hook} hooks.content\n     * @memberof Rendition\n     */\n    this.hooks = {};\n    this.hooks.display = new Hook(this);\n    this.hooks.serialize = new Hook(this);\n    this.hooks.content = new Hook(this);\n    this.hooks.unloaded = new Hook(this);\n    this.hooks.layout = new Hook(this);\n    this.hooks.render = new Hook(this);\n    this.hooks.show = new Hook(this);\n    this.hooks.content.register(this.handleLinks.bind(this));\n    this.hooks.content.register(this.passEvents.bind(this));\n    this.hooks.content.register(this.adjustImages.bind(this));\n    this.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n    if (this.settings.stylesheet) {\n      this.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n    }\n    if (this.settings.script) {\n      this.book.spine.hooks.content.register(this.injectScript.bind(this));\n    }\n\n    /**\n     * @member {Themes} themes\n     * @memberof Rendition\n     */\n    this.themes = new Themes(this);\n\n    /**\n     * @member {Annotations} annotations\n     * @memberof Rendition\n     */\n    this.annotations = new Annotations(this);\n    this.epubcfi = new EpubCFI();\n    this.q = new Queue(this);\n\n    /**\n     * A Rendered Location Range\n     * @typedef location\n     * @type {Object}\n     * @property {object} start\n     * @property {string} start.index\n     * @property {string} start.href\n     * @property {object} start.displayed\n     * @property {EpubCFI} start.cfi\n     * @property {number} start.location\n     * @property {number} start.percentage\n     * @property {number} start.displayed.page\n     * @property {number} start.displayed.total\n     * @property {object} end\n     * @property {string} end.index\n     * @property {string} end.href\n     * @property {object} end.displayed\n     * @property {EpubCFI} end.cfi\n     * @property {number} end.location\n     * @property {number} end.percentage\n     * @property {number} end.displayed.page\n     * @property {number} end.displayed.total\n     * @property {boolean} atStart\n     * @property {boolean} atEnd\n     * @memberof Rendition\n     */\n    this.location = undefined;\n\n    // Hold queue until book is opened\n    this.q.enqueue(this.book.opened);\n    this.starting = new defer();\n    /**\n     * @member {promise} started returns after the rendition has started\n     * @memberof Rendition\n     */\n    this.started = this.starting.promise;\n\n    // Block the queue until rendering is started\n    this.q.enqueue(this.start);\n  }\n\n  /**\n   * Set the manager function\n   * @param {function} manager\n   */\n  _createClass(Rendition, [{\n    key: \"setManager\",\n    value: function setManager(manager) {\n      this.manager = manager;\n    }\n\n    /**\n     * Require the manager from passed string, or as a class function\n     * @param  {string|object} manager [description]\n     * @return {method}\n     */\n  }, {\n    key: \"requireManager\",\n    value: function requireManager(manager) {\n      var viewManager;\n\n      // If manager is a string, try to load from imported managers\n      if (typeof manager === \"string\" && manager === \"default\") {\n        viewManager = DefaultViewManager;\n      } else if (typeof manager === \"string\" && manager === \"continuous\") {\n        viewManager = ContinuousViewManager;\n      } else {\n        // otherwise, assume we were passed a class function\n        viewManager = manager;\n      }\n      return viewManager;\n    }\n\n    /**\n     * Require the view from passed string, or as a class function\n     * @param  {string|object} view\n     * @return {view}\n     */\n  }, {\n    key: \"requireView\",\n    value: function requireView(view) {\n      var View;\n\n      // If view is a string, try to load from imported views,\n      if (typeof view == \"string\" && view === \"iframe\") {\n        View = IframeView;\n      } else {\n        // otherwise, assume we were passed a class function\n        View = view;\n      }\n      return View;\n    }\n\n    /**\n     * Start the rendering\n     * @return {Promise} rendering has started\n     */\n  }, {\n    key: \"start\",\n    value: function start() {\n      if (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\n        this.settings.layout = \"pre-paginated\";\n      }\n      switch (this.book.package.metadata.spread) {\n        case 'none':\n          this.settings.spread = 'none';\n          break;\n        case 'both':\n          this.settings.spread = true;\n          break;\n      }\n      if (!this.manager) {\n        this.ViewManager = this.requireManager(this.settings.manager);\n        this.View = this.requireView(this.settings.view);\n        this.manager = new this.ViewManager({\n          view: this.View,\n          queue: this.q,\n          request: this.book.load.bind(this.book),\n          settings: this.settings\n        });\n      }\n      this.direction(this.book.package.metadata.direction || this.settings.defaultDirection);\n\n      // Parse metadata to get layout props\n      this.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n      this.flow(this.settings.globalLayoutProperties.flow);\n      this.layout(this.settings.globalLayoutProperties);\n\n      // Listen for displayed views\n      this.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n      this.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n      // Listen for resizing\n      this.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n      // Listen for rotation\n      this.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n      // Listen for scroll changes\n      this.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n      /**\n       * Emit that rendering has started\n       * @event started\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.STARTED);\n\n      // Start processing queue\n      this.starting.resolve();\n    }\n\n    /**\n     * Call to attach the container to an element in the dom\n     * Container must be attached before rendering can begin\n     * @param  {element} element to attach to\n     * @return {Promise}\n     */\n  }, {\n    key: \"attachTo\",\n    value: function attachTo(element) {\n      return this.q.enqueue(function () {\n        // Start rendering\n        this.manager.render(element, {\n          \"width\": this.settings.width,\n          \"height\": this.settings.height\n        });\n\n        /**\n         * Emit that rendering has attached to an element\n         * @event attached\n         * @memberof Rendition\n         */\n        this.emit(EVENTS.RENDITION.ATTACHED);\n      }.bind(this));\n    }\n\n    /**\n     * Display a point in the book\n     * The request will be added to the rendering Queue,\n     * so it will wait until book is opened, rendering started\n     * and all other rendering tasks have finished to be called.\n     * @param  {string} target Url or EpubCFI\n     * @return {Promise}\n     */\n  }, {\n    key: \"display\",\n    value: function display(target) {\n      if (this.displaying) {\n        this.displaying.resolve();\n      }\n      return this.q.enqueue(this._display, target);\n    }\n\n    /**\n     * Tells the manager what to display immediately\n     * @private\n     * @param  {string} target Url or EpubCFI\n     * @return {Promise}\n     */\n  }, {\n    key: \"_display\",\n    value: function _display(target) {\n      var _this = this;\n      if (!this.book) {\n        return;\n      }\n      var isCfiString = this.epubcfi.isCfiString(target);\n      var displaying = new defer();\n      var displayed = displaying.promise;\n      var section;\n      var moveTo;\n      this.displaying = displaying;\n\n      // Check if this is a book percentage\n      if (this.book.locations.length() && isFloat(target)) {\n        target = this.book.locations.cfiFromPercentage(parseFloat(target));\n      }\n      section = this.book.spine.get(target);\n      if (!section) {\n        displaying.reject(new Error(\"No Section Found\"));\n        return displayed;\n      }\n      this.manager.display(section, target).then(function () {\n        displaying.resolve(section);\n        _this.displaying = undefined;\n\n        /**\n         * Emit that a section has been displayed\n         * @event displayed\n         * @param {Section} section\n         * @memberof Rendition\n         */\n        _this.emit(EVENTS.RENDITION.DISPLAYED, section);\n        _this.reportLocation();\n      }, function (err) {\n        /**\n         * Emit that has been an error displaying\n         * @event displayError\n         * @param {Section} section\n         * @memberof Rendition\n         */\n        _this.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n      });\n      return displayed;\n    }\n\n    /*\n    render(view, show) {\n    \t\t// view.onLayout = this.layout.format.bind(this.layout);\n    \tview.create();\n    \t\t// Fit to size of the container, apply padding\n    \tthis.manager.resizeView(view);\n    \t\t// Render Chain\n    \treturn view.section.render(this.book.request)\n    \t\t.then(function(contents){\n    \t\t\treturn view.load(contents);\n    \t\t}.bind(this))\n    \t\t.then(function(doc){\n    \t\t\treturn this.hooks.content.trigger(view, this);\n    \t\t}.bind(this))\n    \t\t.then(function(){\n    \t\t\tthis.layout.format(view.contents);\n    \t\t\treturn this.hooks.layout.trigger(view, this);\n    \t\t}.bind(this))\n    \t\t.then(function(){\n    \t\t\treturn view.display();\n    \t\t}.bind(this))\n    \t\t.then(function(){\n    \t\t\treturn this.hooks.render.trigger(view, this);\n    \t\t}.bind(this))\n    \t\t.then(function(){\n    \t\t\tif(show !== false) {\n    \t\t\t\tthis.q.enqueue(function(view){\n    \t\t\t\t\tview.show();\n    \t\t\t\t}, view);\n    \t\t\t}\n    \t\t\t// this.map = new Map(view, this.layout);\n    \t\t\tthis.hooks.show.trigger(view, this);\n    \t\t\tthis.trigger(\"rendered\", view.section);\n    \t\t\t}.bind(this))\n    \t\t.catch(function(e){\n    \t\t\tthis.trigger(\"loaderror\", e);\n    \t\t}.bind(this));\n    \t}\n    */\n\n    /**\n     * Report what section has been displayed\n     * @private\n     * @param  {*} view\n     */\n  }, {\n    key: \"afterDisplayed\",\n    value: function afterDisplayed(view) {\n      var _this2 = this;\n      view.on(EVENTS.VIEWS.MARK_CLICKED, function (cfiRange, data) {\n        return _this2.triggerMarkEvent(cfiRange, data, view.contents);\n      });\n      this.hooks.render.trigger(view, this).then(function () {\n        if (view.contents) {\n          _this2.hooks.content.trigger(view.contents, _this2).then(function () {\n            /**\n             * Emit that a section has been rendered\n             * @event rendered\n             * @param {Section} section\n             * @param {View} view\n             * @memberof Rendition\n             */\n            _this2.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n          });\n        } else {\n          _this2.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n        }\n      });\n    }\n\n    /**\n     * Report what has been removed\n     * @private\n     * @param  {*} view\n     */\n  }, {\n    key: \"afterRemoved\",\n    value: function afterRemoved(view) {\n      var _this3 = this;\n      this.hooks.unloaded.trigger(view, this).then(function () {\n        /**\n         * Emit that a section has been removed\n         * @event removed\n         * @param {Section} section\n         * @param {View} view\n         * @memberof Rendition\n         */\n        _this3.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n      });\n    }\n\n    /**\n     * Report resize events and display the last seen location\n     * @private\n     */\n  }, {\n    key: \"onResized\",\n    value: function onResized(size, epubcfi) {\n      /**\n       * Emit that the rendition has been resized\n       * @event resized\n       * @param {number} width\n       * @param {height} height\n       * @param {string} epubcfi (optional)\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.RESIZED, {\n        width: size.width,\n        height: size.height\n      }, epubcfi);\n      if (this.location && this.location.start) {\n        this.display(epubcfi || this.location.start.cfi);\n      }\n    }\n\n    /**\n     * Report orientation events and display the last seen location\n     * @private\n     */\n  }, {\n    key: \"onOrientationChange\",\n    value: function onOrientationChange(orientation) {\n      /**\n       * Emit that the rendition has been rotated\n       * @event orientationchange\n       * @param {string} orientation\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n    }\n\n    /**\n     * Move the Rendition to a specific offset\n     * Usually you would be better off calling display()\n     * @param {object} offset\n     */\n  }, {\n    key: \"moveTo\",\n    value: function moveTo(offset) {\n      this.manager.moveTo(offset);\n    }\n\n    /**\n     * Trigger a resize of the views\n     * @param {number} [width]\n     * @param {number} [height]\n     * @param {string} [epubcfi] (optional)\n     */\n  }, {\n    key: \"resize\",\n    value: function resize(width, height, epubcfi) {\n      if (width) {\n        this.settings.width = width;\n      }\n      if (height) {\n        this.settings.height = height;\n      }\n      this.manager.resize(width, height, epubcfi);\n    }\n\n    /**\n     * Clear all rendered views\n     */\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.manager.clear();\n    }\n\n    /**\n     * Go to the next \"page\" in the rendition\n     * @return {Promise}\n     */\n  }, {\n    key: \"next\",\n    value: function next() {\n      return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this));\n    }\n\n    /**\n     * Go to the previous \"page\" in the rendition\n     * @return {Promise}\n     */\n  }, {\n    key: \"prev\",\n    value: function prev() {\n      return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this));\n    }\n\n    //-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n    /**\n     * Determine the Layout properties from metadata and settings\n     * @private\n     * @param  {object} metadata\n     * @return {object} properties\n     */\n  }, {\n    key: \"determineLayoutProperties\",\n    value: function determineLayoutProperties(metadata) {\n      var properties;\n      var layout = this.settings.layout || metadata.layout || \"reflowable\";\n      var spread = this.settings.spread || metadata.spread || \"auto\";\n      var orientation = this.settings.orientation || metadata.orientation || \"auto\";\n      var flow = this.settings.flow || metadata.flow || \"auto\";\n      var viewport = metadata.viewport || \"\";\n      var minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n      var direction = this.settings.direction || metadata.direction || \"ltr\";\n      if ((this.settings.width === 0 || this.settings.width > 0) && (this.settings.height === 0 || this.settings.height > 0)) {\n        // viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n      }\n      properties = {\n        layout: layout,\n        spread: spread,\n        orientation: orientation,\n        flow: flow,\n        viewport: viewport,\n        minSpreadWidth: minSpreadWidth,\n        direction: direction\n      };\n      return properties;\n    }\n\n    /**\n     * Adjust the flow of the rendition to paginated or scrolled\n     * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n     * @param  {string} flow\n     */\n  }, {\n    key: \"flow\",\n    value: function flow(_flow2) {\n      var _flow = _flow2;\n      if (_flow2 === \"scrolled\" || _flow2 === \"scrolled-doc\" || _flow2 === \"scrolled-continuous\") {\n        _flow = \"scrolled\";\n      }\n      if (_flow2 === \"auto\" || _flow2 === \"paginated\") {\n        _flow = \"paginated\";\n      }\n      this.settings.flow = _flow2;\n      if (this._layout) {\n        this._layout.flow(_flow);\n      }\n      if (this.manager && this._layout) {\n        this.manager.applyLayout(this._layout);\n      }\n      if (this.manager) {\n        this.manager.updateFlow(_flow);\n      }\n      if (this.manager && this.manager.isRendered() && this.location) {\n        this.manager.clear();\n        this.display(this.location.start.cfi);\n      }\n    }\n\n    /**\n     * Adjust the layout of the rendition to reflowable or pre-paginated\n     * @param  {object} settings\n     */\n  }, {\n    key: \"layout\",\n    value: function layout(settings) {\n      var _this4 = this;\n      if (settings) {\n        this._layout = new Layout(settings);\n        this._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n        // this.mapping = new Mapping(this._layout.props);\n\n        this._layout.on(EVENTS.LAYOUT.UPDATED, function (props, changed) {\n          _this4.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n        });\n      }\n      if (this.manager && this._layout) {\n        this.manager.applyLayout(this._layout);\n      }\n      return this._layout;\n    }\n\n    /**\n     * Adjust if the rendition uses spreads\n     * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n     * @param  {int} [min] min width to use spreads at\n     */\n  }, {\n    key: \"spread\",\n    value: function spread(_spread, min) {\n      this.settings.spread = _spread;\n      if (min) {\n        this.settings.minSpreadWidth = min;\n      }\n      if (this._layout) {\n        this._layout.spread(_spread, min);\n      }\n      if (this.manager && this.manager.isRendered()) {\n        this.manager.updateLayout();\n      }\n    }\n\n    /**\n     * Adjust the direction of the rendition\n     * @param  {string} dir\n     */\n  }, {\n    key: \"direction\",\n    value: function direction(dir) {\n      this.settings.direction = dir || \"ltr\";\n      if (this.manager) {\n        this.manager.direction(this.settings.direction);\n      }\n      if (this.manager && this.manager.isRendered() && this.location) {\n        this.manager.clear();\n        this.display(this.location.start.cfi);\n      }\n    }\n\n    /**\n     * Report the current location\n     * @fires relocated\n     * @fires locationChanged\n     */\n  }, {\n    key: \"reportLocation\",\n    value: function reportLocation() {\n      return this.q.enqueue(function reportedLocation() {\n        requestAnimationFrame(function reportedLocationAfterRAF() {\n          var location = this.manager.currentLocation();\n          if (location && location.then && typeof location.then === \"function\") {\n            location.then(function (result) {\n              var located = this.located(result);\n              if (!located || !located.start || !located.end) {\n                return;\n              }\n              this.location = located;\n              this.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n                index: this.location.start.index,\n                href: this.location.start.href,\n                start: this.location.start.cfi,\n                end: this.location.end.cfi,\n                percentage: this.location.start.percentage\n              });\n              this.emit(EVENTS.RENDITION.RELOCATED, this.location);\n            }.bind(this));\n          } else if (location) {\n            var located = this.located(location);\n            if (!located || !located.start || !located.end) {\n              return;\n            }\n            this.location = located;\n\n            /**\n             * @event locationChanged\n             * @deprecated\n             * @type {object}\n             * @property {number} index\n             * @property {string} href\n             * @property {EpubCFI} start\n             * @property {EpubCFI} end\n             * @property {number} percentage\n             * @memberof Rendition\n             */\n            this.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n              index: this.location.start.index,\n              href: this.location.start.href,\n              start: this.location.start.cfi,\n              end: this.location.end.cfi,\n              percentage: this.location.start.percentage\n            });\n\n            /**\n             * @event relocated\n             * @type {displayedLocation}\n             * @memberof Rendition\n             */\n            this.emit(EVENTS.RENDITION.RELOCATED, this.location);\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n\n    /**\n     * Get the Current Location object\n     * @return {displayedLocation | promise} location (may be a promise)\n     */\n  }, {\n    key: \"currentLocation\",\n    value: function currentLocation() {\n      var location = this.manager.currentLocation();\n      if (location && location.then && typeof location.then === \"function\") {\n        location.then(function (result) {\n          var located = this.located(result);\n          return located;\n        }.bind(this));\n      } else if (location) {\n        var located = this.located(location);\n        return located;\n      }\n    }\n\n    /**\n     * Creates a Rendition#locationRange from location\n     * passed by the Manager\n     * @returns {displayedLocation}\n     * @private\n     */\n  }, {\n    key: \"located\",\n    value: function located(location) {\n      if (!location.length) {\n        return {};\n      }\n      var start = location[0];\n      var end = location[location.length - 1];\n      var located = {\n        start: {\n          index: start.index,\n          href: start.href,\n          cfi: start.mapping.start,\n          displayed: {\n            page: start.pages[0] || 1,\n            total: start.totalPages\n          }\n        },\n        end: {\n          index: end.index,\n          href: end.href,\n          cfi: end.mapping.end,\n          displayed: {\n            page: end.pages[end.pages.length - 1] || 1,\n            total: end.totalPages\n          }\n        }\n      };\n      var locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n      var locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n      if (locationStart != null) {\n        located.start.location = locationStart;\n        located.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n      }\n      if (locationEnd != null) {\n        located.end.location = locationEnd;\n        located.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n      }\n      var pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n      var pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n      if (pageStart != -1) {\n        located.start.page = pageStart;\n      }\n      if (pageEnd != -1) {\n        located.end.page = pageEnd;\n      }\n      if (end.index === this.book.spine.last().index && located.end.displayed.page >= located.end.displayed.total) {\n        located.atEnd = true;\n      }\n      if (start.index === this.book.spine.first().index && located.start.displayed.page === 1) {\n        located.atStart = true;\n      }\n      return located;\n    }\n\n    /**\n     * Remove and Clean Up the Rendition\n     */\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      // Clear the queue\n      // this.q.clear();\n      // this.q = undefined;\n\n      this.manager && this.manager.destroy();\n      this.book = undefined;\n\n      // this.views = null;\n\n      // this.hooks.display.clear();\n      // this.hooks.serialize.clear();\n      // this.hooks.content.clear();\n      // this.hooks.layout.clear();\n      // this.hooks.render.clear();\n      // this.hooks.show.clear();\n      // this.hooks = {};\n\n      // this.themes.destroy();\n      // this.themes = undefined;\n\n      // this.epubcfi = undefined;\n\n      // this.starting = undefined;\n      // this.started = undefined;\n    }\n\n    /**\n     * Pass the events from a view's Contents\n     * @private\n     * @param  {Contents} view contents\n     */\n  }, {\n    key: \"passEvents\",\n    value: function passEvents(contents) {\n      var _this5 = this;\n      DOM_EVENTS.forEach(function (e) {\n        contents.on(e, function (ev) {\n          return _this5.triggerViewEvent(ev, contents);\n        });\n      });\n      contents.on(EVENTS.CONTENTS.SELECTED, function (e) {\n        return _this5.triggerSelectedEvent(e, contents);\n      });\n    }\n\n    /**\n     * Emit events passed by a view\n     * @private\n     * @param  {event} e\n     */\n  }, {\n    key: \"triggerViewEvent\",\n    value: function triggerViewEvent(e, contents) {\n      this.emit(e.type, e, contents);\n    }\n\n    /**\n     * Emit a selection event's CFI Range passed from a a view\n     * @private\n     * @param  {string} cfirange\n     */\n  }, {\n    key: \"triggerSelectedEvent\",\n    value: function triggerSelectedEvent(cfirange, contents) {\n      /**\n       * Emit that a text selection has occurred\n       * @event selected\n       * @param {string} cfirange\n       * @param {Contents} contents\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n    }\n\n    /**\n     * Emit a markClicked event with the cfiRange and data from a mark\n     * @private\n     * @param  {EpubCFI} cfirange\n     */\n  }, {\n    key: \"triggerMarkEvent\",\n    value: function triggerMarkEvent(cfiRange, data, contents) {\n      /**\n       * Emit that a mark was clicked\n       * @event markClicked\n       * @param {EpubCFI} cfirange\n       * @param {object} data\n       * @param {Contents} contents\n       * @memberof Rendition\n       */\n      this.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n    }\n\n    /**\n     * Get a Range from a Visible CFI\n     * @param  {string} cfi EpubCfi String\n     * @param  {string} ignoreClass\n     * @return {range}\n     */\n  }, {\n    key: \"getRange\",\n    value: function getRange(cfi, ignoreClass) {\n      var _cfi = new EpubCFI(cfi);\n      var found = this.manager.visible().filter(function (view) {\n        if (_cfi.spinePos === view.index) return true;\n      });\n\n      // Should only every return 1 item\n      if (found.length) {\n        return found[0].contents.range(_cfi, ignoreClass);\n      }\n    }\n\n    /**\n     * Hook to adjust images to fit in columns\n     * @param  {Contents} contents\n     * @private\n     */\n  }, {\n    key: \"adjustImages\",\n    value: function adjustImages(contents) {\n      if (this._layout.name === \"pre-paginated\") {\n        return new Promise(function (resolve) {\n          resolve();\n        });\n      }\n      var computed = contents.window.getComputedStyle(contents.content, null);\n      var height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n      var horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\n      contents.addStylesheetRules({\n        \"img\": {\n          \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth - horizontalPadding + \"px\" : \"100%\") + \"!important\",\n          \"max-height\": height + \"px\" + \"!important\",\n          \"object-fit\": \"contain\",\n          \"page-break-inside\": \"avoid\",\n          \"break-inside\": \"avoid\",\n          \"box-sizing\": \"border-box\"\n        },\n        \"svg\": {\n          \"max-width\": (this._layout.columnWidth ? this._layout.columnWidth - horizontalPadding + \"px\" : \"100%\") + \"!important\",\n          \"max-height\": height + \"px\" + \"!important\",\n          \"page-break-inside\": \"avoid\",\n          \"break-inside\": \"avoid\"\n        }\n      });\n      return new Promise(function (resolve, reject) {\n        // Wait to apply\n        setTimeout(function () {\n          resolve();\n        }, 1);\n      });\n    }\n\n    /**\n     * Get the Contents object of each rendered view\n     * @returns {Contents[]}\n     */\n  }, {\n    key: \"getContents\",\n    value: function getContents() {\n      return this.manager ? this.manager.getContents() : [];\n    }\n\n    /**\n     * Get the views member from the manager\n     * @returns {Views}\n     */\n  }, {\n    key: \"views\",\n    value: function views() {\n      var views = this.manager ? this.manager.views : undefined;\n      return views || [];\n    }\n\n    /**\n     * Hook to handle link clicks in rendered content\n     * @param  {Contents} contents\n     * @private\n     */\n  }, {\n    key: \"handleLinks\",\n    value: function handleLinks(contents) {\n      var _this6 = this;\n      if (contents) {\n        contents.on(EVENTS.CONTENTS.LINK_CLICKED, function (href) {\n          var relative = _this6.book.path.relative(href);\n          _this6.display(relative);\n        });\n      }\n    }\n\n    /**\n     * Hook to handle injecting stylesheet before\n     * a Section is serialized\n     * @param  {document} doc\n     * @param  {Section} section\n     * @private\n     */\n  }, {\n    key: \"injectStylesheet\",\n    value: function injectStylesheet(doc, section) {\n      var style = doc.createElement(\"link\");\n      style.setAttribute(\"type\", \"text/css\");\n      style.setAttribute(\"rel\", \"stylesheet\");\n      style.setAttribute(\"href\", this.settings.stylesheet);\n      doc.getElementsByTagName(\"head\")[0].appendChild(style);\n    }\n\n    /**\n     * Hook to handle injecting scripts before\n     * a Section is serialized\n     * @param  {document} doc\n     * @param  {Section} section\n     * @private\n     */\n  }, {\n    key: \"injectScript\",\n    value: function injectScript(doc, section) {\n      var script = doc.createElement(\"script\");\n      script.setAttribute(\"type\", \"text/javascript\");\n      script.setAttribute(\"src\", this.settings.script);\n      script.textContent = \" \"; // Needed to prevent self closing tag\n      doc.getElementsByTagName(\"head\")[0].appendChild(script);\n    }\n\n    /**\n     * Hook to handle the document identifier before\n     * a Section is serialized\n     * @param  {document} doc\n     * @param  {Section} section\n     * @private\n     */\n  }, {\n    key: \"injectIdentifier\",\n    value: function injectIdentifier(doc, section) {\n      var ident = this.book.packaging.metadata.identifier;\n      var meta = doc.createElement(\"meta\");\n      meta.setAttribute(\"name\", \"dc.relation.ispartof\");\n      if (ident) {\n        meta.setAttribute(\"content\", ident);\n      }\n      doc.getElementsByTagName(\"head\")[0].appendChild(meta);\n    }\n  }]);\n  return Rendition;\n}(); //-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\nexport default Rendition;","map":{"version":3,"names":["EventEmitter","extend","defer","isFloat","Hook","EpubCFI","Queue","Layout","Themes","Contents","Annotations","EVENTS","DOM_EVENTS","IframeView","DefaultViewManager","ContinuousViewManager","Rendition","book","options","settings","width","height","ignoreClass","manager","view","flow","layout","spread","minSpreadWidth","stylesheet","resizeOnOrientationChange","script","snap","defaultDirection","allowScriptedContent","allowPopups","hooks","display","serialize","content","unloaded","render","show","register","handleLinks","bind","passEvents","adjustImages","spine","injectIdentifier","injectStylesheet","injectScript","themes","annotations","epubcfi","q","location","undefined","enqueue","opened","starting","started","promise","start","viewManager","View","package","metadata","displayOptions","fixedLayout","ViewManager","requireManager","requireView","queue","request","load","direction","globalLayoutProperties","determineLayoutProperties","on","MANAGERS","ADDED","afterDisplayed","REMOVED","afterRemoved","RESIZED","onResized","ORIENTATION_CHANGE","onOrientationChange","SCROLLED","reportLocation","emit","RENDITION","STARTED","resolve","element","ATTACHED","target","displaying","_display","isCfiString","displayed","section","moveTo","locations","length","cfiFromPercentage","parseFloat","get","reject","Error","then","DISPLAYED","err","DISPLAY_ERROR","VIEWS","MARK_CLICKED","cfiRange","data","triggerMarkEvent","contents","trigger","RENDERED","size","cfi","orientation","offset","resize","clear","next","prev","properties","viewport","_flow","_layout","applyLayout","updateFlow","isRendered","LAYOUT","UPDATED","props","changed","min","updateLayout","dir","reportedLocation","requestAnimationFrame","reportedLocationAfterRAF","currentLocation","result","located","end","LOCATION_CHANGED","index","href","percentage","RELOCATED","mapping","page","pages","total","totalPages","locationStart","locationFromCfi","locationEnd","percentageFromLocation","pageStart","pageList","pageFromCfi","pageEnd","last","atEnd","first","atStart","destroy","forEach","e","ev","triggerViewEvent","CONTENTS","SELECTED","triggerSelectedEvent","type","cfirange","_cfi","found","visible","filter","spinePos","range","name","Promise","computed","window","getComputedStyle","offsetHeight","paddingTop","paddingBottom","horizontalPadding","paddingLeft","paddingRight","addStylesheetRules","columnWidth","setTimeout","getContents","views","LINK_CLICKED","relative","path","doc","style","createElement","setAttribute","getElementsByTagName","appendChild","textContent","ident","packaging","identifier","meta","prototype"],"sources":["/home/parallels/Downloads/read/node_modules/epubjs/src/rendition.js"],"sourcesContent":["import EventEmitter from \"event-emitter\";\nimport { extend, defer, isFloat } from \"./utils/core\";\nimport Hook from \"./utils/hook\";\nimport EpubCFI from \"./epubcfi\";\nimport Queue from \"./utils/queue\";\nimport Layout from \"./layout\";\n// import Mapping from \"./mapping\";\nimport Themes from \"./themes\";\nimport Contents from \"./contents\";\nimport Annotations from \"./annotations\";\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\n\n// Default Views\nimport IframeView from \"./managers/views/iframe\";\n\n// Default View Managers\nimport DefaultViewManager from \"./managers/default/index\";\nimport ContinuousViewManager from \"./managers/continuous/index\";\n\n/**\n * Displays an Epub as a series of Views for each Section.\n * Requires Manager and View class to handle specifics of rendering\n * the section content.\n * @class\n * @param {Book} book\n * @param {object} [options]\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\n * @param {string | function | object} [options.manager='default']\n * @param {string | function} [options.view='iframe']\n * @param {string} [options.layout] layout to force\n * @param {string} [options.spread] force spread value\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\n * @param {string} [options.stylesheet] url of stylesheet to be injected\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\n * @param {string} [options.script] url of script to be injected\n * @param {boolean | object} [options.snap=false] use snap scrolling\n * @param {string} [options.defaultDirection='ltr'] default text direction\n * @param {boolean} [options.allowScriptedContent=false] enable running scripts in content\n * @param {boolean} [options.allowPopups=false] enable opening popup in content\n */\nclass Rendition {\n\tconstructor(book, options) {\n\n\t\tthis.settings = extend(this.settings || {}, {\n\t\t\twidth: null,\n\t\t\theight: null,\n\t\t\tignoreClass: \"\",\n\t\t\tmanager: \"default\",\n\t\t\tview: \"iframe\",\n\t\t\tflow: null,\n\t\t\tlayout: null,\n\t\t\tspread: null,\n\t\t\tminSpreadWidth: 800,\n\t\t\tstylesheet: null,\n\t\t\tresizeOnOrientationChange: true,\n\t\t\tscript: null,\n\t\t\tsnap: false,\n\t\t\tdefaultDirection: \"ltr\",\n\t\t\tallowScriptedContent: false,\n\t\t\tallowPopups: false\n\t\t});\n\n\t\textend(this.settings, options);\n\n\t\tif (typeof(this.settings.manager) === \"object\") {\n\t\t\tthis.manager = this.settings.manager;\n\t\t}\n\n\t\tthis.book = book;\n\n\t\t/**\n\t\t * Adds Hook methods to the Rendition prototype\n\t\t * @member {object} hooks\n\t\t * @property {Hook} hooks.content\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.hooks = {};\n\t\tthis.hooks.display = new Hook(this);\n\t\tthis.hooks.serialize = new Hook(this);\n\t\tthis.hooks.content = new Hook(this);\n\t\tthis.hooks.unloaded = new Hook(this);\n\t\tthis.hooks.layout = new Hook(this);\n\t\tthis.hooks.render = new Hook(this);\n\t\tthis.hooks.show = new Hook(this);\n\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\n\n\t\tthis.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\n\n\t\tif (this.settings.stylesheet) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\n\t\t}\n\n\t\tif (this.settings.script) {\n\t\t\tthis.book.spine.hooks.content.register(this.injectScript.bind(this));\n\t\t}\n\n\t\t/**\n\t\t * @member {Themes} themes\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.themes = new Themes(this);\n\n\t\t/**\n\t\t * @member {Annotations} annotations\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.annotations = new Annotations(this);\n\n\t\tthis.epubcfi = new EpubCFI();\n\n\t\tthis.q = new Queue(this);\n\n\t\t/**\n\t\t * A Rendered Location Range\n\t\t * @typedef location\n\t\t * @type {Object}\n\t\t * @property {object} start\n\t\t * @property {string} start.index\n\t\t * @property {string} start.href\n\t\t * @property {object} start.displayed\n\t\t * @property {EpubCFI} start.cfi\n\t\t * @property {number} start.location\n\t\t * @property {number} start.percentage\n\t\t * @property {number} start.displayed.page\n\t\t * @property {number} start.displayed.total\n\t\t * @property {object} end\n\t\t * @property {string} end.index\n\t\t * @property {string} end.href\n\t\t * @property {object} end.displayed\n\t\t * @property {EpubCFI} end.cfi\n\t\t * @property {number} end.location\n\t\t * @property {number} end.percentage\n\t\t * @property {number} end.displayed.page\n\t\t * @property {number} end.displayed.total\n\t\t * @property {boolean} atStart\n\t\t * @property {boolean} atEnd\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.location = undefined;\n\n\t\t// Hold queue until book is opened\n\t\tthis.q.enqueue(this.book.opened);\n\n\t\tthis.starting = new defer();\n\t\t/**\n\t\t * @member {promise} started returns after the rendition has started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.started = this.starting.promise;\n\n\t\t// Block the queue until rendering is started\n\t\tthis.q.enqueue(this.start);\n\t}\n\n\t/**\n\t * Set the manager function\n\t * @param {function} manager\n\t */\n\tsetManager(manager) {\n\t\tthis.manager = manager;\n\t}\n\n\t/**\n\t * Require the manager from passed string, or as a class function\n\t * @param  {string|object} manager [description]\n\t * @return {method}\n\t */\n\trequireManager(manager) {\n\t\tvar viewManager;\n\n\t\t// If manager is a string, try to load from imported managers\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\n\t\t\tviewManager = DefaultViewManager;\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\n\t\t\tviewManager = ContinuousViewManager;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tviewManager = manager;\n\t\t}\n\n\t\treturn viewManager;\n\t}\n\n\t/**\n\t * Require the view from passed string, or as a class function\n\t * @param  {string|object} view\n\t * @return {view}\n\t */\n\trequireView(view) {\n\t\tvar View;\n\n\t\t// If view is a string, try to load from imported views,\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\n\t\t\tView = IframeView;\n\t\t} else {\n\t\t\t// otherwise, assume we were passed a class function\n\t\t\tView = view;\n\t\t}\n\n\t\treturn View;\n\t}\n\n\t/**\n\t * Start the rendering\n\t * @return {Promise} rendering has started\n\t */\n\tstart(){\n\t\tif (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\n\t\t\tthis.settings.layout = \"pre-paginated\";\n\t\t}\n\t\tswitch(this.book.package.metadata.spread) {\n\t\t\tcase 'none':\n\t\t\t\tthis.settings.spread = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 'both':\n\t\t\t\tthis.settings.spread = true;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif(!this.manager) {\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\n\t\t\tthis.View = this.requireView(this.settings.view);\n\n\t\t\tthis.manager = new this.ViewManager({\n\t\t\t\tview: this.View,\n\t\t\t\tqueue: this.q,\n\t\t\t\trequest: this.book.load.bind(this.book),\n\t\t\t\tsettings: this.settings\n\t\t\t});\n\t\t}\n\n\t\tthis.direction(this.book.package.metadata.direction || this.settings.defaultDirection);\n\n\t\t// Parse metadata to get layout props\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\n\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\n\n\t\tthis.layout(this.settings.globalLayoutProperties);\n\n\t\t// Listen for displayed views\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\n\n\t\t// Listen for resizing\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, this.onResized.bind(this));\n\n\t\t// Listen for rotation\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\n\n\t\t// Listen for scroll changes\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\n\n\t\t/**\n\t\t * Emit that rendering has started\n\t\t * @event started\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\n\n\t\t// Start processing queue\n\t\tthis.starting.resolve();\n\t}\n\n\t/**\n\t * Call to attach the container to an element in the dom\n\t * Container must be attached before rendering can begin\n\t * @param  {element} element to attach to\n\t * @return {Promise}\n\t */\n\tattachTo(element){\n\n\t\treturn this.q.enqueue(function () {\n\n\t\t\t// Start rendering\n\t\t\tthis.manager.render(element, {\n\t\t\t\t\"width\"  : this.settings.width,\n\t\t\t\t\"height\" : this.settings.height\n\t\t\t});\n\n\t\t\t/**\n\t\t\t * Emit that rendering has attached to an element\n\t\t\t * @event attached\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\n\n\t\t}.bind(this));\n\n\t}\n\n\t/**\n\t * Display a point in the book\n\t * The request will be added to the rendering Queue,\n\t * so it will wait until book is opened, rendering started\n\t * and all other rendering tasks have finished to be called.\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\tdisplay(target){\n\t\tif (this.displaying) {\n\t\t\tthis.displaying.resolve();\n\t\t}\n\t\treturn this.q.enqueue(this._display, target);\n\t}\n\n\t/**\n\t * Tells the manager what to display immediately\n\t * @private\n\t * @param  {string} target Url or EpubCFI\n\t * @return {Promise}\n\t */\n\t_display(target){\n\t\tif (!this.book) {\n\t\t\treturn;\n\t\t}\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\n\t\tvar displaying = new defer();\n\t\tvar displayed = displaying.promise;\n\t\tvar section;\n\t\tvar moveTo;\n\n\t\tthis.displaying = displaying;\n\n\t\t// Check if this is a book percentage\n\t\tif (this.book.locations.length() && isFloat(target)) {\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\n\t\t}\n\n\t\tsection = this.book.spine.get(target);\n\n\t\tif(!section){\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\n\t\t\treturn displayed;\n\t\t}\n\n\t\tthis.manager.display(section, target)\n\t\t\t.then(() => {\n\t\t\t\tdisplaying.resolve(section);\n\t\t\t\tthis.displaying = undefined;\n\n\t\t\t\t/**\n\t\t\t\t * Emit that a section has been displayed\n\t\t\t\t * @event displayed\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\n\t\t\t\tthis.reportLocation();\n\t\t\t}, (err) => {\n\t\t\t\t/**\n\t\t\t\t * Emit that has been an error displaying\n\t\t\t\t * @event displayError\n\t\t\t\t * @param {Section} section\n\t\t\t\t * @memberof Rendition\n\t\t\t\t */\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\n\t\t\t});\n\n\t\treturn displayed;\n\t}\n\n\t/*\n\trender(view, show) {\n\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\n\t\tview.create();\n\n\t\t// Fit to size of the container, apply padding\n\t\tthis.manager.resizeView(view);\n\n\t\t// Render Chain\n\t\treturn view.section.render(this.book.request)\n\t\t\t.then(function(contents){\n\t\t\t\treturn view.load(contents);\n\t\t\t}.bind(this))\n\t\t\t.then(function(doc){\n\t\t\t\treturn this.hooks.content.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tthis.layout.format(view.contents);\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn view.display();\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\treturn this.hooks.render.trigger(view, this);\n\t\t\t}.bind(this))\n\t\t\t.then(function(){\n\t\t\t\tif(show !== false) {\n\t\t\t\t\tthis.q.enqueue(function(view){\n\t\t\t\t\t\tview.show();\n\t\t\t\t\t}, view);\n\t\t\t\t}\n\t\t\t\t// this.map = new Map(view, this.layout);\n\t\t\t\tthis.hooks.show.trigger(view, this);\n\t\t\t\tthis.trigger(\"rendered\", view.section);\n\n\t\t\t}.bind(this))\n\t\t\t.catch(function(e){\n\t\t\t\tthis.trigger(\"loaderror\", e);\n\t\t\t}.bind(this));\n\n\t}\n\t*/\n\n\t/**\n\t * Report what section has been displayed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterDisplayed(view){\n\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data) => this.triggerMarkEvent(cfiRange, data, view.contents));\n\n\t\tthis.hooks.render.trigger(view, this)\n\t\t\t.then(() => {\n\t\t\t\tif (view.contents) {\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Emit that a section has been rendered\n\t\t\t\t\t\t * @event rendered\n\t\t\t\t\t\t * @param {Section} section\n\t\t\t\t\t\t * @param {View} view\n\t\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t\t */\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\n\t\t\t\t}\n\t\t\t});\n\n\t}\n\n\t/**\n\t * Report what has been removed\n\t * @private\n\t * @param  {*} view\n\t */\n\tafterRemoved(view){\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\n\t\t\t/**\n\t\t\t * Emit that a section has been removed\n\t\t\t * @event removed\n\t\t\t * @param {Section} section\n\t\t\t * @param {View} view\n\t\t\t * @memberof Rendition\n\t\t\t */\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\n\t\t});\n\t}\n\n\t/**\n\t * Report resize events and display the last seen location\n\t * @private\n\t */\n\tonResized(size, epubcfi){\n\n\t\t/**\n\t\t * Emit that the rendition has been resized\n\t\t * @event resized\n\t\t * @param {number} width\n\t\t * @param {height} height\n\t\t * @param {string} epubcfi (optional)\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\n\t\t\twidth: size.width,\n\t\t\theight: size.height\n\t\t}, epubcfi);\n\n\t\tif (this.location && this.location.start) {\n\t\t\tthis.display(epubcfi || this.location.start.cfi);\n\t\t}\n\n\t}\n\n\t/**\n\t * Report orientation events and display the last seen location\n\t * @private\n\t */\n\tonOrientationChange(orientation){\n\t\t/**\n\t\t * Emit that the rendition has been rotated\n\t\t * @event orientationchange\n\t\t * @param {string} orientation\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\n\t}\n\n\t/**\n\t * Move the Rendition to a specific offset\n\t * Usually you would be better off calling display()\n\t * @param {object} offset\n\t */\n\tmoveTo(offset){\n\t\tthis.manager.moveTo(offset);\n\t}\n\n\t/**\n\t * Trigger a resize of the views\n\t * @param {number} [width]\n\t * @param {number} [height]\n\t * @param {string} [epubcfi] (optional)\n\t */\n\tresize(width, height, epubcfi){\n\t\tif (width) {\n\t\t\tthis.settings.width = width;\n\t\t}\n\t\tif (height) {\n\t\t\tthis.settings.height = height;\n\t\t}\n\t\tthis.manager.resize(width, height, epubcfi);\n\t}\n\n\t/**\n\t * Clear all rendered views\n\t */\n\tclear(){\n\t\tthis.manager.clear();\n\t}\n\n\t/**\n\t * Go to the next \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tnext(){\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t/**\n\t * Go to the previous \"page\" in the rendition\n\t * @return {Promise}\n\t */\n\tprev(){\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\n\t\t\t.then(this.reportLocation.bind(this));\n\t}\n\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\n\t/**\n\t * Determine the Layout properties from metadata and settings\n\t * @private\n\t * @param  {object} metadata\n\t * @return {object} properties\n\t */\n\tdetermineLayoutProperties(metadata){\n\t\tvar properties;\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\n\t\tvar viewport = metadata.viewport || \"\";\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 800;\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\n\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\n\t\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\n\t\t}\n\n\t\tproperties = {\n\t\t\tlayout : layout,\n\t\t\tspread : spread,\n\t\t\torientation : orientation,\n\t\t\tflow : flow,\n\t\t\tviewport : viewport,\n\t\t\tminSpreadWidth : minSpreadWidth,\n\t\t\tdirection: direction\n\t\t};\n\n\t\treturn properties;\n\t}\n\n\t/**\n\t * Adjust the flow of the rendition to paginated or scrolled\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\n\t * @param  {string} flow\n\t */\n\tflow(flow){\n\t\tvar _flow = flow;\n\t\tif (flow === \"scrolled\" ||\n\t\t\t\tflow === \"scrolled-doc\" ||\n\t\t\t\tflow === \"scrolled-continuous\") {\n\t\t\t_flow = \"scrolled\";\n\t\t}\n\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\n\t\t\t_flow = \"paginated\";\n\t\t}\n\n\t\tthis.settings.flow = flow;\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.flow(_flow);\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.updateFlow(_flow);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\n\t * @param  {object} settings\n\t */\n\tlayout(settings){\n\t\tif (settings) {\n\t\t\tthis._layout = new Layout(settings);\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\n\n\t\t\t// this.mapping = new Mapping(this._layout.props);\n\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\n\t\t\t})\n\t\t}\n\n\t\tif (this.manager && this._layout) {\n\t\t\tthis.manager.applyLayout(this._layout);\n\t\t}\n\n\t\treturn this._layout;\n\t}\n\n\t/**\n\t * Adjust if the rendition uses spreads\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\n\t * @param  {int} [min] min width to use spreads at\n\t */\n\tspread(spread, min){\n\n\t\tthis.settings.spread = spread;\n\n\t\tif (min) {\n\t\t\tthis.settings.minSpreadWidth = min;\n\t\t}\n\n\t\tif (this._layout) {\n\t\t\tthis._layout.spread(spread, min);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered()) {\n\t\t\tthis.manager.updateLayout();\n\t\t}\n\t}\n\n\t/**\n\t * Adjust the direction of the rendition\n\t * @param  {string} dir\n\t */\n\tdirection(dir){\n\n\t\tthis.settings.direction = dir || \"ltr\";\n\n\t\tif (this.manager) {\n\t\t\tthis.manager.direction(this.settings.direction);\n\t\t}\n\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\n\t\t\tthis.manager.clear();\n\t\t\tthis.display(this.location.start.cfi);\n\t\t}\n\t}\n\n\t/**\n\t * Report the current location\n\t * @fires relocated\n\t * @fires locationChanged\n\t */\n\treportLocation(){\n\t\treturn this.q.enqueue(function reportedLocation(){\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\n\t\t\t\tvar location = this.manager.currentLocation();\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\t\t\tlocation.then(function(result) {\n\t\t\t\t\t\tlet located = this.located(result);\n\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t\t}.bind(this));\n\t\t\t\t} else if (location) {\n\t\t\t\t\tlet located = this.located(location);\n\n\t\t\t\t\tif (!located || !located.start || !located.end) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.location = located;\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event locationChanged\n\t\t\t\t\t * @deprecated\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t * @property {number} index\n\t\t\t\t\t * @property {string} href\n\t\t\t\t\t * @property {EpubCFI} start\n\t\t\t\t\t * @property {EpubCFI} end\n\t\t\t\t\t * @property {number} percentage\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\n\t\t\t\t\t\tindex: this.location.start.index,\n\t\t\t\t\t\thref: this.location.start.href,\n\t\t\t\t\t\tstart: this.location.start.cfi,\n\t\t\t\t\t\tend: this.location.end.cfi,\n\t\t\t\t\t\tpercentage: this.location.start.percentage\n\t\t\t\t\t});\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @event relocated\n\t\t\t\t\t * @type {displayedLocation}\n\t\t\t\t\t * @memberof Rendition\n\t\t\t\t\t */\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\t/**\n\t * Get the Current Location object\n\t * @return {displayedLocation | promise} location (may be a promise)\n\t */\n\tcurrentLocation(){\n\t\tvar location = this.manager.currentLocation();\n\t\tif (location && location.then && typeof location.then === \"function\") {\n\t\t\tlocation.then(function(result) {\n\t\t\t\tlet located = this.located(result);\n\t\t\t\treturn located;\n\t\t\t}.bind(this));\n\t\t} else if (location) {\n\t\t\tlet located = this.located(location);\n\t\t\treturn located;\n\t\t}\n\t}\n\n\t/**\n\t * Creates a Rendition#locationRange from location\n\t * passed by the Manager\n\t * @returns {displayedLocation}\n\t * @private\n\t */\n\tlocated(location){\n\t\tif (!location.length) {\n\t\t\treturn {};\n\t\t}\n\t\tlet start = location[0];\n\t\tlet end = location[location.length-1];\n\n\t\tlet located = {\n\t\t\tstart: {\n\t\t\t\tindex: start.index,\n\t\t\t\thref: start.href,\n\t\t\t\tcfi: start.mapping.start,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: start.pages[0] || 1,\n\t\t\t\t\ttotal: start.totalPages\n\t\t\t\t}\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tindex: end.index,\n\t\t\t\thref: end.href,\n\t\t\t\tcfi: end.mapping.end,\n\t\t\t\tdisplayed: {\n\t\t\t\t\tpage: end.pages[end.pages.length-1] || 1,\n\t\t\t\t\ttotal: end.totalPages\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\n\n\t\tif (locationStart != null) {\n\t\t\tlocated.start.location = locationStart;\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\n\t\t}\n\t\tif (locationEnd != null) {\n\t\t\tlocated.end.location = locationEnd;\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\n\t\t}\n\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\n\n\t\tif (pageStart != -1) {\n\t\t\tlocated.start.page = pageStart;\n\t\t}\n\t\tif (pageEnd != -1) {\n\t\t\tlocated.end.page = pageEnd;\n\t\t}\n\n\t\tif (end.index === this.book.spine.last().index &&\n\t\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\n\t\t\tlocated.atEnd = true;\n\t\t}\n\n\t\tif (start.index === this.book.spine.first().index &&\n\t\t\t\tlocated.start.displayed.page === 1) {\n\t\t\tlocated.atStart = true;\n\t\t}\n\n\t\treturn located;\n\t}\n\n\t/**\n\t * Remove and Clean Up the Rendition\n\t */\n\tdestroy(){\n\t\t// Clear the queue\n\t\t// this.q.clear();\n\t\t// this.q = undefined;\n\n\t\tthis.manager && this.manager.destroy();\n\n\t\tthis.book = undefined;\n\n\t\t// this.views = null;\n\n\t\t// this.hooks.display.clear();\n\t\t// this.hooks.serialize.clear();\n\t\t// this.hooks.content.clear();\n\t\t// this.hooks.layout.clear();\n\t\t// this.hooks.render.clear();\n\t\t// this.hooks.show.clear();\n\t\t// this.hooks = {};\n\n\t\t// this.themes.destroy();\n\t\t// this.themes = undefined;\n\n\t\t// this.epubcfi = undefined;\n\n\t\t// this.starting = undefined;\n\t\t// this.started = undefined;\n\n\n\t}\n\n\t/**\n\t * Pass the events from a view's Contents\n\t * @private\n\t * @param  {Contents} view contents\n\t */\n\tpassEvents(contents){\n\t\tDOM_EVENTS.forEach((e) => {\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\n\t\t});\n\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\n\t}\n\n\t/**\n\t * Emit events passed by a view\n\t * @private\n\t * @param  {event} e\n\t */\n\ttriggerViewEvent(e, contents){\n\t\tthis.emit(e.type, e, contents);\n\t}\n\n\t/**\n\t * Emit a selection event's CFI Range passed from a a view\n\t * @private\n\t * @param  {string} cfirange\n\t */\n\ttriggerSelectedEvent(cfirange, contents){\n\t\t/**\n\t\t * Emit that a text selection has occurred\n\t\t * @event selected\n\t\t * @param {string} cfirange\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\n\t}\n\n\t/**\n\t * Emit a markClicked event with the cfiRange and data from a mark\n\t * @private\n\t * @param  {EpubCFI} cfirange\n\t */\n\ttriggerMarkEvent(cfiRange, data, contents){\n\t\t/**\n\t\t * Emit that a mark was clicked\n\t\t * @event markClicked\n\t\t * @param {EpubCFI} cfirange\n\t\t * @param {object} data\n\t\t * @param {Contents} contents\n\t\t * @memberof Rendition\n\t\t */\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents);\n\t}\n\n\t/**\n\t * Get a Range from a Visible CFI\n\t * @param  {string} cfi EpubCfi String\n\t * @param  {string} ignoreClass\n\t * @return {range}\n\t */\n\tgetRange(cfi, ignoreClass){\n\t\tvar _cfi = new EpubCFI(cfi);\n\t\tvar found = this.manager.visible().filter(function (view) {\n\t\t\tif(_cfi.spinePos === view.index) return true;\n\t\t});\n\n\t\t// Should only every return 1 item\n\t\tif (found.length) {\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\n\t\t}\n\t}\n\n\t/**\n\t * Hook to adjust images to fit in columns\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\tadjustImages(contents) {\n\n\t\tif (this._layout.name === \"pre-paginated\") {\n\t\t\treturn new Promise(function(resolve){\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom))) * .95;\n\t\tlet horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\n\n\t\tcontents.addStylesheetRules({\n\t\t\t\"img\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"object-fit\": \"contain\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\",\n\t\t\t\t\"box-sizing\": \"border-box\"\n\t\t\t},\n\t\t\t\"svg\" : {\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\n\t\t\t\t\"page-break-inside\": \"avoid\",\n\t\t\t\t\"break-inside\": \"avoid\"\n\t\t\t}\n\t\t});\n\n\t\treturn new Promise(function(resolve, reject){\n\t\t\t// Wait to apply\n\t\t\tsetTimeout(function() {\n\t\t\t\tresolve();\n\t\t\t}, 1);\n\t\t});\n\t}\n\n\t/**\n\t * Get the Contents object of each rendered view\n\t * @returns {Contents[]}\n\t */\n\tgetContents () {\n\t\treturn this.manager ? this.manager.getContents() : [];\n\t}\n\n\t/**\n\t * Get the views member from the manager\n\t * @returns {Views}\n\t */\n\tviews () {\n\t\tlet views = this.manager ? this.manager.views : undefined;\n\t\treturn views || [];\n\t}\n\n\t/**\n\t * Hook to handle link clicks in rendered content\n\t * @param  {Contents} contents\n\t * @private\n\t */\n\thandleLinks(contents) {\n\t\tif (contents) {\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\n\t\t\t\tlet relative = this.book.path.relative(href);\n\t\t\t\tthis.display(relative);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Hook to handle injecting stylesheet before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectStylesheet(doc, section) {\n\t\tlet style = doc.createElement(\"link\");\n\t\tstyle.setAttribute(\"type\", \"text/css\");\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\n\t}\n\n\t/**\n\t * Hook to handle injecting scripts before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectScript(doc, section) {\n\t\tlet script = doc.createElement(\"script\");\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", this.settings.script);\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\n\t}\n\n\t/**\n\t * Hook to handle the document identifier before\n\t * a Section is serialized\n\t * @param  {document} doc\n\t * @param  {Section} section\n\t * @private\n\t */\n\tinjectIdentifier(doc, section) {\n\t\tlet ident = this.book.packaging.metadata.identifier;\n\t\tlet meta = doc.createElement(\"meta\");\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\n\t\tif (ident) {\n\t\t\tmeta.setAttribute(\"content\", ident);\n\t\t}\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\n\t}\n\n}\n\n//-- Enable binding events to Renderer\nEventEmitter(Rendition.prototype);\n\nexport default Rendition;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}